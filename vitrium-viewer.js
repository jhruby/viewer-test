/*
  version: 1.1.412
  build time: 2016-09-22T17:13:45.214000
 The MIT License: Copyright (c) 2010-2012 LiosK.
*/
(function(I,r){function R(a){var c=a.length,b=s.type(a);return s.isWindow(a)?!1:1===a.nodeType&&c?!0:"array"===b||"function"!==b&&(0===c||"number"==typeof c&&0<c&&c-1 in a)}function fa(a){var c=La[a]={};return s.each(a.match(ha)||[],function(a,b){c[b]=!0}),c}function N(a,c,b,d){if(s.acceptData(a)){var g,k,t=s.expando,e="string"==typeof c,f=a.nodeType,w=f?s.cache:a,l=f?a[t]:a[t]&&t;if(l&&w[l]&&(d||w[l].data)||!e||b!==r)return l||(f?a[t]=l=X.pop()||s.guid++:l=t),w[l]||(w[l]={},f||(w[l].toJSON=s.noop)),
("object"==typeof c||"function"==typeof c)&&(d?w[l]=s.extend(w[l],c):w[l].data=s.extend(w[l].data,c)),g=w[l],d||(g.data||(g.data={}),g=g.data),b!==r&&(g[s.camelCase(c)]=b),e?(k=g[c],null==k&&(k=g[s.camelCase(c)])):k=g,k}}function q(a,c,b){if(s.acceptData(a)){var d,g,k,t=a.nodeType,e=t?s.cache:a,f=t?a[s.expando]:s.expando;if(e[f]){if(c&&(k=b?e[f]:e[f].data)){s.isArray(c)?c=c.concat(s.map(c,s.camelCase)):c in k?c=[c]:(c=s.camelCase(c),c=c in k?[c]:c.split(" "));d=0;for(g=c.length;g>d;d++)delete k[c[d]];
if(!(b?p:s.isEmptyObject)(k))return}(b||(delete e[f].data,p(e[f])))&&(t?s.cleanData([a],!0):s.support.deleteExpando||e!=e.window?delete e[f]:e[f]=null)}}}function m(c,a,b){if(b===r&&1===c.nodeType){var d="data-"+a.replace(Cb,"-$1").toLowerCase();if(b=c.getAttribute(d),"string"==typeof b){try{b="true"===b?!0:"false"===b?!1:"null"===b?null:+b+""===b?+b:Va.test(b)?s.parseJSON(b):b}catch(g){}s.data(c,a,b)}else b=r}return b}function p(c){for(var a in c)if(("data"!==a||!s.isEmptyObject(c[a]))&&"toJSON"!==
a)return!1;return!0}function h(){return!0}function n(){return!1}function l(c,a){do c=c[a];while(c&&1!==c.nodeType);return c}function f(c,a,b){if(a=a||0,s.isFunction(a))return s.grep(c,function(c,d){return!!a.call(c,d,c)===b});if(a.nodeType)return s.grep(c,function(c){return c===a===b});if("string"==typeof a){var d=s.grep(c,function(c){return 1===c.nodeType});if(xa.test(a))return s.filter(a,d,!b);a=s.filter(a,d)}return s.grep(c,function(c){return 0<=s.inArray(c,a)===b})}function b(c){var a=ib.split("|");
c=c.createDocumentFragment();if(c.createElement)for(;a.length;)c.createElement(a.pop());return c}function a(c){var a=c.getAttributeNode("type");return c.type=(a&&a.specified)+"/"+c.type,c}function e(c){var a=Db.exec(c.type);return a?c.type=a[1]:c.removeAttribute("type"),c}function k(c,a){for(var b,d=0;null!=(b=c[d]);d++)s._data(b,"globalEval",!a||s._data(a[d],"globalEval"))}function c(c,a){if(1===a.nodeType&&s.hasData(c)){var b,d,g;d=s._data(c);var k=s._data(a,d),t=d.events;if(t)for(b in delete k.handle,
k.events={},t)for(d=0,g=t[b].length;g>d;d++)s.event.add(a,b,t[b][d]);k.data&&(k.data=s.extend({},k.data))}}function g(c,a){var b,d,k=0,t=typeof c.getElementsByTagName!==S?c.getElementsByTagName(a||"*"):typeof c.querySelectorAll!==S?c.querySelectorAll(a||"*"):r;if(!t)for(t=[],b=c.childNodes||c;null!=(d=b[k]);k++)!a||s.nodeName(d,a)?t.push(d):s.merge(t,g(d,a));return a===r||a&&s.nodeName(c,a)?s.merge([c],t):t}function d(c){Wa.test(c.type)&&(c.defaultChecked=c.checked)}function t(c,a){if(a in c)return a;
for(var b=a.charAt(0).toUpperCase()+a.slice(1),d=a,g=jb.length;g--;)if(a=jb[g]+b,a in c)return a;return d}function y(c,a){return c=a||c,"none"===s.css(c,"display")||!s.contains(c.ownerDocument,c)}function v(c,a){for(var b,d,g,k=[],t=0,e=c.length;e>t;t++)d=c[t],d.style&&(k[t]=s._data(d,"olddisplay"),b=d.style.display,a?(k[t]||"none"!==b||(d.style.display=""),""===d.style.display&&y(d)&&(k[t]=s._data(d,"olddisplay",E(d.nodeName)))):k[t]||(g=y(d),(b&&"none"!==b||!g)&&s._data(d,"olddisplay",g?b:s.css(d,
"display"))));for(t=0;e>t;t++)d=c[t],d.style&&(a&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=a?k[t]||"":"none"));return c}function A(c,a,b){return(c=Eb.exec(a))?Math.max(0,c[1]-(b||0))+(c[2]||"px"):a}function z(c,a,b,d,g){a=b===(d?"border":"content")?4:"width"===a?1:0;for(var k=0;4>a;a+=2)"margin"===b&&(k+=s.css(c,b+sa[a],!0,g)),d?("content"===b&&(k-=s.css(c,"padding"+sa[a],!0,g)),"margin"!==b&&(k-=s.css(c,"border"+sa[a]+"Width",!0,g))):(k+=s.css(c,"padding"+sa[a],!0,g),"padding"!==
b&&(k+=s.css(c,"border"+sa[a]+"Width",!0,g)));return k}function D(c,a,b){var d=!0,g="width"===a?c.offsetWidth:c.offsetHeight,k=ta(c),t=s.support.boxSizing&&"border-box"===s.css(c,"boxSizing",!1,k);if(0>=g||null==g){if(g=ua(c,a,k),(0>g||null==g)&&(g=c.style[a]),Ma.test(g))return g;d=t&&(s.support.boxSizingReliable||g===c.style[a]);g=parseFloat(g)||0}return g+z(c,a,b||(t?"border":"content"),d,k)+"px"}function E(c){var a=M,b=kb[c];return b||(b=u(c,a),"none"!==b&&b||(Ca=(Ca||s("<iframe frameborder='0' width='0' height='0'/>").css("cssText",
"display:block !important")).appendTo(a.documentElement),a=(Ca[0].contentWindow||Ca[0].contentDocument).document,a.write("<!doctype html><html><body>"),a.close(),b=u(c,a),Ca.detach()),kb[c]=b),b}function u(c,a){var b=s(a.createElement(c)).appendTo(a.body),d=s.css(b[0],"display");return b.remove(),d}function w(c,a,b,d){var g;if(s.isArray(a))s.each(a,function(a,g){b||Fb.test(c)?d(c,g):w(c+"["+("object"==typeof g?a:"")+"]",g,b,d)});else if(b||"object"!==s.type(a))d(c,a);else for(g in a)w(c+"["+g+"]",
a[g],b,d)}function x(c){return function(a,b){"string"!=typeof a&&(b=a,a="*");var d,g=0,k=a.toLowerCase().match(ha)||[];if(s.isFunction(b))for(;d=k[g++];)"+"===d[0]?(d=d.slice(1)||"*",(c[d]=c[d]||[]).unshift(b)):(c[d]=c[d]||[]).push(b)}}function G(c,a,b,d){function g(e){var f;return k[e]=!0,s.each(c[e]||[],function(c,e){var w=e(a,b,d);return"string"!=typeof w||t||k[w]?t?!(f=w):r:(a.dataTypes.unshift(w),g(w),!1)}),f}var k={},t=c===Xa;return g(a.dataTypes[0])||!k["*"]&&g("*")}function B(c,a){var b,d,
g=s.ajaxSettings.flatOptions||{};for(d in a)a[d]!==r&&((g[d]?c:b||(b={}))[d]=a[d]);return b&&s.extend(!0,c,b),c}function C(){try{return new I.XMLHttpRequest}catch(c){}}function J(){return setTimeout(function(){ya=r}),ya=s.now()}function O(c,a){s.each(a,function(a,b){for(var d=(Da[a]||[]).concat(Da["*"]),g=0,k=d.length;k>g&&!d[g].call(c,a,b);g++);})}function Q(c,a,b){var d,g=0,k=Na.length,t=s.Deferred().always(function(){delete e.elem}),e=function(){if(d)return!1;for(var a=ya||J(),a=Math.max(0,f.startTime+
f.duration-a),b=1-(a/f.duration||0),g=0,k=f.tweens.length;k>g;g++)f.tweens[g].run(b);return t.notifyWith(c,[f,b,a]),1>b&&k?a:(t.resolveWith(c,[f]),!1)},f=t.promise({elem:c,props:s.extend({},a),opts:s.extend(!0,{specialEasing:{}},b),originalProperties:a,originalOptions:b,startTime:ya||J(),duration:b.duration,tweens:[],createTween:function(a,b){var d=s.Tween(c,f.opts,a,b,f.opts.specialEasing[a]||f.opts.easing);return f.tweens.push(d),d},stop:function(a){var b=0,g=a?f.tweens.length:0;if(d)return this;
for(d=!0;g>b;b++)f.tweens[b].run(1);return a?t.resolveWith(c,[f,a]):t.rejectWith(c,[f,a]),this}});b=f.props;for(K(b,f.opts.specialEasing);k>g;g++)if(a=Na[g].call(f,c,b,f.opts))return a;return O(f,b),s.isFunction(f.opts.start)&&f.opts.start.call(c,f),s.fx.timer(s.extend(e,{elem:c,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function K(a,c){var b,d,g,k,t;for(g in a)if(d=s.camelCase(g),k=c[d],b=a[g],s.isArray(b)&&(k=
b[1],b=a[g]=b[0]),g!==d&&(a[d]=b,delete a[g]),t=s.cssHooks[d],t&&"expand"in t)for(g in b=t.expand(b),delete a[d],b)g in a||(a[g]=b[g],c[g]=k);else c[d]=k}function F(a,c,b,d,g){return new F.prototype.init(a,c,b,d,g)}function L(a,c){var b,d={height:a},g=0;for(c=c?1:0;4>g;g+=2-c)b=sa[g],d["margin"+b]=d["padding"+b]=a;return c&&(d.opacity=d.width=a),d}function H(a){return s.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var ba,T,S=typeof r,M=I.document,Y=I.location,aa=I.jQuery,V=I.$,P=
{},X=[],Z=X.concat,U=X.push,ea=X.slice,Ea=X.indexOf,ma=P.toString,ga=P.hasOwnProperty,na="1.9.1".trim,s=function(a,c){return new s.fn.init(a,c,T)},oa=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ha=/\S+/g,Oa=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,Pa=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,Fa=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Qa=/^[\],:{}\s]*$/,Ga=/(?:^|:|,)(?:\s*\[)+/g,va=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Ra=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,ja=/^-ms-/,Ya=/-([\da-z])/gi,ka=
function(a,c){return c.toUpperCase()},la=function(a){(M.addEventListener||"load"===a.type||"complete"===M.readyState)&&(ca(),s.ready())},ca=function(){M.addEventListener?(M.removeEventListener("DOMContentLoaded",la,!1),I.removeEventListener("load",la,!1)):(M.detachEvent("onreadystatechange",la),I.detachEvent("onload",la))};s.fn=s.prototype={jquery:"1.9.1",constructor:s,init:function(a,c,b){var d,g;if(!a)return this;if("string"==typeof a){if(d="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?
[null,a,null]:Pa.exec(a),!d||!d[1]&&c)return!c||c.jquery?(c||b).find(a):this.constructor(c).find(a);if(d[1]){if(c=c instanceof s?c[0]:c,s.merge(this,s.parseHTML(d[1],c&&c.nodeType?c.ownerDocument||c:M,!0)),Fa.test(d[1])&&s.isPlainObject(c))for(d in c)s.isFunction(this[d])?this[d](c[d]):this.attr(d,c[d]);return this}if(g=M.getElementById(d[2]),g&&g.parentNode){if(g.id!==d[2])return b.find(a);this.length=1;this[0]=g}return this.context=M,this.selector=a,this}return a.nodeType?(this.context=this[0]=
a,this.length=1,this):s.isFunction(a)?b.ready(a):(a.selector!==r&&(this.selector=a.selector,this.context=a.context),s.makeArray(a,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return ea.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){a=s.merge(this.constructor(),a);return a.prevObject=this,a.context=this.context,a},each:function(a,c){return s.each(this,a,c)},ready:function(a){return s.ready.promise().done(a),
this},slice:function(){return this.pushStack(ea.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var c=this.length;a=+a+(0>a?c:0);return this.pushStack(0<=a&&c>a?[this[a]]:[])},map:function(a){return this.pushStack(s.map(this,function(c,b){return a.call(c,b,c)}))},end:function(){return this.prevObject||this.constructor(null)},push:U,sort:[].sort,splice:[].splice};s.fn.init.prototype=s.fn;s.extend=s.fn.extend=function(){var a,c,b,d,g,k,
t=arguments[0]||{},e=1,f=arguments.length,w=!1;"boolean"==typeof t&&(w=t,t=arguments[1]||{},e=2);"object"==typeof t||s.isFunction(t)||(t={});for(f===e&&(t=this,--e);f>e;e++)if(null!=(g=arguments[e]))for(d in g)a=t[d],b=g[d],t!==b&&(w&&b&&(s.isPlainObject(b)||(c=s.isArray(b)))?(c?(c=!1,k=a&&s.isArray(a)?a:[]):k=a&&s.isPlainObject(a)?a:{},t[d]=s.extend(w,k,b)):b!==r&&(t[d]=b));return t};s.extend({noConflict:function(a){return I.$===s&&(I.$=V),a&&I.jQuery===s&&(I.jQuery=aa),s},isReady:!1,readyWait:1,
holdReady:function(a){a?s.readyWait++:s.ready(!0)},ready:function(a){if(!0===a?!--s.readyWait:!s.isReady){if(!M.body)return setTimeout(s.ready);s.isReady=!0;!0!==a&&0<--s.readyWait||(ba.resolveWith(M,[s]),s.fn.trigger&&s(M).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===s.type(a)},isArray:Array.isArray||function(a){return"array"===s.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==
a?a+"":"object"==typeof a||"function"==typeof a?P[ma.call(a)]||"object":typeof a},isPlainObject:function(a){if(!a||"object"!==s.type(a)||a.nodeType||s.isWindow(a))return!1;try{if(a.constructor&&!ga.call(a,"constructor")&&!ga.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var b in a);return b===r||ga.call(a,b)},isEmptyObject:function(a){for(var c in a)return!1;return!0},error:function(a){throw Error(a);},parseHTML:function(a,c,b){if(!a||"string"!=typeof a)return null;
"boolean"==typeof c&&(b=c,c=!1);c=c||M;var d=Fa.exec(a);b=!b&&[];return d?[c.createElement(d[1])]:(d=s.buildFragment([a],c,b),b&&s(b).remove(),s.merge([],d.childNodes))},parseJSON:function(a){return I.JSON&&I.JSON.parse?I.JSON.parse(a):null===a?a:"string"==typeof a&&(a=s.trim(a),a&&Qa.test(a.replace(va,"@").replace(Ra,"]").replace(Ga,"")))?Function("return "+a)():(s.error("Invalid JSON: "+a),r)},parseXML:function(a){var c,b;if(!a||"string"!=typeof a)return null;try{I.DOMParser?(b=new DOMParser,c=
b.parseFromString(a,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a))}catch(d){c=r}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||s.error("Invalid XML: "+a),c},noop:function(){},globalEval:function(a){a&&s.trim(a)&&(I.execScript||function(a){I.eval.call(I,a)})(a)},camelCase:function(a){return a.replace(ja,"ms-").replace(Ya,ka)},nodeName:function(a,c){return a.nodeName&&a.nodeName.toLowerCase()===c.toLowerCase()},each:function(a,c,b){var d,
g=0,k=a.length,t=R(a);if(b)if(t)for(;k>g&&(d=c.apply(a[g],b),!1!==d);g++);else for(g in a){if(d=c.apply(a[g],b),!1===d)break}else if(t)for(;k>g&&(d=c.call(a[g],g,a[g]),!1!==d);g++);else for(g in a)if(d=c.call(a[g],g,a[g]),!1===d)break;return a},trim:na&&!na.call("\ufeff\u00a0")?function(a){return null==a?"":na.call(a)}:function(a){return null==a?"":(a+"").replace(Oa,"")},makeArray:function(a,c){var b=c||[];return null!=a&&(R(Object(a))?s.merge(b,"string"==typeof a?[a]:a):U.call(b,a)),b},inArray:function(a,
c,b){var d;if(c){if(Ea)return Ea.call(c,a,b);d=c.length;for(b=b?0>b?Math.max(0,d+b):b:0;d>b;b++)if(b in c&&c[b]===a)return b}return-1},merge:function(a,c){var b=c.length,d=a.length,g=0;if("number"==typeof b)for(;b>g;g++)a[d++]=c[g];else for(;c[g]!==r;)a[d++]=c[g++];return a.length=d,a},grep:function(a,c,b){var d,g=[],k=0,t=a.length;for(b=!!b;t>k;k++)d=!!c(a[k],k),b!==d&&g.push(a[k]);return g},map:function(a,c,b){var d,g=0,k=a.length,t=[];if(R(a))for(;k>g;g++)d=c(a[g],g,b),null!=d&&(t[t.length]=d);
else for(g in a)d=c(a[g],g,b),null!=d&&(t[t.length]=d);return Z.apply([],t)},guid:1,proxy:function(a,c){var b,d,g;return"string"==typeof c&&(g=a[c],c=a,a=g),s.isFunction(a)?(b=ea.call(arguments,2),d=function(){return a.apply(c||this,b.concat(ea.call(arguments)))},d.guid=a.guid=a.guid||s.guid++,d):r},access:function(a,c,b,d,g,k,t){var e=0,f=a.length,w=null==b;if("object"===s.type(b))for(e in g=!0,b)s.access(a,c,e,b[e],!0,k,t);else if(d!==r&&(g=!0,s.isFunction(d)||(t=!0),w&&(t?(c.call(a,d),c=null):
(w=c,c=function(a,c,b){return w.call(s(a),b)})),c))for(;f>e;e++)c(a[e],b,t?d:d.call(a[e],e,c(a[e],b)));return g?a:w?c.call(a):f?c(a[0],b):k},now:function(){return(new Date).getTime()}});s.ready.promise=function(a){if(!ba)if(ba=s.Deferred(),"complete"===M.readyState)setTimeout(s.ready);else if(M.addEventListener)M.addEventListener("DOMContentLoaded",la,!1),I.addEventListener("load",la,!1);else{M.attachEvent("onreadystatechange",la);I.attachEvent("onload",la);var c=!1;try{c=null==I.frameElement&&M.documentElement}catch(b){}c&&
c.doScroll&&function Bb(){if(!s.isReady){try{c.doScroll("left")}catch(a){return setTimeout(Bb,50)}ca();s.ready()}}()}return ba.promise(a)};s.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,c){P["[object "+c+"]"]=c.toLowerCase()});T=s(M);var La={};s.Callbacks=function(a){a="string"==typeof a?La[a]||fa(a):s.extend({},a);var c,b,d,g,k,t,e=[],f=!a.once&&[],w=function(v){b=a.memory&&v;d=!0;k=t||0;t=0;g=e.length;for(c=!0;e&&g>k;k++)if(!1===e[k].apply(v[0],v[1])&&
a.stopOnFalse){b=!1;break}c=!1;e&&(f?f.length&&w(f.shift()):b?e=[]:l.disable())},l={add:function(){if(e){var d=e.length;(function Gb(c){s.each(c,function(c,b){var d=s.type(b);"function"===d?a.unique&&l.has(b)||e.push(b):b&&b.length&&"string"!==d&&Gb(b)})})(arguments);c?g=e.length:b&&(t=d,w(b))}return this},remove:function(){return e&&s.each(arguments,function(a,b){for(var d;-1<(d=s.inArray(b,e,d));)e.splice(d,1),c&&(g>=d&&g--,k>=d&&k--)}),this},has:function(a){return a?-1<s.inArray(a,e):!(!e||!e.length)},
empty:function(){return e=[],this},disable:function(){return e=f=b=r,this},disabled:function(){return!e},lock:function(){return f=r,b||l.disable(),this},locked:function(){return!f},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],!e||d&&!f||(c?f.push(b):w(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!d}};return l};s.extend({Deferred:function(a){var c=[["resolve","done",s.Callbacks("once memory"),"resolved"],["reject","fail",s.Callbacks("once memory"),
"rejected"],["notify","progress",s.Callbacks("memory")]],b="pending",d={state:function(){return b},always:function(){return g.done(arguments).fail(arguments),this},then:function(){var a=arguments;return s.Deferred(function(b){s.each(c,function(c,k){var t=k[0],e=s.isFunction(a[c])&&a[c];g[k[1]](function(){var a=e&&e.apply(this,arguments);a&&s.isFunction(a.promise)?a.promise().done(b.resolve).fail(b.reject).progress(b.notify):b[t+"With"](this===d?b.promise():this,e?[a]:arguments)})});a=null}).promise()},
promise:function(a){return null!=a?s.extend(a,d):d}},g={};return d.pipe=d.then,s.each(c,function(a,k){var t=k[2],e=k[3];d[k[1]]=t.add;e&&t.add(function(){b=e},c[1^a][2].disable,c[2][2].lock);g[k[0]]=function(){return g[k[0]+"With"](this===g?d:this,arguments),this};g[k[0]+"With"]=t.fireWith}),d.promise(g),a&&a.call(g,g),g},when:function(a){var c=0,b=ea.call(arguments),d=b.length,g=1!==d||a&&s.isFunction(a.promise)?d:0,k=1===g?a:s.Deferred(),t=function(a,c,b){return function(d){c[a]=this;b[a]=1<arguments.length?
ea.call(arguments):d;b===e?k.notifyWith(c,b):--g||k.resolveWith(c,b)}},e,f,w;if(1<d)for(e=Array(d),f=Array(d),w=Array(d);d>c;c++)b[c]&&s.isFunction(b[c].promise)?b[c].promise().done(t(c,w,b)).fail(k.reject).progress(t(c,f,e)):--g;return g||k.resolveWith(w,b),k.promise()}});s.support=function(){var a,c,b,d,g,k,t,e=M.createElement("div");if(e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=e.getElementsByTagName("*"),b=e.getElementsByTagName("a")[0],
!c||!b||!c.length)return{};d=M.createElement("select");g=d.appendChild(M.createElement("option"));c=e.getElementsByTagName("input")[0];b.style.cssText="top:1px;float:left;opacity:.5";a={getSetAttribute:"t"!==e.className,leadingWhitespace:3===e.firstChild.nodeType,tbody:!e.getElementsByTagName("tbody").length,htmlSerialize:!!e.getElementsByTagName("link").length,style:/top/.test(b.getAttribute("style")),hrefNormalized:"/a"===b.getAttribute("href"),opacity:/^0.5/.test(b.style.opacity),cssFloat:!!b.style.cssFloat,
checkOn:!!c.value,optSelected:g.selected,enctype:!!M.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==M.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===M.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};c.checked=!0;a.noCloneChecked=c.cloneNode(!0).checked;d.disabled=!0;a.optDisabled=!g.disabled;try{delete e.test}catch(f){a.deleteExpando=!1}c=M.createElement("input");
c.setAttribute("value","");a.input=""===c.getAttribute("value");c.value="t";c.setAttribute("type","radio");a.radioValue="t"===c.value;c.setAttribute("checked","t");c.setAttribute("name","t");b=M.createDocumentFragment();b.appendChild(c);a.appendChecked=c.checked;a.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked;e.attachEvent&&(e.attachEvent("onclick",function(){a.noCloneEvent=!1}),e.cloneNode(!0).click());for(t in{submit:!0,change:!0,focusin:!0})e.setAttribute(b="on"+t,"t"),a[t+"Bubbles"]=
b in I||!1===e.attributes[b].expando;return e.style.backgroundClip="content-box",e.cloneNode(!0).style.backgroundClip="",a.clearCloneStyle="content-box"===e.style.backgroundClip,s(function(){var c,b,d,g=M.getElementsByTagName("body")[0];g&&(c=M.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(e),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",d=e.getElementsByTagName("td"),d[0].style.cssText=
"padding:0;margin:0;border:0;display:none",k=0===d[0].offsetHeight,d[0].style.display="",d[1].style.display="none",a.reliableHiddenOffsets=k&&0===d[0].offsetHeight,e.innerHTML="",e.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",a.boxSizing=4===e.offsetWidth,a.doesNotIncludeMarginInBodyOffset=1!==g.offsetTop,I.getComputedStyle&&(a.pixelPosition="1%"!==(I.getComputedStyle(e,
null)||{}).top,a.boxSizingReliable="4px"===(I.getComputedStyle(e,null)||{width:"4px"}).width,b=e.appendChild(M.createElement("div")),b.style.cssText=e.style.cssText="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",b.style.marginRight=b.style.width="0",e.style.width="1px",a.reliableMarginRight=!parseFloat((I.getComputedStyle(b,null)||{}).marginRight)),typeof e.style.zoom!==S&&(e.innerHTML="",e.style.cssText="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;width:1px;padding:1px;display:inline;zoom:1",
a.inlineBlockNeedsLayout=3===e.offsetWidth,e.style.display="block",e.innerHTML="<div></div>",e.firstChild.style.width="5px",a.shrinkWrapBlocks=3!==e.offsetWidth,a.inlineBlockNeedsLayout&&(g.style.zoom=1)),g.removeChild(c),e=null)}),c=d=b=g=b=c=null,a}();var Va=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Cb=/([A-Z])/g;s.extend({cache:{},expando:"jQuery"+("1.9.1"+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?
s.cache[a[s.expando]]:a[s.expando],!!a&&!p(a)},data:function(a,c,b){return N(a,c,b)},removeData:function(a,c){return q(a,c)},_data:function(a,c,b){return N(a,c,b,!0)},_removeData:function(a,c){return q(a,c,!0)},acceptData:function(a){if(a.nodeType&&1!==a.nodeType&&9!==a.nodeType)return!1;var c=a.nodeName&&s.noData[a.nodeName.toLowerCase()];return!c||!0!==c&&a.getAttribute("classid")===c}});s.fn.extend({data:function(a,c){var b,d,g=this[0],k=0,e=null;if(a===r){if(this.length&&(e=s.data(g),1===g.nodeType&&
!s._data(g,"parsedAttrs"))){for(b=g.attributes;b.length>k;k++)d=b[k].name,d.indexOf("data-")||(d=s.camelCase(d.slice(5)),m(g,d,e[d]));s._data(g,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){s.data(this,a)}):s.access(this,function(c){return c===r?g?m(g,a,s.data(g,a)):null:(this.each(function(){s.data(this,a,c)}),r)},null,c,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){s.removeData(this,a)})}});s.extend({queue:function(a,c,b){var d;return a?
(c=(c||"fx")+"queue",d=s._data(a,c),b&&(!d||s.isArray(b)?d=s._data(a,c,s.makeArray(b)):d.push(b)),d||[]):r},dequeue:function(a,c){c=c||"fx";var b=s.queue(a,c),d=b.length,g=b.shift(),k=s._queueHooks(a,c),e=function(){s.dequeue(a,c)};"inprogress"===g&&(g=b.shift(),d--);(k.cur=g)&&("fx"===c&&b.unshift("inprogress"),delete k.stop,g.call(a,e,k));!d&&k&&k.empty.fire()},_queueHooks:function(a,c){var b=c+"queueHooks";return s._data(a,b)||s._data(a,b,{empty:s.Callbacks("once memory").add(function(){s._removeData(a,
c+"queue");s._removeData(a,b)})})}});s.fn.extend({queue:function(a,c){var b=2;return"string"!=typeof a&&(c=a,a="fx",b--),b>arguments.length?s.queue(this[0],a):c===r?this:this.each(function(){var b=s.queue(this,a,c);s._queueHooks(this,a);"fx"===a&&"inprogress"!==b[0]&&s.dequeue(this,a)})},dequeue:function(a){return this.each(function(){s.dequeue(this,a)})},delay:function(a,c){return a=s.fx?s.fx.speeds[a]||a:a,c=c||"fx",this.queue(c,function(c,b){var d=setTimeout(c,a);b.stop=function(){clearTimeout(d)}})},
clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var b,d=1,g=s.Deferred(),k=this,e=this.length,t=function(){--d||g.resolveWith(k,[k])};"string"!=typeof a&&(c=a,a=r);for(a=a||"fx";e--;)(b=s._data(k[e],a+"queueHooks"))&&b.empty&&(d++,b.empty.add(t));return t(),g.promise(c)}});var za,lb,Za=/[\t\r\n]/g,Hb=/\r/g,Ib=/^(?:input|select|textarea|button|object)$/i,Jb=/^(?:a|area)$/i,mb=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,
$a=/^(?:checked|selected)$/i,da=s.support.getSetAttribute,Ha=s.support.input;s.fn.extend({attr:function(a,c){return s.access(this,s.attr,a,c,1<arguments.length)},removeAttr:function(a){return this.each(function(){s.removeAttr(this,a)})},prop:function(a,c){return s.access(this,s.prop,a,c,1<arguments.length)},removeProp:function(a){return a=s.propFix[a]||a,this.each(function(){try{this[a]=r,delete this[a]}catch(c){}})},addClass:function(a){var c,b,d,g,k,e=0,t=this.length;c="string"==typeof a&&a;if(s.isFunction(a))return this.each(function(c){s(this).addClass(a.call(this,
c,this.className))});if(c)for(c=(a||"").match(ha)||[];t>e;e++)if(b=this[e],d=1===b.nodeType&&(b.className?(" "+b.className+" ").replace(Za," "):" ")){for(k=0;g=c[k++];)0>d.indexOf(" "+g+" ")&&(d+=g+" ");b.className=s.trim(d)}return this},removeClass:function(a){var c,b,d,g,k,e=0,t=this.length;c=0===arguments.length||"string"==typeof a&&a;if(s.isFunction(a))return this.each(function(c){s(this).removeClass(a.call(this,c,this.className))});if(c)for(c=(a||"").match(ha)||[];t>e;e++)if(b=this[e],d=1===
b.nodeType&&(b.className?(" "+b.className+" ").replace(Za," "):"")){for(k=0;g=c[k++];)for(;0<=d.indexOf(" "+g+" ");)d=d.replace(" "+g+" "," ");b.className=a?s.trim(d):""}return this},toggleClass:function(a,c){var b=typeof a,d="boolean"==typeof c;return s.isFunction(a)?this.each(function(b){s(this).toggleClass(a.call(this,b,this.className,c),c)}):this.each(function(){if("string"===b)for(var g,k=0,e=s(this),t=c,f=a.match(ha)||[];g=f[k++];)t=d?t:!e.hasClass(g),e[t?"addClass":"removeClass"](g);else(b===
S||"boolean"===b)&&(this.className&&s._data(this,"__className__",this.className),this.className=this.className||!1===a?"":s._data(this,"__className__")||"")})},hasClass:function(a){a=" "+a+" ";for(var c=0,b=this.length;b>c;c++)if(1===this[c].nodeType&&0<=(" "+this[c].className+" ").replace(Za," ").indexOf(a))return!0;return!1},val:function(a){var c,b,d,g=this[0];if(arguments.length)return d=s.isFunction(a),this.each(function(c){var g,k=s(this);1===this.nodeType&&(g=d?a.call(this,c,k.val()):a,null==
g?g="":"number"==typeof g?g+="":s.isArray(g)&&(g=s.map(g,function(a){return null==a?"":a+""})),b=s.valHooks[this.type]||s.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&b.set(this,g,"value")!==r||(this.value=g))});if(g)return b=s.valHooks[g.type]||s.valHooks[g.nodeName.toLowerCase()],b&&"get"in b&&(c=b.get(g,"value"))!==r?c:(c=g.value,"string"==typeof c?c.replace(Hb,""):null==c?"":c)}});s.extend({valHooks:{option:{get:function(a){var c=a.attributes.value;return!c||c.specified?a.value:a.text}},
select:{get:function(a){for(var c,b=a.options,d=a.selectedIndex,g="select-one"===a.type||0>d,k=g?null:[],e=g?d+1:b.length,t=0>d?e:g?d:0;e>t;t++)if(c=b[t],!(!c.selected&&t!==d||(s.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&s.nodeName(c.parentNode,"optgroup"))){if(a=s(c).val(),g)return a;k.push(a)}return k},set:function(a,c){var b=s.makeArray(c);return s(a).find("option").each(function(){this.selected=0<=s.inArray(s(this).val(),b)}),b.length||(a.selectedIndex=
-1),b}}},attr:function(a,c,b){var d,g,k,e=a.nodeType;if(a&&3!==e&&8!==e&&2!==e)return typeof a.getAttribute===S?s.prop(a,c,b):(g=1!==e||!s.isXMLDoc(a),g&&(c=c.toLowerCase(),d=s.attrHooks[c]||(mb.test(c)?lb:za)),b===r?d&&g&&"get"in d&&null!==(k=d.get(a,c))?k:(typeof a.getAttribute!==S&&(k=a.getAttribute(c)),null==k?r:k):null!==b?d&&g&&"set"in d&&(k=d.set(a,b,c))!==r?k:(a.setAttribute(c,b+""),b):(s.removeAttr(a,c),r))},removeAttr:function(a,c){var b,d,g=0,k=c&&c.match(ha);if(k&&1===a.nodeType)for(;b=
k[g++];)d=s.propFix[b]||b,mb.test(b)?!da&&$a.test(b)?a[s.camelCase("default-"+b)]=a[d]=!1:a[d]=!1:s.attr(a,b,""),a.removeAttribute(da?b:d)},attrHooks:{type:{set:function(a,c){if(!s.support.radioValue&&"radio"===c&&s.nodeName(a,"input")){var b=a.value;return a.setAttribute("type",c),b&&(a.value=b),c}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",
frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,b){var d,g,k,e=a.nodeType;if(a&&3!==e&&8!==e&&2!==e)return k=1!==e||!s.isXMLDoc(a),k&&(c=s.propFix[c]||c,g=s.propHooks[c]),b!==r?g&&"set"in g&&(d=g.set(a,b,c))!==r?d:a[c]=b:g&&"get"in g&&null!==(d=g.get(a,c))?d:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):Ib.test(a.nodeName)||Jb.test(a.nodeName)&&a.href?0:r}}}});lb={get:function(a,c){var b=s.prop(a,
c),d="boolean"==typeof b&&a.getAttribute(c);return(b="boolean"==typeof b?Ha&&da?null!=d:$a.test(c)?a[s.camelCase("default-"+c)]:!!d:a.getAttributeNode(c))&&!1!==b.value?c.toLowerCase():r},set:function(a,c,b){return!1===c?s.removeAttr(a,b):Ha&&da||!$a.test(b)?a.setAttribute(!da&&s.propFix[b]||b,b):a[s.camelCase("default-"+b)]=a[b]=!0,b}};Ha&&da||(s.attrHooks.value={get:function(a,c){var b=a.getAttributeNode(c);return s.nodeName(a,"input")?a.defaultValue:b&&b.specified?b.value:r},set:function(a,c,b){return s.nodeName(a,
"input")?(a.defaultValue=c,r):za&&za.set(a,c,b)}});da||(za=s.valHooks.button={get:function(a,c){var b=a.getAttributeNode(c);return b&&("id"===c||"name"===c||"coords"===c?""!==b.value:b.specified)?b.value:r},set:function(a,c,b){var d=a.getAttributeNode(b);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(b)),d.value=c+="","value"===b||c===a.getAttribute(b)?c:r}},s.attrHooks.contenteditable={get:za.get,set:function(a,c,b){za.set(a,""===c?!1:c,b)}},s.each(["width","height"],function(a,c){s.attrHooks[c]=
s.extend(s.attrHooks[c],{set:function(a,b){return""===b?(a.setAttribute(c,"auto"),b):r}})}));s.support.hrefNormalized||(s.each(["href","src","width","height"],function(a,c){s.attrHooks[c]=s.extend(s.attrHooks[c],{get:function(a){a=a.getAttribute(c,2);return null==a?r:a}})}),s.each(["href","src"],function(a,c){s.propHooks[c]={get:function(a){return a.getAttribute(c,4)}}}));s.support.style||(s.attrHooks.style={get:function(a){return a.style.cssText||r},set:function(a,c){return a.style.cssText=c+""}});
s.support.optSelected||(s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(a){a=a.parentNode;return a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex),null}}));s.support.enctype||(s.propFix.enctype="encoding");s.support.checkOn||s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}});s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(a,c){return s.isArray(c)?
a.checked=0<=s.inArray(s(a).val(),c):r}})});var pa=/^(?:input|select|textarea)$/i,Ia=/^key/,qa=/^(?:mouse|contextmenu)|click/,Aa=/^(?:focusinfocus|focusoutblur)$/,Sa=/^([^.]*)(?:\.(.+)|)$/;s.event={global:{},add:function(a,c,b,d,g){var k,e,t,f,w,l,v,h,y;if(t=s._data(a)){b.handler&&(f=b,b=f.handler,g=f.selector);b.guid||(b.guid=s.guid++);(e=t.events)||(e=t.events={});(w=t.handle)||(w=t.handle=function(a){return typeof s===S||a&&s.event.triggered===a.type?r:s.event.dispatch.apply(w.elem,arguments)},
w.elem=a);c=(c||"").match(ha)||[""];for(t=c.length;t--;)k=Sa.exec(c[t])||[],h=l=k[1],y=(k[2]||"").split(".").sort(),k=s.event.special[h]||{},h=(g?k.delegateType:k.bindType)||h,k=s.event.special[h]||{},l=s.extend({type:h,origType:l,data:d,handler:b,guid:b.guid,selector:g,needsContext:g&&s.expr.match.needsContext.test(g),namespace:y.join(".")},f),(v=e[h])||(v=e[h]=[],v.delegateCount=0,k.setup&&!1!==k.setup.call(a,d,y,w)||(a.addEventListener?a.addEventListener(h,w,!1):a.attachEvent&&a.attachEvent("on"+
h,w))),k.add&&(k.add.call(a,l),l.handler.guid||(l.handler.guid=b.guid)),g?v.splice(v.delegateCount++,0,l):v.push(l),s.event.global[h]=!0;a=null}},remove:function(a,c,b,d,g){var k,e,t,f,w,l,v,h,y,n,A,x=s.hasData(a)&&s._data(a);if(x&&(l=x.events)){c=(c||"").match(ha)||[""];for(w=c.length;w--;)if(t=Sa.exec(c[w])||[],y=A=t[1],n=(t[2]||"").split(".").sort(),y){v=s.event.special[y]||{};y=(d?v.delegateType:v.bindType)||y;h=l[y]||[];t=t[2]&&RegExp("(^|\\.)"+n.join("\\.(?:.*\\.|)")+"(\\.|$)");for(f=k=h.length;k--;)e=
h[k],!g&&A!==e.origType||b&&b.guid!==e.guid||t&&!t.test(e.namespace)||d&&d!==e.selector&&("**"!==d||!e.selector)||(h.splice(k,1),e.selector&&h.delegateCount--,v.remove&&v.remove.call(a,e));f&&!h.length&&(v.teardown&&!1!==v.teardown.call(a,n,x.handle)||s.removeEvent(a,y,x.handle),delete l[y])}else for(y in l)s.event.remove(a,y+c[w],b,d,!0);s.isEmptyObject(l)&&(delete x.handle,s._removeData(a,"events"))}},trigger:function(a,c,b,d){var g,k,e,t,f,w,l=[b||M],v=ga.call(a,"type")?a.type:a;w=ga.call(a,"namespace")?
a.namespace.split("."):[];if(e=g=b=b||M,3!==b.nodeType&&8!==b.nodeType&&!Aa.test(v+s.event.triggered)&&(0<=v.indexOf(".")&&(w=v.split("."),v=w.shift(),w.sort()),k=0>v.indexOf(":")&&"on"+v,a=a[s.expando]?a:new s.Event(v,"object"==typeof a&&a),a.isTrigger=!0,a.namespace=w.join("."),a.namespace_re=a.namespace?RegExp("(^|\\.)"+w.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a.result=r,a.target||(a.target=b),c=null==c?[a]:s.makeArray(c,[a]),f=s.event.special[v]||{},d||!f.trigger||!1!==f.trigger.apply(b,c))){if(!d&&
!f.noBubble&&!s.isWindow(b)){t=f.delegateType||v;for(Aa.test(t+v)||(e=e.parentNode);e;e=e.parentNode)l.push(e),g=e;g===(b.ownerDocument||M)&&l.push(g.defaultView||g.parentWindow||I)}for(w=0;(e=l[w++])&&!a.isPropagationStopped();)a.type=1<w?t:f.bindType||v,(g=(s._data(e,"events")||{})[a.type]&&s._data(e,"handle"))&&g.apply(e,c),(g=k&&e[k])&&s.acceptData(e)&&g.apply&&!1===g.apply(e,c)&&a.preventDefault();if(a.type=v,!(d||a.isDefaultPrevented()||f._default&&!1!==f._default.apply(b.ownerDocument,c)||
"click"===v&&s.nodeName(b,"a"))&&s.acceptData(b)&&k&&b[v]&&!s.isWindow(b)){(g=b[k])&&(b[k]=null);s.event.triggered=v;try{b[v]()}catch(h){}s.event.triggered=r;g&&(b[k]=g)}return a.result}},dispatch:function(a){a=s.event.fix(a);var c,b,d,g,k,e=[],t=ea.call(arguments);c=(s._data(this,"events")||{})[a.type]||[];var f=s.event.special[a.type]||{};if(t[0]=a,a.delegateTarget=this,!f.preDispatch||!1!==f.preDispatch.call(this,a)){e=s.event.handlers.call(this,a,c);for(c=0;(g=e[c++])&&!a.isPropagationStopped();)for(a.currentTarget=
g.elem,k=0;(d=g.handlers[k++])&&!a.isImmediatePropagationStopped();)a.namespace_re&&!a.namespace_re.test(d.namespace)||(a.handleObj=d,a.data=d.data,b=((s.event.special[d.origType]||{}).handle||d.handler).apply(g.elem,t),b===r||!1!==(a.result=b)||(a.preventDefault(),a.stopPropagation()));return f.postDispatch&&f.postDispatch.call(this,a),a.result}},handlers:function(a,c){var b,d,g,k,e=[],t=c.delegateCount,f=a.target;if(t&&f.nodeType&&(!a.button||"click"!==a.type))for(;f!=this;f=f.parentNode||this)if(1===
f.nodeType&&(!0!==f.disabled||"click"!==a.type)){g=[];for(k=0;t>k;k++)d=c[k],b=d.selector+" ",g[b]===r&&(g[b]=d.needsContext?0<=s(b,this).index(f):s.find(b,this,null,[f]).length),g[b]&&g.push(d);g.length&&e.push({elem:f,handlers:g})}return c.length>t&&e.push({elem:this,handlers:c.slice(t)}),e},fix:function(a){if(a[s.expando])return a;var c,b,d;c=a.type;var g=a,k=this.fixHooks[c];k||(this.fixHooks[c]=k=qa.test(c)?this.mouseHooks:Ia.test(c)?this.keyHooks:{});d=k.props?this.props.concat(k.props):this.props;
a=new s.Event(g);for(c=d.length;c--;)b=d[c],a[b]=g[b];return a.target||(a.target=g.srcElement||M),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,k.filter?k.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(a,c){return null==a.which&&(a.which=null!=c.charCode?c.charCode:c.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
filter:function(a,c){var b,d,g,k=c.button,e=c.fromElement;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||M,g=d.documentElement,b=d.body,a.pageX=c.clientX+(g&&g.scrollLeft||b&&b.scrollLeft||0)-(g&&g.clientLeft||b&&b.clientLeft||0),a.pageY=c.clientY+(g&&g.scrollTop||b&&b.scrollTop||0)-(g&&g.clientTop||b&&b.clientTop||0)),!a.relatedTarget&&e&&(a.relatedTarget=e===a.target?c.toElement:e),a.which||k===r||(a.which=1&k?1:2&k?3:4&k?2:0),a}},special:{load:{noBubble:!0},click:{trigger:function(){return s.nodeName(this,
"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):r}},focus:{trigger:function(){if(this!==M.activeElement&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===M.activeElement&&this.blur?(this.blur(),!1):r},delegateType:"focusout"},beforeunload:{postDispatch:function(a){a.result!==r&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,c,b,d){a=s.extend(new s.Event,b,{type:a,isSimulated:!0,originalEvent:{}});d?s.event.trigger(a,
null,c):s.event.dispatch.call(c,a);a.isDefaultPrevented()&&b.preventDefault()}};s.removeEvent=M.removeEventListener?function(a,c,b){a.removeEventListener&&a.removeEventListener(c,b,!1)}:function(a,c,b){c="on"+c;a.detachEvent&&(typeof a[c]===S&&(a[c]=null),a.detachEvent(c,b))};s.Event=function(a,c){return this instanceof s.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?h:n):this.type=
a,c&&s.extend(this,c),this.timeStamp=a&&a.timeStamp||s.now(),this[s.expando]=!0,r):new s.Event(a,c)};s.Event.prototype={isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=h;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=h;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=
h;this.stopPropagation()}};s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,c){s.event.special[a]={delegateType:c,bindType:c,handle:function(a){var b,d=a.relatedTarget,g=a.handleObj;return(!d||d!==this&&!s.contains(this,d))&&(a.type=g.origType,b=g.handler.apply(this,arguments),a.type=c),b}}});s.support.submitBubbles||(s.event.special.submit={setup:function(){return s.nodeName(this,"form")?!1:(s.event.add(this,"click._submit keypress._submit",function(a){a=a.target;(a=s.nodeName(a,
"input")||s.nodeName(a,"button")?a.form:r)&&!s._data(a,"submitBubbles")&&(s.event.add(a,"submit._submit",function(a){a._submit_bubble=!0}),s._data(a,"submitBubbles",!0))}),r)},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&s.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return s.nodeName(this,"form")?!1:(s.event.remove(this,"._submit"),r)}});s.support.changeBubbles||(s.event.special.change={setup:function(){return pa.test(this.nodeName)?
(("checkbox"===this.type||"radio"===this.type)&&(s.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),s.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1);s.event.simulate("change",this,a,!0)})),!1):(s.event.add(this,"beforeactivate._change",function(a){a=a.target;pa.test(a.nodeName)&&!s._data(a,"changeBubbles")&&(s.event.add(a,"change._change",function(a){!this.parentNode||a.isSimulated||
a.isTrigger||s.event.simulate("change",this.parentNode,a,!0)}),s._data(a,"changeBubbles",!0))}),r)},handle:function(a){var c=a.target;return this!==c||a.isSimulated||a.isTrigger||"radio"!==c.type&&"checkbox"!==c.type?a.handleObj.handler.apply(this,arguments):r},teardown:function(){return s.event.remove(this,"._change"),!pa.test(this.nodeName)}});s.support.focusinBubbles||s.each({focus:"focusin",blur:"focusout"},function(a,c){var b=0,d=function(a){s.event.simulate(c,a.target,s.event.fix(a),!0)};s.event.special[c]=
{setup:function(){0===b++&&M.addEventListener(a,d,!0)},teardown:function(){0===--b&&M.removeEventListener(a,d,!0)}}});s.fn.extend({on:function(a,c,b,d,g){var k,e;if("object"==typeof a){"string"!=typeof c&&(b=b||c,c=r);for(k in a)this.on(k,c,b,a[k],g);return this}if(null==b&&null==d?(d=c,b=c=r):null==d&&("string"==typeof c?(d=b,b=r):(d=b,b=c,c=r)),!1===d)d=n;else if(!d)return this;return 1===g&&(e=d,d=function(a){return s().off(a),e.apply(this,arguments)},d.guid=e.guid||(e.guid=s.guid++)),this.each(function(){s.event.add(this,
a,d,b,c)})},one:function(a,c,b,d){return this.on(a,c,b,d,1)},off:function(a,c,b){var d,g;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,s(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(g in a)this.off(g,c,a[g]);return this}return(!1===c||"function"==typeof c)&&(b=c,c=r),!1===b&&(b=n),this.each(function(){s.event.remove(this,a,b,c)})},bind:function(a,c,b){return this.on(a,null,c,b)},unbind:function(a,c){return this.off(a,
null,c)},delegate:function(a,c,b,d){return this.on(c,a,b,d)},undelegate:function(a,c,b){return 1===arguments.length?this.off(a,"**"):this.off(c,a||"**",b)},trigger:function(a,c){return this.each(function(){s.event.trigger(a,c,this)})},triggerHandler:function(a,c){var b=this[0];return b?s.event.trigger(a,c,b,!0):r}});(function(a,c){function b(a){return Sa.test(a+"")}function d(){var a,c=[];return a=function(b,d){return c.push(b+=" ")>u.cacheLength&&delete a[c.shift()],a[b]=d}}function g(a){return a[H]=
!0,a}function k(a){var c=r.createElement("div");try{return a(c)}catch(b){return!1}finally{}}function e(a,c,b,d){var g,k,t,f,w;if((c?c.ownerDocument||c:ca)!==r&&E(c),c=c||r,b=b||[],!a||"string"!=typeof a)return b;if(1!==(f=c.nodeType)&&9!==f)return[];if(!K&&!d){if(g=Va.exec(a))if(t=g[1])if(9===f){if(k=c.getElementById(t),!k||!k.parentNode)return b;if(k.id===t)return b.push(k),b}else{if(c.ownerDocument&&(k=c.ownerDocument.getElementById(t))&&M(c,k)&&k.id===t)return b.push(k),b}else{if(g[2])return qa.apply(b,
ma.call(c.getElementsByTagName(a),0)),b;if((t=g[3])&&da.getByClassName&&c.getElementsByClassName)return qa.apply(b,ma.call(c.getElementsByClassName(t),0)),b}if(da.qsa&&!T.test(a)){if(g=!0,k=H,t=c,w=9===f&&a,1===f&&"object"!==c.nodeName.toLowerCase()){f=v(a);(g=c.getAttribute("id"))?k=g.replace(Z,"\\$&"):c.setAttribute("id",k);k="[id='"+k+"'] ";for(t=f.length;t--;)f[t]=k+h(f[t]);t=Aa.test(a)&&c.parentNode||c;w=f.join(",")}if(w)try{return qa.apply(b,ma.call(t.querySelectorAll(w),0)),b}catch(l){}finally{g||
c.removeAttribute("id")}}}var y;a:{a=a.replace(pa,"$1");var n,A;k=v(a);if(!d&&1===k.length){if(y=k[0]=k[0].slice(0),2<y.length&&"ID"===(n=y[0]).type&&9===c.nodeType&&!K&&u.relative[y[1].type]){if(c=u.find.ID(n.matches[0].replace(ka,U),c)[0],!c){y=b;break a}a=a.slice(y.shift().value.length)}for(f=xa.needsContext.test(a)?0:y.length;f--&&(n=y[f],!u.relative[g=n.type]);)if((A=u.find[g])&&(d=A(n.matches[0].replace(ka,U),Aa.test(y[0].type)&&c.parentNode||c))){if(y.splice(f,1),a=d.length&&h(y),!a){y=(qa.apply(b,
ma.call(d,0)),b);break a}break}}y=(J(a,k)(d,c,K,b,Aa.test(a)),b)}return y}function t(a,c){var b=c&&a,d=b&&(~c.sourceIndex||ba)-(~a.sourceIndex||ba);if(d)return d;if(b)for(;b=b.nextSibling;)if(b===c)return-1;return a?1:-1}function f(a){return function(c){return"input"===c.nodeName.toLowerCase()&&c.type===a}}function w(a){return function(c){var b=c.nodeName.toLowerCase();return("input"===b||"button"===b)&&c.type===a}}function l(a){return g(function(c){return c=+c,g(function(b,d){for(var g,k=a([],b.length,
c),e=k.length;e--;)b[g=k[e]]&&(b[g]=!(d[g]=b[g]))})})}function v(a,c){var b,d,g,k,t,f,w;if(t=Ea[a+" "])return c?0:t.slice(0);t=a;f=[];for(w=u.preFilter;t;){b&&!(d=I.exec(t))||(d&&(t=t.slice(d[0].length)||t),f.push(g=[]));b=!1;(d=X.exec(t))&&(b=d.shift(),g.push({value:b,type:d[0].replace(pa," ")}),t=t.slice(b.length));for(k in u.filter)!(d=xa[k].exec(t))||w[k]&&!(d=w[k](d))||(b=d.shift(),g.push({value:b,type:k,matches:d}),t=t.slice(b.length));if(!b)break}return c?t.length:t?e.error(a):Ea(a,f).slice(0)}
function h(a){for(var c=0,b=a.length,d="";b>c;c++)d+=a[c].value;return d}function y(a,c,b){var d=c.dir,g=b&&"parentNode"===d,k=Y++;return c.first?function(c,b,k){for(;c=c[d];)if(1===c.nodeType||g)return a(c,b,k)}:function(c,b,e){var t,f,w,l=ea+" "+k;if(e)for(;c=c[d];){if((1===c.nodeType||g)&&a(c,b,e))return!0}else for(;c=c[d];)if(1===c.nodeType||g)if(w=c[H]||(c[H]={}),(f=w[d])&&f[0]===l){if(!0===(t=f[1])||t===G)return!0===t}else if(f=w[d]=[l],f[1]=a(c,b,e)||G,!0===f[1])return!0}}function n(a){return 1<
a.length?function(c,b,d){for(var g=a.length;g--;)if(!a[g](c,b,d))return!1;return!0}:a[0]}function A(a,c,b,d,g){for(var k,e=[],t=0,f=a.length,w=null!=c;f>t;t++)(k=a[t])&&(!b||b(k,d,g))&&(e.push(k),w&&c.push(t));return e}function x(a,c,b,d,k,t){return d&&!d[H]&&(d=x(d)),k&&!k[H]&&(k=x(k,t)),g(function(g,t,f,w){var l,v,h=[],y=[],n=t.length,x;if(!(x=g)){x=c||"*";for(var m=f.nodeType?[f]:f,z=[],p=0,u=m.length;u>p;p++)e(x,m[p],z);x=z}x=!a||!g&&c?x:A(x,h,a,f,w);m=b?k||(g?a:n||d)?[]:t:x;if(b&&b(x,m,f,w),
d)for(l=A(m,y),d(l,[],f,w),f=l.length;f--;)(v=l[f])&&(m[y[f]]=!(x[y[f]]=v));if(g){if(k||a){if(k){l=[];for(f=m.length;f--;)(v=m[f])&&l.push(x[f]=v);k(null,m=[],l,w)}for(f=m.length;f--;)(v=m[f])&&-1<(l=k?Ia.call(g,v):h[f])&&(g[l]=!(t[l]=v))}}else m=A(m===t?m.splice(n,m.length):m),k?k(null,t,m,w):qa.apply(t,m)})}function m(a){var c,b,d,g=a.length,k=u.relative[a[0].type];b=k||u.relative[" "];for(var e=k?1:0,t=y(function(a){return a===c},b,!0),f=y(function(a){return-1<Ia.call(c,a)},b,!0),w=[function(a,
b,d){return!k&&(d||b!==B)||((c=b).nodeType?t(a,b,d):f(a,b,d))}];g>e;e++)if(b=u.relative[a[e].type])w=[y(n(w),b)];else{if(b=u.filter[a[e].type].apply(null,a[e].matches),b[H]){for(d=++e;g>d&&!u.relative[a[d].type];d++);return x(1<e&&n(w),1<e&&h(a.slice(0,e-1)).replace(pa,"$1"),b,d>e&&m(a.slice(e,d)),g>d&&m(a=a.slice(d)),g>d&&h(a))}w.push(b)}return n(w)}function z(a,c){var b=0,d=0<c.length,k=0<a.length,t=function(g,t,f,w,l){var v,h,y=[],n=0,m="0",x=g&&[],z=null!=l,p=B,C=g||k&&u.find.TAG("*",l&&t.parentNode||
t),q=ea+=null==p?1:Math.random()||0.1;for(z&&(B=t!==r&&t,G=b);null!=(l=C[m]);m++){if(k&&l){for(v=0;h=a[v++];)if(h(l,t,f)){w.push(l);break}z&&(ea=q,G=++b)}d&&((l=!h&&l)&&n--,g&&x.push(l))}if(n+=m,d&&m!==n){for(v=0;h=c[v++];)h(x,y,t,f);if(g){if(0<n)for(;m--;)x[m]||y[m]||(y[m]=Ha.call(w));y=A(y)}qa.apply(w,y);z&&!g&&0<y.length&&1<n+c.length&&e.uniqueSort(w)}return z&&(ea=q,B=p),x};return d?g(t):t}function p(){}var C,G,u,q,D,J,O,B,E,r,Q,K,T,F,S,M,L,H="sizzle"+-new Date,ca=a.document,da={},ea=0,Y=0,ga=
d(),Ea=d(),aa=d(),V=typeof c,ba=-2147483648,P=[],Ha=P.pop,qa=P.push,ma=P.slice,Ia=P.indexOf||function(a){for(var c=0,b=this.length;b>c;c++)if(this[c]===a)return c;return-1},P="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w#"),na="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+P+")|)|)[\\x20\\t\\r\\n\\f]*\\]",Ja=":((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+
na.replace(3,8)+")*)|.*)\\)|)",pa=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,I=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,X=/^[\x20\t\r\n\f]*([\x20\t\r\n\f>+~])[\x20\t\r\n\f]*/,oa=RegExp(Ja),ab=RegExp("^"+P+"$"),xa={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[\w-]|[^\x00-\xa0])+)['"]?\]/,TAG:RegExp("^("+"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:RegExp("^"+na),PSEUDO:RegExp("^"+Ja),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)",
"i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Aa=/[\x20\t\r\n\f]*[+~]/,Sa=/^[^{]+\{\s*\[native code/,Va=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ha=/^(?:input|select|textarea|button)$/i,La=/^h\d$/i,Z=/'|\\/g,Ta=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,ka=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,U=function(a,c){var b="0x"+c-65536;return b!==b?c:0>b?String.fromCharCode(b+65536):
String.fromCharCode(55296|b>>10,56320|1023&b)};try{ma.call(ca.documentElement.childNodes,0)[0].nodeType}catch(la){ma=function(a){for(var c,b=[];c=this[a++];)b.push(c);return b}}D=e.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1};E=e.setDocument=function(a){var d=a?a.ownerDocument||a:ca;return d!==r&&9===d.nodeType&&d.documentElement?(r=d,Q=d.documentElement,K=D(d),da.tagNameNoComments=k(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),
da.attributes=k(function(a){a.innerHTML="<select></select>";a=typeof a.lastChild.getAttribute("multiple");return"boolean"!==a&&"string"!==a}),da.getByClassName=k(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",a.getElementsByClassName&&a.getElementsByClassName("e").length?(a.lastChild.className="e",2===a.getElementsByClassName("e").length):!1}),da.getByName=k(function(a){a.id=H+0;a.innerHTML="<a name='"+H+"'></a><div name='"+H+"'></div>";Q.insertBefore(a,Q.firstChild);
var c=d.getElementsByName&&d.getElementsByName(H).length===2+d.getElementsByName(H+0).length;return da.getIdNotName=!d.getElementById(H),Q.removeChild(a),c}),u.attrHandle=k(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==V&&"#"===a.firstChild.getAttribute("href")})?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},da.getIdNotName?(u.find.ID=function(a,c){if(typeof c.getElementById!==V&&!K){var b=
c.getElementById(a);return b&&b.parentNode?[b]:[]}},u.filter.ID=function(a){var c=a.replace(ka,U);return function(a){return a.getAttribute("id")===c}}):(u.find.ID=function(a,b){if(typeof b.getElementById!==V&&!K){var d=b.getElementById(a);return d?d.id===a||typeof d.getAttributeNode!==V&&d.getAttributeNode("id").value===a?[d]:c:[]}},u.filter.ID=function(a){var c=a.replace(ka,U);return function(a){return(a=typeof a.getAttributeNode!==V&&a.getAttributeNode("id"))&&a.value===c}}),u.find.TAG=da.tagNameNoComments?
function(a,b){return typeof b.getElementsByTagName!==V?b.getElementsByTagName(a):c}:function(a,c){var b,d=[],g=0,k=c.getElementsByTagName(a);if("*"===a){for(;b=k[g++];)1===b.nodeType&&d.push(b);return d}return k},u.find.NAME=da.getByName&&function(a,b){return typeof b.getElementsByName!==V?b.getElementsByName(name):c},u.find.CLASS=da.getByClassName&&function(a,b){return typeof b.getElementsByClassName===V||K?c:b.getElementsByClassName(a)},F=[],T=[":focus"],(da.qsa=b(d.querySelectorAll))&&(k(function(a){a.innerHTML=
"<select><option selected=''></option></select>";a.querySelectorAll("[selected]").length||T.push("\\[[\\x20\\t\\r\\n\\f]*(?:checked|disabled|ismap|multiple|readonly|selected|value)");a.querySelectorAll(":checked").length||T.push(":checked")}),k(function(a){a.innerHTML="<input type='hidden' i=''/>";a.querySelectorAll("[i^='']").length&&T.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:\"\"|'')");a.querySelectorAll(":enabled").length||T.push(":enabled",":disabled");a.querySelectorAll("*,:x");T.push(",.*:")})),(da.matchesSelector=
b(S=Q.matchesSelector||Q.mozMatchesSelector||Q.webkitMatchesSelector||Q.oMatchesSelector||Q.msMatchesSelector))&&k(function(a){da.disconnectedMatch=S.call(a,"div");S.call(a,"[s!='']:x");F.push("!=",Ja)}),T=RegExp(T.join("|")),F=RegExp(F.join("|")),M=b(Q.contains)||Q.compareDocumentPosition?function(a,c){var b=9===a.nodeType?a.documentElement:a,d=c&&c.parentNode;return a===d||!(!d||1!==d.nodeType||!(b.contains?b.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,c){if(c)for(;c=
c.parentNode;)if(c===a)return!0;return!1},L=Q.compareDocumentPosition?function(a,c){var b;return a===c?(O=!0,0):(b=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c))?1&b||a.parentNode&&11===a.parentNode.nodeType?a===d||M(ca,a)?-1:c===d||M(ca,c)?1:0:4&b?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var b,g=0;b=a.parentNode;var k=c.parentNode,e=[a],f=[c];if(a===c)return O=!0,0;if(!b||!k)return a===d?-1:c===d?1:b?-1:k?1:0;if(b===k)return t(a,c);for(b=a;b=b.parentNode;)e.unshift(b);
for(b=c;b=b.parentNode;)f.unshift(b);for(;e[g]===f[g];)g++;return g?t(e[g],f[g]):e[g]===ca?-1:f[g]===ca?1:0},O=!1,[0,0].sort(L),da.detectDuplicates=O,r):r};e.matches=function(a,c){return e(a,null,null,c)};e.matchesSelector=function(a,c){if((a.ownerDocument||a)!==r&&E(a),c=c.replace(Ta,"='$1']"),da.matchesSelector&&!(K||F&&F.test(c)||T.test(c)))try{var b=S.call(a,c);if(b||da.disconnectedMatch||a.document&&11!==a.document.nodeType)return b}catch(d){}return 0<e(c,r,null,[a]).length};e.contains=function(a,
c){return(a.ownerDocument||a)!==r&&E(a),M(a,c)};e.attr=function(a,c){var b;return(a.ownerDocument||a)!==r&&E(a),K||(c=c.toLowerCase()),(b=u.attrHandle[c])?b(a):K||da.attributes?a.getAttribute(c):((b=a.getAttributeNode(c))||a.getAttribute(c))&&!0===a[c]?c:b&&b.specified?b.value:null};e.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};e.uniqueSort=function(a){var c,b=[],d=1,g=0;if(O=!da.detectDuplicates,a.sort(L),O){for(;c=a[d];d++)c===a[d-1]&&(g=b.push(d));for(;g--;)a.splice(b[g],
1)}return a};q=e.getText=function(a){var c,b="",d=0;if(c=a.nodeType)if(1===c||9===c||11===c){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)b+=q(a)}else{if(3===c||4===c)return a.nodeValue}else for(;c=a[d];d++)b+=q(c);return b};u=e.selectors={cacheLength:50,createPseudo:g,match:xa,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=
a[1].replace(ka,U),a[3]=(a[4]||a[5]||"").replace(ka,U),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||e.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&e.error(a[0]),a},PSEUDO:function(a){var c,b=!a[5]&&a[2];return xa.CHILD.test(a[0])?null:(a[4]?a[2]=a[4]:b&&oa.test(b)&&(c=v(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(a[0]=a[0].slice(0,c),a[2]=b.slice(0,
c)),a.slice(0,3))}},filter:{TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(ka,U).toLowerCase(),function(c){return c.nodeName&&c.nodeName.toLowerCase()===a})},CLASS:function(a){var c=ga[a+" "];return c||(c=RegExp("(^|[\\x20\\t\\r\\n\\f])"+a+"([\\x20\\t\\r\\n\\f]|$)"))&&ga(a,function(a){return c.test(a.className||typeof a.getAttribute!==V&&a.getAttribute("class")||"")})},ATTR:function(a,c,b){return function(d){d=e.attr(d,a);return null==d?"!="===c:c?(d+="","="===c?d===b:"!="===c?d!==
b:"^="===c?b&&0===d.indexOf(b):"*="===c?b&&-1<d.indexOf(b):"$="===c?b&&d.slice(-b.length)===b:"~="===c?-1<(" "+d+" ").indexOf(b):"|="===c?d===b||d.slice(0,b.length+1)===b+"-":!1):!0}},CHILD:function(a,c,b,d,g){var k="nth"!==a.slice(0,3),e="last"!==a.slice(-4),t="of-type"===c;return 1===d&&0===g?function(a){return!!a.parentNode}:function(c,b,f){var w,l,v,h,y;b=k!==e?"nextSibling":"previousSibling";var n=c.parentNode,A=t&&c.nodeName.toLowerCase();f=!f&&!t;if(n){if(k){for(;b;){for(l=c;l=l[b];)if(t?l.nodeName.toLowerCase()===
A:1===l.nodeType)return!1;y=b="only"===a&&!y&&"nextSibling"}return!0}if(y=[e?n.firstChild:n.lastChild],e&&f)for(f=n[H]||(n[H]={}),w=f[a]||[],h=w[0]===ea&&w[1],v=w[0]===ea&&w[2],l=h&&n.childNodes[h];l=++h&&l&&l[b]||(v=h=0)||y.pop();){if(1===l.nodeType&&++v&&l===c){f[a]=[ea,h,v];break}}else if(f&&(w=(c[H]||(c[H]={}))[a])&&w[0]===ea)v=w[1];else for(;(l=++h&&l&&l[b]||(v=h=0)||y.pop())&&((t?l.nodeName.toLowerCase()!==A:1!==l.nodeType)||!++v||(f&&((l[H]||(l[H]={}))[a]=[ea,v]),l!==c)););return v-=g,v===
d||0===v%d&&0<=v/d}}},PSEUDO:function(a,c){var b,d=u.pseudos[a]||u.setFilters[a.toLowerCase()]||e.error("unsupported pseudo: "+a);return d[H]?d(c):1<d.length?(b=[a,a,"",c],u.setFilters.hasOwnProperty(a.toLowerCase())?g(function(a,b){for(var g,k=d(a,c),e=k.length;e--;)g=Ia.call(a,k[e]),a[g]=!(b[g]=k[e])}):function(a){return d(a,0,b)}):d}},pseudos:{not:g(function(a){var c=[],b=[],d=J(a.replace(pa,"$1"));return d[H]?g(function(a,c,b,g){var k;b=d(a,null,g,[]);for(g=a.length;g--;)(k=b[g])&&(a[g]=!(c[g]=
k))}):function(a,g,k){return c[0]=a,d(c,null,k,b),!b.pop()}}),has:g(function(a){return function(c){return 0<e(a,c).length}}),contains:g(function(a){return function(c){return-1<(c.textContent||c.innerText||q(c)).indexOf(a)}}),lang:g(function(a){return ab.test(a||"")||e.error("unsupported lang: "+a),a=a.replace(ka,U).toLowerCase(),function(c){var b;do if(b=K?c.getAttribute("xml:lang")||c.getAttribute("lang"):c.lang)return b=b.toLowerCase(),b===a||0===b.indexOf(a+"-");while((c=c.parentNode)&&1===c.nodeType);
return!1}}),target:function(c){var b=a.location&&a.location.hash;return b&&b.slice(1)===c.id},root:function(a){return a===Q},focus:function(a){return a===r.activeElement&&(!r.hasFocus||r.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var c=a.nodeName.toLowerCase();return"input"===c&&!!a.checked||"option"===c&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===
a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if("@"<a.nodeName||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!u.pseudos.empty(a)},header:function(a){return La.test(a.nodeName)},input:function(a){return ha.test(a.nodeName)},button:function(a){var c=a.nodeName.toLowerCase();return"input"===c&&"button"===a.type||"button"===c},text:function(a){var c;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===
a.type)},first:l(function(){return[0]}),last:l(function(a,c){return[c-1]}),eq:l(function(a,c,b){return[0>b?b+c:b]}),even:l(function(a,c){for(var b=0;c>b;b+=2)a.push(b);return a}),odd:l(function(a,c){for(var b=1;c>b;b+=2)a.push(b);return a}),lt:l(function(a,c,b){for(c=0>b?b+c:b;0<=--c;)a.push(c);return a}),gt:l(function(a,c,b){for(b=0>b?b+c:b;c>++b;)a.push(b);return a})}};for(C in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})u.pseudos[C]=f(C);for(C in{submit:!0,reset:!0})u.pseudos[C]=w(C);J=
e.compile=function(a,c){var b,d=[],g=[],k=aa[a+" "];if(!k){c||(c=v(a));for(b=c.length;b--;)k=m(c[b]),k[H]?d.push(k):g.push(k);k=aa(a,z(g,d))}return k};u.pseudos.nth=u.pseudos.eq;u.filters=p.prototype=u.pseudos;u.setFilters=new p;E();e.attr=s.attr;s.find=e;s.expr=e.selectors;s.expr[":"]=s.expr.pseudos;s.unique=e.uniqueSort;s.text=e.getText;s.isXMLDoc=e.isXML;s.contains=e.contains})(I);var ab=/Until$/,Ja=/^(?:parents|prev(?:Until|All))/,xa=/^.[^:#\[\.,]*$/,Ta=s.expr.match.needsContext,Kb={children:!0,
contents:!0,next:!0,prev:!0};s.fn.extend({find:function(a){var c,b,d,g=this.length;if("string"!=typeof a)return d=this,this.pushStack(s(a).filter(function(){for(c=0;g>c;c++)if(s.contains(d[c],this))return!0}));b=[];for(c=0;g>c;c++)s.find(a,this[c],b);return b=this.pushStack(1<g?s.unique(b):b),b.selector=(this.selector?this.selector+" ":"")+a,b},has:function(a){var c,b=s(a,this),d=b.length;return this.filter(function(){for(c=0;d>c;c++)if(s.contains(this,b[c]))return!0})},not:function(a){return this.pushStack(f(this,
a,!1))},filter:function(a){return this.pushStack(f(this,a,!0))},is:function(a){return!!a&&("string"==typeof a?Ta.test(a)?0<=s(a,this.context).index(this[0]):0<s.filter(a,this).length:0<this.filter(a).length)},closest:function(a,c){for(var b,d=0,g=this.length,k=[],e=Ta.test(a)||"string"!=typeof a?s(a,c||this.context):0;g>d;d++)for(b=this[d];b&&b.ownerDocument&&b!==c&&11!==b.nodeType;){if(e?-1<e.index(b):s.find.matchesSelector(b,a)){k.push(b);break}b=b.parentNode}return this.pushStack(1<k.length?s.unique(k):
k)},index:function(a){return a?"string"==typeof a?s.inArray(this[0],s(a)):s.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,c){var b="string"==typeof a?s(a,c):s.makeArray(a&&a.nodeType?[a]:a),b=s.merge(this.get(),b);return this.pushStack(s.unique(b))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});s.fn.andSelf=s.fn.addBack;s.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},
parents:function(a){return s.dir(a,"parentNode")},parentsUntil:function(a,c,b){return s.dir(a,"parentNode",b)},next:function(a){return l(a,"nextSibling")},prev:function(a){return l(a,"previousSibling")},nextAll:function(a){return s.dir(a,"nextSibling")},prevAll:function(a){return s.dir(a,"previousSibling")},nextUntil:function(a,c,b){return s.dir(a,"nextSibling",b)},prevUntil:function(a,c,b){return s.dir(a,"previousSibling",b)},siblings:function(a){return s.sibling((a.parentNode||{}).firstChild,a)},
children:function(a){return s.sibling(a.firstChild)},contents:function(a){return s.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:s.merge([],a.childNodes)}},function(a,c){s.fn[a]=function(b,d){var g=s.map(this,c,b);return ab.test(a)||(d=b),d&&"string"==typeof d&&(g=s.filter(d,g)),g=1<this.length&&!Kb[a]?s.unique(g):g,1<this.length&&Ja.test(a)&&(g=g.reverse()),this.pushStack(g)}});s.extend({filter:function(a,c,b){return b&&(a=":not("+a+")"),1===c.length?s.find.matchesSelector(c[0],
a)?[c[0]]:[]:s.find.matches(a,c)},dir:function(a,c,b){var d=[];for(a=a[c];a&&9!==a.nodeType&&(b===r||1!==a.nodeType||!s(a).is(b));)1===a.nodeType&&d.push(a),a=a[c];return d},sibling:function(a,c){for(var b=[];a;a=a.nextSibling)1===a.nodeType&&a!==c&&b.push(a);return b}});var ib="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Lb=/ jQuery\d+="(?:null|\d+)"/g,nb=RegExp("<(?:"+ib+")[\\s/>]","i"),
bb=/^\s+/,ob=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,pb=/<([\w:]+)/,qb=/<tbody/i,Mb=/<|&#?\w+;/,W=/<(?:script|style|link)/i,Wa=/^(?:checkbox|radio)$/i,Nb=/checked\s*(?:[^=]|=\s*.checked.)/i,rb=/^$|\/(?:java|ecma)script/i,Db=/^true\/(.*)/,Ob=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ia={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],
tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:s.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},cb=b(M).appendChild(M.createElement("div"));ia.optgroup=ia.option;ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead;ia.th=ia.td;s.fn.extend({text:function(a){return s.access(this,function(a){return a===r?s.text(this):this.empty().append((this[0]&&this[0].ownerDocument||M).createTextNode(a))},
null,a,arguments.length)},wrapAll:function(a){if(s.isFunction(a))return this.each(function(c){s(this).wrapAll(a.call(this,c))});if(this[0]){var c=s(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&c.insertBefore(this[0]);c.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return s.isFunction(a)?this.each(function(c){s(this).wrapInner(a.call(this,c))}):this.each(function(){var c=s(this),b=c.contents();
b.length?b.wrapAll(a):c.append(a)})},wrap:function(a){var c=s.isFunction(a);return this.each(function(b){s(this).wrapAll(c?a.call(this,b):a)})},unwrap:function(){return this.parent().each(function(){s.nodeName(this,"body")||s(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){1!==this.nodeType&&11!==
this.nodeType&&9!==this.nodeType||this.insertBefore(a,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,!1,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,c){for(var b,d=0;null!=(b=this[d]);d++)(!a||0<s.filter(a,[b]).length)&&(c||1!==b.nodeType||s.cleanData(g(b)),b.parentNode&&(c&&s.contains(b.ownerDocument,b)&&
k(g(b,"script")),b.parentNode.removeChild(b)));return this},empty:function(){for(var a,c=0;null!=(a=this[c]);c++){for(1===a.nodeType&&s.cleanData(g(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&s.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,c){return a=null==a?!1:a,c=null==c?a:c,this.map(function(){return s.clone(this,a,c)})},html:function(a){return s.access(this,function(a){var c=this[0]||{},b=0,d=this.length;if(a===r)return 1===c.nodeType?c.innerHTML.replace(Lb,
""):r;if(!("string"!=typeof a||W.test(a)||!s.support.htmlSerialize&&nb.test(a)||!s.support.leadingWhitespace&&bb.test(a)||ia[(pb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ob,"<$1></$2>");try{for(;d>b;b++)c=this[b]||{},1===c.nodeType&&(s.cleanData(g(c,!1)),c.innerHTML=a);c=0}catch(k){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return s.isFunction(a)||"string"==typeof a||(a=s(a).not(this).detach()),this.domManip([a],!0,function(a){var c=this.nextSibling,b=
this.parentNode;b&&(s(this).remove(),b.insertBefore(a,c))})},detach:function(a){return this.remove(a,!0)},domManip:function(c,b,d){c=Z.apply([],c);var k,t,f,w,l=0,v=this.length,h=this,y=v-1,n=c[0],A=s.isFunction(n);if(A||!(1>=v||"string"!=typeof n||s.support.checkClone)&&Nb.test(n))return this.each(function(a){var g=h.eq(a);A&&(c[0]=n.call(this,a,b?g.html():r));g.domManip(c,b,d)});if(v&&(w=s.buildFragment(c,this[0].ownerDocument,!1,this),k=w.firstChild,1===w.childNodes.length&&(w=k),k)){b=b&&s.nodeName(k,
"tr");f=s.map(g(w,"script"),a);for(t=f.length;v>l;l++)k=w,l!==y&&(k=s.clone(k,!0,!0),t&&s.merge(f,g(k,"script"))),d.call(b&&s.nodeName(this[l],"table")?this[l].getElementsByTagName("tbody")[0]||this[l].appendChild(this[l].ownerDocument.createElement("tbody")):this[l],k,l);if(t)for(w=f[f.length-1].ownerDocument,s.map(f,e),l=0;t>l;l++)k=f[l],rb.test(k.type||"")&&!s._data(k,"globalEval")&&s.contains(w,k)&&(k.src?s.ajax({url:k.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):s.globalEval((k.text||
k.textContent||k.innerHTML||"").replace(Ob,"")));w=k=null}return this}});s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,c){s.fn[a]=function(a){for(var b=0,d=[],g=s(a),k=g.length-1;k>=b;b++)a=b===k?this:this.clone(!0),s(g[b])[c](a),U.apply(d,a.get());return this.pushStack(d)}});s.extend({clone:function(b,d,t){var f,w,l,v,h,y=s.contains(b.ownerDocument,b);if(s.support.html5Clone||s.isXMLDoc(b)||!nb.test("<"+b.nodeName+">")?
l=b.cloneNode(!0):(cb.innerHTML=b.outerHTML,cb.removeChild(l=cb.firstChild)),!(s.support.noCloneEvent&&s.support.noCloneChecked||1!==b.nodeType&&11!==b.nodeType||s.isXMLDoc(b)))for(f=g(l),h=g(b),v=0;null!=(w=h[v]);++v)if(f[v]){var n=f[v],A=void 0,m=void 0,x=void 0;if(1===n.nodeType){if(A=n.nodeName.toLowerCase(),!s.support.noCloneEvent&&n[s.expando]){x=s._data(n);for(m in x.events)s.removeEvent(n,m,x.handle);n.removeAttribute(s.expando)}"script"===A&&n.text!==w.text?(a(n).text=w.text,e(n)):"object"===
A?(n.parentNode&&(n.outerHTML=w.outerHTML),s.support.html5Clone&&w.innerHTML&&!s.trim(n.innerHTML)&&(n.innerHTML=w.innerHTML)):"input"===A&&Wa.test(w.type)?(n.defaultChecked=n.checked=w.checked,n.value!==w.value&&(n.value=w.value)):"option"===A?n.defaultSelected=n.selected=w.defaultSelected:("input"===A||"textarea"===A)&&(n.defaultValue=w.defaultValue)}}if(d)if(t)for(h=h||g(b),f=f||g(l),v=0;null!=(w=h[v]);v++)c(w,f[v]);else c(b,l);return f=g(l,"script"),0<f.length&&k(f,!y&&g(b,"script")),l},buildFragment:function(a,
c,e,t){for(var f,w,l,v,h,y,n,A=a.length,m=b(c),x=[],z=0;A>z;z++)if(w=a[z],w||0===w)if("object"===s.type(w))s.merge(x,w.nodeType?[w]:w);else if(Mb.test(w)){v=v||m.appendChild(c.createElement("div"));h=(pb.exec(w)||["",""])[1].toLowerCase();n=ia[h]||ia._default;v.innerHTML=n[1]+w.replace(ob,"<$1></$2>")+n[2];for(f=n[0];f--;)v=v.lastChild;if(!s.support.leadingWhitespace&&bb.test(w)&&x.push(c.createTextNode(bb.exec(w)[0])),!s.support.tbody)for(f=(w="table"!==h||qb.test(w)?"<table>"!==n[1]||qb.test(w)?
0:v:v.firstChild)&&w.childNodes.length;f--;)s.nodeName(y=w.childNodes[f],"tbody")&&!y.childNodes.length&&w.removeChild(y);s.merge(x,v.childNodes);for(v.textContent="";v.firstChild;)v.removeChild(v.firstChild);v=m.lastChild}else x.push(c.createTextNode(w));v&&m.removeChild(v);s.support.appendChecked||s.grep(g(x,"input"),d);for(z=0;w=x[z++];)if((!t||-1===s.inArray(w,t))&&(l=s.contains(w.ownerDocument,w),v=g(m.appendChild(w),"script"),l&&k(v),e))for(f=0;w=v[f++];)rb.test(w.type||"")&&e.push(w);return m},
cleanData:function(a,c){for(var b,d,g,k,e=0,t=s.expando,f=s.cache,w=s.support.deleteExpando,l=s.event.special;null!=(b=a[e]);e++)if((c||s.acceptData(b))&&(g=b[t],k=g&&f[g])){if(k.events)for(d in k.events)l[d]?s.event.remove(b,d):s.removeEvent(b,d,k.handle);f[g]&&(delete f[g],w?delete b[t]:typeof b.removeAttribute!==S?b.removeAttribute(t):b[t]=null,X.push(g))}}});var Ca,ta,ua,db=/alpha\([^)]*\)/i,Pb=/opacity\s*=\s*([^)]*)/,Qb=/^(top|right|bottom|left)$/,Rb=/^(none|table(?!-c[ea]).+)/,sb=/^margin/,
Eb=RegExp("^("+oa+")(.*)$","i"),Ma=RegExp("^("+oa+")(?!px)[a-z%]+$","i"),Sb=RegExp("^([+-])=("+oa+")","i"),kb={BODY:"block"},Tb={position:"absolute",visibility:"hidden",display:"block"},tb={letterSpacing:0,fontWeight:400},sa=["Top","Right","Bottom","Left"],jb=["Webkit","O","Moz","ms"];s.fn.extend({css:function(a,c){return s.access(this,function(a,c,b){var d,g={},k=0;if(s.isArray(c)){d=ta(a);for(b=c.length;b>k;k++)g[c[k]]=s.css(a,c[k],!1,d);return g}return b!==r?s.style(a,c,b):s.css(a,c)},a,c,1<arguments.length)},
show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(a){var c="boolean"==typeof a;return this.each(function(){(c?a:y(this))?s(this).show():s(this).hide()})}});s.extend({cssHooks:{opacity:{get:function(a,c){if(c){var b=ua(a,"opacity");return""===b?"1":b}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,b,d){if(a&&3!==
a.nodeType&&8!==a.nodeType&&a.style){var g,k,e,f=s.camelCase(c),w=a.style;if(c=s.cssProps[f]||(s.cssProps[f]=t(w,f)),e=s.cssHooks[c]||s.cssHooks[f],b===r)return e&&"get"in e&&(g=e.get(a,!1,d))!==r?g:w[c];if(k=typeof b,"string"===k&&(g=Sb.exec(b))&&(b=(g[1]+1)*g[2]+parseFloat(s.css(a,c)),k="number"),!(null==b||"number"===k&&isNaN(b)||("number"!==k||s.cssNumber[f]||(b+="px"),s.support.clearCloneStyle||""!==b||0!==c.indexOf("background")||(w[c]="inherit"),e&&"set"in e&&(b=e.set(a,b,d))===r)))try{w[c]=
b}catch(l){}}},css:function(a,c,b,d){var g,k,e,f=s.camelCase(c);return c=s.cssProps[f]||(s.cssProps[f]=t(a.style,f)),e=s.cssHooks[c]||s.cssHooks[f],e&&"get"in e&&(k=e.get(a,!0,b)),k===r&&(k=ua(a,c,d)),"normal"===k&&c in tb&&(k=tb[c]),""===b||b?(g=parseFloat(k),!0===b||s.isNumeric(g)?g||0:k):k},swap:function(a,c,b,d){var g,k={};for(g in c)k[g]=a.style[g],a.style[g]=c[g];b=b.apply(a,d||[]);for(g in c)a.style[g]=k[g];return b}});I.getComputedStyle?(ta=function(a){return I.getComputedStyle(a,null)},ua=
function(a,c,b){var d,g,k,e=(b=b||ta(a))?b.getPropertyValue(c)||b[c]:r,t=a.style;return b&&(""!==e||s.contains(a.ownerDocument,a)||(e=s.style(a,c)),Ma.test(e)&&sb.test(c)&&(d=t.width,g=t.minWidth,k=t.maxWidth,t.minWidth=t.maxWidth=t.width=e,e=b.width,t.width=d,t.minWidth=g,t.maxWidth=k)),e}):M.documentElement.currentStyle&&(ta=function(a){return a.currentStyle},ua=function(a,c,b){var d,g,k;b=(b=b||ta(a))?b[c]:r;var e=a.style;return null==b&&e&&e[c]&&(b=e[c]),Ma.test(b)&&!Qb.test(c)&&(d=e.left,g=a.runtimeStyle,
k=g&&g.left,k&&(g.left=a.currentStyle.left),e.left="fontSize"===c?"1em":b,b=e.pixelLeft+"px",e.left=d,k&&(g.left=k)),""===b?"auto":b});s.each(["height","width"],function(a,c){s.cssHooks[c]={get:function(a,b,d){return b?0===a.offsetWidth&&Rb.test(s.css(a,"display"))?s.swap(a,Tb,function(){return D(a,c,d)}):D(a,c,d):r},set:function(a,b,d){var g=d&&ta(a);return A(a,b,d?z(a,c,d,s.support.boxSizing&&"border-box"===s.css(a,"boxSizing",!1,g),g):0)}}});s.support.opacity||(s.cssHooks.opacity={get:function(a,
c){return Pb.test((c&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":c?"1":""},set:function(a,c){var b=a.style,d=a.currentStyle,g=s.isNumeric(c)?"alpha(opacity="+100*c+")":"",k=d&&d.filter||b.filter||"";b.zoom=1;(1<=c||""===c)&&""===s.trim(k.replace(db,""))&&b.removeAttribute&&(b.removeAttribute("filter"),""===c||d&&!d.filter)||(b.filter=db.test(k)?k.replace(db,g):k+" "+g)}});s(function(){s.support.reliableMarginRight||(s.cssHooks.marginRight={get:function(a,
c){return c?s.swap(a,{display:"inline-block"},ua,[a,"marginRight"]):r}});!s.support.pixelPosition&&s.fn.position&&s.each(["top","left"],function(a,c){s.cssHooks[c]={get:function(a,b){return b?(b=ua(a,c),Ma.test(b)?s(a).position()[c]+"px":b):r}}})});s.expr&&s.expr.filters&&(s.expr.filters.hidden=function(a){return 0>=a.offsetWidth&&0>=a.offsetHeight||!s.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||s.css(a,"display"))},s.expr.filters.visible=function(a){return!s.expr.filters.hidden(a)});
s.each({margin:"",padding:"",border:"Width"},function(a,c){s.cssHooks[a+c]={expand:function(b){var d=0,g={};for(b="string"==typeof b?b.split(" "):[b];4>d;d++)g[a+sa[d]+c]=b[d]||b[d-2]||b[0];return g}};sb.test(a)||(s.cssHooks[a+c].set=A)});var Ub=/%20/g,Fb=/\[\]$/,ub=/\r?\n/g,Vb=/^(?:submit|button|image|reset|file)$/i,Wb=/^(?:input|select|textarea|keygen)/i;s.fn.extend({serialize:function(){return s.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=s.prop(this,
"elements");return a?s.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!s(this).is(":disabled")&&Wb.test(this.nodeName)&&!Vb.test(a)&&(this.checked||!Wa.test(a))}).map(function(a,c){var b=s(this).val();return null==b?null:s.isArray(b)?s.map(b,function(a){return{name:c.name,value:a.replace(ub,"\r\n")}}):{name:c.name,value:b.replace(ub,"\r\n")}}).get()}});s.param=function(a,c){var b,d=[],g=function(a,c){c=s.isFunction(c)?c():null==c?"":c;d[d.length]=encodeURIComponent(a)+"="+
encodeURIComponent(c)};if(c===r&&(c=s.ajaxSettings&&s.ajaxSettings.traditional),s.isArray(a)||a.jquery&&!s.isPlainObject(a))s.each(a,function(){g(this.name,this.value)});else for(b in a)w(b,a[b],c,g);return d.join("&").replace(Ub,"+")};s.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,c){s.fn[c]=function(a,b){return 0<
arguments.length?this.on(c,null,a,b):this.trigger(c)}});s.fn.hover=function(a,c){return this.mouseenter(a).mouseleave(c||a)};var wa,ra,eb=s.now(),fb=/\?/,Xb=/#.*$/,vb=/([?&])_=[^&]*/,Yb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Zb=/^(?:GET|HEAD)$/,$b=/^\/\//,wb=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,xb=s.fn.load,yb={},Xa={},zb="*/".concat("*");try{ra=Y.href}catch(ec){ra=M.createElement("a"),ra.href="",ra=ra.href}wa=wb.exec(ra.toLowerCase())||[];s.fn.load=function(a,c,b){if("string"!=typeof a&&xb)return xb.apply(this,
arguments);var d,g,k,e=this,t=a.indexOf(" ");return 0<=t&&(d=a.slice(t,a.length),a=a.slice(0,t)),s.isFunction(c)?(b=c,c=r):c&&"object"==typeof c&&(k="POST"),0<e.length&&s.ajax({url:a,type:k,dataType:"html",data:c}).done(function(a){g=arguments;e.html(d?s("<div>").append(s.parseHTML(a)).find(d):a)}).complete(b&&function(a,c){e.each(b,g||[a.responseText,c,a])}),this};s.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,c){s.fn[c]=function(a){return this.on(c,
a)}});s.each(["get","post"],function(a,c){s[c]=function(a,b,d,g){return s.isFunction(b)&&(g=g||d,d=b,b=r),s.ajax({url:a,type:c,dataType:g,data:b,success:d})}});s.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ra,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wa[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},
contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":I.String,"text html":!0,"text json":s.parseJSON,"text xml":s.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,c){return c?B(B(a,s.ajaxSettings),c):B(s.ajaxSettings,a)},ajaxPrefilter:x(yb),ajaxTransport:x(Xa),ajax:function(a,c){function b(a,c,d,g){var l,x,z,u,G,q=c;if(2!==p){p=2;t&&clearTimeout(t);w=r;e=g||"";C.readyState=0<a?4:0;if(d){u=v;g=C;var D,J,O,B,E=u.contents,
Q=u.dataTypes,K=u.responseFields;for(B in K)B in d&&(g[K[B]]=d[B]);for(;"*"===Q[0];)Q.shift(),J===r&&(J=u.mimeType||g.getResponseHeader("Content-Type"));if(J)for(B in E)if(E[B]&&E[B].test(J)){Q.unshift(B);break}if(Q[0]in d)O=Q[0];else{for(B in d){if(!Q[0]||u.converters[B+" "+Q[0]]){O=B;break}D||(D=B)}O=O||D}u=O?(O!==Q[0]&&Q.unshift(O),d[O]):r}if(200<=a&&300>a||304===a)if(v.ifModified&&(G=C.getResponseHeader("Last-Modified"),G&&(s.lastModified[k]=G),G=C.getResponseHeader("etag"),G&&(s.etag[k]=G)),
204===a)l=!0,q="nocontent";else if(304===a)l=!0,q="notmodified";else{var T;a:{d=v;l=u;var F,S;z={};G=0;q=d.dataTypes.slice();D=q[0];if(d.dataFilter&&(l=d.dataFilter(l,d.dataType)),q[1])for(F in d.converters)z[F.toLowerCase()]=d.converters[F];for(;x=q[++G];)if("*"!==x){if("*"!==D&&D!==x){if(F=z[D+" "+x]||z["* "+x],!F)for(T in z)if(S=T.split(" "),S[1]===x&&(F=z[D+" "+S[0]]||z["* "+S[0]])){!0===F?F=z[T]:!0!==z[T]&&(x=S[0],q.splice(G--,0,x));break}if(!0!==F)if(F&&d["throws"])l=F(l);else try{l=F(l)}catch(M){T=
{state:"parsererror",error:F?M:"No conversion from "+D+" to "+x};break a}}D=x}T={state:"success",data:l}}l=T;q=l.state;x=l.data;z=l.error;l=!z}else z=q,(a||!q)&&(q="error",0>a&&(a=0));C.status=a;C.statusText=(c||q)+"";l?n.resolveWith(h,[x,q,C]):n.rejectWith(h,[C,q,z]);C.statusCode(m);m=r;f&&y.trigger(l?"ajaxSuccess":"ajaxError",[C,v,l?x:z]);A.fireWith(h,[C,q]);f&&(y.trigger("ajaxComplete",[C,v]),--s.active||s.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=r);c=c||{};var d,g,k,e,t,f,w,l,v=
s.ajaxSetup({},c),h=v.context||v,y=v.context&&(h.nodeType||h.jquery)?s(h):s.event,n=s.Deferred(),A=s.Callbacks("once memory"),m=v.statusCode||{},x={},z={},p=0,u="canceled",C={readyState:0,getResponseHeader:function(a){var c;if(2===p){if(!l)for(l={};c=Yb.exec(e);)l[c[1].toLowerCase()]=c[2];c=l[a.toLowerCase()]}return null==c?null:c},getAllResponseHeaders:function(){return 2===p?e:null},setRequestHeader:function(a,c){var b=a.toLowerCase();return p||(a=z[b]=z[b]||a,x[a]=c),this},overrideMimeType:function(a){return p||
(v.mimeType=a),this},statusCode:function(a){var c;if(a)if(2>p)for(c in a)m[c]=[m[c],a[c]];else C.always(a[C.status]);return this},abort:function(a){a=a||u;return w&&w.abort(a),b(0,a),this}};if(n.promise(C).complete=A.add,C.success=C.done,C.error=C.fail,v.url=((a||v.url||ra)+"").replace(Xb,"").replace($b,wa[1]+"//"),v.type=c.method||c.type||v.method||v.type,v.dataTypes=s.trim(v.dataType||"*").toLowerCase().match(ha)||[""],null==v.crossDomain&&(d=wb.exec(v.url.toLowerCase()),v.crossDomain=!(!d||d[1]===
wa[1]&&d[2]===wa[2]&&(d[3]||("http:"===d[1]?80:443))==(wa[3]||("http:"===wa[1]?80:443)))),v.data&&v.processData&&"string"!=typeof v.data&&(v.data=s.param(v.data,v.traditional)),G(yb,v,c,C),2===p)return C;(f=v.global)&&0===s.active++&&s.event.trigger("ajaxStart");v.type=v.type.toUpperCase();v.hasContent=!Zb.test(v.type);k=v.url;v.hasContent||(v.data&&(k=v.url+=(fb.test(k)?"&":"?")+v.data,delete v.data),!1===v.cache&&(v.url=vb.test(k)?k.replace(vb,"$1_="+eb++):k+(fb.test(k)?"&":"?")+"_="+eb++));v.ifModified&&
(s.lastModified[k]&&C.setRequestHeader("If-Modified-Since",s.lastModified[k]),s.etag[k]&&C.setRequestHeader("If-None-Match",s.etag[k]));(v.data&&v.hasContent&&!1!==v.contentType||c.contentType)&&C.setRequestHeader("Content-Type",v.contentType);C.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+zb+"; q=0.01":""):v.accepts["*"]);for(g in v.headers)C.setRequestHeader(g,v.headers[g]);if(v.beforeSend&&(!1===v.beforeSend.call(h,C,v)||
2===p))return C.abort();u="abort";for(g in{success:1,error:1,complete:1})C[g](v[g]);if(w=G(Xa,v,c,C)){C.readyState=1;f&&y.trigger("ajaxSend",[C,v]);v.async&&0<v.timeout&&(t=setTimeout(function(){C.abort("timeout")},v.timeout));try{p=1,w.send(x,b)}catch(q){if(!(2>p))throw q;b(-1,q)}}else b(-1,"No Transport");return C},getScript:function(a,c){return s.get(a,r,c,"script")},getJSON:function(a,c,b){return s.get(a,c,b,"json")}});s.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return s.globalEval(a),a}}});s.ajaxPrefilter("script",function(a){a.cache===r&&(a.cache=!1);a.crossDomain&&(a.type="GET",a.global=!1)});s.ajaxTransport("script",function(a){if(a.crossDomain){var c,b=M.head||s("head")[0]||M.documentElement;return{send:function(d,g){c=M.createElement("script");c.async=!0;a.scriptCharset&&(c.charset=a.scriptCharset);c.src=a.url;c.onload=c.onreadystatechange=function(a,b){(b||!c.readyState||
/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),c=null,b||g(200,"success"))};b.insertBefore(c,b.firstChild)},abort:function(){c&&c.onload(r,!0)}}}});var Ab=[],gb=/(=)\?(?=&|$)|\?\?/;s.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Ab.pop()||s.expando+"_"+eb++;return this[a]=!0,a}});s.ajaxPrefilter("json jsonp",function(a,c,b){var d,g,k,e=!1!==a.jsonp&&(gb.test(a.url)?"url":"string"==typeof a.data&&!(a.contentType||"").indexOf("application/x-www-form-urlencoded")&&
gb.test(a.data)&&"data");return e||"jsonp"===a.dataTypes[0]?(d=a.jsonpCallback=s.isFunction(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback,e?a[e]=a[e].replace(gb,"$1"+d):!1!==a.jsonp&&(a.url+=(fb.test(a.url)?"&":"?")+a.jsonp+"="+d),a.converters["script json"]=function(){return k||s.error(d+" was not called"),k[0]},a.dataTypes[0]="json",g=I[d],I[d]=function(){k=arguments},b.always(function(){I[d]=g;a[d]&&(a.jsonpCallback=c.jsonpCallback,Ab.push(d));k&&s.isFunction(g)&&g(k[0]);k=g=r}),"script"):
r});var Ba,Ka,ac=0,hb=I.ActiveXObject&&function(){for(var a in Ba)Ba[a](r,!0)};s.ajaxSettings.xhr=I.ActiveXObject?function(){var a;if(!(a=!this.isLocal&&C()))a:{try{a=new I.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}a=void 0}return a}:C;Ka=s.ajaxSettings.xhr();s.support.cors=!!Ka&&"withCredentials"in Ka;(Ka=s.support.ajax=!!Ka)&&s.ajaxTransport(function(a){if(!a.crossDomain||s.support.cors){var c;return{send:function(b,d){var g,k,e=a.xhr();if(a.username?e.open(a.type,a.url,a.async,a.username,
a.password):e.open(a.type,a.url,a.async),a.xhrFields)for(k in a.xhrFields)e[k]=a.xhrFields[k];a.mimeType&&e.overrideMimeType&&e.overrideMimeType(a.mimeType);a.crossDomain||b["X-Requested-With"]||(b["X-Requested-With"]="XMLHttpRequest");try{for(k in b)e.setRequestHeader(k,b[k])}catch(t){}e.send(a.hasContent&&a.data||null);c=function(b,k){var t,f,w,v;try{if(c&&(k||4===e.readyState))if(c=r,g&&(e.onreadystatechange=s.noop,hb&&delete Ba[g]),k)4!==e.readyState&&e.abort();else{v={};t=e.status;f=e.getAllResponseHeaders();
"string"==typeof e.responseText&&(v.text=e.responseText);try{w=e.statusText}catch(l){w=""}t||!a.isLocal||a.crossDomain?1223===t&&(t=204):t=v.text?200:404}}catch(h){k||d(-1,h)}v&&d(t,w,v,f)};a.async?4===e.readyState?setTimeout(c):(g=++ac,hb&&(Ba||(Ba={},s(I).unload(hb)),Ba[g]=c),e.onreadystatechange=c):c()},abort:function(){c&&c(r,!0)}}}});var ya,Ua,bc=/^(?:toggle|show|hide)$/,cc=RegExp("^(?:([+-])=|)("+oa+")([a-z%]*)$","i"),dc=/queueHooks$/,Na=[function(a,c,b){var d,g,k,e,t,f,w=this,v=a.style,l={},
h=[],n=a.nodeType&&y(a);b.queue||(t=s._queueHooks(a,"fx"),null==t.unqueued&&(t.unqueued=0,f=t.empty.fire,t.empty.fire=function(){t.unqueued||f()}),t.unqueued++,w.always(function(){w.always(function(){t.unqueued--;s.queue(a,"fx").length||t.empty.fire()})}));1===a.nodeType&&("height"in c||"width"in c)&&(b.overflow=[v.overflow,v.overflowX,v.overflowY],"inline"===s.css(a,"display")&&"none"===s.css(a,"float")&&(s.support.inlineBlockNeedsLayout&&"inline"!==E(a.nodeName)?v.zoom=1:v.display="inline-block"));
b.overflow&&(v.overflow="hidden",s.support.shrinkWrapBlocks||w.always(function(){v.overflow=b.overflow[0];v.overflowX=b.overflow[1];v.overflowY=b.overflow[2]}));for(g in c)(k=c[g],bc.exec(k))&&(delete c[g],d=d||"toggle"===k,k!==(n?"hide":"show"))&&h.push(g);if(c=h.length)for(k=s._data(a,"fxshow")||s._data(a,"fxshow",{}),("hidden"in k)&&(n=k.hidden),d&&(k.hidden=!n),n?s(a).show():w.done(function(){s(a).hide()}),w.done(function(){var c;s._removeData(a,"fxshow");for(c in l)s.style(a,c,l[c])}),g=0;c>
g;g++)d=h[g],e=w.createTween(d,n?k[d]:0),l[d]=k[d]||s.style(a,d),d in k||(k[d]=e.start,n&&(e.end=e.start,e.start="width"===d||"height"===d?1:0))}],Da={"*":[function(a,c){var b,d,g=this.createTween(a,c),k=cc.exec(c),e=g.cur(),t=+e||0,f=1,w=20;if(k){if(b=+k[2],d=k[3]||(s.cssNumber[a]?"":"px"),"px"!==d&&t){t=s.css(g.elem,a,!0)||b||1;do f=f||".5",t/=f,s.style(g.elem,a,t+d);while(f!==(f=g.cur()/e)&&1!==f&&--w)}g.unit=d;g.start=t;g.end=k[1]?t+(k[1]+1)*b:b}return g}]};s.Animation=s.extend(Q,{tweener:function(a,
c){s.isFunction(a)?(c=a,a=["*"]):a=a.split(" ");for(var b,d=0,g=a.length;g>d;d++)b=a[d],Da[b]=Da[b]||[],Da[b].unshift(c)},prefilter:function(a,c){c?Na.unshift(a):Na.push(a)}});s.Tween=F;F.prototype={constructor:F,init:function(a,c,b,d,g,k){this.elem=a;this.prop=b;this.easing=g||"swing";this.options=c;this.start=this.now=this.cur();this.end=d;this.unit=k||(s.cssNumber[b]?"":"px")},cur:function(){var a=F.propHooks[this.prop];return a&&a.get?a.get(this):F.propHooks._default.get(this)},run:function(a){var c,
b=F.propHooks[this.prop];return this.pos=c=this.options.duration?s.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*c+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),b&&b.set?b.set(this):F.propHooks._default.set(this),this}};F.prototype.init.prototype=F.prototype;F.propHooks={_default:{get:function(a){var c;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(c=s.css(a.elem,a.prop,""),c&&"auto"!==
c?c:0):a.elem[a.prop]},set:function(a){s.fx.step[a.prop]?s.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[s.cssProps[a.prop]]||s.cssHooks[a.prop])?s.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};F.propHooks.scrollTop=F.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};s.each(["toggle","show","hide"],function(a,c){var b=s.fn[c];s.fn[c]=function(a,d,g){return null==a||"boolean"==typeof a?b.apply(this,arguments):this.animate(L(c,!0),
a,d,g)}});s.fn.extend({fadeTo:function(a,c,b,d){return this.filter(y).css("opacity",0).show().end().animate({opacity:c},a,b,d)},animate:function(a,c,b,d){var g=s.isEmptyObject(a),k=s.speed(c,b,d),e=function(){var c=Q(this,s.extend({},a),k);e.finish=function(){c.stop(!0)};(g||s._data(this,"finish"))&&c.stop(!0)};return e.finish=e,g||!1===k.queue?this.each(e):this.queue(k.queue,e)},stop:function(a,c,b){var d=function(a){var c=a.stop;delete a.stop;c(b)};return"string"!=typeof a&&(b=c,c=a,a=r),c&&!1!==
a&&this.queue(a||"fx",[]),this.each(function(){var c=!0,g=null!=a&&a+"queueHooks",k=s.timers,e=s._data(this);if(g)e[g]&&e[g].stop&&d(e[g]);else for(g in e)e[g]&&e[g].stop&&dc.test(g)&&d(e[g]);for(g=k.length;g--;)k[g].elem!==this||null!=a&&k[g].queue!==a||(k[g].anim.stop(b),c=!1,k.splice(g,1));!c&&b||s.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var c,b=s._data(this),d=b[a+"queue"];c=b[a+"queueHooks"];var g=s.timers,k=d?d.length:0;b.finish=!0;s.queue(this,a,
[]);c&&c.cur&&c.cur.finish&&c.cur.finish.call(this);for(c=g.length;c--;)g[c].elem===this&&g[c].queue===a&&(g[c].anim.stop(!0),g.splice(c,1));for(c=0;k>c;c++)d[c]&&d[c].finish&&d[c].finish.call(this);delete b.finish})}});s.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,c){s.fn[a]=function(a,b,d){return this.animate(c,a,b,d)}});s.speed=function(a,c,b){var d=a&&"object"==typeof a?s.extend({},
a):{complete:b||!b&&c||s.isFunction(a)&&a,duration:a,easing:b&&c||c&&!s.isFunction(c)&&c};return d.duration=s.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in s.fx.speeds?s.fx.speeds[d.duration]:s.fx.speeds._default,(null==d.queue||!0===d.queue)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){s.isFunction(d.old)&&d.old.call(this);d.queue&&s.dequeue(this,d.queue)},d};s.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}};s.timers=[];s.fx=F.prototype.init;
s.fx.tick=function(){var a,c=s.timers,b=0;for(ya=s.now();c.length>b;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||s.fx.stop();ya=r};s.fx.timer=function(a){a()&&s.timers.push(a)&&s.fx.start()};s.fx.interval=13;s.fx.start=function(){Ua||(Ua=setInterval(s.fx.tick,s.fx.interval))};s.fx.stop=function(){clearInterval(Ua);Ua=null};s.fx.speeds={slow:600,fast:200,_default:400};s.fx.step={};s.expr&&s.expr.filters&&(s.expr.filters.animated=function(a){return s.grep(s.timers,function(c){return a===c.elem}).length});
s.fn.offset=function(a){if(arguments.length)return a===r?this:this.each(function(c){s.offset.setOffset(this,a,c)});var c,b,d={top:0,left:0},g=this[0],k=g&&g.ownerDocument;if(k)return c=k.documentElement,s.contains(c,g)?(typeof g.getBoundingClientRect!==S&&(d=g.getBoundingClientRect()),b=H(k),{top:d.top+(b.pageYOffset||c.scrollTop)-(c.clientTop||0),left:d.left+(b.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}):d};s.offset={setOffset:function(a,c,b){var d=s.css(a,"position");"static"===d&&(a.style.position=
"relative");var g=s(a),k=g.offset(),e=s.css(a,"top"),t=s.css(a,"left"),f={},w={},v,l;("absolute"===d||"fixed"===d)&&-1<s.inArray("auto",[e,t])?(w=g.position(),v=w.top,l=w.left):(v=parseFloat(e)||0,l=parseFloat(t)||0);s.isFunction(c)&&(c=c.call(a,b,k));null!=c.top&&(f.top=c.top-k.top+v);null!=c.left&&(f.left=c.left-k.left+l);"using"in c?c.using.call(a,f):g.css(f)}};s.fn.extend({position:function(){if(this[0]){var a,c,b={top:0,left:0},d=this[0];return"fixed"===s.css(d,"position")?c=d.getBoundingClientRect():
(a=this.offsetParent(),c=this.offset(),s.nodeName(a[0],"html")||(b=a.offset()),b.top+=s.css(a[0],"borderTopWidth",!0),b.left+=s.css(a[0],"borderLeftWidth",!0)),{top:c.top-b.top-s.css(d,"marginTop",!0),left:c.left-b.left-s.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||M.documentElement;a&&!s.nodeName(a,"html")&&"static"===s.css(a,"position");)a=a.offsetParent;return a||M.documentElement})}});s.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},
function(a,c){var b=/Y/.test(c);s.fn[a]=function(d){return s.access(this,function(a,d,g){var k=H(a);return g===r?k?c in k?k[c]:k.document.documentElement[d]:a[d]:(k?k.scrollTo(b?s(k).scrollLeft():g,b?g:s(k).scrollTop()):a[d]=g,r)},a,d,arguments.length,null)}});s.each({Height:"height",Width:"width"},function(a,c){s.each({padding:"inner"+a,content:c,"":"outer"+a},function(b,d){s.fn[d]=function(d,g){var k=arguments.length&&(b||"boolean"!=typeof d),e=b||(!0===d||!0===g?"margin":"border");return s.access(this,
function(c,b,d){var g;return s.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(g=c.documentElement,Math.max(c.body["scroll"+a],g["scroll"+a],c.body["offset"+a],g["offset"+a],g["client"+a])):d===r?s.css(c,b,e):s.style(c,b,d,e)},c,k?d:r,k,null)}})});I.jQuery=I.$=s;"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return s})})(window);
(function(I){I.browserTest=function(r,R){var fa=function(q,m){for(var p=0;p<m.length;p+=1)q=q.replace(m[p][0],m[p][1]);return q},N=function(q,m,p,h){m={name:fa((m.exec(q)||["unknown","unknown"])[1],p)};m[m.name]=!0;m.version=(h.exec(q)||["X","X","X","X"])[3];m.name.match(/safari/)&&400<m.version&&(m.version="2.0");"presto"===m.name&&(m.version=9.27<I.browser.version?"futhark":"linear_b");m.versionNumber=parseFloat(m.version,10)||0;m.versionX="X"!==m.version?(m.version+"").substr(0,1):"X";m.className=
m.name+m.versionX;return m};r=(r.match(/Opera|Navigator|Minefield|KHTML|Chrome/)?fa(r,[[/(Firefox|MSIE|KHTML,\slike\sGecko|Konqueror)/,""],["Chrome Safari","Chrome"],["KHTML","Konqueror"],["Minefield","Firefox"],["Navigator","Netscape"]]):r).toLowerCase();I.browser=I.extend(R?{}:I.browser,N(r,/(camino|chrome|firefox|netscape|konqueror|lynx|msie|opera|safari)/,[],/(camino|chrome|firefox|netscape|netscape6|opera|version|konqueror|lynx|msie|safari)(\/|\s)([a-z0-9\.\+]*?)(\;|dev|rel|\s|$)/));I.layout=
N(r,/(gecko|konqueror|msie|opera|webkit)/,[["konqueror","khtml"],["msie","trident"],["opera","presto"]],/(applewebkit|rv|konqueror|msie)(\:|\/|\s)([a-z0-9\.]*?)(\;|\)|\s)/);I.os={name:(/(win|mac|linux|sunos|solaris|iphone)/.exec(navigator.platform.toLowerCase())||["unknown"])[0].replace("sunos","solaris")};R||I("html").addClass([I.os.name,I.browser.name,I.browser.className,I.layout.name,I.layout.className].join(" "))};I.browserTest(navigator.userAgent)})(jQuery);
(function(I){function r(r){var q=r||window.event,m=[].slice.call(arguments,1),p=0,h=0,n=0;return r=I.event.fix(q),r.type="mousewheel",q.wheelDelta&&(p=q.wheelDelta/120),q.detail&&(p=-q.detail/3),n=p,void 0!==q.axis&&q.axis===q.HORIZONTAL_AXIS&&(n=0,h=-1*p),void 0!==q.wheelDeltaY&&(n=q.wheelDeltaY/120),void 0!==q.wheelDeltaX&&(h=-1*q.wheelDeltaX/120),m.unshift(r,p,h,n),(I.event.dispatch||I.event.handle).apply(this,m)}var R=["DOMMouseScroll","mousewheel"];if(I.event.fixHooks)for(var fa=R.length;fa;)I.event.fixHooks[R[--fa]]=
I.event.mouseHooks;I.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var I=R.length;I;)this.addEventListener(R[--I],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var I=R.length;I;)this.removeEventListener(R[--I],r,!1);else this.onmousewheel=null}};I.fn.extend({mousewheel:function(r){return r?this.bind("mousewheel",r):this.trigger("mousewheel")},unmousewheel:function(r){return this.unbind("mousewheel",r)}})})(jQuery);
window.Modernizr=function(I,r,R){var fa={},N=r.documentElement;I=r.createElement("modernizr");I=I.style;var q={},m=[],p=m.slice,h,n=function(a,b,k,c){var g,d,t,f,v=r.createElement("div"),l=r.body,h=l||r.createElement("body");if(parseInt(k,10))for(;k--;)t=r.createElement("div"),t.id=c?c[k]:"modernizr"+(k+1),v.appendChild(t);return g=['&#173;<style id="smodernizr">',a,"</style>"].join(""),v.id="modernizr",(l?v:h).innerHTML+=g,h.appendChild(v),l||(h.style.background="",h.style.overflow="hidden",f=N.style.overflow,
N.style.overflow="hidden",N.appendChild(h)),d=b(v,a),l?v.parentNode.removeChild(v):(h.parentNode.removeChild(h),N.style.overflow=f),!!d},l={}.hasOwnProperty,f;"undefined"!==typeof l&&"undefined"!==typeof l.call?f=function(a,b){return l.call(a,b)}:f=function(a,b){return b in a&&"undefined"===typeof a.constructor.prototype[b]};Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var k=p.call(arguments,1),c=function(){if(this instanceof
c){var g=function(){};g.prototype=b.prototype;var g=new g,d=b.apply(g,k.concat(p.call(arguments)));return Object(d)===d?d:g}return b.apply(a,k.concat(p.call(arguments)))};return c});q.canvas=function(){var a=r.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")};q.canvastext=function(){var a;if(a=!!fa.canvas)a="function"===typeof r.createElement("canvas").getContext("2d").fillText;return a};q.fontface=function(){var a;return n('@font-face {font-family:"font";src:url("https://")}',function(b,
k){var c=r.getElementById("smodernizr"),c=(c=c.sheet||c.styleSheet)?c.cssRules&&c.cssRules[0]?c.cssRules[0].cssText:c.cssText||"":"";a=/src/i.test(c)&&0===c.indexOf(k.split(" ")[0])}),a};q.inlinesvg=function(){var a=r.createElement("div");return a.innerHTML="<svg/>","http://www.w3.org/2000/svg"==(a.firstChild&&a.firstChild.namespaceURI)};for(var b in q)f(q,b)&&(h=b.toLowerCase(),fa[h]=q[b](),m.push((fa[h]?"":"no-")+h));fa.addTest=function(a,b){if("object"==typeof a)for(var k in a)f(a,k)&&fa.addTest(k,
a[k]);else{a=a.toLowerCase();if(fa[a]!==R)return fa;b="function"==typeof b?b():b;"undefined"!=typeof enableClasses&&enableClasses&&(N.className+=" "+(b?"":"no-")+a);fa[a]=b}return fa};I.cssText="";return I=null,fa._version="2.8.3",fa.testStyles=n,fa}(this,this.document);
(function(I){var r={actions:{},analytics:{},aria:{},async:{},bin:{},codec:{},crypto:{},easy:{},events:{},features:{},fonts:{},fs:{},g4s:{},geometry:{},geometry2:{},i18n:{},io:{cache:{},documents:{},package:{}},json:{},log:{},service:{},ui:{},utils:{asyncStorage:{},pools:{}},viewer:{events:{},version:{}},xps:{},zip:{}};(function(){var q=this,m=q._,p={},h=Array.prototype,n=Object.prototype,l=h.push,f=h.slice,b=h.concat,a=n.toString,e=n.hasOwnProperty,k=h.forEach,c=h.map,g=h.reduce,d=h.reduceRight,t=
h.filter,y=h.every,v=h.some,A=h.indexOf,z=h.lastIndexOf,n=Array.isArray,D=Object.keys,E=Function.prototype.bind,u=function(a){if(a instanceof u)return a;if(!(this instanceof u))return new u(a);this._wrapped=a};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports._=u):q._=u;u.VERSION="1.4.2";var w=u.each=u.forEach=function(a,c,b){if(null!=a)if(k&&a.forEach===k)a.forEach(c,b);else if(a.length===+a.length)for(var d=0,g=a.length;d<g&&c.call(b,a[d],
d,a)!==p;d++);else for(d in a)if(u.has(a,d)&&c.call(b,a[d],d,a)===p)break};u.map=u.collect=function(a,b,d){var g=[];return null==a?g:c&&a.map===c?a.map(b,d):(w(a,function(a,c,k){g[g.length]=b.call(d,a,c,k)}),g)};u.reduce=u.foldl=u.inject=function(a,c,b,d){var k=2<arguments.length;null==a&&(a=[]);if(g&&a.reduce===g)return d&&(c=u.bind(c,d)),k?a.reduce(c,b):a.reduce(c);w(a,function(a,g,e){k?b=c.call(d,b,a,g,e):(b=a,k=!0)});if(!k)throw new TypeError("Reduce of empty array with no initial value");return b};
u.reduceRight=u.foldr=function(a,c,b,g){var k=2<arguments.length;null==a&&(a=[]);if(d&&a.reduceRight===d)return g&&(c=u.bind(c,g)),2<arguments.length?a.reduceRight(c,b):a.reduceRight(c);var e=a.length;if(e!==+e)var t=u.keys(a),e=t.length;w(a,function(d,f,w){f=t?t[--e]:--e;k?b=c.call(g,b,a[f],f,w):(b=a[f],k=!0)});if(!k)throw new TypeError("Reduce of empty array with no initial value");return b};u.find=u.detect=function(a,c,b){var d;return x(a,function(a,g,k){if(c.call(b,a,g,k))return d=a,!0}),d};u.filter=
u.select=function(a,c,b){var d=[];return null==a?d:t&&a.filter===t?a.filter(c,b):(w(a,function(a,g,k){c.call(b,a,g,k)&&(d[d.length]=a)}),d)};u.reject=function(a,c,b){var d=[];return null==a?d:(w(a,function(a,g,k){c.call(b,a,g,k)||(d[d.length]=a)}),d)};u.every=u.all=function(a,c,b){c||(c=u.identity);var d=!0;return null==a?d:y&&a.every===y?a.every(c,b):(w(a,function(a,g,k){if(!(d=d&&c.call(b,a,g,k)))return p}),!!d)};var x=u.some=u.any=function(a,c,b){c||(c=u.identity);var d=!1;return null==a?d:v&&
a.some===v?a.some(c,b):(w(a,function(a,g,k){if(d||(d=c.call(b,a,g,k)))return p}),!!d)};u.contains=u.include=function(a,c){var b=!1;return null==a?b:A&&a.indexOf===A?-1!=a.indexOf(c):(b=x(a,function(a){return a===c}),b)};u.invoke=function(a,c){var b=f.call(arguments,2);return u.map(a,function(a){return(u.isFunction(c)?c:a[c]).apply(a,b)})};u.pluck=function(a,c){return u.map(a,function(a){return a[c]})};u.where=function(a,c){return u.isEmpty(c)?[]:u.filter(a,function(a){for(var b in c)if(c[b]!==a[b])return!1;
return!0})};u.max=function(a,c,b){if(!c&&u.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!c&&u.isEmpty(a))return-Infinity;var d={computed:-Infinity};return w(a,function(a,g,k){g=c?c.call(b,a,g,k):a;g>=d.computed&&(d={value:a,computed:g})}),d.value};u.min=function(a,c,b){if(!c&&u.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!c&&u.isEmpty(a))return Infinity;var d={computed:Infinity};return w(a,function(a,g,k){g=c?c.call(b,a,g,k):a;g<d.computed&&
(d={value:a,computed:g})}),d.value};u.shuffle=function(a){var c,b=0,d=[];return w(a,function(a){c=u.random(b++);d[b-1]=d[c];d[c]=a}),d};var G=function(a){return u.isFunction(a)?a:function(c){return c[a]}};u.sortBy=function(a,c,b){var d=G(c);return u.pluck(u.map(a,function(a,c,g){return{value:a,index:c,criteria:d.call(b,a,c,g)}}).sort(function(a,c){var b=a.criteria,d=c.criteria;if(b!==d){if(b>d||void 0===b)return 1;if(b<d||void 0===d)return-1}return a.index<c.index?-1:1}),"value")};var B=function(a,
c,b,d){var g={},k=G(c);return w(a,function(c,e){var t=k.call(b,c,e,a);d(g,t,c)}),g};u.groupBy=function(a,c,b){return B(a,c,b,function(a,c,b){(u.has(a,c)?a[c]:a[c]=[]).push(b)})};u.countBy=function(a,c,b){return B(a,c,b,function(a,c,b){u.has(a,c)||(a[c]=0);a[c]++})};u.sortedIndex=function(a,c,b,d){b=null==b?u.identity:G(b);c=b.call(d,c);for(var g=0,k=a.length;g<k;){var e=g+k>>>1;b.call(d,a[e])<c?g=e+1:k=e}return g};u.toArray=function(a){return a?a.length===+a.length?f.call(a):u.values(a):[]};u.size=
function(a){return a.length===+a.length?a.length:u.keys(a).length};u.first=u.head=u.take=function(a,c,b){return null==c||b?a[0]:f.call(a,0,c)};u.initial=function(a,c,b){return f.call(a,0,a.length-(null==c||b?1:c))};u.last=function(a,c,b){return null==c||b?a[a.length-1]:f.call(a,Math.max(a.length-c,0))};u.rest=u.tail=u.drop=function(a,c,b){return f.call(a,null==c||b?1:c)};u.compact=function(a){return u.filter(a,function(a){return!!a})};var C=function(a,c,b){return w(a,function(a){u.isArray(a)?c?l.apply(b,
a):C(a,c,b):b.push(a)}),b};u.flatten=function(a,c){return C(a,c,[])};u.without=function(a){return u.difference(a,f.call(arguments,1))};u.uniq=u.unique=function(a,c,b,d){b=b?u.map(a,b,d):a;var g=[],k=[];return w(b,function(b,d){(c?d&&k[k.length-1]===b:u.contains(k,b))||(k.push(b),g.push(a[d]))}),g};u.union=function(){return u.uniq(b.apply(h,arguments))};u.intersection=function(a){var c=f.call(arguments,1);return u.filter(u.uniq(a),function(a){return u.every(c,function(c){return 0<=u.indexOf(c,a)})})};
u.difference=function(a){var c=b.apply(h,f.call(arguments,1));return u.filter(a,function(a){return!u.contains(c,a)})};u.zip=function(){for(var a=f.call(arguments),c=u.max(u.pluck(a,"length")),b=Array(c),d=0;d<c;d++)b[d]=u.pluck(a,""+d);return b};u.object=function(a,c){for(var b={},d=0,g=a.length;d<g;d++)c?b[a[d]]=c[d]:b[a[d][0]]=a[d][1];return b};u.indexOf=function(a,c,b){if(null==a)return-1;var d=0,g=a.length;if(b){if("number"!=typeof b)return d=u.sortedIndex(a,c),a[d]===c?d:-1;d=0>b?Math.max(0,
g+b):b}if(A&&a.indexOf===A)return a.indexOf(c,b);for(;d<g;d++)if(a[d]===c)return d;return-1};u.lastIndexOf=function(a,c,b){if(null==a)return-1;var d=null!=b;if(z&&a.lastIndexOf===z)return d?a.lastIndexOf(c,b):a.lastIndexOf(c);for(b=d?b:a.length;b--;)if(a[b]===c)return b;return-1};u.range=function(a,c,b){1>=arguments.length&&(c=a||0,a=0);b=arguments[2]||1;for(var d=Math.max(Math.ceil((c-a)/b),0),g=0,k=Array(d);g<d;)k[g++]=a,a+=b;return k};var J=function(){};u.bind=function(a,c){var b,d;if(a.bind===
E&&E)return E.apply(a,f.call(arguments,1));if(!u.isFunction(a))throw new TypeError;return d=f.call(arguments,2),b=function(){if(this instanceof b){J.prototype=a.prototype;var g=new J,k=a.apply(g,d.concat(f.call(arguments)));return Object(k)===k?k:g}return a.apply(c,d.concat(f.call(arguments)))}};u.bindAll=function(a){var c=f.call(arguments,1);return 0==c.length&&(c=u.functions(a)),w(c,function(c){a[c]=u.bind(a[c],a)}),a};u.memoize=function(a,c){var b={};return c||(c=u.identity),function(){var d=c.apply(this,
arguments);return u.has(b,d)?b[d]:b[d]=a.apply(this,arguments)}};u.delay=function(a,c){var b=f.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},c)};u.defer=function(a){return u.delay.apply(u,[a,1].concat(f.call(arguments,1)))};u.throttle=function(a,c){var b,d,g,k,e,t,f=u.debounce(function(){e=k=!1},c);return function(){b=this;d=arguments;return g||(g=setTimeout(function(){g=null;e&&(t=a.apply(b,d));f()},c)),k?e=!0:(k=!0,t=a.apply(b,d)),f(),t}};u.debounce=function(a,c,b){var d,
g;return function(){var k=this,e=arguments,t=b&&!d;return clearTimeout(d),d=setTimeout(function(){d=null;b||(g=a.apply(k,e))},c),t&&(g=a.apply(k,e)),g}};u.once=function(a){var c=!1,b;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}};u.wrap=function(a,c){return function(){var b=[a];return l.apply(b,arguments),c.apply(this,b)}};u.compose=function(){var a=arguments;return function(){for(var c=arguments,b=a.length-1;0<=b;b--)c=[a[b].apply(this,c)];return c[0]}};u.after=function(a,
c){return 0>=a?c():function(){if(1>--a)return c.apply(this,arguments)}};u.keys=D||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],b;for(b in a)u.has(a,b)&&(c[c.length]=b);return c};u.values=function(a){var c=[],b;for(b in a)u.has(a,b)&&c.push(a[b]);return c};u.pairs=function(a){var c=[],b;for(b in a)u.has(a,b)&&c.push([b,a[b]]);return c};u.invert=function(a){var c={},b;for(b in a)u.has(a,b)&&(c[a[b]]=b);return c};u.functions=u.methods=function(a){var c=[],b;for(b in a)u.isFunction(a[b])&&
c.push(b);return c.sort()};u.extend=function(a){return w(f.call(arguments,1),function(c){for(var b in c)a[b]=c[b]}),a};u.pick=function(a){var c={},d=b.apply(h,f.call(arguments,1));return w(d,function(b){b in a&&(c[b]=a[b])}),c};u.omit=function(a){var c={},d=b.apply(h,f.call(arguments,1)),g;for(g in a)u.contains(d,g)||(c[g]=a[g]);return c};u.defaults=function(a){return w(f.call(arguments,1),function(c){for(var b in c)null==a[b]&&(a[b]=c[b])}),a};u.clone=function(a){return u.isObject(a)?u.isArray(a)?
a.slice():u.extend({},a):a};u.tap=function(a,c){return c(a),a};var O=function(c,b,d,g){if(c===b)return 0!==c||1/c==1/b;if(null==c||null==b)return c===b;c instanceof u&&(c=c._wrapped);b instanceof u&&(b=b._wrapped);var k=a.call(c);if(k!=a.call(b))return!1;switch(k){case "[object String]":return c==String(b);case "[object Number]":return c!=+c?b!=+b:0==c?1/c==1/b:c==+b;case "[object Date]":case "[object Boolean]":return+c==+b;case "[object RegExp]":return c.source==b.source&&c.global==b.global&&c.multiline==
b.multiline&&c.ignoreCase==b.ignoreCase}if("object"!=typeof c||"object"!=typeof b)return!1;for(var e=d.length;e--;)if(d[e]==c)return g[e]==b;d.push(c);g.push(b);var e=0,t=!0;if("[object Array]"==k){if(e=c.length,t=e==b.length)for(;e--&&(t=O(c[e],b[e],d,g)););}else{var k=c.constructor,f=b.constructor;if(k!==f&&!(u.isFunction(k)&&k instanceof k&&u.isFunction(f)&&f instanceof f))return!1;for(var w in c)if(u.has(c,w)&&(e++,!(t=u.has(b,w)&&O(c[w],b[w],d,g))))break;if(t){for(w in b)if(u.has(b,w)&&!e--)break;
t=!e}}return d.pop(),g.pop(),t};u.isEqual=function(a,c){return O(a,c,[],[])};u.isEmpty=function(a){if(null==a)return!0;if(u.isArray(a)||u.isString(a))return 0===a.length;for(var c in a)if(u.has(a,c))return!1;return!0};u.isElement=function(a){return!!a&&1===a.nodeType};u.isArray=n||function(c){return"[object Array]"==a.call(c)};u.isObject=function(a){return a===Object(a)};w("Arguments Function String Number Date RegExp".split(" "),function(c){u["is"+c]=function(b){return a.call(b)=="[object "+c+"]"}});
u.isArguments(arguments)||(u.isArguments=function(a){return!!a&&!!u.has(a,"callee")});"function"!=typeof/./&&(u.isFunction=function(a){return"function"==typeof a});u.isFinite=function(a){return u.isNumber(a)&&isFinite(a)};u.isNaN=function(a){return u.isNumber(a)&&a!=+a};u.isBoolean=function(c){return!0===c||!1===c||"[object Boolean]"==a.call(c)};u.isNull=function(a){return null===a};u.isUndefined=function(a){return void 0===a};u.has=function(a,c){return e.call(a,c)};u.noConflict=function(){return q._=
m,this};u.identity=function(a){return a};u.times=function(a,c,b){for(var d=0;d<a;d++)c.call(b,d)};u.random=function(a,c){return null==c&&(c=a,a=0),a+(0|Math.random()*(c-a+1))};var r={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};r.unescape=u.invert(r.escape);var K={escape:RegExp("["+u.keys(r.escape).join("")+"]","g"),unescape:RegExp("("+u.keys(r.unescape).join("|")+")","g")};u.each(["escape","unescape"],function(a){u[a]=function(c){return null==c?"":(""+c).replace(K[a],
function(c){return r[a][c]})}});u.result=function(a,c){if(null==a)return null;var b=a[c];return u.isFunction(b)?b.call(a):b};u.mixin=function(a){w(u.functions(a),function(c){var b=u[c]=a[c];u.prototype[c]=function(){var a=[this._wrapped];l.apply(a,arguments);a=b.apply(u,a);return this._chain?u(a).chain():a}})};var F=0;u.uniqueId=function(a){var c=F++;return a?a+c:c};u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,H={"'":"'","\\":"\\",
"\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},ba=/\\|'|\r|\n|\t|\u2028|\u2029/g;u.template=function(a,c,b){b=u.defaults({},b,u.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),g=0,k="__p+='";a.replace(d,function(c,b,d,e,t){k+=a.slice(g,t).replace(ba,function(a){return"\\"+H[a]});k+=b?"'+\n((__t=("+b+"))==null?'':_.escape(__t))+\n'":d?"'+\n((__t=("+d+"))==null?'':__t)+\n'":e?"';\n"+e+"\n__p+='":"";g=t+c.length});
k+="';\n";b.variable||(k="with(obj||{}){\n"+k+"}\n");k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{var e=new Function(b.variable||"obj","_",k)}catch(t){throw t.source=k,t;}if(c)return e(c,u);c=function(a){return e.call(this,a,u)};return c.source="function("+(b.variable||"obj")+"){\n"+k+"}",c};u.chain=function(a){return u(a).chain()};u.mixin(u);w("pop push reverse shift sort splice unshift".split(" "),function(a){var c=h[a];u.prototype[a]=
function(){var b=this._wrapped;return c.apply(b,arguments),("shift"==a||"splice"==a)&&0===b.length&&delete b[0],this._chain?u(b).chain():b}});w(["concat","join","slice"],function(a){var c=h[a];u.prototype[a]=function(){var a=c.apply(this._wrapped,arguments);return this._chain?u(a).chain():a}});u.extend(u.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(){var q=this,m=q.Backbone,p=Array.prototype.slice,h=Array.prototype.splice,
n;n="undefined"!==typeof exports?exports:q.Backbone={};n.VERSION="0.9.2";var l=q._;l||"undefined"===typeof require||(l=require("underscore"));var f=q.jQuery||q.Zepto||q.ender;n.setDomLibrary=function(a){f=a};n.noConflict=function(){q.Backbone=m;return this};n.emulateHTTP=!1;n.emulateJSON=!1;var b=/\s+/,a=n.Events={on:function(a,c,d){var g,k,e,t,f;if(!c)return this;a=a.split(b);for(g=this._callbacks||(this._callbacks={});k=a.shift();)e=(f=g[k])?f.tail:{},e.next=t={},e.context=d,e.callback=c,g[k]={tail:t,
next:f?f.next:e};return this},off:function(a,c,d){var g,k,e,t,f,w;if(k=this._callbacks){if(!(a||c||d))return delete this._callbacks,this;for(a=a?a.split(b):l.keys(k);g=a.shift();)if(e=k[g],delete k[g],e&&(c||d))for(t=e.tail;(e=e.next)!==t;)if(f=e.callback,w=e.context,c&&f!==c||d&&w!==d)this.on(g,f,w);return this}},trigger:function(a){var c,d,g,k,e,t;if(!(g=this._callbacks))return this;e=g.all;a=a.split(b);for(t=p.call(arguments,1);c=a.shift();){if(d=g[c])for(k=d.tail;(d=d.next)!==k;)d.callback.apply(d.context||
this,t);if(d=e)for(k=d.tail,c=[c].concat(t);(d=d.next)!==k;)d.callback.apply(d.context||this,c)}return this}};a.bind=a.on;a.unbind=a.off;var e=n.Model=function(a,c){var b;a||(a={});c&&c.parse&&(a=this.parse(a));if(b=G(this,"defaults"))a=l.extend({},b,a);c&&c.collection&&(this.collection=c.collection);this.attributes={};this._escapedAttributes={};this.cid=l.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=
l.clone(this.attributes);this.initialize.apply(this,arguments)};l.extend(e.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return l.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var c;if(c=this._escapedAttributes[a])return c;c=this.get(a);return this._escapedAttributes[a]=l.escape(null==c?"":""+c)},has:function(a){return null!=this.get(a)},set:function(a,c,b){var d,g;l.isObject(a)||null==a?(d=
a,b=c):(d={},d[a]=c);b||(b={});if(!d)return this;d instanceof e&&(d=d.attributes);if(b.unset)for(g in d)d[g]=void 0;if(!this._validate(d,b))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);c=b.changes={};var k=this.attributes,t=this._escapedAttributes,f=this._previousAttributes||{};for(g in d){a=d[g];if(!l.isEqual(k[g],a)||b.unset&&l.has(k,g))delete t[g],(b.silent?this._silent:c)[g]=!0;b.unset?delete k[g]:k[g]=a;l.isEqual(f[g],a)&&l.has(k,g)==l.has(f,g)?(delete this.changed[g],delete this._pending[g]):
(this.changed[g]=a,b.silent||(this._pending[g]=!0))}b.silent||this.change(b);return this},unset:function(a,c){(c||(c={})).unset=!0;return this.set(a,null,c)},clear:function(a){(a||(a={})).unset=!0;return this.set(l.clone(this.attributes),a)},fetch:function(a){a=a?l.clone(a):{};var c=this,b=a.success;a.success=function(d,g,k){if(!c.set(c.parse(d,k),a))return!1;b&&b(c,d)};a.error=n.wrapError(a.error,c,a);return(this.sync||n.sync).call(this,"read",this,a)},save:function(a,c,b){var d,g;l.isObject(a)||
null==a?(d=a,b=c):(d={},d[a]=c);b=b?l.clone(b):{};if(b.wait){if(!this._validate(d,b))return!1;g=l.clone(this.attributes)}a=l.extend({},b,{silent:!0});if(d&&!this.set(d,b.wait?a:b))return!1;var k=this,e=b.success;b.success=function(a,c,g){c=k.parse(a,g);b.wait&&(delete b.wait,c=l.extend(d||{},c));if(!k.set(c,b))return!1;e?e(k,a):k.trigger("sync",k,a,b)};b.error=n.wrapError(b.error,k,b);c=this.isNew()?"create":"update";c=(this.sync||n.sync).call(this,c,this,b);b.wait&&this.set(g,a);return c},destroy:function(a){a=
a?l.clone(a):{};var c=this,b=a.success,d=function(){c.trigger("destroy",c,c.collection,a)};if(this.isNew())return d(),!1;a.success=function(g){a.wait&&d();b?b(c,g):c.trigger("sync",c,g,a)};a.error=n.wrapError(a.error,c,a);var g=(this.sync||n.sync).call(this,"delete",this,a);a.wait||d();return g},url:function(){var a=G(this,"urlRoot")||G(this.collection,"url")||B();return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,c){return a},clone:function(){return new this.constructor(this.attributes)},
isNew:function(){return null==this.id},change:function(a){a||(a={});var c=this._changing;this._changing=!0;for(var b in this._silent)this._pending[b]=!0;var d=l.extend({},a.changes,this._silent);this._silent={};for(b in d)this.trigger("change:"+b,this,this.get(b),a);if(c)return this;for(;!l.isEmpty(this._pending);){this._pending={};this.trigger("change",this,a);for(b in this.changed)this._pending[b]||this._silent[b]||delete this.changed[b];this._previousAttributes=l.clone(this.attributes)}this._changing=
!1;return this},hasChanged:function(a){return arguments.length?l.has(this.changed,a):!l.isEmpty(this.changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?l.clone(this.changed):!1;var c,b=!1,d=this._previousAttributes,g;for(g in a)l.isEqual(d[g],c=a[g])||((b||(b={}))[g]=c);return b},previous:function(a){return arguments.length&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return l.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},
_validate:function(a,c){if(c.silent||!this.validate)return!0;a=l.extend({},this.attributes,a);var b=this.validate(a,c);if(!b)return!0;c&&c.error?c.error(this,b,c):this.trigger("error",this,b,c);return!1}});var k=n.Collection=function(a,c){c||(c={});c.model&&(this.model=c.model);c.comparator&&(this.comparator=c.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:c.parse})};l.extend(k.prototype,a,{model:e,initialize:function(){},toJSON:function(a){return this.map(function(c){return c.toJSON(a)})},
add:function(a,c){var b,d,g,k,e,t={},f={},w=[];c||(c={});a=l.isArray(a)?a.slice():[a];b=0;for(d=a.length;b<d;b++){if(!(g=a[b]=this._prepareModel(a[b],c)))throw Error("Can't add an invalid model to a collection");k=g.cid;e=g.id;t[k]||this._byCid[k]||null!=e&&(f[e]||this._byId[e])?w.push(b):t[k]=f[e]=g}for(b=w.length;b--;)a.splice(w[b],1);b=0;for(d=a.length;b<d;b++)(g=a[b]).on("all",this._onModelEvent,this),this._byCid[g.cid]=g,null!=g.id&&(this._byId[g.id]=g);this.length+=d;h.apply(this.models,[null!=
c.at?c.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(c.silent)return this;b=0;for(d=this.models.length;b<d;b++)t[(g=this.models[b]).cid]&&(c.index=b,g.trigger("add",g,this,c));return this},remove:function(a,c){var b,d,g,k;c||(c={});a=l.isArray(a)?a.slice():[a];b=0;for(d=a.length;b<d;b++)if(k=this.getByCid(a[b])||this.get(a[b]))delete this._byId[k.id],delete this._byCid[k.cid],g=this.indexOf(k),this.models.splice(g,1),this.length--,c.silent||(c.index=g,k.trigger("remove",
k,this,c)),this._removeReference(k);return this},push:function(a,c){a=this._prepareModel(a,c);this.add(a,c);return a},pop:function(a){var c=this.at(this.length-1);this.remove(c,a);return c},unshift:function(a,c){a=this._prepareModel(a,c);this.add(a,l.extend({at:0},c));return a},shift:function(a){var c=this.at(0);this.remove(c,a);return c},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},
where:function(a){return l.isEmpty(a)?[]:this.filter(function(c){for(var b in a)if(a[b]!==c.get(b))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var c=l.bind(this.comparator,this);1==this.comparator.length?this.models=this.sortBy(c):this.models.sort(c);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return l.map(this.models,function(c){return c.get(a)})},reset:function(a,c){a||(a=[]);c||(c={});for(var b=
0,d=this.models.length;b<d;b++)this._removeReference(this.models[b]);this._reset();this.add(a,l.extend({silent:!0},c));c.silent||this.trigger("reset",this,c);return this},fetch:function(a){a=a?l.clone(a):{};void 0===a.parse&&(a.parse=!0);var c=this,b=a.success;a.success=function(d,g,k){c[a.add?"add":"reset"](c.parse(d,k),a);b&&b(c,d)};a.error=n.wrapError(a.error,c,a);return(this.sync||n.sync).call(this,"read",this,a)},create:function(a,c){var b=this;c=c?l.clone(c):{};a=this._prepareModel(a,c);if(!a)return!1;
c.wait||b.add(a,c);var d=c.success;c.success=function(g,k,e){c.wait&&b.add(g,c);d?d(g,k):g.trigger("sync",a,k,c)};a.save(null,c);return a},parse:function(a,c){return a},chain:function(){return l(this.models).chain()},_reset:function(a){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,c){c||(c={});a instanceof e?a.collection||(a.collection=this):(c.collection=this,a=new this.model(a,c),a._validate(a.attributes,c)||(a=!1));return a},_removeReference:function(a){this==
a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,c,b,d){if("add"!=a&&"remove"!=a||b==this)"destroy"==a&&this.remove(c,d),c&&a==="change:"+c.idAttribute&&(delete this._byId[c.previous(c.idAttribute)],this._byId[c.id]=c),this.trigger.apply(this,arguments)}});l.each("forEach each map reduce reduceRight find detect filter select reject every all some any include contains invoke max min sortBy sortedIndex toArray size first initial rest last without indexOf shuffle lastIndexOf isEmpty groupBy".split(" "),
function(a){k.prototype[a]=function(){return l[a].apply(l,[this.models].concat(l.toArray(arguments)))}});var c=n.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},g=/:\w+/g,d=/\*\w+/g,t=/[-[\]{}()+?.,\\^$|#\s]/g;l.extend(c.prototype,a,{initialize:function(){},route:function(a,c,b){n.history||(n.history=new y);l.isRegExp(a)||(a=this._routeToRegExp(a));b||(b=this[c]);n.history.route(a,l.bind(function(d){d=this._extractParameters(a,
d);b&&b.apply(this,d);this.trigger.apply(this,["route:"+c].concat(d));n.history.trigger("route",this,c,d)},this));return this},navigate:function(a,c){n.history.navigate(a,c)},_bindRoutes:function(){if(this.routes){var a=[],c;for(c in this.routes)a.unshift([c,this.routes[c]]);c=0;for(var b=a.length;c<b;c++)this.route(a[c][0],a[c][1],this[a[c][1]])}},_routeToRegExp:function(a){a=a.replace(t,"\\$&").replace(g,"([^/]+)").replace(d,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,c){return a.exec(c).slice(1)}});
var y=n.History=function(){this.handlers=[];l.bindAll(this,"checkUrl")},v=/^[#\/]/,A=/msie [\w.]+/;y.started=!1;l.extend(y.prototype,a,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,c){if(null==a)if(this._hasPushState||c){a=window.location.pathname;var b=window.location.search;b&&(a+=b)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(v,"")},start:function(a){if(y.started)throw Error("Backbone.history has already been started");
y.started=!0;this.options=l.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);a=this.getFragment();var c=document.documentMode;if(c=A.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c))this.iframe=f('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?f(window).bind("popstate",
this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!c?f(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=window.location;c=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!c)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&c&&a.hash&&(this.fragment=
this.getHash().replace(v,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){f(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);y.started=!1},route:function(a,c){this.handlers.unshift({route:a,callback:c})},checkUrl:function(a){a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));
if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var c=this.fragment=this.getFragment(a);return l.any(this.handlers,function(a){if(a.route.test(c))return a.callback(c),!0})},navigate:function(a,c){if(!y.started)return!1;c&&!0!==c||(c={trigger:c});var b=(a||"").replace(v,"");this.fragment!=b&&(this._hasPushState?(0!=b.indexOf(this.options.root)&&(b=this.options.root+b),this.fragment=b,window.history[c.replace?"replaceState":
"pushState"]({},document.title,b)):this._wantsHashChange?(this.fragment=b,this._updateHash(window.location,b,c.replace),this.iframe&&b!=this.getFragment(this.getHash(this.iframe))&&(c.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,b,c.replace))):window.location.assign(this.options.root+a),c.trigger&&this.loadUrl(a))},_updateHash:function(a,c,b){b?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+c):a.hash=c}});var z=n.View=function(a){this.cid=l.uniqueId("view");
this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},D=/^(\S+)\s*(.*)$/,E="model collection el id attributes className tagName".split(" ");l.extend(z.prototype,a,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,c,b){a=document.createElement(a);c&&f(a).attr(c);b&&f(a).html(b);return a},setElement:function(a,c){this.$el&&this.undelegateEvents();
this.$el=a instanceof f?a:f(a);this.el=this.$el[0];!1!==c&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=G(this,"events"))){this.undelegateEvents();for(var c in a){var b=a[c];l.isFunction(b)||(b=this[a[c]]);if(!b)throw Error('Method "'+a[c]+'" does not exist');var d=c.match(D),g=d[1],d=d[2],b=l.bind(b,this),g=g+(".delegateEvents"+this.cid);""===d?this.$el.bind(g,b):this.$el.delegate(d,g,b)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&
(a=l.extend({},this.options,a));for(var c=0,b=E.length;c<b;c++){var d=E[c];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=G(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});e.extend=k.extend=c.extend=z.extend=function(a,c){var b=x(this,a,c);b.extend=this.extend;return b};var u={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};n.sync=
function(a,c,b){var d=u[a];b||(b={});var g={type:d,dataType:"json"};b.url||(g.url=G(c,"url")||B());b.data||!c||"create"!=a&&"update"!=a||(g.contentType="application/json",g.data=JSON.stringify(c.toJSON()));n.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{});!n.emulateHTTP||"PUT"!==d&&"DELETE"!==d||(n.emulateJSON&&(g.data._method=d),g.type="POST",g.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d)});"GET"===g.type||n.emulateJSON||(g.processData=
!1);return f.ajax(l.extend(g,b))};n.wrapError=function(a,c,b){return function(d,g){g=d===c?g:d;a?a(c,g,b):c.trigger("error",c,g,b)}};var w=function(){},x=function(a,c,b){var d;d=c&&c.hasOwnProperty("constructor")?c.constructor:function(){a.apply(this,arguments)};l.extend(d,a);w.prototype=a.prototype;d.prototype=new w;c&&l.extend(d.prototype,c);b&&l.extend(d,b);d.prototype.constructor=d;d.__super__=a.prototype;return d},G=function(a,c){return a&&a[c]?l.isFunction(a[c])?a[c]():a[c]:null},B=function(){throw Error('A "url" property or function must be specified');
}}).call(this);(function(q,m){function p(){if(!h.READY){h.event.determineEventTypes();for(var b in h.gestures)h.gestures.hasOwnProperty(b)&&h.detection.register(h.gestures[b]);h.event.onTouch(h.DOCUMENT,h.EVENT_MOVE,h.detection.detect);h.event.onTouch(h.DOCUMENT,h.EVENT_END,h.detection.detect);h.READY=!0}}var h=function(b,a){return new h.Instance(b,a||{})};h.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};
h.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled;h.HAS_TOUCHEVENTS="ontouchstart"in q;h.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;h.NO_MOUSEEVENTS=!0;h.EVENT_TYPES={};h.DIRECTION_DOWN="down";h.DIRECTION_LEFT="left";h.DIRECTION_UP="up";h.DIRECTION_RIGHT="right";h.POINTER_MOUSE="mouse";h.POINTER_TOUCH="touch";h.POINTER_PEN="pen";h.EVENT_START="start";h.EVENT_MOVE="move";h.EVENT_END="end";h.DOCUMENT=document;h.plugins={};h.READY=!1;h.Instance=function(b,a){var e=this;
p();this.element=b;this.enabled=!0;this.options=h.utils.extend(h.utils.extend({},h.defaults),a||{});this.options.stop_browser_behavior&&h.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior);h.event.onTouch(b,h.EVENT_START,function(a){e.enabled&&h.detection.startDetect(e,a)});return this};h.Instance.prototype={on:function(b,a){for(var e=b.split(" "),k=0;k<e.length;k++)this.element.addEventListener(e[k],a,!1);return this},off:function(b,a){for(var e=b.split(" "),k=0;k<
e.length;k++)this.element.removeEventListener(e[k],a,!1);return this},trigger:function(b,a){var e=h.DOCUMENT.createEvent("Event");e.initEvent(b,!0,!0);e.gesture=a;var k=this.element;h.utils.hasParent(a.target,k)&&(k=a.target,k.dispatchEvent(e));this.element===a.target&&k.dispatchEvent(e);return this},enable:function(b){this.enabled=b;return this}};var n=null,l=!1,f=!1;h.event={bindDom:function(b,a,e){a=a.split(" ");for(var k=0;k<a.length;k++)b.addEventListener(a[k],e,!1)},onTouch:function(b,a,e){var k=
this;this.bindDom(b,h.EVENT_TYPES[a],function(c){var g=c.type.toLowerCase();if(!g.match(/mouse/)||!f){if(g.match(/touch/)||g.match(/pointerdown/)||g.match(/mouse/)&&1===c.which)l=!0;g.match(/touch|pointer/)&&(f=!0);var d=0;l&&(h.HAS_POINTEREVENTS&&a!=h.EVENT_END?d=h.PointerEvent.updatePointer(a,c):g.match(/touch/)?d=c.touches.length:f||(d=g.match(/up/)?0:1),0<d&&a==h.EVENT_END?a=h.EVENT_MOVE:d||(a=h.EVENT_END),d||null===n?n=c:c=n,e.call(h.detection,k.collectEventData(b,a,c)),h.HAS_POINTEREVENTS&&
a==h.EVENT_END&&(d=h.PointerEvent.updatePointer(a,c)));d||(n=null,f=l=!1,h.PointerEvent.reset())}})},determineEventTypes:function(){var b;b=h.HAS_POINTEREVENTS?h.PointerEvent.getEvents():h.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"];h.EVENT_TYPES[h.EVENT_START]=b[0];h.EVENT_TYPES[h.EVENT_MOVE]=b[1];h.EVENT_TYPES[h.EVENT_END]=b[2]},getTouchList:function(b){return h.HAS_POINTEREVENTS?h.PointerEvent.getTouchList():
b.touches?b.touches:[{identifier:1,pageX:b.pageX,pageY:b.pageY,target:b.target}]},collectEventData:function(b,a,e){b=this.getTouchList(e,a);var k=h.POINTER_TOUCH;if(e.type.match(/mouse/)||h.PointerEvent.matchType(h.POINTER_MOUSE,e))k=h.POINTER_MOUSE;return{center:h.utils.getCenter(b),timeStamp:(new Date).getTime(),target:e.target,touches:b,eventType:a,pointerType:k,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation();this.srcEvent.preventDefault&&
this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return h.detection.stopDetect()}}}};h.PointerEvent={pointers:{},getTouchList:function(){var b=this,a=[];Object.keys(b.pointers).sort().forEach(function(e){a.push(b.pointers[e])});return a},updatePointer:function(b,a){b==h.EVENT_END?this.pointers={}:(a.identifier=a.pointerId,this.pointers[a.pointerId]=a);return Object.keys(this.pointers).length},matchType:function(b,a){if(!a.pointerType)return!1;
var e={};e[h.POINTER_MOUSE]=a.pointerType==a.MSPOINTER_TYPE_MOUSE||a.pointerType==h.POINTER_MOUSE;e[h.POINTER_TOUCH]=a.pointerType==a.MSPOINTER_TYPE_TOUCH||a.pointerType==h.POINTER_TOUCH;e[h.POINTER_PEN]=a.pointerType==a.MSPOINTER_TYPE_PEN||a.pointerType==h.POINTER_PEN;return e[b]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}};h.utils={extend:function(b,a,e){for(var k in a)b[k]!==
m&&e||(b[k]=a[k]);return b},hasParent:function(b,a){for(;b;){if(b==a)return!0;b=b.parentNode}return!1},getCenter:function(b){for(var a=[],e=[],k=0,c=b.length;k<c;k++)a.push(b[k].pageX),e.push(b[k].pageY);return{pageX:(Math.min.apply(Math,a)+Math.max.apply(Math,a))/2,pageY:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2}},getVelocity:function(b,a,e){return{x:Math.abs(a/b)||0,y:Math.abs(e/b)||0}},getAngle:function(b,a){return 180*Math.atan2(a.pageY-b.pageY,a.pageX-b.pageX)/Math.PI},getDirection:function(b,
a){var e=Math.abs(b.pageX-a.pageX),k=Math.abs(b.pageY-a.pageY);return e>=k?0<b.pageX-a.pageX?h.DIRECTION_LEFT:h.DIRECTION_RIGHT:0<b.pageY-a.pageY?h.DIRECTION_UP:h.DIRECTION_DOWN},getDistance:function(b,a){var e=a.pageX-b.pageX,k=a.pageY-b.pageY;return Math.sqrt(e*e+k*k)},getScale:function(b,a){return 2<=b.length&&2<=a.length?this.getDistance(a[0],a[1])/this.getDistance(b[0],b[1]):1},getRotation:function(b,a){return 2<=b.length&&2<=a.length?this.getAngle(a[1],a[0])-this.getAngle(b[1],b[0]):0},isVertical:function(b){return b==
h.DIRECTION_UP||b==h.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(b,a){var e,k="webkit khtml moz ms o ".split(" ");if(a&&b.style){for(var c=0;c<k.length;c++)for(var g in a)a.hasOwnProperty(g)&&(e=g,k[c]&&(e=k[c]+e.substring(0,1).toUpperCase()+e.substring(1)),b.style[e]=a[g]);"none"==a.userSelect&&(b.onselectstart=function(){return!1})}}};h.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(b,a){this.current&&this.current.inst!==b&&null!==this.current&&this.stopDetect();
this.current||(this.stopped=!1,this.current={inst:b,startEvent:h.utils.extend({},a),lastEvent:!1,name:""},this.detect(a))},detect:function(b){if(this.current&&!this.stopped){b=this.extendEventData(b);for(var a=this.current.inst.options,e=0,k=this.gestures.length;e<k;e++){var c=this.gestures[e];if(!this.stopped&&!1!==a[c.name]&&!1===c.handler.call(c,b,this.current.inst)){this.stopDetect();break}}this.current&&(this.current.lastEvent=b);b.eventType==h.EVENT_END&&!b.touches.length-1&&this.stopDetect();
return b}},stopDetect:function(){this.previous=h.utils.extend({},this.current);this.current=null;this.stopped=!0},extendEventData:function(b){var a=this.current.startEvent;if(a&&(b.touches.length!=a.touches.length||b.touches===a.touches)){a.touches=[];for(var e=0,k=b.touches.length;e<k;e++)a.touches.push(h.utils.extend({},b.touches[e]))}var e=b.timeStamp-a.timeStamp,k=b.center.pageX-a.center.pageX,c=b.center.pageY-a.center.pageY,g=h.utils.getVelocity(e,k,c);h.utils.extend(b,{deltaTime:e,deltaX:k,
deltaY:c,velocityX:g.x,velocityY:g.y,distance:h.utils.getDistance(a.center,b.center),angle:h.utils.getAngle(a.center,b.center),direction:h.utils.getDirection(a.center,b.center),scale:h.utils.getScale(a.touches,b.touches),rotation:h.utils.getRotation(a.touches,b.touches),startEvent:a});return b},register:function(b){var a=b.defaults||{};a[b.name]===m&&(a[b.name]=!0);h.utils.extend(h.defaults,a,!0);b.index=b.index||1E3;this.gestures.push(b);this.gestures.sort(function(a,b){return a.index<b.index?-1:
a.index>b.index?1:0});return this.gestures}};h.gestures=h.gestures||{};h.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(b,a){switch(b.eventType){case h.EVENT_START:clearTimeout(this.timer);h.detection.current.name=this.name;this.timer=setTimeout(function(){"hold"==h.detection.current.name&&a.trigger("hold",b)},a.options.hold_timeout);break;case h.EVENT_MOVE:b.distance>a.options.hold_threshold&&clearTimeout(this.timer);break;case h.EVENT_END:clearTimeout(this.timer)}}};
h.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(b,a){if(b.eventType==h.EVENT_END){var e=h.detection.previous,k=!1;b.deltaTime>a.options.tap_max_touchtime||b.distance>a.options.tap_max_distance||(e&&"tap"==e.name&&b.timeStamp-e.lastEvent.timeStamp<a.options.doubletap_interval&&b.distance<a.options.doubletap_distance&&(a.trigger("doubletap",b),k=!0),k&&!a.options.tap_always)||(h.detection.current.name=
"tap",a.trigger(h.detection.current.name,b))}}};h.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:0.7},handler:function(b,a){b.eventType!=h.EVENT_END||0<a.options.swipe_max_touches&&b.touches.length>a.options.swipe_max_touches||!(b.velocityX>a.options.swipe_velocity||b.velocityY>a.options.swipe_velocity)||(a.trigger(this.name,b),a.trigger(this.name+b.direction,b))}};h.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,
drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(b,a){if(h.detection.current.name!=this.name&&this.triggered)a.trigger(this.name+"end",b),this.triggered=!1;else if(!(0<a.options.drag_max_touches&&b.touches.length>a.options.drag_max_touches))switch(b.eventType){case h.EVENT_START:this.triggered=!1;break;case h.EVENT_MOVE:if(b.distance<a.options.drag_min_distance&&h.detection.current.name!=this.name)break;h.detection.current.name=this.name;if(h.detection.current.lastEvent.drag_locked_to_axis||
a.options.drag_lock_to_axis&&a.options.drag_lock_min_distance<=b.distance)b.drag_locked_to_axis=!0;var e=h.detection.current.lastEvent.direction;b.drag_locked_to_axis&&e!==b.direction&&(h.utils.isVertical(e)?b.direction=0>b.deltaY?h.DIRECTION_UP:h.DIRECTION_DOWN:b.direction=0>b.deltaX?h.DIRECTION_LEFT:h.DIRECTION_RIGHT);this.triggered||(a.trigger(this.name+"start",b),this.triggered=!0);a.trigger(this.name,b);a.trigger(this.name+b.direction,b);(a.options.drag_block_vertical&&h.utils.isVertical(b.direction)||
a.options.drag_block_horizontal&&!h.utils.isVertical(b.direction))&&b.preventDefault();break;case h.EVENT_END:this.triggered&&a.trigger(this.name+"end",b),this.triggered=!1}}};h.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:0.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(b,a){if(h.detection.current.name!=this.name&&this.triggered)a.trigger(this.name+"end",b),this.triggered=!1;else if(!(2>b.touches.length))switch(a.options.transform_always_block&&
b.preventDefault(),b.eventType){case h.EVENT_START:this.triggered=!1;break;case h.EVENT_MOVE:var e=Math.abs(1-b.scale),k=Math.abs(b.rotation);if(e<a.options.transform_min_scale&&k<a.options.transform_min_rotation)break;h.detection.current.name=this.name;this.triggered||(a.trigger(this.name+"start",b),this.triggered=!0);a.trigger(this.name,b);k>a.options.transform_min_rotation&&a.trigger("rotate",b);e>a.options.transform_min_scale&&(a.trigger("pinch",b),a.trigger("pinch"+(1>b.scale?"in":"out"),b));
break;case h.EVENT_END:this.triggered&&a.trigger(this.name+"end",b),this.triggered=!1}}};h.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(b,a){a.options.prevent_mouseevents&&b.pointerType==h.POINTER_MOUSE?b.stopDetect():(a.options.prevent_default&&b.preventDefault(),b.eventType==h.EVENT_START&&a.trigger(this.name,b))}};h.gestures.FTouch={name:"ftouch",index:0,defaults:{},handler:function(b,a){var e=b.eventType;e===h.EVENT_MOVE?a.trigger(this.name+
"move",b):e===h.EVENT_START?a.trigger(this.name+"start",b):e===h.EVENT_END&&a.trigger(this.name+"end",b)}};h.gestures.Release={name:"release",index:Infinity,handler:function(b,a){b.eventType==h.EVENT_END&&a.trigger(this.name,b)}};"object"===typeof module&&"object"===typeof module.exports?module.exports=h:(q.Hammer=h,"function"===typeof q.define&&q.define.amd&&q.define("hammer",[],function(){return h}))})(this);(function(q){q.each("hold tap doubletap transformstart transform transformend dragstart drag dragend swipe release".split(" "),
function(m,p){q.event.special[p]={setup:function(h,n,l){var f=q(this);f.hammer||(h=new Hammer(this,h),h.options.prevent_mouseevents=!0,h.on("touchstart",function(b){var a=b.target.tagName;"INPUT"!==a&&"TEXTAREA"!==a&&"SELECT"!==a&&b.preventDefault()}),f.data("hammerjs",h));h=f.data("hammerjs");n=h["_h"+p]=function(b){f.trigger(q.Event(p,b))};h.on(p,n)},teardown:function(h){h=q(this).data("hammerjs");var n=h["_h"+p];h&&n&&(h.off(p,n),h["_h"+p]=null)}}})})(jQuery);(function(q){var m;m=navigator.userAgent.match(/Android/i)||
navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)||navigator.userAgent.match(/Tablet PC/i)?!0:!1;q.is_mobile=m})(r);(function(q,m,p){function h(){this._counter=0;this._posibleStates={};this._declarations=[]}function n(l){this._declaration=l;this._stateStack=[]}q.FiniteStateMachineDeclaration=h;q.State=n;h.prototype={declare:function(l,
f){var b=this.get(l);if(this._declarations[b])throw Error("State ["+l+"] is already declared!");f=f||{name:l};f.name=l;this._declarations[b]=f;return b},name:function(l){return this._declarations[l].name},get:function(l){var f;l in this._posibleStates?f=this._posibleStates[l]:this._posibleStates[l]=f=this._counter++;return f},exists:function(l){return l in this._posibleStates},assertState:function(l,f,b,a){if(!a&&0===b.length)throw Error("Initial state must be pushed! [newState:"+this._declarations[l].name+
"]");if(this._declarations.length<=l)throw Error("State is not declared!");l=this._declarations[l];if(!m.isUndefined(l.pushable)&&l.pushable!==a)throw Error("Unallowed operation! [name: "+l.name+"decl: "+l.pushable+" pushed: "+a+"]");if(m.isArray(l.prevIn)&&-1===l.prevIn.indexOf(f))throw Error("Previous state is not satisfied. [from: "+this._declarations[f].name+" to: "+l.name+"]");if(m.isArray(l.notParents)){f=l.notParents;a=0;for(var e=f.length;a<e;++a){var k=f[a];if(-1!==b.indexOf(k))throw Error("Parent state is not allowed! [parent: "+
this._declarations[k].name+" to: "+l.name+"]");}}if(m.isArray(l.directParent)&&(k=l.directParent,-1===b.indexOf(k)))throw Error("Direct parent not found. [directParent: "+this._declarations[k].name+" to: "+l.name+" realParent: "+(0<b.length?this._declarations[b[0]].name:"none")+"]");}};n.prototype={push:function(l){this.current();this._stateStack.push(l);this.trigger("change",l,this)},has:function(l){return-1!==this._stateStack.indexOf(l)},pop:function(){var l=this._stateStack.pop();this.trigger("change",
this.current(),this);return l},current:function(){var l=this._stateStack,f=l.length;return 0===f?null:l[f-1]},change:function(l){var f=this._stateStack;f[f.length-1]=l;this.trigger("change",l,this)},popTo:function(l){var f=this._stateStack,b=f.indexOf(l);f.length=b+1;this.trigger("change",l,this)},reset:function(l){this._stateStack.length=0;this.push(l)},changeState:function(l,f){var b=this._stateStack,a=b.indexOf(l);b[a]=f;this.trigger("change",this.current(),this)}};m.extend(n.prototype,p.Events)})(r,
_,Backbone);r.viewer.STATES=new r.FiniteStateMachineDeclaration;(function(q,m){for(var p="",h=m.document.scripts,n=0,l=h.length;n<l;++n){var f=h[n].attributes.getNamedItem("src");if(f&&(f=f.value))if(p=f.indexOf("vitrium-viewer.js"),-1!==p){p=f.substring(0,p);break}else p=""}q.base_path=p})(r,I);(function(q,m,p){var h={},n={};p.extend(q,m.Events);var l=/[{](\d+)[}]/g;q.format=function(f,b){var a=b.length;return f.replace(l,function(e,k){var c=parseInt(k,10);return c>=a?"?":b[c]})};q._T=function(f,
b){var a=n[f];if(p.isUndefined(a)&&(a="?"+f+"?",b))for(var e=0,k=b.length;e<k;++e)a+=(0!==e?", ":" ")+"{"+e+"}";return b&&0<b.length||a.match(l)?q.format(a,b):a};q._TG=function(f,b,a){p.isArray(b)||(b=[b]);var e,k;do k=0===b.length?f:f+"-"+b.join("-"),b.pop(),e=n[k];while(p.isUndefined(e)&&k!==f);return q._T(k,a)};q.setLanguage=function(f){var b=h[f];if(b&&n!==b)n=b,q.trigger("language:changed",q);else if(!b)throw Error("There is no such language ID ("+f+")");};q.addToLocalization=function(f,b){var a=
p.isEmpty(h);!a&&h[f]?p.extend(h[f],b):h[f]=b;a&&q.setLanguage(f)}})(r.i18n,Backbone,_);r.i18n.addToLocalization("en",{"ui-zoom-in":"Zoom in","ui-zoom-out":"Zoom out","ui-zoom-fit-to-window":"Fit to window","ui-next-page":"Next page","ui-previous-page":"Previous page","ui-page-count":"<span class='page-count-info-of'>of&nbsp;</span>{0}","ui-search":"Search","ui-search-tooltip":"Search [Ctrl + F]","ui-search-next":"Search forward [Enter]","ui-search-prev":"Search backward [Ctrl + Enter]","btn-close":"Close",
"btn-cancel":"Cancel","ui-search-document-end-reached-title":"The end of document","ui-search-document-end-reached":"The end of document has been reached. Do you want to continue from beginning?","ui-search-document-end-start-btn-title":"Continue from beginning [Enter] ","ui-search-document-end-start-btn-label":"Continue","ui-search-document-end-cancel-btn-title":"Cancel [Esc]","ui-search-document-end-cancel-btn-label":"Cancel","ui-search-document-beg-reached-title":"The beginning of document","ui-search-document-beg-reached":"The beginning of document has been reached. Do you want to continue from end?",
"ui-search-document-beg-start-btn-title":"Continue from end [Enter] ","ui-search-document-beg-start-btn-label":"Continue","ui-search-document-beg-cancel-btn-title":"Cancel [Esc]","ui-search-document-beg-cancel-btn-label":"Cancel","ui-search-close":"Close search [Esc]","ui-search-in-progress-title":"Searching...","ui-search-in-progress":"Searching is in progress, please wait.","ui-search-completed-title":"Search completed","ui-search-completed":"Search has been finished.","message-font-substitution-unspecified":"The following embedded fonts will be substituted because they cannot be extracted and some characters or text position may not display correctly: {0}",
"message-font-substitution-license":"Due to font licensing restrictions, the following fonts will be substituted and some characters or text position may not display correctly: {0}","server-error-message":"An error occurred while loading the document. Please try again. If the problem persists, contact your System Administrator.","server-error-message-title":"Error loading document","server-error-button-title":"Try again","server-error-message-404":"Document failed to load. Please try again in a few minutes. If the problem persists, please contact your System Administrator.",
"server-error-message-401":"Access to view this document is denied and any local copies have been removed. If the problem persists, please contact your System Administrator.","server-error-message-title-401":"Access denied","server-error-button-title-401":"Try again","server-error-message-403":"Proceed to Single Sign On authentication ...","server-error-message-title-403":"Single Sign On Authentication","server-error-button-title-403":"Continue","server-error-message-410":"Document has been deleted.",
"server-error-message-title-410":"Document deleted","server-error-button-title-410":"Try again","web-viewer-updated-title":"Application updated","web-viewer-updated":"A new version of this application has been loaded.","web-viewer-updated-button":"Proceed","message-cannot-load-pages":"The following pages could not be loaded: {0}","message-cannot-load-page":"This page cannot be displayed. Scroll up or down to view other pages in this document.","message-document-updated":"A newer version of this document has been loaded.",
"message-document-updated-previous-copy-deleted":"A new version of this document has been loaded and the out-of-date saved version was removed. Would you like to save the new version?","document-updated-dont-save-button":"Cancel","document-updated-save-button":"Save","message-document-updated-title":"Document reloaded",unknown:"An error has occured. Please try again.","ui-tools-menu-title":"Tools","ui-tools-save-document-offline":"Save document to cache for offline use ({0})","ui-tools-document-is-offline":"Delete saved copy of this document",
"ui-tools-manage-saved-documents":"Manage saved documents","ui-tools-saved-documents-title":"Saved documents","ui-tools-clear-cache":"Clear cache {0}","ui-tools-about":"About","ui-tools-downloading":"Downloading","ui-tools-downloading-cancel":"Cancel","ui-tools-download-completed":"Download completed","ui-tools-download-failed":"Download failed","ui-tools-download-failed-message":"The document could not be saved for offline use. Most likely the amount of data your web browser can store on this computer has been exceeded. Please delete unused documents, refresh this webpage and try again.",
"ui-tools-download-close":"Close","ui-tools-open":"Open document","about-title":"About","about-send-feedback-button":"Send feedback","send-feedback-title":"Send feedback","send-feedback-subject":"Feedback","send-feedback-problem-description":"Problem description:","send-feedback-system-information":"System information:","send-feedback-feedback-label":"Tell us what is happening. (required)","send-feedback-email-label":"Email","send-feedback-email-placeholder":"Email (optional)","send-feedback-problem-text":"If your Email client application did not popped up. Please send the message bellow to the address: <a href='mailto:{0}'><strong>{0}</strong></a>.",
"send-feedback-connection-error":"There is a problem while sending your feedback. Check your Internet connection first. ","delete-current-document-title":"Delete saved copy of this document","delete-current-document-question":"Do you really want to delete the saved copy of this document from your computer? The online version of this document will be used instead.","box-unauthorized-title":"Login required","box-unauthorized-message":"You've lost your privileges to view this document. If you have downloaded this document to your device than it has been deleted. ",
"box-unauthorized-button":"Proceed to login","menu-close":"Close","fs-close":"Close","fs-mode-edit":"More options","fs-mode-view":"Hide options","fs-action-create-folder-title":"Create folder","fs-action-create-folder-label":"Folder name","fs-action-create-folder-help":"Type a name of the new folder. Folder name must be unique.","fs-action-err-empty":"Data for this field is required.","fs-action-err-invalid":"This field contains an invalid entry.","fs-cancel":"Cancel","fs-action-item-delete-title":"Delete",
"fs-action-item-rename-title":"Rename","fs-action-item-move-title":"Move","fs-action-item-move-dialog-title":"Move: {0}","fs-action-item-rename-label":"New document title","fs-action-item-rename-help":"Type a new item name.","fs-action-item-delete-question":'Are you sure you want to delete "{0}"?',"fs-action-item-move-to":"Move","fs-action-doItemRename-success":"The document has been renamed.","fs-action-doItemDelete-success":"The document has been deleted.","fs-action-doCreateFolder-success":"The folder has been created.",
"fs-action-doItemMove-success":"The document has been moved.","fs-empty-folder":"This folder is empty","ui-tools-qr-share":"Display document QR code ","qr-share-title":"Document QR code","fs-action-failed":"Action failed.","message-cache-is-disabled":"Saving documents offline is not available. Your browser may not support this feature, there may be a network connection problem or you may be browsing with privacy settings enabled.","message-download-successful":"The document has been successfully downloaded and is available for viewing offline by visiting this page again. You may bookmark this page for your convenience.",
"document-author-label":"Author","document-pages-label":"Pages","document-size-label":"Storage space","document-saved-label":"Saved on","err-folder-already-exists":"A folder with the same name already exists.","web-viewer-deleted-expired-document-title":"Offline use expired","web-viewer-deleted-expired-document":"Offline use of this document has expired. Locally saved copy of this document has been deleted.","web-viewer-deleted-expired-document-button":"Proceed","message-documents-erased-title":"Off-line data deleted",
"message-documents-erased":"Your off-line accessible documents has been deleted from your computer.","web-viewer-service-unable-to-connect-title":"Service connection error","web-viewer-service-unable-to-connect":"Communication with server failed. Some features will be disabled.","highlight-panel-title":"Highlighting","notes-panel-title":"Notes","thumbnails-panel-title":"Thumbnails","bookmarks-panel-title":"Bookmarks","text-selection-done":"Done","text-selection-highlight":"Highlight","note-page":"Page:",
"note-form-title-new":"New note","note-text-label":"Note:","note-form-validation-empty-note":"Please enter your note.","note-cancel-label":"Cancel","note-save-label":"Save","note-form-title-edit":"Edit note","tool-null":"Read mode","tool-note":"Create note","tool-eraser":"Delete annotation","tool-freehighlight":"Draw free shape","tool-texthighlight":"Highlight selected text","tool-undo":"Undo","tool-repeat":"Redo","selected-tool-note":"Click the page to create a note","selected-tool-eraser":"Click the annotation to delete it",
"selected-tool-freehighlight":"Press mouse button on the page to start drawing","selected-tool-texthighlight":"Select text on the page to highlight it","side-panel-close":"Close","sync-display-error-desktop":"Annotations are not synchronized. Click the bubble to try it again.","sync-display-error-mobile":"Annotations are not synchronized. Tap the bubble to try it again."});(function(q,m,p,h,n){var l={},f=h.document;(function(b,a,e){a.async=!0;q[b.toUpperCase()]=b;l[b]=a})("canvas-woff-support",function(b){function a(){var a=
f.createElement("canvas"),g=a.width=100,d=a.height=100,a=a.getContext("2d");a.fillStyle="white";a.fillRect(0,0,g,d);a.fillStyle="black";a.font=d+"px vitriumtestfont";a.fillText("\ue600",0,d);m.free();a=a.getImageData(0,0,g,d);g=4*(d/2*g+g/2);d=a.data;b(0===d[g]&&0===d[g+1]&&0===d[g+2]&&255===d[g+3])}if(p.fontface&&p.canvas){var e=h.navigator.appVersion,k=!1;e.replace(/.*Trident\/(\d+)\..+/g,function(a,b){k=7<=parseInt(b)});!k&&n.browser.chrome&&e.replace(/.*Chrome\/(\d+)\..+/g,function(a,b){k=19<=
parseInt(b)});!k&&n.browser.safari&&e.replace(/.*Version\/(\d+)\..+/g,function(a,b){k=5<=parseInt(b)});!k&&n.browser.firefox&&e.replace(/.*Firefox\/(\d+)\..+/g,function(a,b){k=18<=parseInt(b)});k?setTimeout(function(){b(!0)},0):m.load({fonts:[{key:"vitriumtestfont",data:"data:application/x-font-woff;base64,d09GRk9UVE8AAARUAAsAAAAABnwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAABCAAAAOQAAADuK8RPXEZGVE0AAAHsAAAAHAAAABxo/hdsR0RFRgAAAggAAAAYAAAAHgAPAB5PUy8yAAACIAAAAEkAAABgO7tMumNtYXAAAAJsAAAANAAAAUIADeimaGVhZAAAAqAAAAAwAAAANv/r7JhoaGVhAAAC0AAAAB4AAAAkBxsEDGhtdHgAAALwAAAACAAAAAgH0AAnbWF4cAAAAvgAAAAGAAAABgACUABuYW1lAAADAAAAATwAAAJhF6X02nBvc3QAAAQ8AAAAFgAAACD/hgAzeJxjZGBhYWBkZOQKzSvJLMlJTTFkYGRiYGTQ/cHP8EOG8Ycs0w855h/iLD08jJvW/Ar9OYVVhmEhvwwDg4AMwxJBGQYg874QAwtICweDDYMrg19pXqarmYGBc1FqYklqikJ5ZkmGglt+XolbflF6qoKRnoGCRkZJSYGVvn4aUDQNJKpXnKaXl1qiCXcDwjEMDIztDEyMjEpm3Xt/uO5l3Lv355a9zHvFfkn8WPlPgm3vn3LRH64/t/xxZedb87OY8T+DegPDzymif4t/6f4sZuf7VSPSLdrNw/WzGIh4eACGsE9jAAAAAQAAAADMF3JjAAAAAM5zUUoAAAAAznNTvnicY2BkgAA+BjEgyQLETEDMCMEAA18ALnicY2BhfsH4hYGVgYGpi2k3AwNDD4RmvM9gyMgEFGVg42RAASxQOiDNNYXhwDOGZwzMCv8tGKKYGf7fBwozwhUqACEjAM0BDfMAAAB4nGNgYGBmgGAZBkYGELAB8hjBfBYGBSDNAoRA/jOG//8hpBQjVCUDIxsDjDliAQAoVwaZeJxjYGRgYADiHP5Ww3h+m68M3MwvgCIM54pDPOG0OoMi8wFmEJeDgQlEAQAEOgideJxjYGRgYGZgUGSIYn7BAATMBxgYGVABEwAzZwIxAAAD6AAAA+gAJwAAUAAAAgAAeJyFkLFOwzAURa/bNFIlhFA/AHlBKkNdJ2HKWpQBiZGKtShOY1SSKnXVH+AXmJlZWJj5Aja+iJvUqoSQaKy8d9718/OVAZziHQL77wqPngWG+PDcQ4gvz31ciHPPAYbi3vMAZ+LZc0j9jZ0iGLIqu1MtC4zw6rmHE3x67uMG354DjMS15wGkePAcUn/BDA0MFnCMOSR2sOSSlKFGRW5zgyX3JWIoaOYxOxzXGimmXIXvLQ69ChtWiqqhfgnMGrNwJpc760qZ1ZXL6mZpZKy0HJfOrdPptKBatKraFKoyjqfuurGtpVVnMKJUOetWJifedprFFk8sTG63zP/5Tvn/HbnXE0zImjFmjFjjt81UHq4mJ5NIT2IdJcdMzqk1fA3b+ZKc3U5XXW49YW6aja0rqXWktNbyyMAf9fhlOHicY2BmAIP/zQxGQIqRAQ0AAChVAbkAAA=="}],
timeout:1E3,checkInterval:16,additionalCharacters:"\ue600",noASCII:!0,success:a,error:a})}else setTimeout(function(){b(!1)},0)});q.require=function(b,a,e){function k(b){d=d&&b;--c;0===c&&d?a():0===c&&e()}for(var c=0,g=b.length;c<g;++c)l[b[c]](k);var d=!0}})(r,r.fonts,Modernizr,I,$);(function(q,m){function p(l){this.tasks=[];this.active=!1;this.master=l;this.lastTime=null;this.delayed=!1;this.currentTask=null;this.lastFrame=Date.now();this.paused=!1}function h(){this.done=!1;this.semaphore=0;this.page=
this.parentTask=null;this.interrupted=!1}var n=1E3/60;p.prototype={filter:function(l){this.tasks=m.filter(this.tasks,l)},pause:function(){this.paused=!0},resume:function(){this.paused=!1;this.delayed=!0},execute:function(){if(!this.active&&!this.paused){q.globalTaskScheduler=this;this.lastTime=Date.now();this.delayed=!1;this.active=!0;var l=0,f=null,b=this.tasks,a=!1;do if(++l,this.currentTask=f=b.shift())for(;!a&&0===f.semaphore&&!f.done;)++l,f.step(),a=this.hasDelayedExecution(l);while(!a&&f);a&&
(b.push(f),this.delayed=!0);this.currentTask=null;this.active=!1}},hasDelayedExecution:function(l){if(1E6<l)return!0;if(0===l%50){l=this.lastTime;var f=Date.now();if(100<=f-l)return this.lastTime=f,Math.max(this.lastFrame+n*((f-this.lastFrame)/n|0)+n-f,0),!0}return!1},addTask:function(l){this.tasks.push(l);this.master.refresh()},markFrame:function(){this.lastFrame=Date.now()}};h.prototype={wait:function(){++this.semaphore},post:function(){if(0===this.semaphore)throw Error("Unbalanced use of semaphore!!!");
--this.semaphore;0===this.semaphore&&q.globalTaskScheduler.addTask(this)},interrupt:function(){this.interrupted=!0}};q.Task=h;q.TaskScheduler=p;q.globalTaskScheduler=null})(r,_);(function(q){function m(h,n){this.x=h;this.y=n}function p(h,n,l,f,b,a){this.a=h;this.b=n;this.c=l;this.d=f;this.e=b;this.f=a}q.Point=m;q.Matrix=p;m.prototype={relativeTo:function(h){this.x+=h.x;this.y+=h.y;return this},subs:function(h){this.x-=h.x;this.y-=h.y;return this},rotateClockwise:function(h){var n=Math.cos(h);h=Math.sin(h);
var l=this.x;this.x=l*n+this.y*h;this.y=-l*h+this.y*n;return this},rotateClockwiseF:function(h,n,l){n=n(h);h=l(h);l=this.x;this.x=l*n+this.y*h;this.y=-l*h+this.y*n;return this},clone:function(){return new m(this.x,this.y)},assign:function(h){this.x=h.x;this.y=h.y;return this},distance:function(h){var n=this.x-h.x;h=this.y-h.y;return Math.pow(n*n+h*h,0.5)},equals:function(h){return this.x===h.x&&this.y===h.y}};m.prototype.add=m.prototype.relativeTo;p.identity=function(){return new p(1,0,0,1,0,0)};
p.fromXPS=function(h){h=h.split(",");return new p(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),parseFloat(h[4]),parseFloat(h[5]))};p.prototype.multiply=function(h){return new p(this.a*h.a+this.c*h.b,this.b*h.a+this.d*h.b,this.a*h.c+this.c*h.d,this.b*h.c+this.d*h.d,this.a*h.e+this.c*h.f+this.e,this.b*h.e+this.d*h.f+this.f)};p.prototype.multiplyPoint=function(h){return new m(this.a*h.x+this.c*h.y+this.e,this.b*h.x+this.d*h.y+this.f)};p.prototype.inPlaceMultiplyPoint=function(h){var n=
this.b*h.x+this.d*h.y+this.f;h.x=this.a*h.x+this.c*h.y+this.e;h.y=n;return h};p.prototype.transform=function(h){h.transform(this.a,this.b,this.c,this.d,this.e,this.f)};p.prototype.getScale=function(){var h=Math.sqrt,n=Math.pow;return new m(h(n(this.a,2)+n(this.b,2)),h(n(this.c,2)+n(this.d,2)))};p.prototype.getRotation=function(){return Math.atan2(this.c/this.d)};p.prototype.inverse=function(){var h=this.a,n=this.b,l=this.c,f=this.d,b=this.e,a=this.f,e=1*f-0*a,k=1/(h*e-l*(1*n-0*a)+b*(0*n-0*f));return new p(k*
e,k*(0*a-1*n),k*(0*b-1*l),k*(1*h-0*b),k*(l*a-f*b),k*(b*n-a*h))};p.prototype.toString=function(){return this.a+"\t"+this.c+"\t"+this.e+"\n"+this.b+"\t"+this.d+"\t"+this.f+"\n0\t0\t1"}})(r.geometry);(function(q,m){function p(a,c,b,g,k){this.x=a;this.y=c;this.w=b;this.h=g;this.a=k}function h(a,c,b,g,k,e){p.call(this,a,c,b,g,k);this.d=e}q.Rectangle=p;q.DataRectangle=h;p.createFromCoordinates=function(a,c,b,g){var k;a>b?k=b:(k=a,a=b);c>g?b=g:(b=c,c=g);return new p(k,b,a-k,c-b,0)};var n=new m.Point(0,0),
l=new m.Point(0,0),f=new m.Point(0,0),b=new m.Point(0,0),a=new m.Point(0,0),e=new m.Point(0,0),k=new m.Point(0,0),c=new m.Point(0,0),g=new m.Point(0,0);p.prototype={init:p,clone:function(){return new p(this.x,this.y,this.w,this.h,this.a)},assign:function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h;this.a=a.a},intersectWithZeroAngle:function(a){if(this.isIntersected(a)&&0===this.a&&0===a.a){var c=this.x+this.w,b=this.y+this.h,g=a.x+a.w,k=a.y+a.h,e=Math.min,f=Math.max,l=f(this.x,a.x);a=f(this.y,
a.y);c=e(c,g);b=e(b,k);return new p(l,a,c-l,b-a,0)}return null},isWrapping:function(a){return this.x<=a.x&&this.y<=a.y&&this.x+this.w>=a.x+a.w&&this.y+this.h>=a.y+a.h},getCenterPoint:function(){return new m.Point(this.x+this.w/2,this.y+this.h/2)},getEndPoint:function(){return new m.Point(this.x+this.w,this.y+this.h)},getStartPoint:function(){return new m.Point(this.x,this.y)},move:function(a,c){this.x+=a;this.y+=c},isPointIn:function(a){var c=a.x;a=a.y;return c>=this.x&&c<=this.x+this.w&&a>=this.y&&
a<=this.y+this.h},isIntersected:function(a){return this.isIntersectedFast(a,Math.cos,Math.sin)},isIntersectedFast:function(d,t,h){this.fillCenterVectors(n,l);d.fillCenterVectors(f,b);var v=this.a-d.a;d=t(v);var A=h(v);k.assign(f);k.subs(n);k.rotateClockwiseF(v,t,h);c.assign(k);g.assign(k);c.subs(b);g.add(b);a.x=-l.y*A;e.x=a.x;t=l.x*d;a.x+=t;e.x-=t;a.y=l.y*d;e.y=a.y;t=l.x*A;a.y+=t;e.y-=t;t=A*d;0>t&&(t=a.x,a.x=e.x,e.x=t,t=a.y,a.y=e.y,e.y=t);0>A&&(e.x=-e.x,e.y=-e.y);if(e.x>g.x||e.x>-c.x)return 0;0==
t?(A=a.y,v=-A):(t=c.x-a.x,h=g.x-a.x,A=a.y,0<h*t&&(d=a.x,0>t?(d-=e.x,A-=e.y,t=h):(d+=e.x,A+=e.y),A=A*t/d,A+=a.y),t=c.x+a.x,h=g.x+a.x,v=-a.y,0<h*t&&(d=-a.x,0>t?(d-=e.x,v-=e.y,t=h):(d+=e.x,v+=e.y),v=v*t/d,v-=a.y));return!(A<c.y&&v<c.y||A>g.y&&v>g.y)},fillCenterVectors:function(a,c){var b=this.w/2,g=this.h/2;a.x=this.x+b;a.y=this.y+g;c.x=b;c.y=g},toString:function(){return"x="+this.x+" y="+this.y+" w="+this.w+" h="+this.h},equals:function(a){return a?this.x===a.x&&this.y===a.y&&this.w===a.w&&this.h===
a.h&&this.a===a.a:!1}};h.prototype=Object.create(p.prototype);h.prototype.init=h;h.prototype.assign=function(a){p.prototype.assign.call(this,a);this.d=a.d};h.prototype.clone=function(){return new h(this.x,this.y,this.w,this.h,this.a,this.d)}})(r.geometry2,r.geometry);(function(q){function m(h,n){this.p1=h;this.p2=n}function p(h,n){if(2>=h.length)return[h[0]];for(var l=[],f=new m(h[0],h[h.length-1]),b=0,a=0,e=1;e<=h.length-2;e++){var k=f.distanceToPoint(h[e]);k>b&&(b=k,a=e)}b>=n?(b=h[a],f.distanceToPoint(b,
!0),l=l.concat(p(h.slice(0,a+1),n)),l=l.concat(p(h.slice(a,h.length),n))):(b=h[a],f.distanceToPoint(b,!0),l=[h[0]]);return l}q.simplifyPath=function(h,n){if(2<h.length){var l=p(h,n);l.push(h[h.length-1]);return l}return h};m.prototype._helper=[0,0,0];m.prototype.distanceToPoint=function(h){var n=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),l=this._helper;l[0]=Math.abs(h.y-n*h.x-(this.p1.y-n*this.p1.x))/Math.sqrt(Math.pow(n,2)+1);l[1]=Math.sqrt(Math.pow(h.x-this.p1.x,2)+Math.pow(h.y-this.p1.y,2));l[2]=
Math.sqrt(Math.pow(h.x-this.p2.x,2)+Math.pow(h.y-this.p2.y,2));return l.sort(function(f,b){return f-b})[0]}})(r.geometry);(function(q,m){function p(a,b){"fillRule"in a?a.fillRule=b:"mozFillRule"in a?a.mozFillRule=b:"webkitFillRule"in a?a.webkitFillRule=b:"msFillRule"in a?a.msFillRule=b:a.argFillRule=b}function h(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))}function n(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(h(a,
b))}var l=m.Point,f="FMLHVCQSTAZfmlhvcqstaz".split(""),b=/[-+]?[0-9]*\.?[0-9]+|[a-z]|[A-Z]/g;Math.sqrt(2);q.parsePathData=function(a,e){var k=null,c=[],g={},d=new l(0,0);a.vCurrentPath=e;e.replace(b,function(b){-1===f.indexOf(b)&&k?c.push(b):k=b;b=k;var e=c.length;switch(b){case "F":case "f":1===e&&("1"===c[0]?p(a,"nonzero"):p(a,"evenodd"),c.splice(0));break;case "M":case "m":2===e&&(e=new l(parseFloat(c[0]),parseFloat(c[1])),"m"===b?(e.relativeTo(d),b="l"):b="L",a.moveTo(e.x,e.y),d=e,c.splice(0));
break;case "L":case "l":2===e&&(e=new l(parseFloat(c[0]),parseFloat(c[1])),"l"===b&&e.relativeTo(d),a.lineTo(e.x,e.y),d=e,c.splice(0));break;case "H":case "h":1==e&&(e=new l(parseFloat(c[0]),d.y),"h"===b&&(e.x+=d.x),a.lineTo(e.x,e.y),d=e,c.splice(0));break;case "V":case "v":1==e&&(e=new l(d.x,parseFloat(c[0])),"v"===b&&(e.y+=d.y),a.lineTo(e.x,e.y),d=e,c.splice(0));break;case "C":case "c":if(6===e){var e=new l(parseFloat(c[0]),parseFloat(c[1])),v=new l(parseFloat(c[2]),parseFloat(c[3])),A=new l(parseFloat(c[4]),
parseFloat(c[5]));"c"===b&&(e.relativeTo(d),v.relativeTo(d),A.relativeTo(d));a.bezierCurveTo(e.x,e.y,v.x,v.y,A.x,A.y);g=v;d=A;c.splice(0)}break;case "Q":case "q":4===e&&(e=new l(parseFloat(c[0]),parseFloat(c[1])),A=new l(parseFloat(c[2]),parseFloat(c[3])),"q"===b&&(e.relativeTo(d),A.relativeTo(d)),a.quadraticCurveTo(e.x,e.y,A.x,A.y),d=A,c.splice(0));break;case "S":case "s":4===e&&(e=null==g?d:new l(2*d.x-g.x,2*d.y-g.y),v=new l(parseFloat(c[0]),parseFloat(c[1])),A=new l(parseFloat(c[2]),parseFloat(c[3])),
"s"===b&&(v.relativeTo(d),A.relativeTo(d)),a.bezierCurveTo(e.x,e.y,v.x,v.y,A.x,A.y),g=v,d=A,c.splice(0));break;case "A":case "a":if(7===e){var m=parseFloat(c[0]),q=parseFloat(c[1]),A=parseFloat(c[2])*(Math.PI/180),E=parseInt(c[3],10),v=parseInt(c[4],10),e=new l(parseFloat(c[5]),parseFloat(c[6]));"a"===b&&e.relativeTo(d);var u=new l(Math.cos(A)*(d.x-e.x)/2+Math.sin(A)*(d.y-e.y)/2,-Math.sin(A)*(d.x-e.x)/2+Math.cos(A)*(d.y-e.y)/2),w=Math.pow(u.x,2)/Math.pow(m,2)+Math.pow(u.y,2)/Math.pow(q,2);1<w&&(m*=
Math.sqrt(w),q*=Math.sqrt(w));E=(E==v?-1:1)*Math.sqrt((Math.pow(m,2)*Math.pow(q,2)-Math.pow(m,2)*Math.pow(u.y,2)-Math.pow(q,2)*Math.pow(u.x,2))/(Math.pow(m,2)*Math.pow(u.y,2)+Math.pow(q,2)*Math.pow(u.x,2)));isNaN(E)&&(E=0);var x=new l(E*m*u.y/q,E*-q*u.x/m),E=new l((d.x+e.x)/2+Math.cos(A)*x.x-Math.sin(A)*x.y,(d.y+e.y)/2+Math.sin(A)*x.x+Math.cos(A)*x.y),w=n([1,0],[(u.x-x.x)/m,(u.y-x.y)/q]),G=[(u.x-x.x)/m,(u.y-x.y)/q],x=[(-u.x-x.x)/m,(-u.y-x.y)/q],u=n(G,x);-1>=h(G,x)&&(u=Math.PI);1<=h(G,x)&&(u=0);0==
v&&0<u&&(u-=2*Math.PI);1==v&&0>u&&(u+=2*Math.PI);G=m>q?m:q;x=m>q?1:m/q;m=m>q?q/m:1;a.translate(E.x,E.y);a.rotate(A);a.scale(x,m);a.arc(0,0,G,w,w+u,1-v);a.scale(1/x,1/m);a.rotate(-A);a.translate(-E.x,-E.y);d=e;c.splice(0)}case "Z":case "z":a.closePath();break;default:c.splice(0)}switch(b){case "S":case "s":case "C":case "c":break;default:g=null}k=b;return""})};q.parsePoint=function(a){a=a.split(",");return new l(parseFloat(a[0]),parseFloat(a[1]))};q.parseRectangle=function(a){a=a.split(",");return{x:parseFloat(a[0]),
y:parseFloat(a[1]),width:parseFloat(a[2]),height:parseFloat(a[3])}};q.convertColor=function(a){if(0<a.length&&"#"==a.charAt(0)){if(9==a.length){var b=parseInt(a.substring(1,3),16)/255,k=parseInt(a.substring(3,5),16),c=parseInt(a.substring(5,7),16);a=parseInt(a.substring(7,9),16);return"rgba("+k+","+c+","+a+","+b+")"}return a}return"#000"};q.setFillRule=p})(r.xps,r.geometry);(function(q,m){function p(){this.fillRule="evenodd";this.notARectangle=!1;this.vertices=[];this.lastPoint=0;this.dimensions=
null}function h(){this.notARectangle=!0}q.RectanglePathDetector=p;p.prototype={addVertex:function(h,l){var f=new m.Point(h,l);this.vertices.push(f);this.lastPoint=f},moveTo:function(h,l){this.notARectangle||(0!==this.vertices.length?this.notARectangle=!0:this.addVertex(h,l))},lineTo:function(h,l){if(!this.notARectangle){if(0==this.vertices.length||3<this.vertices.length)this.notARectangle=!0;var f=this.lastPoint;f.x===h||f.y===l?this.addVertex(h,l):this.notARectangle=!0}},closePath:function(){if(!this.notARectangle)if(4!==
this.vertices.length)this.notARectangle=!1;else{var h=this.vertices,l=h[0].distance(h[1]),f=h[2].distance(h[3]),b=h[0].distance(h[3]),a=h[1].distance(h[2]);if(l===f&&b===a&&this.checkRightAngle(h[1],h[2],h[0])&&this.checkRightAngle(h[3],h[2],h[0])){for(var l=h[0],f=h[3],b=0,a=1,e=h.length;a<e;++a){var k=h[a];if(k.x<l.x||k.y<l.y)l=k,b=a;if(k.x>f.x||k.y>f.y)f=k}a=h[(b+1)%4];b=h[0===b?3:b-1];a.x>l.x?(h=a.distance(l),b=b.distance(l)):(h=b.distance(l),b=a.distance(l));this.dimensions={x:l.x,y:l.y,eX:f.x,
eY:f.y,width:h,height:b}}else this.notARectangle=!0,this.dimensions=null}},checkRightAngle:function(h,l,f){var b=f.distance(l);f=f.distance(h);h=h.distance(l);b=180*Math.acos((f*f+h*h-b*b)/2*f*h)/Math.PI;return 0.01>Math.abs(b-90)},bezierCurveTo:h,quadraticCurveTo:h,arc:h}})(r.geometry,r.geometry);(function(q){q.renderErrorIcon=function(m,p){m.save();m.scale(p,p);m.beginPath();m.moveTo(0,0);m.lineTo(48,0);m.lineTo(48,48);m.lineTo(0,48);m.closePath();m.clip();m.strokeStyle="rgba(0,0,0,0)";m.lineCap=
"butt";m.lineJoin="miter";m.miterLimit=4;m.save();m.restore();m.save();m.restore();m.save();m.save();m.transform(1.566667,0,0,1.566667,-8.925566,-23.94764);m.save();m.transform(0.01444074,0,0,0.01331973,33.38871,40.40337);m.save();var h=m.createLinearGradient(-1051.93545446865,-150.69685117966003,-1051.93545446865,327.66039340941995);h.addColorStop(0,"rgba(0, 0, 0, 0)");h.addColorStop(0.5,"rgba(0, 0, 0, 1)");h.addColorStop(1,"rgba(0, 0, 0, 0)");m.fillStyle=h;m.strokeStyle="rgba(0, 0, 0, 0)";m.lineWidth=
1;m.lineCap="round";m.lineJoin="miter";m.miterLimit=4;m.globalAlpha=0.4020618498325348;m.beginPath();m.moveTo(-1559.2523,-150.69685);m.lineTo(-219.6188000000002,-150.69685);m.quadraticCurveTo(-219.6188000000002,-150.69685,-219.6188000000002,-150.69685);m.lineTo(-219.6188000000002,327.66033000000004);m.quadraticCurveTo(-219.6188000000002,327.66033000000004,-219.6188000000002,327.66033000000004);m.lineTo(-1559.2523,327.66033000000004);m.quadraticCurveTo(-1559.2523,327.66033000000004,-1559.2523,327.66033000000004);
m.lineTo(-1559.2523,-150.69685);m.quadraticCurveTo(-1559.2523,-150.69685,-1559.2523,-150.69685);m.closePath();m.fill();m.stroke();m.restore();m.save();h=m.createRadialGradient(-211.14593668118982,85.66786882034,0,-211.14593668118982,85.66786882034,117.14286);h.addColorStop(0,"rgba(0, 0, 0, 1)");h.addColorStop(1,"rgba(0, 0, 0, 0)");m.fillStyle=h;m.strokeStyle="rgba(0, 0, 0, 0)";m.lineWidth=1;m.lineCap="round";m.lineJoin="miter";m.miterLimit=4;m.globalAlpha=0.4020618498325348;m.beginPath();m.moveTo(-219.61876,
-150.68038);m.bezierCurveTo(-219.61876,-150.68038,-219.61876,327.65041,-219.61876,327.65041);m.bezierCurveTo(-76.744594,328.55086,125.78146,220.48075,125.78138,88.454235);m.bezierCurveTo(125.78138,-43.572302,-33.655436,-150.68036,-219.61876,-150.68038);m.closePath();m.fill();m.stroke();m.restore();m.save();h=m.createRadialGradient(-1567.7247633188101,85.66786882034,0,-1567.7247633188101,85.66786882034,117.14286);h.addColorStop(0,"rgba(0, 0, 0, 1)");h.addColorStop(1,"rgba(0, 0, 0, 0)");m.fillStyle=
h;m.strokeStyle="rgba(0, 0, 0, 0)";m.lineWidth=1;m.lineCap="round";m.lineJoin="miter";m.miterLimit=4;m.globalAlpha=0.4020618498325348;m.beginPath();m.moveTo(-1559.2523,-150.68038);m.bezierCurveTo(-1559.2523,-150.68038,-1559.2523,327.65041,-1559.2523,327.65041);m.bezierCurveTo(-1702.1265,328.55086,-1904.6525,220.48075,-1904.6525,88.454235);m.bezierCurveTo(-1904.6525,-43.572302,-1745.2157,-150.68036,-1559.2523,-150.68038);m.closePath();m.fill();m.stroke();m.restore();m.restore();m.save();m.transform(1,
0,0.004537846,1,-0.138907,-1.394718E-15);m.save();m.fillStyle="#cc0000";m.strokeStyle="#9f0000";m.lineWidth=0.6382977962493896;m.miterLimit=4;m.transform(1,0,-0.008726683,1,0.328074,1.276596);m.beginPath();m.moveTo(33.282781,38.644744);m.lineTo(22.407791,18.394765);m.bezierCurveTo(22.095292,17.832266,21.532792,17.519767,20.907793,17.519767);m.bezierCurveTo(20.282793,17.519767,19.720294,17.894765,19.407795,18.457265);m.lineTo(8.7828048,38.707245);m.bezierCurveTo(8.5328048,39.207244,8.5328048,39.894744,
8.8453048,40.394743);m.bezierCurveTo(9.1578038,40.894743,9.6578038,41.144742,10.282804,41.144742);m.lineTo(31.782782,41.144742);m.bezierCurveTo(32.407781,41.144742,32.97028,40.832243,33.220281,40.332243);m.bezierCurveTo(33.53278,39.832243,33.53278,39.207244,33.282781,38.644744);m.closePath();m.fill();m.stroke();m.restore();m.save();m.strokeStyle="#000000";m.miterLimit=4;m.transform(0.625,0,-0.005534934,0.634254,6.164053,15.76055);m.save();m.save();m.restore();m.save();m.restore();m.restore();m.save();
h=m.createLinearGradient(4.1914,11.1133,47.3197,56.0523);h.addColorStop(0,"#D4D4D4");h.addColorStop(0.3982,"#E2E2E2");h.addColorStop(1,"#FFFFFF");m.fillStyle=h;m.strokeStyle="rgba(0, 0, 0, 0)";m.beginPath();m.moveTo(9.5,37.6);m.bezierCurveTo(9.2,38.1,9.5,38.5,10,38.5);m.lineTo(38.2,38.5);m.bezierCurveTo(38.7,38.5,39,38.1,38.7,37.6);m.lineTo(24.4,11);m.bezierCurveTo(24.1,10.5,23.7,10.5,23.5,11);m.lineTo(9.5,37.6);m.closePath();m.fill();m.stroke();m.restore();m.restore();m.save();m.fillStyle="rgba(0, 0, 0, 0)";
h=m.createLinearGradient(9.5588786783069,29.483851249035002,29.61032677792,46.318955598740004);h.addColorStop(0,"rgba(255, 255, 255, 1)");h.addColorStop(1,"rgba(255, 255, 255, 0.34020618)");m.strokeStyle="[object CanvasGradient]";m.lineWidth=0.6382979154586792;m.miterLimit=4;m.transform(1,0,-0.008726683,1,0.318277,1.276596);m.globalAlpha=0.5;m.beginPath();m.moveTo(32.323106,38.183905);m.lineTo(22.150271,19.265666);m.bezierCurveTo(21.71698,18.45069,21.561698,18.189213,20.908406,18.189213);m.bezierCurveTo(20.346525,
18.189213,20.054127,18.57002,19.651305,19.339291);m.lineTo(9.7489285,38.242296);m.bezierCurveTo(9.1737649,39.303588,9.1128238,39.580228,9.3937644,40.047345);m.bezierCurveTo(9.6747034,40.514462,10.032797,40.48902,11.356441,40.519491);m.lineTo(30.974593,40.519491);m.bezierCurveTo(32.206825,40.534726,32.483988,40.440837,32.70874,39.97372);m.bezierCurveTo(32.989681,39.506602,32.867799,39.136,32.323106,38.183905);m.closePath();m.fill();m.stroke();m.restore();m.restore();m.save();m.strokeStyle="#000000";
m.miterLimit=4;m.transform(0.555088,0,0,0.555052,7.749711,17.80196);m.save();m.strokeStyle="rgba(0, 0, 0, 0)";m.beginPath();m.moveTo(23.9,36.5);m.bezierCurveTo(22.6,36.5,21.6,35.5,21.6,34.2);m.bezierCurveTo(21.6,32.8,22.5,31.9,23.9,31.9);m.bezierCurveTo(25.3,31.9,26.1,32.8,26.2,34.2);m.bezierCurveTo(26.2,35.5,25.3,36.5,23.9,36.5);m.lineTo(23.9,36.5);m.closePath();m.moveTo(22.5,30.6);m.lineTo(21.9,19.1);m.lineTo(25.9,19.1);m.lineTo(25.3,30.6);m.lineTo(22.4,30.6);m.lineTo(22.5,30.6);m.closePath();m.fill();
m.stroke();m.restore();m.restore();m.restore();m.restore();m.restore()}})(r.viewer);(function(q,m,p,h,n){function l(){this.pool=[]}function f(){this.pool=[]}function b(a){this.pool=[];this.rectanglePool=a}function a(){this.pool=[]}q.ArrayPool=l;q.PointPool=f;q.RectanglePool=a;q.RectangleArrayPool=b;var e=p.Point,k=h.DataRectangle;l.prototype={create:function(a){var b=this.pool.pop();if(b)return b.length=a,b;a=Array(a);a._pool=this;a.free=this.arrFree;return a},free:function(a){this.pool.push(a);a.length=
0},arrFree:function(){this._pool.free(this)}};f.prototype={clone:function(a){return this.create(a.x,a.y)},create:function(a,b){var d=this.pool.pop();return d?(d.x=a,d.y=b,d):new e(a,b)},free:function(a){this.pool.push(a)}};b.prototype={create:function(a){var b=this.pool.pop();if(b)return b.length=a,b;a=Array(a);a._pool=this;a._ref=0;a.callback=null;a.incRef=this.arrIncRef;a.decRef=this.arrDecRef;return a},free:function(a){this.pool.push(a);for(var b=this.rectanglePool.pool,d=0,k=a.length;d<k;++d)b.push(a[d]);
a.length=0},arrIncRef:function(){++this._ref},arrDecRef:function(){var a=--this._ref;0===a?(this._pool.free(this),this.callback&&this.callback(this)):0>a&&(this._ref=0,m.log.error("[RectangleArrayPool] Unbalanced decRef call!"))}};a.prototype={clone:function(a){var b=this.pool.pop();b||(b=new k(0,0,0,0,0,null));b.assign(a);return b},create:function(a,b,d,e,f,v){var l=this.pool.pop();return l?(l.init(b,d,e,f,v,a),l):new k(b,d,e,f,v,a)},free:function(a){var b=this.pool;1E4>b.length&&b.push(a)}};q.GLOBAL_POINT_POOL=
new f;q.GLOBAL_ARRAY_POOL=new l;q.GLOBAL_RECTANGLE_POOL=new a})(r.utils.pools,r,r.geometry,r.geometry2,_);(function(q,m){function p(h){for(var n=0,l=h.length;n<l;++n){var f=parseInt(h[n],10);if(m.isNaN(f))throw Error('Unable to parse a date time string ["'+h[n]+'" is not a number]');h[n]=f}return h}q.parseDateTimeUTC=function(h){var n=h.split("T"),l=p(n[0].split("-")),f=n[1],b=f.indexOf("-"),n=f.indexOf("+"),a=null;-1!==b?(a=p(f.substring(b+1).split(":")),f=f.substring(0,b)):-1!==n&&(a=p(f.substring(n+
1).split(":")),f=f.substring(0,n));f=p(f.split(":"));if(3===l.length&&3===f.length)return h=new Date,h.setUTCFullYear(l[0]),h.setUTCMonth(l[1]-1),h.setUTCDate(l[2]),h.setUTCHours(f[0]),h.setUTCMinutes(f[1]),h.setUTCSeconds(f[2]),null!==a&&(l=36E5*a[0]+6E4*a[1],-1!==n&&(l*=-1),h.setUTCMilliseconds(l)),h;throw Error('Unable to parse a date time string ["'+h+'" has an incorrect format]');}})(r.utils,_);(function(q,m,p,h,n,l){function f(b,a){this.viewer=a;this.model=b;this.document=null;a.on("document:attached",
this.onDocumentAttached,this);a.on("document:detached",this.onDocumentDetached,this);b.on("change:offlineExpiryDate",this.onOfflineStorageExpiryDateChanged,this);b.on("change:cacheEnabled",this.onCacheEnabled,this);this.checkTimer=null;this.infoLoaded=!1}q.OfflineStorageGuard=f;f.prototype={destroy:function(){viewer.off("document:attached",this.onDocumentAttached,this);viewer.off("document:detached",this.onDocumentDetached,this)},onDocumentAttached:function(b){this.document=b;b.on("info:loaded",this.onInfoLoaded,
this)},onInfoLoaded:function(){this.infoLoaded=!0;this.onOfflineStorageExpiryDateChanged()},onDocumentDetached:function(b){b.off("info:loaded",this.onInfoLoaded,this);this.document=null;this.infoLoaded=!1;this.scheduleInvalidation(null)},onOfflineStorageExpiryDateChanged:function(){this.model.has("offlineExpiryDate")?this.scheduleInvalidation(m.parseDateTimeUTC(this.model.get("offlineExpiryDate")).getTime()):this.scheduleInvalidation(null)},onCacheEnabled:function(){this.document&&(this.document.getContext().cacheEnabled=
this.model.get("cacheEnabled"))},scheduleInvalidation:function(b){if(this.infoLoaded)if(clearTimeout(this.checkTimer),null===b)this.document.getContext().offlineStorage=!0;else{var a=b-Date.now();0>a?(a=0,this.document.getContext().offlineStorage=!1):this.document.getContext().offlineStorage=!0;this.checkTimer=setTimeout(l.bind(function(){b>Date.now()&&this.scheduleInvalidation(b);this.viewer.cancelCurrentStorageAction();var a=this.document.getContext();a.offlineStorage=!1;var k=a.cacheManager.openCache(a.url,
l.bind(function(){k.erase();this.document.trigger("offline-invalidated",k.downloadState===p.CACHE_STATE.DOWNLOADED)},this),function(){h.warn("there is a problem during document removal")})},this),Math.min(a,2147483647))}}}})(r.viewer,r.utils,r.io,r.log,Backbone,_);(function(q,m,p,h){function n(b,a){this.viewer=b;a.on("change:cursor",this.requestChange,this);this._onRender=new m.UISync(this.onRender,this,0);this._requestedCursor=this._renderedCursor=null}function l(b,a){this.cursor=b;this.priority=
a;this.idx=null}function f(){this._defaultCursor=new l(null,0);this._cursors=[this._defaultCursor]}q.CursorView=n;q.CursorModel=f;q.Cursor=l;n.prototype={requestChange:function(b,a){null===a&&(a="default");this._requestedCursor!==a&&(this._renderedCursor===a?this._requestedCursor=null:(this._requestedCursor=a,this.viewer.uiLoop.runAsync(this._onRender)))},onRender:function(){var b=this._requestedCursor;null!==b&&(this._renderedCursor=this.viewer.el.style.cursor=b,this._requestedCursor=null)}};l.create=
function(b,a){"_cursors"in this||(this._cursors=[]);var e=h.find(this._cursors,function(k){return k.cursor===b&&k.priority===a});if(e)return e;e=new l(b,a);this._cursors.push(e);return e};l.comparator=function(b,a){var e=b.priority-a.priority;0===e&&(e=b.idx-a.idx);return e};f.prototype={push:function(b){return null===b?!1:-1===this._cursors.indexOf(b)?(b.idx=this._cursors.length,this._cursors.push(b),this._cursors.sort(l.comparator),this.triggerUpdate(),!0):!1},pop:function(b){null!==b&&(this._cursors=
h.without(this._cursors,b),b.idx=null,this.triggerUpdate())},triggerUpdate:function(){this.trigger("change:cursor",this,this.currentCursor().cursor)},currentCursor:function(){var b=this._cursors;return b[b.length-1]}};h.extend(f.prototype,p.Events)})(r.viewer,r.ui,Backbone,_);(function(q,m,p){function h(f){f||(f=null);this.matrix=f;this.p1=new l(Number.MAX_VALUE,Number.MAX_VALUE);this.p2=new l(Number.MIN_VALUE,Number.MAX_VALUE);this.p3=new l(Number.MIN_VALUE,Number.MIN_VALUE);this.p4=new l(Number.MAX_VALUE,
Number.MIN_VALUE)}q.RectangleContext=h;var n=p.DataRectangle,l=m.Point;q=h.prototype;q.moveTo=function(f,b){var a=new l(f,b);this.matrix&&(a=this.matrix.multiplyPoint(a));var e=this.p1;e.x=Math.min(e.x,a.x);e.y=Math.min(e.y,a.y);e=this.p2;e.x=Math.max(e.x,a.x);e.y=Math.min(e.y,a.y);e=this.p3;e.x=Math.max(e.x,a.x);e.y=Math.max(e.y,a.y);e=this.p4;e.x=Math.min(e.x,a.x);e.y=Math.max(e.y,a.y)};q.getRectangle=function(){return new n(this.p1.x,this.p1.y,this.p2.x-this.p1.x,this.p4.y-this.p1.y,0,null)};q.lineTo=
function(f,b){this.moveTo(f,b)};q.bezierCurveTo=function(f,b,a,e,k,c){this.moveTo(k,c)};q.quadraticCurveTo=function(f,b,a,e){this.moveTo(a,e)};q.closePath=function(){};q.arc=q.translate=q.rotate=q.scale=function(){r.log.warn("cannot aproximate ractangle correctly")}})(r.utils,r.geometry,r.geometry2);(function(q,m,p,h,n,l){function f(a,c){this.rectangleStorage=a;this.nameRectangleStorage=c;this.add=!1;this.pageNumber=0}p.extend(q,{LinkRectangleProcessorFactory:function(a,c){this.getInstance=function(){return new f(a,
c)}},LinkToRectangleProcessor:f});q=m.geometry.Point;var b=l.GLOBAL_RECTANGLE_POOL,a=new q(0,0),e=new q(0,0);f.prototype={begin:function(a){this.pageNumber=a;this.add=this.rectangleStorage.begin(a);this.nameRectangleStorage.begin(a)},addLink:function(a,c,b,d){this.add&&(a=this.getRectangle(a,c,b,d))&&this.rectangleStorage.add(this.pageNumber,a)},getRectangle:function(k,c,g,d){var t=null;"G"===g?(a.x=d.x,a.y=d.y,k.inPlaceMultiplyPoint(a),e.x=d.x+d.width,e.y=d.y+d.height,k.inPlaceMultiplyPoint(e),e.x-=
a.x,e.y-=a.y,t=b.create(c,a.x,a.y,e.x,e.y,0)):"P"===g&&(g=d.properties.E,k=new m.utils.RectangleContext(k),m.viewer.processPathData(k,g),t=k.getRectangle(),t.d=c,t=b.clone(t));return t},addName:function(a,c,b,d){this.add&&(a=this.getRectangle(a,c,b,d))&&this.nameRectangleStorage.add(this.pageNumber,a)},end:function(){this.add&&(this.rectangleStorage.commit(this.pageNumber),this.nameRectangleStorage.trigger("finished",this.pageNumber))},freeMemory:function(){this.rectangleStorage.free(this.pageNumber);
this.nameRectangleStorage.free(this.pageNumber)}}})(r.viewer,r,_,jQuery,document,r.utils.pools);(function(q,m,p,h,n,l,f,b){function a(a,b,d,g){this.linkRectangleStorage=a;this.nameRectangleStorage=b;this.cursorModel=g;this.viewer=d;this.pageNumber=this.waitForName=null;this.lastMousePosition=new p.Point(0,0);this.queryPoint=new p.Point(0,0);this.queryRectangle=new h.DataRectangle(0,0,0,0,0,null);this.queryResult=[];d.on("change:viewport",this.onRenderCursorStatus,this).on("mousemove",this.onMouseMove,
this).on("mouseleave",this.onMouseLeave,this).on("mouseup",this.onClick,this).on("tap",this.onTap,this);b.on("finished",this.onNameRectanglesFinished,this);this.renderCursorStatus=new n.UISync(this.onRenderCursorStatus,this,0);this.status=c}function e(a){if(r.is_mobile){var c=l.document,b=c.createElement("a");b.setAttribute("href",a);b.setAttribute("target","_blank");a=c.createEvent("HTMLEvents");a.initEvent("click",!0,!0);b.dispatchEvent(a)}else l.open(a)}q.LinkController=a;q.openLink=e;m=q;var k=
m.STATES.get("READY"),c=null,g=m.Cursor.create("text",0),d=m.Cursor.create("pointer",0);a.prototype={onRenderCursorStatus:function(){var a=this.status,b=c,e=null;this.viewer.state.current()===k&&(e=this.getLink(this.lastMousePosition));null!==this.pageNumber?(b=g,a!==b&&this.viewer.setProperty("pageUnderMouse",this.pageNumber)):a===g&&this.viewer.setProperty("pageUnderMouse",null);e&&(b=d);a!==b&&(a!==c&&this.cursorModel.pop(a),b!==c&&this.cursorModel.push(b));this.status=b},onNameRectanglesFinished:function(a){this.waitForName&&
this.waitForName.pageNumber===a&&(this.tryFindRefNamePosition(this.waitForName.pageNumber,this.waitForName.name),this.waitForName=null)},onMouseMove:function(a,c){var b=this.lastMousePosition;b.x=a.pageX;b.y=a.pageY;this.onDocumentMousePositionChanged()},onMouseLeave:function(a){0===a.which&&(a=this.lastMousePosition,a.x=-1,a.y=-1,this.onDocumentMousePositionChanged())},onClick:function(a,c){var b=this.lastMousePosition;b.x=a.pageX;b.y=a.pageY;c.current()===k&&(b=this.getLink(b))&&this.open(b.d)},
onTap:function(a,c){this.onClick(a.gesture.center,c)},onDocumentMousePositionChanged:function(){this.viewer.state.current()===k&&this.viewer.uiLoop.runAsync(this.renderCursorStatus)},open:function(a){if(0===a.indexOf("name:")){var c=a.substring(5,a.length);if(0<c.length){var b=this.document.getTargetPage(c);null!==b?(this.viewer.scrollTo(b),this.tryFindRefNamePosition(a,c)||(this.waitForName={name:c,pageNumber:b})):r.log.warn("link="+a+" not found")}}else 0===a.indexOf("page:")?(b=parseInt(a.substring(5,
a.length),10),f.isNaN(b)||this.viewer.scrollTo(b-1)):e(a)},getLink:function(a){var c=this.viewer,b=this.pageNumber=c.getPageNumberByCoordinates(a.x,a.y,1),d=this.queryResult;d.length=0;if(null!==b){var g=this.queryPoint;g.x=a.x;g.y=a.y;c.translateCoordinatesToPage(g,b);a=this.queryRectangle;a.init(g.x,g.y,1,1,0,null);this.linkRectangleStorage.intersect(b,d,a)}b=0<d.length?d[0]:null;d.length=0;return b},tryFindRefNamePosition:function(a,c){var b=this.nameRectangleStorage.getRectangles(a,0,!0);if(null!==
b)for(var d=0,g=b.length;d<g;++d){var k=b[d];if(k.d===c)return this.viewer.scrollToPoint(a,k.position,"top"),!0}return!1}}})(r.viewer,r.viewer,r.geometry,r.geometry2,r.ui,I,_,jQuery);(function(q,m,p,h){function n(a,c){if(h.console){var b=!1;m.each(e,function(d,g){if(a==d){var k=h.console[g.toLowerCase()];m.isFunction(k)&&(k.apply(h.console,c),b=!0)}});!b&&m.isFunction(h.console.log)&&h.console.log.apply(h.console,c)}}function l(b,e){b>=c&&(a&&a(b,e,k[b]),n(b,e));b>=g&&(100<d.length&&d.shift(),e.toString=
f,d.push({level:b,message:e}))}function f(){for(var a=[],c=0,b=this.length;c!==b;++c){var d=this[c];null===d?a.push("null"):m.isUndefined(d)?a.push("undefined"):m.isString(d)||m.isNumber(d)||m.isBoolean(d)?a.push(d):d.toString?a.push(d.toString()):a.push(JSON.stringify(d))}return a.join(" ")}function b(){for(var a=[],c=0,b=arguments.length;c!==b;++c)a[c]=arguments[c];return a}var a=null,e={DEBUG:0,INFO:1,WARN:2,ERROR:3},k=["debug","info","warn","error"];m.extend(q,{levels:e,setLevel:function(a){if(a>=
e.DEBUG&&a<=e.ERROR)c=a;else throw Error("ERROR: level["+a+"] cannot be set!");},setCaptureLevel:function(a){if(a>=e.DEBUG&&a<=e.ERROR)g=a;else throw Error("ERROR: captureLevel["+a+"] cannot be set!");},getLevel:function(){return c},getCapture:function(a){return a?m.filter(d,a):d},setLogger:function(c){a=c},log:l,debug:function(){l(e.DEBUG,b.apply(null,arguments))},info:function(){l(e.INFO,b.apply(null,arguments))},warn:function(){l(e.WARN,b.apply(null,arguments))},error:function(){l(e.ERROR,b.apply(null,
arguments))}});var c=e.WARN,g=e.WARN,d=[]})(r.log,_,jQuery,I);(function(q){q.setProperty=function(m,p,h,n){this[m]!=p&&(this[m]=p,h||(h="change:"+m),this.trigger(h,p,this))}})(r.events);(function(q,m,p,h){q.load=function(b){var a=b.fonts,e=b.success||function(){},k=b.error||function(){},c=b.timeout||1E3,g=b.checkInterval||50,d=b.additionalCharacters||"?",t=b.noASCII?d:n+d;if(!_.isArray(a))throw Error("Error: fonts must be specified!");b=p("<div class='vitrium-font-reference'>");d=Array(a.length+2);
d[0]="<style type='text/css' data-document-font='true'>";for(var y=0,v=a.length;y<v;++y){var A=a[y];p("<div style='top:0px; left:0px; overflow:hidden; width: 1px; height: 1px; visibility: hidden; position:absolute; font-family:\""+A.key+"\"'>"+t+"</div>").appendTo(b);p.browser.chrome&&(A.data=A.data.replace("application/x-font-woff","application/font-woff"));d[y+1]="@font-face { font-family: '"+A.key+"'; src: url('"+A.data+"');}"}d[d.length-1]="</style>";0!==a.length&&(p(h.head).append(d.join("\n")),
b.appendTo("body"));l||(l=h.createElement("canvas"),f=l.getContext("2d"));for(var m=["monospace","sans-serif","serif"],q=Array(m.length),y=0;y<m.length;++y)f.font="72px "+m[y],q[y]=f.measureText(t).width;var E=Array(a.length),u,w=function(){for(var c=!0,b=0;b<a.length;++b){var d=E[b];if(!d)for(var k=0;k<m.length;++k){f.font="72px '"+a[b].key+"',"+m[k];var l=f.measureText(t).width;0<l&&q[k]!=l&&(d=!0,E[b]=!0)}d||(c=!1)}c?(clearTimeout(u),p(".vitrium-font-reference").remove(),e()):x=setTimeout(w,g)},
x=setTimeout(w,g);u=setTimeout(function(){clearTimeout(x);p(".vitrium-font-reference").remove();k(E)},c)};q.free=function(){p("[data-document-font]").remove()};var n="!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",l,f})(r.fonts,r,jQuery,document);(function(q){function m(f,b,a,e){return b>=a&&e>=f?(result.start=n(f,a),result.end=l(b,e),result):null}function p(f,b){this.start=f;this.end=b}function h(){this.intervals=[]}q.intersect1D=function(f,b,a,e){return b>=
a&&e>=f?{start:n(f,a),end:l(b,e)}:null};q.intSubstract1D=function(f,b,a,e){return a<f&&e>b?null:a>=f&&e<=b?a!==e&&a+1!==e?[new p(f,a),new p(e,b)]:[new p(f,b)]:f<=a&&b>a?[new p(f,a)]:a<f&&e>f?[new p(e,b)]:[new p(f,b)]};q.IntInterval=p;q.IntIntervalGroup=h;var n=Math.max,l=Math.min;q.intersect1DFill=m;p.prototype={set:function(f,b){this.start=f;this.end=b},intersect:function(f,b){return null===m(this,this.start,this.end,f,b)},toString:function(){return"<"+this.start+";"+this.end+">"}};h.prototype={add:function(f,
b){this.intervals.push(new p(f,b))},addInterval:function(f){this.intervals.push(f)},substract:function(f,b){for(var a=this.intervals,e=a.length,k=Array(e),c=0,g=0;g<e;++g){var d=a[g],t=d.start,l=d.end;f<t&&b>l||(f>=t&&b<=l?f!==b&&f+1!==b&&(k[c++]=new p(t,f),d.start=b):t<=f&&l>f?d.end=f:f<t&&b>t&&(d.start=b),k[c++]=d)}k.length=c;this.intervals=k},compact:function(){var f=this.intervals;f.sort(function(a,c){return a.start-c.start});for(var b=f.length,a=Array(b),e=0,k=null,c=0;c<b;++c){var g=f[c];0!==
c?g.start<=k.end?k.end=g.end:(k=g,a[e++]=k):(k=g,a[e++]=k)}a.length=e;this.intervals=a}}})(r.utils);(function(q,m,p,h,n,l,f,b,a,e){function k(a,b){this.info=null;this.requests=[{},{},{},{},{}];this.onPageLoaded=l.bind(t,this);this.onInfoLoaded=l.bind(g,this);this.onTextIndexLoaded=l.bind(c,this);this.intersectionResult={start:0,end:0};this.documentInfoOverride={};this.documentInfoProperties=["title","author","publisher"];this.fontsManager=new m.FontsManager(l.bind(function(a){this.trigger("page-fonts:initialized",
a)},this));this.packageFormatHandler=new m.VitriumDocumentPackageFormatManager(a,this.fontsManager);this.context=b;this.fileSystem=a;this.loadInfoFuture=null}function c(a,c){var b=c.userdata.idx;this.trigger("textindex:loaded",b,a,this);v.call(this,D,b)}function g(a){this.info=a;this.trigger("info:loaded",a,this);this.trigger("change:documentInfo",this.getDocumentInfo(),this);v.call(this,E,1);y.call(this,u,1,1);this.packageFormatHandler.loadDocumentOutline({complete:l.bind(d,this),error:A.call(this,
u,1)})}function d(a){v.call(this,u,1);1<a.length?n.log.error("Document contains more that one DocumentOutline."):1==a.length?this.trigger("document-outline:loaded",a[0].data):n.log.debug("There is no DocumentOutline.")}function t(a,c,b){this.trigger("page:loaded",a,b,c,this);3===c&&v.call(this,z,a)}function y(a,c,b){var d=this.isAnyRequest();this.requests[a][c]=b;d||this.trigger("loading:begin",this)}function v(a,c){delete this.requests[a][c];this.isAnyRequest()||this.trigger("loading:end",this)}
function A(a,c){return l.bind(function(b,d){v.call(this,a,c);b&&b.stack&&n.log.error(b.stack);-2!==d&&this.trigger("loading:error",a,c,b,d,this)},this)}var z=0,D=1,E=2,u=4;q.VitriumDocumentModel=k;k.prototype={setDocumentInfo:function(a){var c=l.pick(a,this.documentInfoProperties);l.each(c,function(a,b){null===a&&delete c[b]});this.documentInfoOverride=c;if(null!==this.info){var b=this.getDocumentInfo();this.trigger("change:documentInfo",b,this);var d=this.context.cacheManager.openCache(this.context.url,
function(){d.storeGlobalDocumentInfo(b)},function(){})}},getDocumentInfo:function(){return null===this.info?null:l.extend(l.pick(this.info,this.documentInfoProperties),this.documentInfoOverride)},load:function(){this.requests.loadInfo||(y.call(this,E,1,1),(this.loadInfoFuture=this.packageFormatHandler.loadInfo()).then(this.onInfoLoaded).catchError(A.call(this,E,1)).whenComplete(l.bind(function(){this.loadInfoFuture=null},this)))},requestPage:function(a){y.call(this,z,a,1);this.packageFormatHandler.loadPage({idx:a,
success:this.onPageLoaded,error:A.call(this,z,a)})},requestTextIndexFileForPage:function(a){y.call(this,D,a,1);var c=this.packageFormatHandler.loadTextIndex({idx:a,success:this.onTextIndexLoaded,error:A.call(this,D,a)}),b=this;return function(){c();v.call(b,D)}},freePage:function(a){this.packageFormatHandler.freePage(a);v.call(this,z,a)},freePageRange:function(a,c){for(var b=this.packageFormatHandler,d=a;d<=c;++d)b.freePage(d),v.call(this,z,d)},destroy:function(){this.packageFormatHandler.destroy();
null!==this.loadInfoFuture&&this.loadInfoFuture.cancel()},fileProvider:function(){return this.packageFormatHandler},getTargetPage:function(a){a=this.info.linkTargets[a];return l.isUndefined(a)?null:a},isAnyRequest:function(){for(var a=this.requests,c=!0,b=l.isEmpty,d=0,g=a.length;d<g&&c;++d)c=b(a[d]);return!c},getContext:function(){return this.context},downloadToOfflineStorage:function(){function a(){c||(l.each(b,function(a){a.cancel()}),c=!0,A.erase())}var c=!1,b=[],d=new p.ProgressCompleter(a);
d.future.then(function(){c=!0}).catchError(a);var g=l.bind(d.fail,d),k=this,f=this.context,t=this.fileSystem,v=this.fileSystem.remoteFileSystem,n=this.packageFormatHandler,A=f.cacheManager.openCache(f.url,function(){c||A.setDownloadState(h.CACHE_STATE.DOWNLOADING,function(){c||A.listStoredItems(function(a){if(!c){var f=n.listFilesForDownload(),w=t.entries,y=[],m=0,z=0;l.each(f,function(c){if(-1===a.indexOf(c)){y.push(c);var b=l.find(w,function(a){return a.filename===c});m+=b.compressedSize}});-1===
a.indexOf("||info||")&&v.loadFileSystemInfo().then(function(a){A.storeFileSystemInfo(a,function(){},g)}).catchError(g);var p=4;l.each(y,function(a){var t=v.read(a);t.then(function U(t){c||A.storeFile(a,t,function(){if(!c)if(p=4,--u,0===u){var t=0;l.each(w,function(a){-1!==f.indexOf(a.filename)&&(t+=a.uncompressedSize)});var v=n.loadFirstPageThumbnail().then(function(a){var b=k.getDocumentInfo();b.thumb=a;b.pages=n.getNumberOfPages();b.location=e.location.toString();A.setDownloadState(h.CACHE_STATE.DOWNLOADED,
function(){c||(d.progress(100),d.complete())},g,{documentInfo:b,size:t})}).catchError(g);b.push(v)}else v=l.find(w,function(c){return c.filename===a}),z+=v.compressedSize,1<u&&d.progress(Math.floor(z/m*100))},function(a){--p;0===p?g(a):U(t)})}).catchError(g);b.push(t)});var u=b.length}},g)},g,null)},g);return d.future}};l.extend(k.prototype,b.Events);l.extend(k.prototype,n.events)})(r.viewer,r.viewer,r.async,r.io,r,_,jQuery,Backbone,r.utils,I);(function(q,m){function p(){this.accessors=[]}function h(l,
f){this.priority=l;this.callback=f}function n(l,f){var b=l.priority,a=f.priority;return b>a?-1:b<a?1:0}q.StringPriorityProperty=p;p.prototype={val:function(){for(var l=null,f=0,b=this.accessors.length;f<b;++f){var a=this.accessors[f].callback();if(m.isString(a)){l=a;break}}return l},createAccessor:function(l,f){this.accessors.push(new h(l,f));this.accessors.sort(n)}}})(r.utils,_);(function(q,m,p,h){m=h.Blob&&h.FileReader;var n,l;n=function(b){l.call(this,b)};l=function(b){b||(b=1E3);this.tmp_arr=
null;this.len=b;this.c3=this.c2=this.c1=this.ac=this.i=0};if(h.ArrayBuffer){var f=l.prototype;f.init=function(b){this.tmp_arr=Array(this.len);b()};f.free=function(){this.tmp_arr=null};f.writeUint8Array=function(b,a){if(null!==this.tmp_arr){for(var e=0,k=b.length;e<k;++e)this.decodeUTF8(b[e]);a()}};f.getData=function(b,a){b(this.tmp_arr.join(""))};f.decodeUTF8=function(b){for(var a=String.fromCharCode,e=0,k=this.ac,c=this.c1,g=this.c2,d=this.c3,f=this.tmp_arr,l=b.length,e=0;e<l;++e){0==c?c=b[e]:191<
c&&0===g?g=b[e]:d=b[e];var v=null;128>c?v=c:191<c&&224>c&&0<g?v=(c&31)<<6|g&63:0<d&&(v=(c&15)<<12|(g&63)<<6|d&63);v&&(d=g=c=0,f[k++]=a(v))}this.ac=k;this.c1=c;this.c2=g;this.c3=d};p.extend(n.prototype,f);n.prototype.getData=function(b){b(JSON.parse(this.tmp_arr.join("")))}}else f=l.prototype,f.init=function(b){this.tmp_arr=Array(this.len);b()},f.free=function(){this.tmp_arr=null},f.writeUint8Array=function(b,a){if(null!==this.tmp_arr){for(var e=0,k=b.length;e<k;++e)this.decodeUTF8(b[e]);a()}},f.getData=
function(b,a){b(this.tmp_arr.join(""))},f.decodeUTF8=function(b){var a=String.fromCharCode,e=0,k=this.ac,c=this.c1,g=this.c2,d=this.c3,f=this.tmp_arr,l=b.length;if(b.readNumber)for(e=0;e<l;++e){0==c?c=b.readNumber(1,e):191<c&&0===g?g=b.readNumber(1,e):d=b.readNumber(1,e);var v=null;128>c?v=c:191<c&&224>c&&0<g?v=(c&31)<<6|g&63:0<d&&(v=(c&15)<<12|(g&63)<<6|d&63);v&&(d=g=c=0,f[k++]=a(v))}else for(e=0;e<l;++e)0==c?c=b[e]:191<c&&0===g?g=b[e]:d=b[e],v=null,128>c?v=c:191<c&&224>c&&0<g?v=(c&31)<<6|g&63:0<
d&&(v=(c&15)<<12|(g&63)<<6|d&63),v&&(d=g=c=0,f[k++]=a(v));this.ac=k;this.c1=c;this.c2=g;this.c3=d},p.extend(n.prototype,f),n.prototype.getData=function(b){b(JSON.parse(this.tmp_arr.join("")))};f=l;m&&(n=function(b){l.call(this,length)},l=function(b){this.parts=null},l.prototype={init:function(b){this.parts=[];b()},free:function(){this.parts=null},writeUint8Array:function(b,a){for(var e=this.parts,k=0,c=b.length;k<c;++k)e.push(b[k].buffer);a()},decodeUTF8:function(b){this.parts.push(b.buffer)},getData:function(b){var a=
new h.Blob(this.parts,{type:"text/plain"}),e=new h.FileReader;e.onload=function(){b(this.result);e=a=this.onerror=this.onload=null};e.onerror=function(){b(null);e=a=this.onerror=this.onload=null};e.readAsText(a,"UTF-8")}},p.extend(n.prototype,l.prototype),n.prototype.getDataSuper=n.prototype.getData,n.prototype.getData=function(b){this.getDataSuper(function(a){b(JSON.parse(a))})});p.extend(q,{Utf8Decoder:l,Utf8JSONDecoder:n,SimpleUTF8Decoder:f})})(r.bin,r.log,_,I);(function(q,m,p,h){function n(b){var a=
new p.Completer,e=new m.Utf8Decoder(b.length);e.init(function(){setTimeout(function(){e.decodeUTF8(b);e.getData(function(b){null===b?a.fail():a.complete(b)})},0)});return a.future}function l(b){var a=new p.Completer;b=new Blob([b],{type:"text/plain;charset=UTF-8"});var e=new FileReader;e.onerror=function(){a.fail(e.error)};e.onload=function(){a.complete(new Uint8Array(e.result))};e.readAsArrayBuffer(b);return a.future}function f(b){return p.callDefered(function(){var a=b.length,e=0,k,c;for(c=0;c!==
a;++c)k=b.charCodeAt(c),127>=k?++e:e=2047>=k?e+2:55040>=k||57344<=k?e+3:e+4;a=new Uint8Array(e);e=b.length;k=0;var g;for(g=0;g!==e;++g)c=b.charCodeAt(g),127>=c?a[k++]=c:(2047>=c?a[k++]=192|c>>>6&31:(55040>=c||57344<=c?a[k++]=224|c>>>12&15:(c=(c-55296<<10|b.charCodeAt(++g)-56320)+65536,a[k++]=240|c>>>18&7,a[k++]=128|c>>>12&63),a[k++]=128|c>>>6&63),a[k++]=128|c&63);return a})}h=h.Blob&&h.FileReader;q=q.utf8={encode:null,decode:null};q.decode=n;q.encode=h?l:f;n.true_async=h;l.true_async=!0;f.true_async=
!1})(r.codec,r.bin,r.async,I);(function(q){var m={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(p){var h=new ArrayBuffer(p.length/4*3);return m.decode(p,h)},decode:function(p,h){var n=m._keyStr,l=n.indexOf(p.charAt(p.length-1)),f=n.indexOf(p.charAt(p.length-2)),b=p.length/4*3;64==l&&b--;64==f&&b--;for(var a,e,k,c,g=0,d=0,l=h?new Uint8Array(h):new Uint8Array(b),g=0;g<b;g+=3)a=n.indexOf(p.charAt(d++)),e=n.indexOf(p.charAt(d++)),f=n.indexOf(p.charAt(d++)),
c=n.indexOf(p.charAt(d++)),a=a<<2|e>>4,e=(e&15)<<4|f>>2,k=(f&3)<<6|c,l[g]=a,64!=f&&(l[g+1]=e),64!=c&&(l[g+2]=k);return l}};q.Base64Binary=m})(self||window);(function(q,m,p){function h(a){return m.callDefered(function(){for(var b=p.atob(a),k=b.length,c=new Uint8Array(k),g=0;g!==k;++g)c[g]=b.charCodeAt(g);return c})}function n(a){return m.callDefered(function(){return p.Base64Binary.decode(a)})}var l=p.Blob&&p.FileReader,f=!!p.atob,b={type:"application/binary"};h.true_async=!1;n.true_async=!1;q.base64=
l?function(){function a(a){var c=new m.Completer;a=new Blob([a],b);var g=new FileReader;g.onerror=function(){c.fail()};g.onload=function(){var a=g.result,b=a.indexOf(e);-1===b?c.fail():(a=a.substring(b+e.length,a.length),c.complete(a))};g.readAsDataURL(a);return c.future}var e="base64,";a.true_async=!0;return{encode:a,decode:f?h:n}}():function(){function a(a){return m.callDefered(function(){for(var b="",c=a.length,g=c%3,c=c-g,d,f,l,v,h=0;h<c;h+=3)v=a[h]<<16|a[h+1]<<8|a[h+2],d=(v&16515072)>>18,f=(v&
258048)>>12,l=(v&4032)>>6,v&=63,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[v];1==g?(v=a[c],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(v&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(v&3)<<4]+"=="):2==g&&(v=
a[c]<<8|a[c+1],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(v&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(v&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(v&15)<<2]+"=");return b})}a.true_async=!1;return{encode:a,decode:f?h:n}}()})(r.codec,r.async,I);var R=function(){function q(a,c,b){null!=a&&("number"==typeof a?this.fromNumber(a,c,b):null==c&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,c))}
function m(){return new q(null)}function p(a,c,b,d,g,k){for(;0<=--k;){var e=c*this[a++]+b[d]+g;g=Math.floor(e/67108864);b[d++]=e&67108863}return g}function h(a,c,b,d,g,k){var e=c&32767;for(c>>=15;0<=--k;){var f=this[a]&32767,t=this[a++]>>15,l=c*f+t*e,f=e*f+((l&32767)<<15)+b[d]+(g&1073741823);g=(f>>>30)+(l>>>15)+c*t+(g>>>30);b[d++]=f&1073741823}return g}function n(a,c,b,d,g,k){var e=c&16383;for(c>>=14;0<=--k;){var f=this[a]&16383,t=this[a++]>>14,l=c*f+t*e,f=e*f+((l&16383)<<14)+b[d]+g;g=(f>>28)+(l>>
14)+c*t;b[d++]=f&268435455}return g}function l(a,c){var b=z[a.charCodeAt(c)];return null==b?-1:b}function f(a){var c=m();c.fromInt(a);return c}function b(a){var c=1,b;0!=(b=a>>>16)&&(a=b,c+=16);0!=(b=a>>8)&&(a=b,c+=8);0!=(b=a>>4)&&(a=b,c+=4);0!=(b=a>>2)&&(a=b,c+=2);0!=a>>1&&(c+=1);return c}function a(a){this.m=a}function e(a){this.m=a;this.mp=a.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<a.DB-15)-1;this.mt2=2*a.t}function k(a,c){return a&c}function c(a,c){return a|c}function g(a,
c){return a^c}function d(a,c){return a&~c}function t(){}function y(a){return a}function v(a){this.r2=m();this.q3=m();q.ONE.dlShiftTo(2*a.t,this.r2);this.mu=this.r2.divide(a);this.m=a}var A;"Microsoft Internet Explorer"==navigator.appName?(q.prototype.am=h,A=30):"Netscape"!=navigator.appName?(q.prototype.am=p,A=26):(q.prototype.am=n,A=28);q.prototype.DB=A;q.prototype.DM=(1<<A)-1;q.prototype.DV=1<<A;q.prototype.FV=Math.pow(2,52);q.prototype.F1=52-A;q.prototype.F2=2*A-52;var z=[],D;A=48;for(D=0;9>=D;++D)z[A++]=
D;A=97;for(D=10;36>D;++D)z[A++]=D;A=65;for(D=10;36>D;++D)z[A++]=D;a.prototype.convert=function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):a};a.prototype.revert=function(a){return a};a.prototype.reduce=function(a){a.divRemTo(this.m,null,a)};a.prototype.mulTo=function(a,c,b){a.multiplyTo(c,b);this.reduce(b)};a.prototype.sqrTo=function(a,c){a.squareTo(c);this.reduce(c)};e.prototype.convert=function(a){var c=m();a.abs().dlShiftTo(this.m.t,c);c.divRemTo(this.m,null,c);0>a.s&&0<c.compareTo(q.ZERO)&&
this.m.subTo(c,c);return c};e.prototype.revert=function(a){var c=m();a.copyTo(c);this.reduce(c);return c};e.prototype.reduce=function(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var c=0;c<this.m.t;++c){var b=a[c]&32767,d=b*this.mpl+((b*this.mph+(a[c]>>15)*this.mpl&this.um)<<15)&a.DM,b=c+this.m.t;for(a[b]+=this.m.am(0,d,a,c,0,this.m.t);a[b]>=a.DV;)a[b]-=a.DV,a[++b]++}a.clamp();a.drShiftTo(this.m.t,a);0<=a.compareTo(this.m)&&a.subTo(this.m,a)};e.prototype.mulTo=function(a,c,b){a.multiplyTo(c,b);this.reduce(b)};
e.prototype.sqrTo=function(a,c){a.squareTo(c);this.reduce(c)};q.prototype.copyTo=function(a){for(var c=this.t-1;0<=c;--c)a[c]=this[c];a.t=this.t;a.s=this.s};q.prototype.fromInt=function(a){this.t=1;this.s=0>a?-1:0;0<a?this[0]=a:-1>a?this[0]=a+this.DV:this.t=0};q.prototype.fromString=function(a,c){var b;if(16==c)b=4;else if(8==c)b=3;else if(256==c)b=8;else if(2==c)b=1;else if(32==c)b=5;else if(4==c)b=2;else{this.fromRadix(a,c);return}this.s=this.t=0;for(var d=a.length,g=!1,k=0;0<=--d;){var e=8==b?
a[d]&255:l(a,d);0>e?"-"==a.charAt(d)&&(g=!0):(g=!1,0==k?this[this.t++]=e:k+b>this.DB?(this[this.t-1]|=(e&(1<<this.DB-k)-1)<<k,this[this.t++]=e>>this.DB-k):this[this.t-1]|=e<<k,k+=b,k>=this.DB&&(k-=this.DB))}8==b&&0!=(a[0]&128)&&(this.s=-1,0<k&&(this[this.t-1]|=(1<<this.DB-k)-1<<k));this.clamp();g&&q.ZERO.subTo(this,this)};q.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this[this.t-1]==a;)--this.t};q.prototype.dlShiftTo=function(a,c){var b;for(b=this.t-1;0<=b;--b)c[b+a]=this[b];for(b=
a-1;0<=b;--b)c[b]=0;c.t=this.t+a;c.s=this.s};q.prototype.drShiftTo=function(a,c){for(var b=a;b<this.t;++b)c[b-a]=this[b];c.t=Math.max(this.t-a,0);c.s=this.s};q.prototype.lShiftTo=function(a,c){var b=a%this.DB,d=this.DB-b,g=(1<<d)-1,k=Math.floor(a/this.DB),e=this.s<<b&this.DM,f;for(f=this.t-1;0<=f;--f)c[f+k+1]=this[f]>>d|e,e=(this[f]&g)<<b;for(f=k-1;0<=f;--f)c[f]=0;c[k]=e;c.t=this.t+k+1;c.s=this.s;c.clamp()};q.prototype.rShiftTo=function(a,c){c.s=this.s;var b=Math.floor(a/this.DB);if(b>=this.t)c.t=
0;else{var d=a%this.DB,g=this.DB-d,k=(1<<d)-1;c[0]=this[b]>>d;for(var e=b+1;e<this.t;++e)c[e-b-1]|=(this[e]&k)<<g,c[e-b]=this[e]>>d;0<d&&(c[this.t-b-1]|=(this.s&k)<<g);c.t=this.t-b;c.clamp()}};q.prototype.subTo=function(a,c){for(var b=0,d=0,g=Math.min(a.t,this.t);b<g;)d+=this[b]-a[b],c[b++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;b<this.t;)d+=this[b],c[b++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;b<a.t;)d-=a[b],c[b++]=d&this.DM,d>>=this.DB;d-=a.s}c.s=0>d?-1:0;-1>d?c[b++]=this.DV+
d:0<d&&(c[b++]=d);c.t=b;c.clamp()};q.prototype.multiplyTo=function(a,c){var b=this.abs(),d=a.abs(),g=b.t;for(c.t=g+d.t;0<=--g;)c[g]=0;for(g=0;g<d.t;++g)c[g+b.t]=b.am(0,d[g],c,g,0,b.t);c.s=0;c.clamp();this.s!=a.s&&q.ZERO.subTo(c,c)};q.prototype.squareTo=function(a){for(var c=this.abs(),b=a.t=2*c.t;0<=--b;)a[b]=0;for(b=0;b<c.t-1;++b){var d=c.am(b,c[b],a,2*b,0,1);(a[b+c.t]+=c.am(b+1,2*c[b],a,2*b+1,d,c.t-b-1))>=c.DV&&(a[b+c.t]-=c.DV,a[b+c.t+1]=1)}0<a.t&&(a[a.t-1]+=c.am(b,c[b],a,2*b,0,1));a.s=0;a.clamp()};
q.prototype.divRemTo=function(a,c,d){var g=a.abs();if(!(0>=g.t)){var k=this.abs();if(k.t<g.t)null!=c&&c.fromInt(0),null!=d&&this.copyTo(d);else{null==d&&(d=m());var e=m(),f=this.s;a=a.s;var t=this.DB-b(g[g.t-1]);0<t?(g.lShiftTo(t,e),k.lShiftTo(t,d)):(g.copyTo(e),k.copyTo(d));g=e.t;k=e[g-1];if(0!=k){var l=k*(1<<this.F1)+(1<g?e[g-2]>>this.F2:0),v=this.FV/l,l=(1<<this.F1)/l,h=1<<this.F2,n=d.t,A=n-g,y=null==c?m():c;e.dlShiftTo(A,y);0<=d.compareTo(y)&&(d[d.t++]=1,d.subTo(y,d));q.ONE.dlShiftTo(g,y);for(y.subTo(e,
e);e.t<g;)e[e.t++]=0;for(;0<=--A;){var z=d[--n]==k?this.DM:Math.floor(d[n]*v+(d[n-1]+h)*l);if((d[n]+=e.am(0,z,d,A,0,g))<z)for(e.dlShiftTo(A,y),d.subTo(y,d);d[n]<--z;)d.subTo(y,d)}null!=c&&(d.drShiftTo(g,c),f!=a&&q.ZERO.subTo(c,c));d.t=g;d.clamp();0<t&&d.rShiftTo(t,d);0>f&&q.ZERO.subTo(d,d)}}}};q.prototype.invDigit=function(){if(1>this.t)return 0;var a=this[0];if(0==(a&1))return 0;var c=a&3,c=c*(2-(a&15)*c)&15,c=c*(2-(a&255)*c)&255,c=c*(2-((a&65535)*c&65535))&65535,c=c*(2-a*c%this.DV)%this.DV;return 0<
c?this.DV-c:-c};q.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};q.prototype.exp=function(a,c){if(4294967295<a||1>a)return q.ONE;var d=m(),g=m(),k=c.convert(this),e=b(a)-1;for(k.copyTo(d);0<=--e;)if(c.sqrTo(d,g),0<(a&1<<e))c.mulTo(g,k,d);else var f=d,d=g,g=f;return c.revert(d)};q.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else return this.toRadix(a);var c=(1<<a)-
1,b,d=!1,g="",k=this.t,e=this.DB-k*this.DB%a;if(0<k--)for(e<this.DB&&0<(b=this[k]>>e)&&(d=!0,g="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));0<=k;)e<a?(b=(this[k]&(1<<e)-1)<<a-e,b|=this[--k]>>(e+=this.DB-a)):(b=this[k]>>(e-=a)&c,0>=e&&(e+=this.DB,--k)),0<b&&(d=!0),d&&(g+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));return d?g:"0"};q.prototype.negate=function(){var a=m();q.ZERO.subTo(this,a);return a};q.prototype.abs=function(){return 0>this.s?this.negate():this};q.prototype.compareTo=function(a){var c=
this.s-a.s;if(0!=c)return c;var b=this.t,c=b-a.t;if(0!=c)return 0>this.s?-c:c;for(;0<=--b;)if(0!=(c=this[b]-a[b]))return c;return 0};q.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+b(this[this.t-1]^this.s&this.DM)};q.prototype.mod=function(a){var c=m();this.abs().divRemTo(a,null,c);0>this.s&&0<c.compareTo(q.ZERO)&&a.subTo(c,c);return c};q.prototype.modPowInt=function(c,b){var d;d=256>c||b.isEven()?new a(b):new e(b);return this.exp(c,d)};q.ZERO=f(0);q.ONE=f(1);t.prototype.convert=
y;t.prototype.revert=y;t.prototype.mulTo=function(a,c,b){a.multiplyTo(c,b)};t.prototype.sqrTo=function(a,c){a.squareTo(c)};v.prototype.convert=function(a){if(0>a.s||a.t>2*this.m.t)return a.mod(this.m);if(0>a.compareTo(this.m))return a;var c=m();a.copyTo(c);this.reduce(c);return c};v.prototype.revert=function(a){return a};v.prototype.reduce=function(a){a.drShiftTo(this.m.t-1,this.r2);a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,
this.m.t+1,this.r2);0>a.compareTo(this.r2);)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);0<=a.compareTo(this.m);)a.subTo(this.m,a)};v.prototype.mulTo=function(a,c,b){a.multiplyTo(c,b);this.reduce(b)};v.prototype.sqrTo=function(a,c){a.squareTo(c);this.reduce(c)};var E=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,
313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],u=67108864/E[E.length-1];q.prototype.chunkSize=function(a){return Math.floor(Math.LN2*
this.DB/Math.log(a))};q.prototype.toRadix=function(a){null==a&&(a=10);if(0==this.signum()||2>a||36<a)return"0";var c=this.chunkSize(a),c=Math.pow(a,c),b=f(c),d=m(),g=m(),k="";for(this.divRemTo(b,d,g);0<d.signum();)k=(c+g.intValue()).toString(a).substr(1)+k,d.divRemTo(b,d,g);return g.intValue().toString(a)+k};q.prototype.fromRadix=function(a,c){this.fromInt(0);null==c&&(c=10);for(var b=this.chunkSize(c),d=Math.pow(c,b),g=!1,k=0,e=0,f=0;f<a.length;++f){var t=l(a,f);0>t?"-"==a.charAt(f)&&0==this.signum()&&
(g=!0):(e=c*e+t,++k>=b&&(this.dMultiply(d),this.dAddOffset(e,0),e=k=0))}0<k&&(this.dMultiply(Math.pow(c,k)),this.dAddOffset(e,0));g&&q.ZERO.subTo(this,this)};q.prototype.fromNumber=function(a,b,d){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,d),this.testBit(a-1)||this.bitwiseTo(q.ONE.shiftLeft(a-1),c,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(q.ONE.shiftLeft(a-1),this);else{d=[];var g=a&7;d.length=
(a>>3)+1;b.nextBytes(d);d[0]=0<g?d[0]&(1<<g)-1:0;this.fromString(d,256)}};q.prototype.bitwiseTo=function(a,c,b){var d,g,k=Math.min(a.t,this.t);for(d=0;d<k;++d)b[d]=c(this[d],a[d]);if(a.t<this.t){g=a.s&this.DM;for(d=k;d<this.t;++d)b[d]=c(this[d],g);b.t=this.t}else{g=this.s&this.DM;for(d=k;d<a.t;++d)b[d]=c(g,a[d]);b.t=a.t}b.s=c(this.s,a.s);b.clamp()};q.prototype.changeBit=function(a,c){var b=q.ONE.shiftLeft(a);this.bitwiseTo(b,c,b);return b};q.prototype.addTo=function(a,c){for(var b=0,d=0,g=Math.min(a.t,
this.t);b<g;)d+=this[b]+a[b],c[b++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;b<this.t;)d+=this[b],c[b++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;b<a.t;)d+=a[b],c[b++]=d&this.DM,d>>=this.DB;d+=a.s}c.s=0>d?-1:0;0<d?c[b++]=d:-1>d&&(c[b++]=this.DV+d);c.t=b;c.clamp()};q.prototype.dMultiply=function(a){this[this.t]=this.am(0,a-1,this,0,0,this.t);++this.t;this.clamp()};q.prototype.dAddOffset=function(a,c){if(0!=a){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=a;this[c]>=this.DV;)this[c]-=
this.DV,++c>=this.t&&(this[this.t++]=0),++this[c]}};q.prototype.multiplyLowerTo=function(a,c,b){var d=Math.min(this.t+a.t,c);b.s=0;for(b.t=d;0<d;)b[--d]=0;var g;for(g=b.t-this.t;d<g;++d)b[d+this.t]=this.am(0,a[d],b,d,0,this.t);for(g=Math.min(a.t,c);d<g;++d)this.am(0,a[d],b,d,0,c-d);b.clamp()};q.prototype.multiplyUpperTo=function(a,c,b){--c;var d=b.t=this.t+a.t-c;for(b.s=0;0<=--d;)b[d]=0;for(d=Math.max(c-this.t,0);d<a.t;++d)b[this.t+d-c]=this.am(c-d,a[d],b,0,0,this.t+d-c);b.clamp();b.drShiftTo(1,b)};
q.prototype.modInt=function(a){if(0>=a)return 0;var c=this.DV%a,b=0>this.s?a-1:0;if(0<this.t)if(0==c)b=this[0]%a;else for(var d=this.t-1;0<=d;--d)b=(c*b+this[d])%a;return b};q.prototype.millerRabin=function(a){var c=this.subtract(q.ONE),b=c.getLowestSetBit();if(0>=b)return!1;var d=c.shiftRight(b);a=a+1>>1;a>E.length&&(a=E.length);for(var g=m(),k=0;k<a;++k){g.fromInt(E[Math.floor(Math.random()*E.length)]);var e=g.modPow(d,this);if(0!=e.compareTo(q.ONE)&&0!=e.compareTo(c)){for(var f=1;f++<b&&0!=e.compareTo(c);)if(e=
e.modPowInt(2,this),0==e.compareTo(q.ONE))return!1;if(0!=e.compareTo(c))return!1}}return!0};q.prototype.clone=function(){var a=m();this.copyTo(a);return a};q.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};q.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};q.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<
16>>16};q.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};q.prototype.toByteArray=function(){var a=this.t,c=[];c[0]=this.s;var b=this.DB-a*this.DB%8,d,g=0;if(0<a--)for(b<this.DB&&(d=this[a]>>b)!=(this.s&this.DM)>>b&&(c[g++]=d|this.s<<this.DB-b);0<=a;)if(8>b?(d=(this[a]&(1<<b)-1)<<8-b,d|=this[--a]>>(b+=this.DB-8)):(d=this[a]>>(b-=8)&255,0>=b&&(b+=this.DB,--a)),0!=(d&128)&&(d|=-256),0==g&&(this.s&128)!=(d&128)&&++g,0<g||d!=this.s)c[g++]=d;return c};q.prototype.equals=
function(a){return 0==this.compareTo(a)};q.prototype.min=function(a){return 0>this.compareTo(a)?this:a};q.prototype.max=function(a){return 0<this.compareTo(a)?this:a};q.prototype.and=function(a){var c=m();this.bitwiseTo(a,k,c);return c};q.prototype.or=function(a){var b=m();this.bitwiseTo(a,c,b);return b};q.prototype.xor=function(a){var c=m();this.bitwiseTo(a,g,c);return c};q.prototype.andNot=function(a){var c=m();this.bitwiseTo(a,d,c);return c};q.prototype.not=function(){for(var a=m(),c=0;c<this.t;++c)a[c]=
this.DM&~this[c];a.t=this.t;a.s=~this.s;return a};q.prototype.shiftLeft=function(a){var c=m();0>a?this.rShiftTo(-a,c):this.lShiftTo(a,c);return c};q.prototype.shiftRight=function(a){var c=m();0>a?this.lShiftTo(-a,c):this.rShiftTo(a,c);return c};q.prototype.getLowestSetBit=function(){for(var a=0;a<this.t;++a)if(0!=this[a]){var c=a*this.DB;a=this[a];if(0==a)a=-1;else{var b=0;0==(a&65535)&&(a>>=16,b+=16);0==(a&255)&&(a>>=8,b+=8);0==(a&15)&&(a>>=4,b+=4);0==(a&3)&&(a>>=2,b+=2);0==(a&1)&&++b;a=b}return c+
a}return 0>this.s?this.t*this.DB:-1};q.prototype.bitCount=function(){for(var a=0,c=this.s&this.DM,b=0;b<this.t;++b){for(var d=this[b]^c,g=0;0!=d;)d&=d-1,++g;a+=g}return a};q.prototype.testBit=function(a){var c=Math.floor(a/this.DB);return c>=this.t?0!=this.s:0!=(this[c]&1<<a%this.DB)};q.prototype.setBit=function(a){return this.changeBit(a,c)};q.prototype.clearBit=function(a){return this.changeBit(a,d)};q.prototype.flipBit=function(a){return this.changeBit(a,g)};q.prototype.add=function(a){var c=m();
this.addTo(a,c);return c};q.prototype.subtract=function(a){var c=m();this.subTo(a,c);return c};q.prototype.multiply=function(a){var c=m();this.multiplyTo(a,c);return c};q.prototype.divide=function(a){var c=m();this.divRemTo(a,c,null);return c};q.prototype.remainder=function(a){var c=m();this.divRemTo(a,null,c);return c};q.prototype.divideAndRemainder=function(a){var c=m(),b=m();this.divRemTo(a,c,b);return[c,b]};q.prototype.modPow=function(c,d){var g=c.bitLength(),k,t=f(1),l;if(0>=g)return t;k=18>
g?1:48>g?3:144>g?4:768>g?5:6;l=8>g?new a(d):d.isEven()?new v(d):new e(d);var h=[],n=3,A=k-1,y=(1<<k)-1;h[1]=l.convert(this);if(1<k)for(g=m(),l.sqrTo(h[1],g);n<=y;)h[n]=m(),l.mulTo(g,h[n-2],h[n]),n+=2;for(var z=c.t-1,p,u=!0,q=m(),g=b(c[z])-1;0<=z;){g>=A?p=c[z]>>g-A&y:(p=(c[z]&(1<<g+1)-1)<<A-g,0<z&&(p|=c[z-1]>>this.DB+g-A));for(n=k;0==(p&1);)p>>=1,--n;0>(g-=n)&&(g+=this.DB,--z);if(u)h[p].copyTo(t),u=!1;else{for(;1<n;)l.sqrTo(t,q),l.sqrTo(q,t),n-=2;0<n?l.sqrTo(t,q):(n=t,t=q,q=n);l.mulTo(q,h[p],t)}for(;0<=
z&&0==(c[z]&1<<g);)l.sqrTo(t,q),n=t,t=q,q=n,0>--g&&(g=this.DB-1,--z)}return l.revert(t)};q.prototype.modInverse=function(a){var c=a.isEven();if(this.isEven()&&c||0==a.signum())return q.ZERO;for(var b=a.clone(),d=this.clone(),g=f(1),k=f(0),e=f(0),t=f(1);0!=b.signum();){for(;b.isEven();)b.rShiftTo(1,b),c?(g.isEven()&&k.isEven()||(g.addTo(this,g),k.subTo(a,k)),g.rShiftTo(1,g)):k.isEven()||k.subTo(a,k),k.rShiftTo(1,k);for(;d.isEven();)d.rShiftTo(1,d),c?(e.isEven()&&t.isEven()||(e.addTo(this,e),t.subTo(a,
t)),e.rShiftTo(1,e)):t.isEven()||t.subTo(a,t),t.rShiftTo(1,t);0<=b.compareTo(d)?(b.subTo(d,b),c&&g.subTo(e,g),k.subTo(t,k)):(d.subTo(b,d),c&&e.subTo(g,e),t.subTo(k,t))}if(0!=d.compareTo(q.ONE))return q.ZERO;if(0<=t.compareTo(a))return t.subtract(a);if(0>t.signum())t.addTo(a,t);else return t;return 0>t.signum()?t.add(a):t};q.prototype.pow=function(a){return this.exp(a,new t)};q.prototype.gcd=function(a){var c=0>this.s?this.negate():this.clone();a=0>a.s?a.negate():a.clone();if(0>c.compareTo(a)){var b=
c,c=a;a=b}var b=c.getLowestSetBit(),d=a.getLowestSetBit();if(0>d)return c;b<d&&(d=b);0<d&&(c.rShiftTo(d,c),a.rShiftTo(d,a));for(;0<c.signum();)0<(b=c.getLowestSetBit())&&c.rShiftTo(b,c),0<(b=a.getLowestSetBit())&&a.rShiftTo(b,a),0<=c.compareTo(a)?(c.subTo(a,c),c.rShiftTo(1,c)):(a.subTo(c,a),a.rShiftTo(1,a));0<d&&a.lShiftTo(d,a);return a};q.prototype.isProbablePrime=function(a){var c,b=this.abs();if(1==b.t&&b[0]<=E[E.length-1]){for(c=0;c<E.length;++c)if(b[0]==E[c])return!0;return!1}if(b.isEven())return!1;
for(c=1;c<E.length;){for(var d=E[c],g=c+1;g<E.length&&d<u;)d*=E[g++];for(d=b.modInt(d);c<g;)if(0==d%E[c++])return!1}return b.millerRabin(a)};q.prototype.square=function(){var a=m();this.squareTo(a);return a};return q}(),fa=function(){function q(){this.j=this.i=0;this.S=[]}function m(){var c=(new Date).getTime();b[a++]^=c&255;b[a++]^=c>>8&255;b[a++]^=c>>16&255;b[a++]^=c>>24&255;a>=l&&(a-=l)}function p(){}function h(a,b){return new R(a,b)}function n(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=
this.q=this.p=this.d=null}q.prototype.init=function(a){var b,d,k;for(b=0;256>b;++b)this.S[b]=b;for(b=d=0;256>b;++b)d=d+this.S[b]+a[b%a.length]&255,k=this.S[b],this.S[b]=this.S[d],this.S[d]=k;this.j=this.i=0};q.prototype.next=function(){var a;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;a=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=a;return this.S[a+this.S[this.i]&255]};var l=256,f,b,a;if(null==b){b=[];a=0;var e;if(window.crypto&&window.crypto.getRandomValues){var k=new Uint8Array(32);
window.crypto.getRandomValues(k);for(e=0;32>e;++e)b[a++]=k[e]}if("Netscape"==navigator.appName&&"5">navigator.appVersion&&window.crypto)for(k=window.crypto.random(32),e=0;e<k.length;++e)b[a++]=k.charCodeAt(e)&255;for(;a<l;)e=Math.floor(65536*Math.random()),b[a++]=e>>>8,b[a++]=e&255;a=0;m()}p.prototype.nextBytes=function(c){var g;for(g=0;g<c.length;++g){var d=c,k=g,e;if(null==f){m();f=new q;f.init(b);for(a=0;a<b.length;++a)b[a]=0;a=0}e=f.next();d[k]=e}};n.prototype.doPublic=function(a){return a.modPowInt(this.e,
this.n)};n.prototype.setPublic=function(a,b){if(null!=a&&null!=b&&0<a.length&&0<b.length)this.n=h(a,16),this.e=parseInt(b,16);else throw Error("Invalid RSA public key");};n.prototype.encrypt=function(a){var b;b=this.n.bitLength()+7>>3;if(b<a.length+11)throw Error("Message too long for RSA");for(var d=[],k=a.length-1;0<=k&&0<b;){var e=a.charCodeAt(k--);128>e?d[--b]=e:127<e&&2048>e?(d[--b]=e&63|128,d[--b]=e>>6|192):(d[--b]=e&63|128,d[--b]=e>>6&63|128,d[--b]=e>>12|224)}d[--b]=0;a=new p;for(k=[];2<b;){for(k[0]=
0;0==k[0];)a.nextBytes(k);d[--b]=k[0]}d[--b]=2;d[--b]=0;b=new R(d);if(null==b)return null;b=this.doPublic(b);if(null==b)return null;b=b.toString(16);return 0==(b.length&1)?b:"0"+b};n.prototype.encryptByteArray=function(a){var b;b=this.n.bitLength()+7>>3;if(b<a.length+11)throw Error("Message too long for RSA");for(var d=[],k=a.length-1;0<=k;)d[--b]=a[k--];d[--b]=0;a=new p;for(k=[];2<b;){for(k[0]=0;0==k[0];)a.nextBytes(k);d[--b]=k[0]}d[--b]=2;d[--b]=0;b=new R(d);if(null==b)return null;b=this.doPublic(b);
if(null==b)return null;b=b.toString(16);return 0==(b.length&1)?b:"0"+b};n.prototype.doPrivate=function(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);var b=a.mod(this.p).modPow(this.dmp1,this.p);for(a=a.mod(this.q).modPow(this.dmq1,this.q);0>b.compareTo(a);)b=b.add(this.p);return b.subtract(a).multiply(this.coeff).mod(this.p).multiply(this.q).add(a)};n.prototype.setPrivate=function(a,b,d){if(null!=a&&null!=b&&0<a.length&&0<b.length)this.n=h(a,16),this.e=parseInt(b,16),this.d=h(d,
16);else throw Error("Invalid RSA private key");};n.prototype.setPrivateEx=function(a,b,d,k,e,f,l,n){if(null!=a&&null!=b&&0<a.length&&0<b.length)this.n=h(a,16),this.e=parseInt(b,16),this.d=h(d,16),this.p=h(k,16),this.q=h(e,16),this.dmp1=h(f,16),this.dmq1=h(l,16),this.coeff=h(n,16);else throw Error("Invalid RSA private key");};n.prototype.generate=function(a,b){var d=new p,k=a>>1;this.e=parseInt(b,16);for(var e=new R(b,16);;){for(;this.p=new R(a-k,1,d),0!=this.p.subtract(R.ONE).gcd(e).compareTo(R.ONE)||
!this.p.isProbablePrime(10););for(;this.q=new R(k,1,d),0!=this.q.subtract(R.ONE).gcd(e).compareTo(R.ONE)||!this.q.isProbablePrime(10););if(0>=this.p.compareTo(this.q)){var f=this.p;this.p=this.q;this.q=f}var f=this.p.subtract(R.ONE),l=this.q.subtract(R.ONE),h=f.multiply(l);if(0==h.gcd(e).compareTo(R.ONE)){this.n=this.p.multiply(this.q);this.d=e.modInverse(h);this.dmp1=this.d.mod(f);this.dmq1=this.d.mod(l);this.coeff=this.q.modInverse(this.p);break}}};n.prototype.decrypt=function(a){a=h(a,16);a=this.doPrivate(a);
if(null==a)return null;a:{var b=this.n.bitLength()+7>>3;a=a.toByteArray();for(var d=0;d<a.length&&0==a[d];)++d;if(a.length-d!=b-1||2!=a[d])a=null;else{for(++d;0!=a[d];)if(++d>=a.length){a=null;break a}for(b="";++d<a.length;){var k=a[d]&255;128>k?b+=String.fromCharCode(k):191<k&&224>k?(b+=String.fromCharCode((k&31)<<6|a[d+1]&63),++d):(b+=String.fromCharCode((k&15)<<12|(a[d+1]&63)<<6|a[d+2]&63),d+=2)}a=b}}return a};n.prototype.decrypt2ByteArray=function(a){a=h(a,16);var b=this.doPrivate(a);if(null==
b)return null;a:{a=this.n.bitLength()+7>>3;for(var b=b.toByteArray(),d=0;d<b.length&&0==b[d];)++d;if(b.length-d!=a-1||2!=b[d])a=null;else{for(++d;0!=b[d];)if(++d>=b.length){a=null;break a}for(a=[];++d<b.length;)a.push(b[d]&255)}}return a};return n}(),N=N||function(q,m){var p={},h=p.lib={},n=function(){},l=h.Base={extend:function(a){n.prototype=this;var c=new n;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},
create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},f=h.WordArray=l.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(c){return(c||a).stringify(this)},concat:function(a){var c=this.words,b=a.words,g=this.sigBytes;a=a.sigBytes;this.clamp();
if(g%4)for(var k=0;k<a;k++)c[g+k>>>2]|=(b[k>>>2]>>>24-k%4*8&255)<<24-(g+k)%4*8;else for(k=0;k<a;k+=4)c[g+k>>>2]=b[k>>>2];this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8;a.length=q.ceil(c/4)},clone:function(){var a=l.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*q.random()|0);return new f.init(c,a)}}),b=p.enc={},a=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;
for(var b=[],g=0;g<a;g++){var k=c[g>>>2]>>>24-g%4*8&255;b.push((k>>>4).toString(16));b.push((k&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],g=0;g<c;g+=2)b[g>>>3]|=parseInt(a.substr(g,2),16)<<24-g%8*4;return new f.init(b,c/2)}},e=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],g=0;g<a;g++)b.push(String.fromCharCode(c[g>>>2]>>>24-g%4*8&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],g=0;g<c;g++)b[g>>>2]|=(a.charCodeAt(g)&255)<<
24-g%4*8;return new f.init(b,c)}},k=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(e.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return e.parse(unescape(encodeURIComponent(a)))}},c=h.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new f.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,g=c.sigBytes,k=
this.blockSize,e=g/(4*k),e=a?q.ceil(e):q.max((e|0)-this._minBufferSize,0);a=e*k;g=q.min(4*a,g);if(a){for(var l=0;l<a;l+=k)this._doProcessBlock(b,l);l=b.splice(0,a);c.sigBytes-=g}return new f.init(l,g)},clone:function(){var a=l.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});h.Hasher=c.extend({cfg:l.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},
finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(c,b){return(new g.HMAC.init(a,b)).finalize(c)}}});var g=p.algo={};return p}(Math);(function(){var q=N,m=q.lib.WordArray;q.enc.Base64={stringify:function(m){var h=m.words,n=m.sigBytes,l=this._map;m.clamp();m=[];for(var f=0;f<n;f+=3)for(var b=(h[f>>>2]>>>24-f%4*8&255)<<16|(h[f+1>>>2]>>>24-(f+1)%
4*8&255)<<8|h[f+2>>>2]>>>24-(f+2)%4*8&255,a=0;4>a&&f+0.75*a<n;a++)m.push(l.charAt(b>>>6*(3-a)&63));if(h=l.charAt(64))for(;m.length%4;)m.push(h);return m.join("")},parse:function(p){var h=p.length,n=this._map,l=n.charAt(64);l&&(l=p.indexOf(l),-1!=l&&(h=l));for(var l=[],f=0,b=0;b<h;b++)if(b%4){var a=n.indexOf(p.charAt(b-1))<<b%4*2,e=n.indexOf(p.charAt(b))>>>6-b%4*2;l[f>>>2]|=(a|e)<<24-f%4*8;f++}return m.create(l,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(q){function m(a,
b,d,k,e,f,l){a=a+(b&d|~b&k)+e+l;return(a<<f|a>>>32-f)+b}function p(a,b,d,k,e,f,l){a=a+(b&k|d&~k)+e+l;return(a<<f|a>>>32-f)+b}function h(a,b,d,k,e,f,l){a=a+(b^d^k)+e+l;return(a<<f|a>>>32-f)+b}function n(a,b,d,k,e,f,l){a=a+(d^(b|~k))+e+l;return(a<<f|a>>>32-f)+b}for(var l=N,f=l.lib,b=f.WordArray,a=f.Hasher,f=l.algo,e=[],k=0;64>k;k++)e[k]=4294967296*q.abs(q.sin(k+1))|0;f=f.MD5=a.extend({_doReset:function(){this._hash=new b.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,
b){for(var d=0;16>d;d++){var k=b+d,f=a[k];a[k]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360}var d=this._hash.words,k=a[b+0],f=a[b+1],l=a[b+2],A=a[b+3],z=a[b+4],q=a[b+5],E=a[b+6],u=a[b+7],w=a[b+8],x=a[b+9],r=a[b+10],B=a[b+11],C=a[b+12],J=a[b+13],O=a[b+14],Q=a[b+15],K=d[0],F=d[1],L=d[2],H=d[3],K=m(K,F,L,H,k,7,e[0]),H=m(H,K,F,L,f,12,e[1]),L=m(L,H,K,F,l,17,e[2]),F=m(F,L,H,K,A,22,e[3]),K=m(K,F,L,H,z,7,e[4]),H=m(H,K,F,L,q,12,e[5]),L=m(L,H,K,F,E,17,e[6]),F=m(F,L,H,K,u,22,e[7]),K=m(K,F,L,H,w,7,e[8]),H=
m(H,K,F,L,x,12,e[9]),L=m(L,H,K,F,r,17,e[10]),F=m(F,L,H,K,B,22,e[11]),K=m(K,F,L,H,C,7,e[12]),H=m(H,K,F,L,J,12,e[13]),L=m(L,H,K,F,O,17,e[14]),F=m(F,L,H,K,Q,22,e[15]),K=p(K,F,L,H,f,5,e[16]),H=p(H,K,F,L,E,9,e[17]),L=p(L,H,K,F,B,14,e[18]),F=p(F,L,H,K,k,20,e[19]),K=p(K,F,L,H,q,5,e[20]),H=p(H,K,F,L,r,9,e[21]),L=p(L,H,K,F,Q,14,e[22]),F=p(F,L,H,K,z,20,e[23]),K=p(K,F,L,H,x,5,e[24]),H=p(H,K,F,L,O,9,e[25]),L=p(L,H,K,F,A,14,e[26]),F=p(F,L,H,K,w,20,e[27]),K=p(K,F,L,H,J,5,e[28]),H=p(H,K,F,L,l,9,e[29]),L=p(L,H,K,
F,u,14,e[30]),F=p(F,L,H,K,C,20,e[31]),K=h(K,F,L,H,q,4,e[32]),H=h(H,K,F,L,w,11,e[33]),L=h(L,H,K,F,B,16,e[34]),F=h(F,L,H,K,O,23,e[35]),K=h(K,F,L,H,f,4,e[36]),H=h(H,K,F,L,z,11,e[37]),L=h(L,H,K,F,u,16,e[38]),F=h(F,L,H,K,r,23,e[39]),K=h(K,F,L,H,J,4,e[40]),H=h(H,K,F,L,k,11,e[41]),L=h(L,H,K,F,A,16,e[42]),F=h(F,L,H,K,E,23,e[43]),K=h(K,F,L,H,x,4,e[44]),H=h(H,K,F,L,C,11,e[45]),L=h(L,H,K,F,Q,16,e[46]),F=h(F,L,H,K,l,23,e[47]),K=n(K,F,L,H,k,6,e[48]),H=n(H,K,F,L,u,10,e[49]),L=n(L,H,K,F,O,15,e[50]),F=n(F,L,H,K,
q,21,e[51]),K=n(K,F,L,H,C,6,e[52]),H=n(H,K,F,L,A,10,e[53]),L=n(L,H,K,F,r,15,e[54]),F=n(F,L,H,K,f,21,e[55]),K=n(K,F,L,H,w,6,e[56]),H=n(H,K,F,L,Q,10,e[57]),L=n(L,H,K,F,E,15,e[58]),F=n(F,L,H,K,J,21,e[59]),K=n(K,F,L,H,z,6,e[60]),H=n(H,K,F,L,B,10,e[61]),L=n(L,H,K,F,l,15,e[62]),F=n(F,L,H,K,x,21,e[63]);d[0]=d[0]+K|0;d[1]=d[1]+F|0;d[2]=d[2]+L|0;d[3]=d[3]+H|0},_doFinalize:function(){var a=this._data,b=a.words,d=8*this._nDataBytes,k=8*a.sigBytes;b[k>>>5]|=128<<24-k%32;var e=q.floor(d/4294967296);b[(k+64>>>
9<<4)+15]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;b[(k+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash;b=a.words;for(d=0;4>d;d++)k=b[d],b[d]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360;return a},clone:function(){var c=a.clone.call(this);c._hash=this._hash.clone();return c}});l.MD5=a._createHelper(f);l.HmacMD5=a._createHmacHelper(f)})(Math);(function(){var q=N,m=q.lib,p=m.Base,h=m.WordArray,m=q.algo,n=m.EvpKDF=p.extend({cfg:p.extend({keySize:4,
hasher:m.MD5,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,f){for(var b=this.cfg,a=b.hasher.create(),e=h.create(),k=e.words,c=b.keySize,b=b.iterations;k.length<c;){g&&a.update(g);var g=a.update(l).finalize(f);a.reset();for(var d=1;d<b;d++)g=a.finalize(g),a.reset();e.concat(g)}e.sigBytes=4*c;return e}});q.EvpKDF=function(l,f,b){return n.create(b).compute(l,f)}})();N.lib.Cipher||function(q){var m=N,p=m.lib,h=p.Base,n=p.WordArray,l=p.BufferedBlockAlgorithm,f=m.enc.Base64,
b=m.algo.EvpKDF,a=p.Cipher=l.extend({cfg:h.extend(),createEncryptor:function(a,c){return this.create(this._ENC_XFORM_MODE,a,c)},createDecryptor:function(a,c){return this.create(this._DEC_XFORM_MODE,a,c)},init:function(a,c,b){this.cfg=this.cfg.extend(b);this._xformMode=a;this._key=c;this.reset()},reset:function(){l.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,
_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(c,b,g){return("string"==typeof b?t:d).encrypt(a,c,b,g)},decrypt:function(c,b,g){return("string"==typeof b?t:d).decrypt(a,c,b,g)}}}});p.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var e=m.mode={},k=function(a,c,b){var d=this._iv;d?this._iv=q:d=this._prevBlock;for(var g=0;g<b;g++)a[c+g]^=d[g]},c=(p.BlockCipherMode=h.extend({createEncryptor:function(a,c){return this.Encryptor.create(a,c)},createDecryptor:function(a,
c){return this.Decryptor.create(a,c)},init:function(a,c){this._cipher=a;this._iv=c}})).extend();c.Encryptor=c.extend({processBlock:function(a,c){var b=this._cipher,d=b.blockSize;k.call(this,a,c,d);b.encryptBlock(a,c);this._prevBlock=a.slice(c,c+d)}});c.Decryptor=c.extend({processBlock:function(a,c){var b=this._cipher,d=b.blockSize,g=a.slice(c,c+d);b.decryptBlock(a,c);k.call(this,a,c,d);this._prevBlock=g}});e=e.CBC=c;c=(m.pad={}).Pkcs7={pad:function(a,c){for(var b=4*c,b=b-a.sigBytes%b,d=b<<24|b<<16|
b<<8|b,g=[],k=0;k<b;k+=4)g.push(d);b=n.create(g,b);a.concat(b)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};p.BlockCipher=a.extend({cfg:a.cfg.extend({mode:e,padding:c}),reset:function(){a.reset.call(this);var c=this.cfg,b=c.iv,c=c.mode;if(this._xformMode==this._ENC_XFORM_MODE)var d=c.createEncryptor;else d=c.createDecryptor,this._minBufferSize=1;this._mode=d.call(c,this,b&&b.words)},_doProcessBlock:function(a,c){this._mode.processBlock(a,c)},_doFinalize:function(){var a=this.cfg.padding;
if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var c=this._process(!0)}else c=this._process(!0),a.unpad(c);return c},blockSize:4});var g=p.CipherParams=h.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),e=(m.format={}).OpenSSL={stringify:function(a){var c=a.ciphertext;a=a.salt;return(a?n.create([1398893684,1701076831]).concat(a).concat(c):c).toString(f)},parse:function(a){a=f.parse(a);var c=a.words;if(1398893684==
c[0]&&1701076831==c[1]){var b=n.create(c.slice(2,4));c.splice(0,4);a.sigBytes-=16}return g.create({ciphertext:a,salt:b})}},d=p.SerializableCipher=h.extend({cfg:h.extend({format:e}),encrypt:function(a,c,b,d){d=this.cfg.extend(d);var k=a.createEncryptor(b,d);c=k.finalize(c);k=k.cfg;return g.create({ciphertext:c,key:b,iv:k.iv,algorithm:a,mode:k.mode,padding:k.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,c,b,d){d=this.cfg.extend(d);c=this._parse(c,d.format);return a.createDecryptor(b,
d).finalize(c.ciphertext)},_parse:function(a,c){return"string"==typeof a?c.parse(a,this):a}}),m=(m.kdf={}).OpenSSL={execute:function(a,c,d,k){k||(k=n.random(8));a=b.create({keySize:c+d}).compute(a,k);d=n.create(a.words.slice(c),4*d);a.sigBytes=4*c;return g.create({key:a,iv:d,salt:k})}},t=p.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:m}),encrypt:function(a,c,b,g){g=this.cfg.extend(g);b=g.kdf.execute(b,a.keySize,a.ivSize);g.iv=b.iv;a=d.encrypt.call(this,a,c,b.key,g);a.mixIn(b);return a},decrypt:function(a,
c,b,g){g=this.cfg.extend(g);c=this._parse(c,g.format);b=g.kdf.execute(b,a.keySize,a.ivSize,c.salt);g.iv=b.iv;return d.decrypt.call(this,a,c,b.key,g)}})}();(function(){for(var q=N,m=q.lib.BlockCipher,p=q.algo,h=[],n=[],l=[],f=[],b=[],a=[],e=[],k=[],c=[],g=[],d=[],t=0;256>t;t++)d[t]=128>t?t<<1:t<<1^283;for(var y=0,v=0,t=0;256>t;t++){var A=v^v<<1^v<<2^v<<3^v<<4,A=A>>>8^A&255^99;h[y]=A;n[A]=y;var z=d[y],D=d[z],E=d[D],u=257*d[A]^16843008*A;l[y]=u<<24|u>>>8;f[y]=u<<16|u>>>16;b[y]=u<<8|u>>>24;a[y]=u;u=16843009*
E^65537*D^257*z^16843008*y;e[A]=u<<24|u>>>8;k[A]=u<<16|u>>>16;c[A]=u<<8|u>>>24;g[A]=u;y?(y=z^d[d[d[E^z]]],v^=d[d[v]]):y=v=1}var w=[0,1,2,4,8,16,32,64,128,27,54],p=p.AES=m.extend({_doReset:function(){for(var a=this._key,b=a.words,d=a.sigBytes/4,a=4*((this._nRounds=d+6)+1),f=this._keySchedule=[],l=0;l<a;l++)if(l<d)f[l]=b[l];else{var t=f[l-1];l%d?6<d&&4==l%d&&(t=h[t>>>24]<<24|h[t>>>16&255]<<16|h[t>>>8&255]<<8|h[t&255]):(t=t<<8|t>>>24,t=h[t>>>24]<<24|h[t>>>16&255]<<16|h[t>>>8&255]<<8|h[t&255],t^=w[l/
d|0]<<24);f[l]=f[l-d]^t}b=this._invKeySchedule=[];for(d=0;d<a;d++)l=a-d,t=d%4?f[l]:f[l-4],b[d]=4>d||4>=l?t:e[h[t>>>24]]^k[h[t>>>16&255]]^c[h[t>>>8&255]]^g[h[t&255]]},encryptBlock:function(c,d){this._doCryptBlock(c,d,this._keySchedule,l,f,b,a,h)},decryptBlock:function(a,b){var d=a[b+1];a[b+1]=a[b+3];a[b+3]=d;this._doCryptBlock(a,b,this._invKeySchedule,e,k,c,g,n);d=a[b+1];a[b+1]=a[b+3];a[b+3]=d},_doCryptBlock:function(a,c,b,d,g,k,e,f){for(var l=this._nRounds,t=a[c]^b[0],h=a[c+1]^b[1],v=a[c+2]^b[2],
n=a[c+3]^b[3],A=4,m=1;m<l;m++)var w=d[t>>>24]^g[h>>>16&255]^k[v>>>8&255]^e[n&255]^b[A++],y=d[h>>>24]^g[v>>>16&255]^k[n>>>8&255]^e[t&255]^b[A++],p=d[v>>>24]^g[n>>>16&255]^k[t>>>8&255]^e[h&255]^b[A++],n=d[n>>>24]^g[t>>>16&255]^k[h>>>8&255]^e[v&255]^b[A++],t=w,h=y,v=p;w=(f[t>>>24]<<24|f[h>>>16&255]<<16|f[v>>>8&255]<<8|f[n&255])^b[A++];y=(f[h>>>24]<<24|f[v>>>16&255]<<16|f[n>>>8&255]<<8|f[t&255])^b[A++];p=(f[v>>>24]<<24|f[n>>>16&255]<<16|f[t>>>8&255]<<8|f[h&255])^b[A++];n=(f[n>>>24]<<24|f[t>>>16&255]<<
16|f[h>>>8&255]<<8|f[v&255])^b[A++];a[c]=w;a[c+1]=y;a[c+2]=p;a[c+3]=n},keySize:8});q.AES=m._createHelper(p)})();(function(q,m,p,h){function n(b){this._settings=b;this._key=null}function l(b,a,e){"then"in b&&"catch"in b?b.then(a).catch(e):(b.oncomplete=function(){a(b.result)},b.onerror=e)}var f=window.crypto||window.msCrypto||window.webkitCrypto;q.AesCbc=n;q.AesCbcAlgorithmSettings=function(b){this.name="AES-CBC";this.iv=void 0===b?m.createByteArray(16):b};n.prototype.init=function(b){function a(a){k._key=
a;c.complete()}function e(a){c.fail(a)}var k=this,c=new p.Completer;f&&f.subtle?(b=f.subtle.importKey("raw",b,this._settings,!0,["encrypt","decrypt"]),l(b,a,e)):setTimeout(function(){c.fail("crypto API is not available")},0);return c.future};n.prototype.encrypt=function(b){function a(a){k.complete(new Uint8Array(a,0,a.byteLength))}function e(a){k.fail(a)}var k=new p.Completer,c;"msCrypto"in window?(c=f.subtle.encrypt(this._key.algorithm,this._key),l(c,a,e),c.onprogress=function(){},c.process(b),c.finish()):
(c=f.subtle.encrypt(this._settings,this._key,b),l(c,a,e));return k.future};n.prototype.decrypt=function(b){var a=new p.Completer;b=f.subtle.decrypt(this._settings,this._key,b);l(b,function(b){a.complete(new Uint8Array(b,0,b.byteLength))},function(b){a.fail(b)});return a.future}})(r.crypto,r.crypto,r.async,I);(function(q,m,p,h,n){function l(f,b){this._iv=p.u8array.parse(f.iv);this._key=p.u8array.parse(b)}q.AesCbcSync=l;q.createByteArray=n.Uint8Array?function(f){return new Uint8Array(f)}:function(f){for(var b=
Array(f),a=0;a!==f;++a)b[a]=0;b.set=function(a,b){for(var c=Math.min(Math.max(this.length-b,0),a.length),g=0;g!==c;++g)this[g+b]=a[g]};return b};l.prototype.encrypt=function(f){var b=h.algo.AES.createEncryptor(this._key,{iv:this._iv,mode:h.mode.CBC,padding:h.pad.Pkcs7});return this._process(f,b)};l.prototype.decrypt=function(f){var b=h.algo.AES.createDecryptor(this._key,{iv:this._iv,mode:h.mode.CBC,padding:h.pad.Pkcs7});return this._process(f,b)};l.prototype._process=function(f,b){var a=p.u8array.parse(f),
a=p.u8array.stringify(b.process(a)),e=b.finalize();if(0<e.sigBytes){var e=p.u8array.stringify(e),k=m.createByteArray(a.length+e.length);k.set(a,0);k.set(e,a.length);a=k}return a}})(r.crypto,r.crypto,r.utils,N,I);(function(q,m,p){function h(h){this._pool=null;this._settings=h}q.AesStringWorkerClient=h;h.prototype.init=function(h){if(null!==this._pool)throw Error("Pool has been instantiated!");var l=new p.Completer,f=this,b=new m.Pool(1,m.Pool.workerPath("aes-string-worker.js"),function(){f._pool=b;
l.complete()});b.start({settings:this._settings,key:h});return l.future};h.prototype.encrypt=function(h){return this._exec(h,0)};h.prototype.decrypt=function(h){return this._exec(h,1)};h.prototype._exec=function(h,l){var f=new p.Completer(function(){b.terminate()}),b=this._pool.createJob(l);b.addEventListener("message",function(a){a=a.data;a.success?f.complete(a.data):f.fail(a.data)});b.postMessage({operation:l,data:h});return f.future}})(r.crypto,r.utils,r.async);N.mode.CTRGladman=function(){function q(h){if(255===
(h>>24&255)){var n=h>>16&255,l=h>>8&255,f=h&255;255===n?(n=0,255===l?(l=0,255===f?f=0:++f):++l):++n;h=0+(n<<16)+(l<<8);h+=f}else h+=16777216;return h}var m=N.lib.BlockCipherMode.extend(),p=m.Encryptor=m.extend({processBlock:function(h,n){var l=this._cipher,f=l.blockSize,b=this._iv,a=this._counter;b&&(a=this._counter=b.slice(0),this._iv=void 0);b=a;0===(b[0]=q(b[0]))&&(b[1]=q(b[1]));a=a.slice(0);l.encryptBlock(a,0);for(l=0;l<f;l++)h[n+l]^=a[l]}});m.Decryptor=p;return m}();N.pad.NoPadding={pad:function(){},
unpad:function(){}};(function(q,m,p){function h(){this.count=0;this.hash=Array(5);this.wbuf=Array(16);this.tmp=Array(80);this.reset()}function n(a,c,b){for(var d=a[0],e=a[1],f=a[2],l=a[3],h=a[4],n=0;16>n;++n){b[n]=c[n]|0;var m=(d<<5|d>>>27)+h+b[n]+((e&f|~e&l)+1518500249),h=l,l=f,f=e<<30|e>>>2,e=d,d=m}for(;20>n;++n)c=b[n-3]^b[n-8]^b[n-14]^b[n-16],b[n]=c<<1|c>>>31,m=(d<<5|d>>>27)+h+b[n]+((e&f|~e&l)+1518500249),h=l,l=f,f=e<<30|e>>>2,e=d,d=m;for(;40>n;++n)c=b[n-3]^b[n-8]^b[n-14]^b[n-16],b[n]=c<<1|c>>>
31,m=(d<<5|d>>>27)+h+b[n]+((e^f^l)+1859775393),h=l,l=f,f=e<<30|e>>>2,e=d,d=m;for(;60>n;++n)c=b[n-3]^b[n-8]^b[n-14]^b[n-16],b[n]=c<<1|c>>>31,m=(d<<5|d>>>27)+h+b[n]+((e&f|e&l|f&l)-1894007588),h=l,l=f,f=e<<30|e>>>2,e=d,d=m;for(;80>n;++n)c=b[n-3]^b[n-8]^b[n-14]^b[n-16],b[n]=c<<1|c>>>31,m=(d<<5|d>>>27)+h+b[n]+((e^f^l)-899497514),h=l,l=f,f=e<<30|e>>>2,e=d,d=m;a[0]=a[0]+d|0;a[1]=a[1]+e|0;a[2]=a[2]+f|0;a[3]=a[3]+l|0;a[4]=a[4]+h|0}function l(a,c,b){var d=a>>>24&255,e=a>>>16&255,f=a>>>8&255;a&=255;switch(c){case 0:d=
b;break;case 1:e=b;break;case 2:f=b;break;case 3:a=b;break;default:throw Error("out of index: "+c);}return d<<24|e<<16|f<<8|a}function f(a,c,b,d,e){a[c>>>2]&=4294967295<<32-c%4*8;if(c%4||d%4)for(var f,h,n,m=0;m<e;++m)f=d+m,f=b[f>>>2]>>>24-f%4*8&255,h=c+m,n=h>>>2,a[n]=l(a[n],h%4,f);else{f=e%4;h=e-f;for(m=0;m<h;m+=4)a[c+m>>>2]=b[d+m>>>2];if(0<f){h=a[c+m>>>2];b=b[d+m>>>2];switch(f){case 3:h=l(h,2,b>>>8&255);case 2:h=l(h,1,b>>>16&255);case 1:h=l(h,0,b>>>24&255)}a[c+m>>>2]=h}}return c+e}function b(a){var c=
this.hasher=new h;this.tmp=Array(5);64<a.sigBytes&&(a=c.finalize(a));c=this._oKey=a.words.slice(0);a=this._iKey=a.words.slice(0);for(var b=0;16>b;b++)c[b]^=1549556828,a[b]^=909522486;this.reset()}function a(a,c,g,d){var e=Math.ceil(g);a=new b(a);var e=Array(e),l=[1],h=c.words;c=c.sigBytes;for(var n=0,m=a.hasher.hash,p=Array(5),q=Array(5);n<g;){a.updateData(h,c).updateData(l,4).finalize();f(p,0,m,0,20);a.reset();for(var u=p,w=1;w<d;++w){a.updateData(u,20).finalize();f(q,0,m,0,20);u=q;a.reset();for(var x=
0;5>x;++x)p[x]^=q[x]}f(e,4*n,p,0,20);n+=5;++l[0];a.reset()}return{words:e,sigBytes:4*g}}q.Sha1=h;q.HMACSha1=b;q.PBKDF2=a;q.calcKeyHash=function(b){b=m.u8array.parse(b);var c=p.enc.Hex.parse("fbdb1d1b18aa6c08324b7d64b71fb76370690e1d");b=a(b,c,4,100);return p.enc.Hex.stringify(b)};q=h.prototype;q.reset=function(){var a=this.hash;a[0]=1732584193;a[1]=4023233417;a[2]=2562383102;a[3]=271733878;a[4]=3285377520;this.count=0;a=this.wbuf;a[0]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=
a[13]=a[14]=a[15]=0};q.updateData=function(a,c){var b=this.count&63,d=64-b;this.count+=c;for(var e=0,l=this.wbuf,h=this.hash,m=this.tmp;c>=d;)f(l,b,a,e,d),e+=d,c-=d,d=64,b=0,n(h,l,m);f(l,b,a,e,c);return this};q.update=function(a){this.updateData(a.words,a.sigBytes);return this};q.finalize=function(a){a&&this.update(a);return{words:this.flush(),sigBytes:20}};var e=[0,4278190080,4294901760,4294967040];q.flush=function(){var a=this.count&63,c=this.wbuf,b=this.hash,d=8*this.count;c[a>>>2]=c[a>>>2]&e[a&
3]|128<<24-a%4*8;var f=this.tmp;55<a?(60>a&&(c[15]=0),n(b,c,f),a=0):a=(a>>2)+1;for(;14>a;)c[a++]=0;c[14]=Math.floor(d/4294967296);c[15]=d;n(b,c,f);return b};q=b.prototype;q.reset=function(){var a=this.hasher;a.reset();a.updateData(this._iKey,64)};q.update=function(a){this.hasher.update(a);return this};q.updateData=function(a,c){this.hasher.updateData(a,c);return this};q.finalize=function(a){var c=this.hasher,b=this.tmp,d=c.hash;a&&c.update(a);c.flush();f(b,0,d,0,20);c.reset();c.updateData(this._oKey,
64);c.updateData(b,20);c.flush()}})(r.crypto,r.utils,N);(function(q){q.u8array={stringify:function(m){var p=m.words;m=m.sigBytes;var h;h="function"===typeof Uint8Array||"object"===typeof Uint8Array?new Uint8Array(m):Array(m);for(var n=0;n<m;n++)h[n]=p[n>>>2]>>>24-n%4*8&255;return h},parse:function(m,p){var h=m.length;"number"===typeof p&&(h=p);if("function"===typeof Uint8Array||"object"===typeof Uint8Array||_.isArray(m))for(var n=[],l=0;l<h;l++)n[l>>>2]|=(m[l]&255)<<24-l%4*8;else for(n=[],l=0;l<h;l++)n[l>>>
2]|=(m.readByteAt(l)&255)<<24-l%4*8;return N.lib.WordArray.create(n,h)}}})(r.utils);(function(q,m,p,h,n,l,f){function b(a,c){this.entries=a;this._initGlobalFlags(c);this.queue=this.password=null;this.prioritizedNames=[]}function a(a,c){var b=p.u8array.parse(a.aesSalt),d=8*(a.aesMode&3)+8,b=h.PBKDF2(c,b,(2*d+2)/4,1E3),b=p.u8array.stringify(b);if(!e){var f=new r.bin.DataBuffer;f.attachData(b);b=f}f=m.getDataHelper(b.length,b).view.getUint16(2*d,!0);a.aesDerivedKey=b.subarray(0,d);a.hmacKey=b.subarray(d,
d+d);return f}var e=!!f.ArrayBuffer;q.SinglePasswordKeyDerivation=b;b.prototype={_initGlobalFlags:function(a){(this.singleKey=1===(a&1))?this.deriveKeys=this.deriveKeysSingle:this.deriveKeys=this.deriveKeysMulti},setPassword:function(a){null===a?this.password=null:(this.password=n.enc.Utf8.parse(a),this.singleKey||(this.queue=l.clone(this.entries),a=this.prioritizedNames,this.prioritizedNames=[],l.each(a,l.bind(this.prioritize,this))))},prioritize:function(a){this.prioritizedNames.push(a);if(null!==
this.queue){a:{for(var c=this.queue,b=0,d=c.length;b!==d;++b)if(c[b].filename===a){a=b;break a}a=-1}if(-1!==a){a=this.queue.splice(a,1);a[0]._prioritized=!0;a:{c=this.queue;b=0;for(d=c.length;b!==d;++b)if(!c[b]._prioritized){c=b;break a}c=c.length}this.queue.splice(c,0,a[0])}}},deriveKeyForEntry:function(b){var c=this.password;if(null===c)return!1;if(a(b,c)===b.aesPV){if(this.singleKey)for(var c=this.entries,g=0,d=this.entries.length;g<d;++g){var e=c[g];e.aesDerivedKey=b.aesDerivedKey;e.hmacKey=b.hmacKey}return!0}b.aesDerivedKey=
null;b.hmacKey=null;return!1},_next:function(){return this.queue.shift()},deriveKeysSingle:function(){var b=this.entries,c=this.password;if(null===c)return{invalidPassword:!0};for(var g=!0,d=null,e=0,f=b.length;e<f&&g;++e){var l=b[e];if(l.flags&2)if(null!==d)l.aesDerivedKey=d.aesDerivedKey,l.hmacKey=d.hmacKey;else if(g=a(l,c)===l.aesPV)d=l;else{l.aesDerivedKey=null;break}}if(g)return{invalidPassword:!1,finished:!0,entries:b};this.password=null;return{invalidPassword:!0}},deriveKeysMulti:function(b){b||
(b=1);var c=this.password;if(null===c)return{invalidPassword:!0};for(var g=[],d=!1,e=null;0<b--&&(e=this._next());)if(0!==(e.flags&6))if(a(e,c)!==e.aesPV){d=!0;break}else g.push(e);return d?(this.password=null,{invalidPassword:!0}):{invalidPassword:!1,finished:0===this.queue.length,entries:g}}}})(r.g4s,r.bin,r.utils,r.crypto,N,_,I);(function(q){function m(a){this.future=new p(a)}function p(a){this.succeed=this.done=!1;this._cancelCallback=a?a:null;this._onCompleted=[];this._onSucceed=[];this._onFailed=
[]}function h(){this.done=!0;this._onCompleted.length=0;this._onSucceed.length=0;this._onFailed.length=0;this._cancelCallback&&(this._cancelCallback(),this._cancelCallback=null)}function n(a){this._onSucceed.push(a);return this}function l(a){this._onFailed.push(a);return this}function f(a){this._onCompleted.push(a);return this}function b(){this.canceled=!1;this._asyncTask=null;var a=this;this.cancelCallback=function(){a.cancel()}}function a(a){m.call(this,a);this.future=new e(a)}function e(a){p.call(this,
a);this._onProgress=[];this.currentProgress=0}q.Completer=m;q.ProgressCompleter=a;q.Cancelable=b;q.asyncSuccess=function(a,b,g){var d=setTimeout(function(){a.complete(b,g)},0);a._oldCancelCallback=a._cancelCallback;a._cancelCallback=function(){clearTimeout(d);this._oldCancelCallback&&this._oldCancelCallback()}};q.asyncError=function(a,b){var g=setTimeout(function(){a.fail(b)},0);a._oldCancelCallback=a._cancelCallback;a._cancelCallback=function(){clearTimeout(g);this._oldCancelCallback&&this._oldCancelCallback()}};
q.callDefered=function(a){var b=new m;setTimeout(function(){try{b.complete(a())}catch(g){b.fail(g)}},1);return b.future};q.run=function(a){setTimeout(a,1)};m.prototype={complete:function(){var a=this.future;a._cancelCallback=null;a.done=!0;a.succeed=!0;var b=[];b.push.apply(b,arguments);this._execute(a._onSucceed,b);b.push(!0);this._execute(a._onCompleted,b);a._onFailed.length=0},fail:function(){var a=this.future;a._cancelCallback=null;a.done=!0;var b=[];b.push.apply(b,arguments);this._execute(a._onFailed,
b);b.push(!1);this._execute(a._onCompleted,b);a._onSucceed.length=0},_execute:function(a,b){for(var g=0;g<a.length;++g)a[g].apply(null,b);a.length=0}};p.prototype={success:n,error:l,completed:f,then:n,catchError:l,whenComplete:f,cancel:h,abort:h,chainSuccess:function(a){this.then(function(){a.complete.apply(a,arguments)});return this},chainError:function(a){this.catchError(function(){a.fail.apply(a,arguments)});return this},runWhenSucceed:function(a){this.done&&this.succeed?setTimeout(a,0):this.done||
this.then(a);return this},runWhenFailed:function(a){this.done&&!this.succeed?setTimeout(function(){a()},0):this.done||this.catchError(a);return this}};b.prototype={set asyncTask(a){if(a)this._asyncTask=a;else{if("undefined"===typeof a)try{throw Error();}catch(b){"console"in window&&console.log(b)}this._asyncTask=null}},get asyncTask(){return this._asyncTask},cancel:function(){this.canceled=!0;if(null!==this.asyncTask){var a=this.asyncTask;"abort"in a?a.abort():"terminate"in a?a.terminate():"cancel"in
a&&a.cancel();this.asyncTask=null}}};b.prototype.abort=b.prototype.cancel;b.prototype.terminate=b.prototype.cancel;a.prototype=Object.create(m.prototype);a.prototype.constructor=a;a.prototype.progress=function(a){this.future.currentProgress=a;this._executeProgress(this.future._onProgress,a)};a.prototype._executeProgress=function(a,b){for(var g=0,d=a.length;g<d;++g)a[g](b)};e.prototype=Object.create(p.prototype);e.prototype.constructor=e;e.prototype.whenProgress=function(a){this._onProgress.push(a);
return this}})(r.async);(function(q,m,p){function h(){this._failed=this._succeeded=this._requests=0;this._boundOnSuccess=p.bind(this._onSuccess,this);this._boundOnFailed=p.bind(this._onFailed,this);this._completer=new m.Completer;this.future=this._completer.future}q.Batch=h;h.prototype={addFuture:function(h){++this._requests;h.then(this._boundOnSuccess).catchError(this._boundOnFailed)},_onSuccess:function(){++this._succeeded;this._completeWhenDone()},_onFailed:function(){++this._failed;this._completeWhenDone()},
_completeWhenDone:function(){this._failed+this._succeeded===this._requests&&(0!==this._failed?this._completer.fail(this._succeeded,this._failed):this._completer.complete(this._succeeded,this._failed),this._boundOnFailed=this._boundOnSuccess=null)}}})(r.async,r.async,_);(function(q,m,p,h){function n(){p.Completer.call(this);this.completers=[]}q.CompleterGroup=n;q.Completer=p.Completer;h.extend(n.prototype,p.Completer.prototype);h.extend(n.prototype,{add:function(l){this.completers.push(l)},$superComplete:p.Completer.prototype.complete,
complete:function(l,f){var b=this.completers;if(b.length==l.length){for(var a=0,e=l.length;a<e;++a){var k=l[a];h.isNumber(k)?b[a].fail(k):b[a].complete(k,f)}this.$superComplete(l,f)}else this.fail(m.ERROR_CODES.UNBALANCED_RESPONSE)},$superFail:p.Completer.prototype.fail,fail:function(l){for(var f=this.completers,b=0,a=f.length;b<a;++b)f[b].fail(l);this.$superFail(l)}})})(r.service,r.service,r.async,_);r.service.ERROR_CODES={UNBALANCED_RESPONSE:900,INVALID_RESPONSE_CHECKSUM:901,INVALID_RESPONSE_FORMAT:902,
INVALID_RESPONSE_MIMETYPE:903};(function(q,m){function p(h){function n(l,f){this.data=l;this.completer=f}n.prototype={url:h||"",method:"POST",headers:[["Content-Type","application/json"]],success:function(l,f){this.completer.complete(l,f)},error:function(l){this.completer.fail(l)},addHeader:function(l,f){this.headers===n.prototype.headers&&(this.headers=m.clone(this.headers));this.headers.push([l,f])}};this._RequestClass=n}q.HTTPRequestTemplate=p;p.prototype={create:function(h,n){return new this._RequestClass(h,
n)}}})(r.service,_);(function(q,m,p,h,n){function l(f,b,a,e){this.requestTemplate=new m.HTTPRequestTemplate(f);this.requestBuilder=new m.RequestBuilder(a||"en",e||{});this.currentGroup=new m.CompleterGroup;b||(b=null);this.signatureCalculator=b;this.signatureHeader="V-Sign";this.calculateRequestSignature=null!==b}q.HTTPServiceCaller=l;l.prototype={call:function(f,b,a){var e=new m.Completer;this.requestBuilder.add(f,b,a);this.currentGroup.add(e);return e.future},send:function(){var f=this.requestBuilder.buildJSON(),
b=this.currentGroup,a=new m.JSONParserCompleter(b);this.currentGroup=new m.CompleterGroup;null!==this.signatureCalculator&&(a=new m.SingnatureVerifierCompleter(this.signatureCalculator,a,this.signatureHeader));a=this.requestTemplate.create(f,a);null!==this.signatureCalculator&&this.calculateRequestSignature&&(f=this.signatureCalculator.calculateMessageSignature(f),a.addHeader(this.signatureHeader,f));p.loadDataCORS(a);return b.future}}})(r.service,r.service,r.utils,r.log,_);(function(q,m){function p(h){this.completer=
h}q.JSONParserCompleter=p;p.prototype={complete:function(h,n){var l=n.getResponseHeader("Content-Type"),l=l.split(";")[0];if("application/json"!==l)this.fail(m.ERROR_CODES.INVALID_RESPONSE_MIMETYPE);else{l=null;try{l=JSON.parse(h)}catch(f){this.fail(m.ERROR_CODES.INVALID_RESPONSE_FORMAT);return}this.completer.complete(l,n)}},fail:function(h){this.completer.fail(h)}}})(r.service,r.service);(function(q){function m(m,h){this._messages=[];this._request={lang:m,metadata:h,messages:this._messages}}q.RequestBuilder=
m;m.prototype={add:function(m,h,n){this._messages.push({service:m,action:h,data:n})},buildJSON:function(){var m=JSON.stringify(this._request);this._messages.length=0;return m}}})(r.service);(function(q,m,p,h){function n(l,f){this.hasher=new m.Sha1;this.textEncoding=p.enc.Utf8;this.hashEncoding=r.utils.u8array;(this.rsaDecryptKey=new h).setPrivate(l,f,f);(this.rsaEncryptKey=new h).setPublic(l,f)}q.SignatureCalulator=n;n.prototype={calculateMessageHash:function(l){l=this.textEncoding.parse(l);this.hasher.update(l);
l=this.hasher.finalize();l=this.hashEncoding.stringify(l);this.hasher.reset();return l},calculateMessageSignature:function(l){l=this.calculateMessageHash(l);return this.rsaEncryptKey.encryptByteArray(l)},verifyMessageSignature:function(l,f){var b=this.rsaDecryptKey.decrypt2ByteArray(f);if(null===b)return!1;var a=this.calculateMessageHash(l);if(b.length===a.length){for(var e=!0,k=0,c=b.length;k<c&&e;++k)e=b[k]===a[k];return e}return!1}}})(r.crypto,r.crypto,N,fa);(function(q,m){function p(h,n,l){this.signatureCalculator=
h;this.completer=n;this.header=l||"V-Sign"}q.SingnatureVerifierCompleter=p;p.prototype={complete:function(h,n){var l=n.getResponseHeader(this.header);null===l?this.fail(m.ERROR_CODES.INVALID_RESPONSE_CHECKSUM):this.signatureCalculator.verifyMessageSignature(h,l)?this.completer.complete(h,n):this.fail(m.ERROR_CODES.INVALID_RESPONSE_CHECKSUM)},fail:function(h){this.completer.fail(h)}}})(r.service,r.service);(function(q,m,p){function h(h,l){if(p.isUndefined(h))throw Error("Url must be defined!");this.url=
h;this.beforeRequest=l?l:null}q.RestClient=h;h.prototype={sendGet:function(h,l){return this._request("GET",h,l)},sendDelete:function(h,l,f){return this._request("DELETE",l,f,h)},sendHead:function(h,l){return this._request("HEAD",h,l)},sendPost:function(h,l,f){return this._request("POST",l,f,h)},sendPut:function(h,l,f){return this._request("PUT",l,f,h)},sendPatch:function(h,l,f){return this._request("PATCH",l,f,h)},_request:function(h,l,f,b){b=b?JSON.stringify(b):"";var a=new m.Completer(function(){e&&
(e.abort(),e=null)}),e=$.ajax({converters:{json:function(a){""===a&&(a=null);return JSON.parse(a)}},type:h,beforeSend:this.beforeRequest?p.bind(this.beforeRequest,this):function(){},url:this._formatUrl(this.url,l,f),dataType:"json",contentType:"application/json",data:b,processData:!1,cache:!1,success:function(b,c,g){a.complete(b,g)},error:function(b,c,g){var d;try{(d=b.responseText)&&(d=JSON.parse(d))}catch(e){g.message&&(d=g.message)}a.fail(b.status,d,b)}});return a.future},_formatUrl:function(h,
l,f){l||(l="");var b=[h,l],a=-1!==h.indexOf("?")||-1!==l.indexOf("?");p.each(f,function(e,k){a?b.push("&"):(b.push("?"),a=!0);b.push(k);b.push("=");b.push(encodeURIComponent(e))});return b.join("")}}})(r.service,r.async,_);(function(q,m,p,h,n){function l(a){this.serviceToRestMapping=a;this.currentMappings=this.currentBatch=null}function f(a){this.providerCallback=a;this.calls={};this.currentBatch={}}function b(a,b){this.prefix=a;this.callback=b;this._current=[]}q.ServiceCallerAdapter=l;l.prototype=
{call:function(a,b,k){null===this.currentBatch&&(this.currentBatch=new p.Batch,this.currentMappings=[]);var c=a+"."+b;a=n.find(this.serviceToRestMapping,function(a){return a.canBeCalled(c)});if(!a)throw Error("No mapping found for: "+c);-1===this.currentMappings.indexOf(a)&&this.currentMappings.push(a);k=a.batch(c,k);this.currentBatch.addFuture(k);return k},send:function(){n.each(this.currentMappings,function(a){a.execute()});var a=new p.Completer,b=this.currentBatch.future;b.then(function(){a.complete()});
b.catchError(function(b,c){0<b?a.complete():a.fail()});this.currentMappings=this.currentBatch=null;return a.future}};q.ServiceMapping=f;f.prototype={add:function(a,b){this.calls[a]={attr:b?b:null};return this},canBeCalled:function(a){return a in this.calls},batch:function(a,b){n.isEmpty(b)||h.debug("[ServiceMapping] there is no support for passing data back to server.");var k=this.currentBatch[a];k||(k=new p.Completer,this.currentBatch[a]=k);return k.future},execute:function(){var a=this.currentBatch,
b=this;this.providerCallback().then(function(k){n.each(a,function(a,g){var d=b.calls[g].attr;d?d in k?a.complete(k[d]):a.fail(404):a.complete(k)})}).catchError(function(b,c){n.each(a,function(a){a.fail(b,c)})});this.currentBatch={}}};q.DirectMapping=b;b.prototype={canBeCalled:function(a){return 0===a.indexOf(this.prefix)},batch:function(a,b){var k=new p.Completer;this._current.push({key:a,data:b,completer:k});return k.future},execute:function(){var a=this;n.each(this._current,function(b){a.callback(b.key,
b.data).then(function(a){b.completer.complete(a)}).catchError(function(a,c){b.completer.fail(a,c)})});this._current=[]}};q.createKeyMappingFunction=function(a){return function(b,k){if(!(b in a))throw Error("Mapping for "+b+" is not defined");return a[b](k)}}})(r.service,r.service,r.async,r.log,_);(function(q,m){q.createRestCompatibleServiceCaller=function(p){var h=new m.RestClient(p);p=(new m.ServiceMapping(function(){return h.sendGet("/info")})).add("Document.describe","document").add("Document.getWatermarks",
"watermarks").add("Event.subscribe","events");var n=(new m.ServiceMapping(function(){return h.sendGet("/events")})).add("Event.poll"),l=new m.DirectMapping("Annotation",m.createKeyMappingFunction({_url:"/annotations","Annotation.describe":function(){return h.sendGet(this._url)},"Annotation.save":function(f){return h.sendPost(f,this._url)},"Annotation.saveMany":function(f){return h.sendPost(f,this._url+"many")},"Annotation.delete":function(f){return h.sendDelete(f,this._url)},"Annotation.deleteMany":function(f){return h.sendDelete(f,
this._url+"many")}}));return new m.ServiceCallerAdapter([p,n,l])}})(r.viewer,r.service,_);(function(q,m,p){function h(f,b){this.path=[];this.handlers=f;this.ctx=b}function n(f,b){this.path=[];this.handlers=f;this.ctx=b;this.begTime=Date.now();this.operationCounter=0;this.interrupted=!1;this.interruptedCallback=null;this.paused=!1;this.pausedStep=null;m.is_mobile?(this.pauseEach=20,this.pauseDelay=0):(this.pauseEach=20,this.pauseDelay=10)}q.ObjectParser=h;q.CooperativeObjectParser=n;var l=[];Object.freeze&&
Object.freeze(l);h.prototype={process:function(f){if(f){var b=this.path,a=this.handlers,e=this.ctx;b.push(f);p.isUndefined(f.children)&&(f.children=l);for(var k=f.children,c=k.length,g=0;g<c;++g){var d=k[g];if(d){var h=d.name,n=d.properties;p.isUndefined(n)&&(n=d.properties=l);for(var v=0;v<a.length;++v)a[v].begin(h,n,d,e,b,this);e.block||this.process(d);for(v=a.length-1;0<=v;--v)a[v].end(h,n,d,e,b,this)}else m.log.warn("child of "+JSON.stringify(f)+" is null")}b.pop()}}};n.prototype.process=function(f,
b){function a(){function v(){for(var a=u,b=z.length-1;0<=b;--b)z[b].end(E,a,q,c,e,n);A()}function A(){var g=++n.operationCounter;0===g%50||0===g%20&&Date.now()-n.begTime>n.pauseEach?setTimeout(function(){n.interrupted?n.interruptedCallback&&n.interruptedCallback(n,c):n.paused?n.pausedStep=function(){n.interrupted?n.interruptedCallback&&n.interruptedCallback(n,c):(n.pausedStep=null,n.begTime=Date.now(),A())}:(n.begTime=Date.now(),A())},n.pauseDelay):h<d?a():(e.pop(),b())}var z=k,q=g[h++];q||(m.log.warn("child of "+
JSON.stringify(f)+" is null"),a());var E=q.name,u=q.properties;p.isUndefined(u)&&(u=q.properties=l);for(var w=0;w<z.length;++w)z[w].begin(E,u,q,c,e,n);c.block?v():n.process(q,v)}if(!b)throw Error("finish callback must be defined");if(f){var e=this.path,k=this.handlers,c=this.ctx;e.push(f);p.isUndefined(f.children)&&(f.children=l);var g=f.children,d=g.length,h=0,n=this;h<d?a():(e.pop(),b())}}})(r.json,r,_);(function(q,m,p){function h(){this.pool=[]}function n(e,k,c,g){m.Task.call(this);this.path=[];
this.interruptedCallback=null;this.handlers=e;this.ctx=k;if(!g)throw Error("finish callback must be defined");this.finishCallback=g;this.stack=[a.create(f,0,null,null),a.create(b,0,c,null)]}q.AdvancedObjectParser=n;var l=[],f=0,b=1;h.prototype={create:function(a,b,c,g){var d=this.pool.pop();return d?(d.st=a,d.i=b,d.object=c,d.child=g,d):{st:a,i:b,object:c,child:g}},free:function(a){a.object=null;a.child=null;this.pool.push(a)}};var a=new h;n.prototype={process:function(a){if(this._top().st!==f)throw Error("state is: "+
this.state+" but it should be ST_INITIALIZED");},step:function(){if(this.interrupted)this.stack.splice(1),this.path=null,this._top().st=5,this.done=!0,this.interruptedCallback&&(this.interruptedCallback(this,this.ctx),this.interruptedCallback=null);else{var e=this._top();switch(e.st){case b:var k=e.object;p.isUndefined(k)?this._popState():p.isUndefined(k.children)&&(k.children=l);this.path.push(k);e.st=2;e.i=0;break;case 2:k=e.object;k=k.children;e.i<k.length&&!this.ctx.block?(k=k[e.i++],p.isUndefined(k.properties)&&
(k.properties=l),this._pushState(a.create(3,0,null,k))):(this.path.pop(),this._popState());break;case 3:for(var c=this.handlers,g=e.i,d=c.length,h=e.i,k=e.child,n=k.name,v=k.properties;g<d&&3>g-h&&0===this.semaphore;++g)c[g].begin(n,v,k,this.ctx,this.path,this);e.i=g;g===d&&(e.st=4,this._pushState(a.create(b,0,e.child,null)));break;case 4:c=this.handlers;k=e.child;n=k.name;v=k.properties;for(h=g=e.i;0<g&&3>h-g&&0===this.semaphore;)c[--g].end(n,v,k,this.ctx,this.path,this);e.i=g;0===g&&this._popState();
break;case f:e.st=5,this.finishCallback(),this.finishCallback=null,this.done=!0}}},_top:function(){return this.stack[this.stack.length-1]},_pushState:function(a){this.stack.push(a)},_popState:function(){a.free(this.stack.pop())},_id:function(){return this.ctx.renderArguments.pageInfo.number}};p.extend(n.prototype,m.Task.prototype)})(r.json,r,_);(function(q,m,p){function h(f,b,a,e,k,c,g,d,l,h){f.drawImage(b,a,e,k,c,g,d,l,h)}function n(f,b,a,e,k,c,g,d,h,n){var v=k/l+(0===k%l?0:1)|0,m=c/l+(0===h%l?0:
1)|0;if(1===v&&1===m)f.drawImage(b,a,e,k,c,g,d,h,n);else for(a=h/k,n/=c,e=0,g=l*a,d=0;d<v;++d){h=0;var p=l*n,q=l*d,E=l;q+E>k&&(E=k-q,g=E*a);for(var u=0;u<m;++u){var w=l*u,x=l;w+x>c&&(x=c-w,p=x*n);f.drawImage(b,q,w,E,x,e,h,g,p);h+=p}e+=g}}p=!!p.browser.safari;m=m.is_mobile&&p;q.drawImage=p?n:h;var l=m?2048:4096})(r.utils,r,jQuery);(function(q,m,p,h,n,l,f){function b(a,b,c){this.ctx=a;this.opacity=isNaN(b)?1:b;this.brush="#ddd";this.imageSmoothing=!0;this.isRAW=!1;this.opacityMask=l.isUndefined(c)?
null:c}function a(a,c,d,g){b.call(this,a,c,g);this.brush=d}function e(a,c,d,g){b.call(this,a,c,g);this.transform=d}function k(a,b,c,d,g,k){e.call(this,a,b,c,k);this.brush=a.createLinearGradient(d.x,d.y,g.x,g.y)}function c(a,b,c,d,g,k,f,l){e.call(this,a,b,c,l);this.brush=a.createRadialGradient(d.x,d.y,0,g.x,g.y,f)}function g(a,b){this.brush.addColorStop(a,b)}function d(a,b,c,d,g,k,f,l,h,t,n,m){e.call(this,a,b,c,n);this.fileProvider=h;this.matrixStack=l;this.viewbox=d;this.viewport=g;this.tileMode=
k;this.imageSource=f;this.tag=t;this.objectProcessor=m;this.rectangleModeAttributes=null}var t=p.Point;l.extend(q,{SolidColorBrush:a,LinearGradientBrush:k,RadialGradientBrush:c,ImageBrush:d});b.prototype={setImageSmoothing:function(a,b){"mozImageSmoothingEnabled"in a?a.mozImageSmoothingEnabled=b:"webkitImageSmoothingEnabled"in a?a.webkitImageSmoothingEnabled=b:"imageSmoothingEnabled"in a&&(a.imageSmoothingEnabled=b)},tryEnableAsync:function(){return!1},beforeBrush:function(a){this.ctx.globalAlpha=
this.opacity;a?this.ctx.fillStyle=this.brush:this.ctx.strokeStyle=this.brush},afterBrush:function(){},fill:function(){this.beforeBrush(!0);var a=this.ctx,b=this.imageSmoothing;b||this.setImageSmoothing(a,!1);a.argFillRule?this.ctx.fill(a.argFillRule):this.ctx.fill();b||this.setImageSmoothing(a,!0);this.afterBrush()},stroke:function(){this.beforeBrush(!1);this.ctx.stroke();this.afterBrush()},fillText:function(a,b,c){this.beforeBrush(!0);this.ctx.fillText(a,b,c);this.afterBrush()},strokeText:function(a,
b,c){this.beforeBrush(!1);this.ctx.strokeText(a,b,c);this.afterBrush()}};l.extend(a.prototype,b.prototype);l.extend(e.prototype,b.prototype);e.prototype.superBeforeBrush=b.prototype.beforeBrush;e.prototype.beforeBrush=function(a){var b=this.transform;b&&(this.ctx.save(),this.ctx.transform(b.a,b.b,b.c,b.d,b.e,b.f));this.superBeforeBrush(a)};e.prototype.afterBrush=function(){this.transform&&this.ctx.restore()};l.extend(k.prototype,e.prototype);k.prototype.addColorStop=g;l.extend(c.prototype,e.prototype);
c.prototype.addColorStop=g;l.extend(d.prototype,e.prototype);d.prototype.beforeSpecialBrush=e.prototype.beforeBrush;d.prototype.beforeBrush=function(a,b){var c=this,d=this.transform,g=this.viewbox,e=this.viewport,k=this.tileMode,f=this.matrixStack.top();d&&(f=f.multiply(d));var l=f.getScale(),d=l.x,l=l.y;Math.atan2(f.c,f.a);(1<d||1<l)&&c.ctx.transform(1/d,0,0,1/l,0,0);if(this.restoreFromCache())this.beforeSpecialBrush(a),b&&b();else{var n=this.fileProvider.getImage(this.imageSource);if(n){var q=n.height,
r=n.metadata,J=r.hDPI,O=r.vDPI,r=J*g.x/96,Q=O*g.y/96,J=J*g.width/96,g=O*g.height/96,J=Math.max(Math.min(n.width-r,J),0),g=Math.max(Math.min(q-Q,g),0);if(0==d||0==l)f=f.multiplyPoint(new t(e.width,e.height)),e.width=f.x,e.height=f.y;else if(1<d||1<l)e.width*=d,e.height*=l,e.x*=d,e.y*=l;e.width=Math.ceil(Math.abs(e.width));e.height=Math.ceil(Math.abs(e.height));e.x=Math.ceil(e.x);e.y=Math.ceil(e.y);f=null;a&&(q=new p.RectanglePathDetector,h.parsePathData(q,c.ctx.vCurrentPath),f=q.dimensions,null===
f&&(q.closePath(),f=q.dimensions));null===f||k&&"None"!==k||(this.rectangleModeAttributes={image:n,sx:r,sy:Q,sWidth:J,sHeight:g,viewport:e,brushRect:f,scaleX:d,scaleY:l});if(null===this.rectangleModeAttributes||this.opacityMask)try{var K=this.createBrushTexture(n,k,r,Q,J,g,e);this.finishTextureBeforeBrush(K,k,a,b)}catch(F){m.log.warn(F.stack),b&&setTimeout(function(){c.objectProcessor.interrupted?c.objectProcessor.post():(c.beforeSpecialBrush(a),b())},0)}else b&&setTimeout(function(){c.objectProcessor.interrupted?
c.objectProcessor.post():(c.beforeSpecialBrush(a),b())},0)}else m.log.error("unable to get image for imageSource:"+this.imageSource+" page: "+c.objectProcessor.number),b&&setTimeout(function(){c.objectProcessor.interrupted?c.objectProcessor.post():(c.beforeSpecialBrush(a),b())},0);b||this.beforeSpecialBrush(a)}};d.prototype.createImageBrushCanvas=function(a){var b=this.matrixStack,c=this.transform,d=this.viewbox,g=this.viewport,e=this.tileMode,k=this.fileProvider.getImage(this.imageSource);if(k){b=
b.top();c&&(b=b.multiply(c));var c=Math.abs(b.a),b=Math.abs(b.d),l=k.height,h=k.metadata,t=h.hDPI,p=h.vDPI,h=t*d.x/96,q=p*d.y/96,t=t*d.width/96,d=p*d.height/96,t=Math.max(Math.min(k.width-h,t),0),d=Math.max(Math.min(l-q,d),0);if(1<c||1<b)g.width*=c,g.height*=b,g.x*=c,g.y*=b;g.width=Math.ceil(g.width);g.height=Math.ceil(g.height);g.x=Math.ceil(g.x);g.y=Math.ceil(g.y);try{var r=document.createElement("canvas"),O=Math.ceil(g.width+g.x),Q=Math.ceil(g.height+g.y);if(!a&&f.browser.firefox&&(!e||"None"===
e))var K=this.ctx.canvas,O=Math.ceil(Math.max(g.x+g.width,K.width)),Q=Math.ceil(Math.max(g.y+g.height,K.height));r.width=O;r.height=Q;var F=r.getContext("2d");this.setImageSmoothing(F,!1);n.drawImage(F,k,h,q,t,d,g.x,g.y,g.width,g.height);return F}catch(L){m.log.warn(L.stack)}}return null};d.prototype.mergeOpacityMask=function(a,b){var c=this.opacityMask.createImageBrushCanvas(null!==this.rectangleModeAttributes);if(b)d=c.canvas,d=c.getImageData(0,0,d.width,d.height),c=a.canvas,g=a.getImageData(0,
0,c.width,c.height),c=new n.OpacityMaskProcess(g,d,function(){a.putImageData(g,0,0);b(a)}),c.parentTask=m.globalTaskScheduler.currentTask,c.parentTask.childTask=c,m.globalTaskScheduler.addTask(c);else{var d=c.canvas,d=c.getImageData(0,0,d.width,d.height),c=a.canvas,g=a.getImageData(0,0,c.width,c.height);n.applyOpacityMask(g,d);a.putImageData(g,0,0)}};d.prototype.tryEnableAsync=f.browser.safari||!m.is_mobile?function(){return!1}:function(){return!!this.opacityMask};d.prototype.fill=function(){this.beforeBrush(!0);
var a=this.ctx,b=this.imageSmoothing;b||this.setImageSmoothing(a,!1);null!==this.rectangleModeAttributes?this.directRender():a.argFillRule?a.fill(a.argFillRule):a.fill();b||this.setImageSmoothing(a,!0);this.afterBrush()};d.prototype.cache=function(a,b){this._canvas=a;this._mode=b};d.prototype.directRender=function(){var a=this.rectangleModeAttributes,b=this.ctx;b.save();var c=a.brushRect;b.beginPath();b.rect(c.x*a.scaleX,c.y*a.scaleY,c.width*a.scaleX,c.height*a.scaleY);b.clip();n.drawImage(b,a.image,
a.sx,a.sy,a.sWidth,a.sHeight,a.viewport.x,a.viewport.y,a.viewport.width,a.viewport.height);b.restore()};d.prototype.restoreFromCache=function(){return null!==this.rectangleModeAttributes?!0:this._canvas?(this.brush=this.ctx.createPattern(this._canvas,this._mode),!0):!1};d.prototype.asyncFill=function(a){var b=this;this.beforeBrush(!0,function(){var c=b.ctx,d=b.imageSmoothing;d||b.setImageSmoothing(c,!1);null!==b.rectangleModeAttributes?b.directRender():c.argFillRule?c.fill(c.argFillRule):c.fill();
d||b.setImageSmoothing(c,!0);b.afterBrush();a()})};d.prototype.asyncStroke=function(a){var b=this;this.beforeBrush(!1,function(){b.ctx.stroke();b.afterBrush();a()})};d.prototype.convertPatternMode=function(a){!f.browser.firefox||a&&"None"!==a||(a="Tile");switch(a){case "None":a="no-repeat";break;case "Tile":a="repeat";break;default:a="no-repeat"}return a};d.prototype.createBrushTexture=function(a,b,c,d,g,e,k){var l=document.createElement("canvas"),h=Math.ceil(k.width+k.x),t=Math.ceil(k.height+k.y);
null!==this.rectangleModeAttributes||!f.browser.firefox||b&&"None"!==b||(b=this.ctx.canvas,h=Math.ceil(Math.max(k.x+k.width,b.width)),t=Math.ceil(Math.max(k.y+k.height,b.height)));l.width=h;l.height=t;h=l.getContext("2d");this.setImageSmoothing(h,!1);n.drawImage(h,a,c,d,g,e,k.x,k.y,k.width,k.height);return l};d.prototype.applyOpacityMask=function(a,b){if(null===this.rectangleModeAttributes)this.brush=this.ctx.createPattern(a,b),this.cache(a,b);else{this.rectangleModeAttributes.image=a;var c=this.rectangleModeAttributes;
c.sx=0;c.sy=0;c.sWidth=a.width;c.sHeight=a.height}};d.prototype.finishTextureBeforeBrush=function(a,b,c,d){var g=this,e=this.convertPatternMode(b);b=a.getContext("2d");d?this.opacityMask?this.mergeOpacityMask(b,function(){g.objectProcessor.interrupted?g.objectProcessor.post():(g.applyOpacityMask(a,e),g.beforeSpecialBrush(c),d())}):setTimeout(function(){g.objectProcessor.interrupted?g.objectProcessor.post():(g.brush=g.ctx.createPattern(a,e),g.cache(a,e),g.beforeSpecialBrush(c),d())},0):this.opacityMask?
(this.mergeOpacityMask(b),this.applyOpacityMask(a,e)):(g.brush=g.ctx.createPattern(a,e),g.cache(a,e))}})(r.viewer,r,r.geometry,r.xps,r.utils,_,jQuery);(function(q,m,p){function h(h,l){h||(h=null);this.scope=l;this.dict={};this.parent=h}q.ResourceDictionary=h;h.prototype={RD_PATTERN:/{(.+)}/,getForPropertyValue:function(h){return p.isString(h)&&(h=h.match(this.RD_PATTERN))&&2===h.length?this.lookup(h[1]):null},lookup:function(h){var l=this.dict[h];if(p.isUndefined(l)){var f=this.parent;if(f)return f.lookup(h)}return l},
store:function(h,l){this.dict[h]=l}}})(r.viewer,r,_);(function(q,m,p,h,n,l,f){function b(a,b,c){this.doc=a;this.fileProvider=b;a=c.length;var d=Array(a);this.layers=d;for(var g=this.glyphProcessors=[],e=this.linkProcessors=[],k=this.nameProcessors=[],f=0;f<a;++f){var l=d[f]=c[f](b);n.isFunction(l.addText)&&g.push(l);n.isFunction(l.addLink)&&e.push(l);n.isFunction(l.addName)&&k.push(l)}}function a(a){return a&&"string"===typeof a&&"{"===a[0]}function e(a,b,c,d,g,e,k,f,l,h){var t=a.fillBrush;t&&t.fillText(b,
d,g);var n=a.strokeBrush;n&&n.strokeText(b,d,g);if(n||t)for(n=a.glyphProcessors,t=n.length;t--;)n[t].addText(b,c,d,g,e,a.matrixStack.top(),k,f);if(l&&0<l.length)for(b={x:d,y:g-c.size,width:e,height:c.size},f=a.linkProcessors,t=0,k=f.length;t<k;++t)f[t].addLink(a.matrixStack.top(),l,u,b);if(h&&0<h.length)for(b={x:d,y:g-c.size,width:e,height:c.size},c=a.nameProcessors,t=0,k=c.length;t<k;++t)c[t].addName(a.matrixStack.top(),h,u,b)}function k(a,b,c,d,g,e,k,f,l,h,t,n){var v=a.fillBrush;v&&(v.ctx=b,v.fillText(c,
g,e));var m=a.strokeBrush;m&&(m.ctx=b,m.strokeText(c,g,e));if(m||v)for(g=a.glyphProcessors,b=g.length;b--;)e=a.matrixStack.top(),g[b].addText(c,h,k,f,l,e,d,!0);if(t&&0<t.length)for(c={x:k,y:f,width:l,height:h.size},g=a.linkProcessors,b=0,d=g.length;b<d;++b)g[b].addLink(a.matrixStack.top(),t,u,c);if(n&&0<n.length)for(c={x:k,y:f,width:l,height:h.size},k=a.nameProcessors,b=0,d=k.length;b<d;++b)k[b].addName(a.matrixStack.top(),n,u,c)}function c(a,b,c,f){function l(){for(var b=ca.join(""),d=b.length,g=
Array(d),k=0;k<d;++k)g[k]=a.measureText(ca[k]).width;d=ba;0<b.length&&(k=a.measureText(b).width,e(c,b,z,P,E,k,d,g,aa,V),P=h(P,k));ca=Array(M.length-T);ba=Array(M.length-T);I=0}function h(a,b){return H?a+b:a-b}b=f[B];n.isUndefined(b)&&(b=1);var v=f[C],v="ItalicSimulation"==v?"italic":"BoldSimulation"==v?"bold":"BoldItalicSimulation"==v?"italic bold":"",m=f[J]||"sans-serif",A=c.matrixStack,p=A.top(),u=1,y=1;if(U){var q=p.getScale(),u=q.x*Z,y=q.y*Z,u=y/u*u;0===u&&(u=1);0===y&&(y=1);if(1>b*y)return}else if(1>
b*p.getScale().y)return;b*=y;a.save();a.scale(1/u,1/y);q=t.identity();q.a=1/u;q.d=1/y;A.push(p.multiply(q));var z={style:v,size:b,family:m};a.font=v+" "+b+"px '"+m+"'";z.spaceSize=a.measureText(" ").width;var D=f[G],r="true"===f[F],u=f[Q]*u,E=f[K]*y;u||(u=0);E||(E=0);var H;H=f[L]?0==parseInt(f[L],10)%2:!0;if(r&&!H)d.log.error("invalid attribute combination: isSideways = true and leftToRight = false");else{var M=f[O];H&&!a.ltr?(a.canvas.dir="ltr",a.ltr=!0):!H&&a.ltr&&(a.canvas.dir="rtl",a.ltr=!1);
if(M)M=M.split(";");else for(M=Array(D.length),v=0;v<D.length;++v)M[v]="";H||(D=D.split("").reverse().join(""),M=M.reverse());var ca=Array(M.length),ba=Array(M.length),S=0,I=0,T=0,P=u,aa=f[w],V=f[x],Y=0,X=null,y=c.document,u=M.length,v=f.KKI;if(!n.isArray(v)){v=Array(u);for(T=0;T<u;++T)p=X?X:D?D[S]:null,q=new g(y.fontsManager,m,M[T],p,b),v[T]=q,0!=Y?--Y:(X=null,Y=q.clusterGlyphCount-1,0!=Y&&(X=D[S]),S+=q.clusterCodeUnitCount);f.KKI=v}if(r)for(f=-Math.PI/2,m=Math.cos(Math.PI/2),y=Math.sin(Math.PI/
2),T=0;T<u;++T)q=v[T],q.valid&&(p=q.orgCh,D=a.measureText(q.ch).width,a.save(),r=h(P,q.uOffset),S=E-q.vOffset-D/2,Y=A.top(),Y=Y.multiply(new t(1,0,0,1,r+D,S)),a.translate(r+D,S),a.rotate(f),Y.multiply(new t(m,-y,y,m,0,0)),a.translate(-(r+D),-S),Y=Y.multiply(new t(1,0,0,1,-(r+D),-S)),A.push(Y),k(c,a,q.ch,p,r,S,r,S-b,D,z,aa,V),A.pop(),a.restore(),P=0!=q.advanceWidth?h(P,h(q.advanceWidth,q.uOffset)):h(P,b));else for(T=0;T<u;++T)q=v[T],q.valid&&(p=q.orgCh,null!==q.advanceWidth?(l(),D=h(q.advanceWidth,
q.uOffset),e(c,q.ch,z,h(P,q.uOffset),E-q.vOffset,D,p,null,aa,V),P=h(P,D)):(ba[I]=p,ca[I++]=q.ch));l();A.pop();a.restore()}}function g(a,b,c,d,g){var e=null!=d;if(e){this.orgCh=d;var k,f=1,l=1,h=null,t=0,n=0,v=c.indexOf(")");if(-1===v)k=c.split(",");else if(0===c.indexOf("(")){var m=c.substring(1,v),m=m.split(":");0===m.length?e=!1:1<=m.length&&(f=parseInt(m[0],10),2==m.length&&(l=parseInt(m[1],10)),0==f||0==l?e=!1:k=c.substring(v+1).split(","))}for(c=0;c<k.length;++c)if(v=0==c?parseInt(k[c],10):parseFloat(k[c]),
!isNaN(v))switch(c){case 0:v=a.glyphIdxToChar(b,v);null!==v&&(d=v);break;case 1:h=v*g/100;break;case 2:t=v*g/100;break;case 3:n=v*g/100;break;default:e=!1}e?(this.clusterCodeUnitCount=f,this.clusterGlyphCount=l,this.ch=d,this.advanceWidth=h,this.uOffset=t,this.vOffset=n,this.valid=!0):this.valid=!1}else this.valid=!1}var d=q,t=p.Matrix,y=h.parsePathData,v=h.parsePoint,A=h.parseRectangle,z=h.convertColor,D=h.setFillRule,r=m.viewer.renderErrorIcon,u="G",w="FU",x="N",G="US",B="FS",C="SS",J="FV",O="I",
Q="OX",K="OY",F="IT",L="BL";n.extend(q,{PageRenderer:b,Point:p.Point,processPathData:y,convertColor:z});b.prototype={renderPage:function(a,b,c,d,g,e){if(n.isEmpty(g))return this.renderError(a,b,d,c,"missing-page",m.i18n._T("message-cannot-load-page")),!1;a=this.createRenderingContext(a,b,c,d,g,e);(new m.json.ObjectParser(a.handlers,a)).process(g);a.finishCallback();return!0},createAsyncRenderer:function(a,b,c,d,g,e){if(n.isEmpty(g))return g=new m.Task,g.self=this,g.step=function(){this.interrupted||
this.self.renderError(a,b,d,c,"missing-page",m.i18n._T("message-cannot-load-page"));this.self=null;this.done=!0},g;e=this.createRenderingContext(a,b,c,d,g,e);return new m.json.AdvancedObjectParser(e.handlers,e,g,e.finishCallback)},createRenderingContext:function(a,b,c,d,g,e){var k=a.getContext("2d"),f=t.identity();k.save();k.scale(b,b);f=[f];f.top=function(a){a&&(this[this.length-1]=a);return this[this.length-1]};var l=[P,H,ba,S,T,M,V,I,aa],h=this.glyphProcessors,n=this.linkProcessors,v=this.nameProcessors;
if(e)for(var w=this.layers,A=w.length,p=0;p<A;++p)w[p].begin(c);else h=[],n=[],v=[];var u={canvas:a,ctx:k,document:this.doc,glyphProcessors:h,linkProcessors:n,nameProcessors:v,imageRequestTag:"img_"+c,dict:new m.viewer.ResourceDictionary,handlers:l,renderArguments:{scale:b,pageNumber:c,pageInfo:d,pageData:g,ltr:!0},pageInstance:this,matrixStack:f,createBrushes:!0,brushes:null,br:null,finishCallback:function(){k.restore();g.brushCache=u.br.cache&&0<u.br.cache.length?u.br.cache:null;if(e)for(var a=
0;a<A;++a)w[a].end()}};g.brushCache?(u.br={cache:g.brushCache,i:0},u.createBrushes=!1):u.br={cache:[]};return u},renderError:function(a,b,c,d,g,e){a=a.getContext("2d");a.save();a.scale(b,b);b=c.width/12;d=b/2;a.save();a.translate(d,d);r(a,b/48);a.restore();a.fillStyle="black";g=18;c=c.width-4*d;a.font=g+"px Arial, Helvetica, sans-serif";if(a.measureText(e).width>c)for(;1<=g&&!(a.font=g+"px Arial, Helvetica, sans-serif",a.measureText(e).width<=c);--g);else for(;100>g;++g)if(a.font=g+"px Arial, Helvetica, sans-serif",
a.measureText(e).width>c){a.font=g-2+"px Arial, Helvetica, sans-serif";break}a.fillText(e,b+2*d,d+b/2);a.restore()},free:function(){for(var a=this.layers,b=a.length,c=0;c<b;++c)a[c].freeMemory()}};var H={begin:function(a,b,c,d,g){if("C"===a||"P"===a||a===u)d.ctx.save(),d.matrixStack.push(d.matrixStack.top())},end:function(a,b,c,d,g){if("C"===a||"P"===a||a===u)d.ctx.restore(),d.matrixStack.pop()}},ba={begin:function(b,c,d,g,e){if(b="MT"===b?c.M:c.RT)a(b)?(new m.json.ObjectParser(g.handlers,g)).process({children:[g.dict.getForPropertyValue(b)]}):
(b=t.fromXPS(b),b.transform(g.ctx),g.matrixStack.top(g.matrixStack.top().multiply(b)))},end:function(a,b,c,d,g){}},T={begin:function(a,b,c,d,g){n.isUndefined(d.opacity)&&(d.opacity=1);n.isUndefined(d.opacityStack)&&(d.opacityStack=[]);a=d.opacityStack;b=b.O;if(!n.isUndefined(b)){b=parseFloat(b);if(0===b||isNaN(b))d.block=!0;a.push(d.opacity);d.opacity*=b}},end:function(a,b,c,d,g){if(!n.isUndefined(b.O)){a=d.opacityStack;b=parseFloat(b.O);if(0===b||isNaN(b))d.block=!1;d.opacity=a.pop()}}},S={begin:function(b,
c,d,g,e){if((c=c.C)||"CC"===b||"GC"===b||"PC"===b)b=g.ctx,g.fillRule=b.fillRule||b.mozFillRule||b.webkitFillRule||b.msFillRule,D(g.ctx,"evenodd");c&&(a(c)?(new m.json.ObjectParser(g.handlers,g)).process({children:[g.dict.getForPropertyValue(c)]}):(b=g.ctx,b.beginPath(),y(b,c),b.argFillRule?b.clip(b.argFillRule):b.clip()),g.fillRule&&(D(g.ctx,g.fillRule),g.fillRule=null))},end:function(a,b,c,d,g){if("CC"===a||"GC"===a||"PC"===a)d.ctx.argFillRule?d.ctx.clip(d.ctx.argFillRule):d.ctx.clip(),d.fillRule&&
(D(d.ctx,d.fillRule),d.fillRule=null)}},M={begin:function(b,c,g,e,k,f){var l=null;g=e.opacity;k=n.isBoolean(e.opacityMask)?e.opacityMask:!1;var h=c.U,h=h?t.fromXPS(h):t.identity();if("SB"===b)l=new d.SolidColorBrush(e.ctx,g,z(c.H),e.opacityMaskBrush);else if("IB"===b)e.createBrushes?(l=new d.ImageBrush(e.ctx,g,h,A(c.V),A(c.W),c.TM||"None",c.IS,e.matrixStack,e.pageInstance.fileProvider,e.imageRequestTag,e.opacityMaskBrush,f),e.br.cache.push(l)):(l=e.br.cache[e.br.i++],d.ImageBrush.call(l,e.ctx,g,h,
A(c.V),A(c.W),c.TM||"None",c.IS,e.matrixStack,e.pageInstance.fileProvider,e.imageRequestTag,e.opacityMaskBrush,f));else if("LB"===b)f=v(c.SP),l=v(c.EP),l=new d.LinearGradientBrush(e.ctx,g,h,f,l,e.opacityMaskBrush);else if("RB"===b){f=v(c.GO);var l=v(c.D),m=parseFloat(c.RX),w=parseFloat(c.RY),l=new d.RadialGradientBrush(e.ctx,g,h,f,l,m,w,e.opacityMaskBrush)}else"VB"===b&&(l=new d.SolidColorBrush(e.ctx,g,"black",e.opacityMaskBrush),e.block=!0);l&&(e.fill?e.fillBrush=l:k?e.opacityMaskBrush=l:e.strokeBrush=
l,e.brush=l);if("P"===b||b===u){b=c.F;k=c.S;h=c.O;n.isUndefined(h)||(g*=parseFloat(h));b&&(a(b)?e.fillBrush=e.dict.getForPropertyValue(b):e.fillBrush=new d.SolidColorBrush(e.ctx,g,z(b)));k&&(a(k)?e.strokeBrush=e.dict.getForPropertyValue(k):e.strokeBrush=new d.SolidColorBrush(e.ctx,g,z(k)));g=c.ST;e.ctx.lineWidth=g?parseFloat(g):1;b=(b=c.SJ)?b.toLowerCase():"miter";e.ctx.lineJoin=b;g=e.matrixStack.top().getScale();g=e.ctx.lineWidth/g.x;"miter"===b&&(b=c.SL,e.ctx.miterLimit=b?parseFloat(b)*g:10*g);
(b=c.SO)||(b=0);k=c.SA;if(e.ctx.setLineDash||"mozDash"in e.ctx||"webkitLineDash"in e.ctx){if(k)for(k=k.split(" "),h=k.length,f=0;f<h;++f)0===(k[f]=parseFloat(k[f])*g)&&(k[f]=1);else k=[];g=e.ctx;"mozDash"in g?(g.mozDash=k,g.mozDashOffset=b):"webkitLineDash"in g?(g.webkitLineDash=k,g.webkitLineDashOffset=b):(g.setLineDash(k),g.lineDashOffset=b)}c=c.SD||c.SC||"Flat";switch(c){case "Square":c="square";break;case "Round":c="round";break;default:c="butt"}e.ctx.lineCap=c}else e.fill="GF"===b||"PF"===b,
e.stroke="GT"===b||"PS"===b,e.opacityMask="GM"===b||"PM"===b},end:function(a,b,c,d,g){if("PF"===a||"GF"===a)d.fill=!1;else if("PS"===a||"GT"===a)d.stroke=!1;else if("P"===a||a===u)d.fillBrush=null,d.strokeBrush=null,d.opacityMaskBrush=null;else if("GM"===a||"PM"===a)d.opacityMask=!1;else if("SB"===a||"IB"===a||"LB"===a||"RB"===a||"VB"===a)d.brush=null,d.block=!1}},I={begin:function(a,b,c,d,g,e){"P"===a&&d.ctx.beginPath()},end:function(b,c,d,g,e,k){if("P"===b){var f=g.ctx;e=g.fillBrush;var l=g.strokeBrush,
h=c.E;h&&(a(h)?(new m.json.ObjectParser(g.handlers,g)).process({children:[g.dict.getForPropertyValue(h)]}):y(f,h));var v=c[w];if(n.isString(v)&&0<v.length)for(var A=g.linkProcessors,f=g.matrixStack.top(),h=0,p=A.length;h<p;++h)A[h].addLink(f,v,b,d);c=c[x];if(n.isString(c)&&0<c.length)for(v=g.nameProcessors,f=g.matrixStack.top(),h=0,p=A.length;h<p;++h)v[h].addName(f,c,b,d);b=!1;e&&(k.wait&&e.tryEnableAsync()?(b=!0,k.wait(),e.asyncFill(function(){l&&(l.tryEnableAsync()?(k.wait(),l.asyncStroke(function(){k.post()})):
l.stroke());k.post()})):e.fill());!b&&l&&(k.wait&&l.tryEnableAsync()?(k.wait(),l.asyncStroke(function(){k.post()})):l.stroke())}else if("PG"===b&&(f=g.ctx,b=c.G)){if(d=c.U)f.save(),t.fromXPS(d).transform(f);y(f,b);d&&f.restore()}}},aa={begin:function(a,b,c,d,g){},end:function(a,b,d,g,e){a===u&&(g.strokeBrush||g.fillBrush)?c(g.ctx,d,g,b):a===u&&m.log.warn("Glyphs are not rendered:"+b[G])}},V={begin:function(a,b,c,d,g){d.brush&&"GS"===a&&d.brush.addColorStop(parseFloat(b.P),z(b.H))},end:function(a,
b,c,d,g){}},P={begin:function(a,b,c,d,g){"RD"===a&&(d.block=!0,d.dict=new m.viewer.ResourceDictionary(d.dict,g[g.length-1]),a=new m.json.ObjectParser([M,X],{dict:d.dict,ctx:d.ctx,br:d.br,createBrushes:d.createBrushes,pageInstance:{fileProvider:d.pageInstance.fileProvider},matrixStack:d.matrixStack,dictParser:!0},null,!0),(b=b.T)?a.process(d.pageInstance.fileProvider.getResource(b)):a.process(c))},end:function(a,b,c,d,g){"RD"===a?d.block=!1:"C"!==a||d.dictParser||d.dict.scope!==c||(d.dict=d.dict.parent)}},
X={begin:function(a,b,c,d){(b=b.XK)&&(!d.brush||"SB"!==a&&"IB"!==a&&"LB"!==a&&"RB"!==a&&"VB"!==a?"PG"!==a&&"P"!==a&&a!==u&&"C"!==a&&"MT"!==a||d.dict.store(b,c):d.dict.store(b,d.brush))},end:function(){}},Z=m.is_mobile?1:15,U=!("firefox"in l.browser)})(r.viewer,r,r.geometry,r.xps,_,jQuery,I);(function(q,m,p,h,n,l,f){function b(a){this.pageNumber=null;this.rectangleStorage=a;this.fontsReady=this.add=!1}function a(){this.pages={};this._tmp={};this.tmpRectangle=e.create(null,0,0,0,0,0);this.freeCallback=
h.bind(this.onArrFreed,this)}n=m.geometry.Point;l=m.geometry.Rectangle;var e=p.GLOBAL_RECTANGLE_POOL,k=new p.RectangleArrayPool(e);h.extend(q,{GlyphsToRectanglesProcessor:b,GlyphsToRectanglesProcessorFactory:function(a){this.getInstance=function(){return new b(a)}},RectangleStorage:a,TextRectangle:l});var c=new n(0,0);b.prototype={freeMemory:function(){this.rectangleStorage.free(this.pageNumber)},begin:function(a){this.pageNumber=a;this.add=this.rectangleStorage.begin(a)},end:function(a){this.add&&
this.rectangleStorage.commit(this.pageNumber)},addText:function(a,b,k,f,l,n,m,p,q){if(this.add)if(a=e,b=b.size,h.isArray(p)){q=this.rectangleStorage;for(var u=0,w=p.length;u<w;++u){var x=p[u];c.x=k;c.y=f;n.inPlaceMultiplyPoint(c);l=x*n.a;var r=b*n.d;c.y-=r;r*=1.25;q.add(this.pageNumber,a.create(m[u],c.x,c.y,l,r,0));k+=x}}else c.x=k,c.y=f,n.inPlaceMultiplyPoint(c),l*=n.a,r=b*n.d,q||(c.y-=r,r*=1.25),this.rectangleStorage.add(this.pageNumber,a.create(m,c.x,c.y,l,r,0))}};a.prototype={begin:function(a){var b=
this.pages[a];if(h.isArray(b))return b.incRef(),!1;this.rollback(a);b=this._tmp[a]=k.create(0);b.incRef();b._pageNumber=a;return!0},onArrFreed:function(a){this.pages[a._pageNumber]=null;a._pageNumber=null;a.callback=null},rollback:function(a){var b=this._tmp,c=b[a];return h.isArray(c)?(c.decRef(),b[a]=null,!0):!1},commit:function(a){var b=this._tmp,c=b[a];h.isArray(c)?(c.callback=this.freeCallback,this.pages[a]=c,b[a]=null,this.trigger("finished",a)):m.log.error("[RectangleStorage] Unbalanced commit call!")},
getHandle:function(a){a=this.pages[a];return h.isArray(a)?a:null},add:function(a,b){this._tmp[a].push(b)},free:function(a){(a=this.pages[a])&&a.decRef()},getRectangles:function(a,b,c){if(a=this.pages[a]){var e=a.length;0>b&&(b=e+b);return b<e&&0<=b?c?a.slice(b,e):a.slice(0,b+1):[]}return null},intersect:function(a,b,c){if(a=this.pages[a]){for(var e=Math.sin,k=Math.cos,f=0,l=a.length;l--;){var h=a[l];c.isIntersectedFast(h,k,e)&&(b[f++]=h)}b.length=f}},selectTextFlow:function(a,b,c,e,k,f){if(b=this.pages[b]){var l=
null,h=null,n=Math.sin,m=Math.cos,w=Math.sqrt;if(f){f=this.tmpRectangle;var p=e.x+e.w;f.init(p,e.y,a.x-p,a.y-e.y,0,null);var p=b.length,q=1E6;for(a=0;a<p;++a){var r=b[a];if(f.isIntersectedFast(r,m,n)){var C=f.x-(r.x+r.w/2),r=f.y-(r.y+r.h/2),r=w(C*C+r*r);r<q&&(q=r,l=a)}}var J=e.x;e=e.y+e.h;f.init(0,0,J,e,0,null);q=1E6;for(a=0;a<p;++a)r=b[a],f.isIntersectedFast(r,m,n)&&(C=J-(r.x+r.w/2),r=e-(r.y+r.h/2),r=w(C*C+r*r),r<q&&(q=r,h=a));l>h&&(e=h,h=l,l=e)}else for(a=b.length;a--;)r=b[a],e.isIntersectedFast(r,
m,n)&&(null===h&&(h=a),l=a);k&&(h=b.length-1,null===l&&(l=0));k=0;for(a=l;a<=h;++a)null!==a&&(r=b[a],c[k++]=r);c.length=k}}};h.extend(a.prototype,f.Events)})(r.viewer,r,r.utils.pools,_,jQuery,document,Backbone);(function(q,m,p,h,n,l){function f(){b.call(this);this.on("finished",this.build,this)}var b=m.viewer.RectangleStorage;p.extend(q,{TextFlowRectangleStorage:f});q=f.prototype;p.extend(q,b.prototype);q.build=function(a){}})(r.viewer,r,_,jQuery,document,Backbone);(function(q,m,p,h,n,l,f){function b(a){this.controller=
a;this.selection={};this.emptySelection=[];this.generatedGetters=[]}function a(a,g,d){this.rectangleStorage=a;this.viewer=g;this.textSelectionModel=d;var k=this.lazyTextSelection=new b(this);d.set("selection",k);this.startPoint=new e(0,0);this.endPoint=new e(0,0);this.startPageDim=new e(0,0);this.endPageDim=new e(0,0);this.tmpPoint=new e(0,0);this.changed=!1;this.endPage=this.startPage=null;this.tmpArr=[];this.handles={};this.queryRectangle=new h.DataRectangle(0,0,0,0,0,null);g.on("document:detached",
this.onDocumentDetached,this);a.on("finished",this.onRectanglesReady,this)}var e=p.Point,k={MOUSE:0,TOUCH:1};p=f.Model.extend({defaults:{selection:null,queryRect:null,mode:k.MOUSE},MODE:k});b.prototype={getSelection:function(a){if(a in this.selection)return this.selection[a];var b=this.controller.computeSelection(a);return b?this.selection[a]=b:this.emptySelection},getAffectedPages:function(){return this.generatedGetters},isEmpty:function(){return n.isEmpty(this.generatedGetters)},createGetterForIndex:function(a){this.generatedGetters.push(a);
return{get:function(){return this.getSelection(a)},enumerable:!0,configurable:!0}},reset:function(){this.selection={};for(var a=this.generatedGetters,b=0,d=a.length;b<d;++b){var e=a[b];e in this&&delete this[e]}this.generatedGetters.length=0},remove:function(a){this.invalidateData(a);delete this[a]},invalidateData:function(a){var b=this.selection;a in b&&delete b[a]}};a.prototype={destroy:function(){this.viewer.off("document:detached",null,this);this.cancelSelection()},onRectanglesReady:function(a){if(this.isActive()&&
this.startPage<=a&&a<=this.endPage){var b=this.tmpArr;b[0]=a;b.length=1;this.textSelectionModel.trigger("changed",b,!0)}},onDocumentDetached:function(){this.cancelSelection()},cancelSelection:function(){if(this.isActive()){var a=this.startPage,b=this.endPage,d=this.tmpArr;for(d.length=0;a<=b;++a)d.push(a),this.decRefIfPosible(a);this.endPage=this.startPage=null;this.textSelectionModel.set("queryRect",null);this.textSelectionModel.trigger("changed",d,!1);this.lazyTextSelection.reset()}this.textSelectionModel.set("mode",
k.MOUSE)},canScrollMore:function(a){return 0===a||this.isActive()&&0>a&&null!==this.rectangleStorage.getHandle(this.startPage)||0<a&&null!==this.rectangleStorage.getHandle(this.endPage)},getNextPageForDirection:function(a){return this.isActive()?0>a?this.startPage:this.endPage:null},selectWord:function(a,b){if(null!==a){this.cancelSelection();var d=this.queryRectangle;d.x=b.x;d.y=b.y;d.w=1;d.h=1;var e=this.rectangleStorage.getHandle(a);if(null===e)return null;for(var k=-1,f=null,l=0,h=e.length;l<
h;++l)if(d.isIntersected(e[l])){k=l;f=e[l];break}if(-1!==k){l=-1===" \n\t,'\".:".indexOf(f.d)?k-1:k;d=null;if(0>=l)l=0;else{for(;l--;){var n=e[l],m=n.d;if((null===d?0:Math.abs(d.y-n.y)>d.h)||-1!==" \n\t,'\".:".indexOf(m)){++l;break}d=n}0>l&&(l=0)}d=null;k=-1===" \n\t,'\".:".indexOf(f.d)?k+1:k;for(h=e.length;k<h;++k){n=e[k];m=n.d;if((null===d?0:Math.abs(d.y-n.y)>d.h)||-1!==" \n\t,'\".:".indexOf(m)){k--;break}d=n}this.handles[a]=e;e.incRef();f=this.lazyTextSelection;d=f.selection[a]=[];for(h=e.length;l<=
k&&l<h;++l)d.push(e[l]);Object.defineProperty(f,a,f.createGetterForIndex(a));this.endPage=this.startPage=a;this.textSelectionModel.trigger("changed",[a],!0)}}},setSelectionPoints:function(a,b){if(b.y<a.y){var d=a;a=b;b=d}var e=this.viewer.getPageIteratorBetweenDU(a,b),d=this.lazyTextSelection,f=this.startPage,l=this.endPage,h=null,n=null,m=this.tmpArr;m.length=0;for(var p=this.tmpPoint.assign(a),u=this.textSelectionModel.get("mode"),w=null;e.hasNext();){w=e.next();if(null===h)h=w.number,this.startPageDim.x=
w.width,this.startPageDim.y=w.height,p.x-=w.x,p.y-=w.y;else if(u===k.TOUCH){this.cancelSelection();return}n=w.number;n in d||(m.push(n),Object.defineProperty(d,n,d.createGetterForIndex(n)))}this.endPageDim.x=w.width;this.endPageDim.y=w.height;for(e=f;null!==f&&e<=l;++e)if(e<h||e>n)d.remove(e),this.decRefIfPosible(e),-1===m.indexOf(e)&&m.push(e);this.startPoint.equals(p)||(-1===m.indexOf(h)&&(m.push(h),d.invalidateData(h),this.decRefIfPosible(h)),this.startPoint.assign(p));p.assign(b);p.x-=w.x;p.y-=
w.y;this.endPoint.equals(p)||(-1===m.indexOf(n)&&(m.push(n),d.invalidateData(n),this.decRefIfPosible(n)),this.endPoint.assign(p));this.startPage=h;this.endPage=n;m.sort();this.textSelectionModel.trigger("changed",m,!0)},decRefIfPosible:function(a){a in this.handles&&(this.handles[a].decRef(),delete this.handles[a])},computeSelection:function(a){var b=0,d=0,e=0,k=0,f=!1;if(this.isActive()){var l=this.rectangleStorage.getHandle(a);if(null===l)return null;l.incRef();this.handles[a]=l;if(this.startPage===
a&&a===this.endPage)var k=this.startPoint,h=this.endPoint,f=h.y>this.startPageDim.y,b=k.x,d=k.y,e=h.x-k.x,k=h.y-k.y;else this.startPage===a?(k=this.startPoint,h=this.startPageDim,b=k.x,d=k.y,e=h.x-k.x,k=h.y-k.y):this.endPage===a&&(h=this.endPoint,e=h.x,k=h.y);if(a!==this.startPage&&a!==this.endPage)return l;var l=this.queryRectangle,h=[],n=!1;0>e&&(b+=e,e=-e,n=!0);l.init(b,d,e,0===k?1:k,0,null);this.rectangleStorage.selectTextFlow(this.startPageDim,a,h,l,f,n);return h}m.error("[TextSelection] method must be called only when it is active")},
isActive:function(){return null!==this.startPage},finish:function(){this.textSelectionModel.trigger("finished")}};q.TextSelectionModel=p;q.TextSelectionController=a})(r.viewer,r.log,r.geometry,r.geometry2,_,jQuery,Backbone);(function(q,m,p){function h(h,l,f){this.model=h;this.field=l;if(f)h.on(f,this.onChanged,this);this.fill="rgba(49, 79, 173, 0.31)";this.stroke=null}q.RectangleRendererLayer=h;h.prototype={onChanged:function(h){this.trigger("changed",h)},getRectangles:function(h){var l=this.model.get(this.field);
return p.isObject(l)&&(h=l[h],p.isArray(h))?h:null},hasContent:function(h){h=this.getRectangles(h);return null!==h&&0<h.length},render:function(h,l,f){h=this.getRectangles(h);l.beginPath();for(f=h.length;f--;){var b=h[f];l.rect(b.x,b.y,b.w,b.h)}if(h=this.fill)l.fillStyle=h,l.fill();if(h=this.stroke)l.strokeStyle=h,l.lineWidth=1,l.stroke()}};p.extend(h.prototype,m.Events)})(r.viewer,Backbone,_);(function(q,m,p,h){function n(l,f){this.textSelectionModel=l;this.radius=f}q.TextSelectionTouchHandlesLayer=
n;n.prototype={hasContent:function(l){return 0!==this.textSelectionModel.get("mode")&&l in this.textSelectionModel.get("selection")},render:function(l,f,b){b=this.textSelectionModel.get("selection")[l];p.isEmpty(b)||(f.strokeStyle="blue",f.fillStyle="dodgerblue",f.lineWidth=1,f.globalAlpha=1,l=b[0],b=b[b.length-1],f.beginPath(),f.moveTo(l.x,l.y),f.lineTo(l.x,l.y+l.h),f.moveTo(b.x+b.w,b.y),f.lineTo(b.x+b.w,b.y+b.h),f.stroke(),f.beginPath(),f.arc(l.x,l.y-this.radius/2-1.5,this.radius,0,2*Math.PI,!1),
f.globalAlpha=0.5,f.fill(),f.globalAlpha=1,f.stroke(),f.beginPath(),f.arc(b.x+b.w,b.y+b.h+this.radius/2+1.5,this.radius,0,2*Math.PI,!1),f.globalAlpha=0.5,f.fill(),f.globalAlpha=1,f.stroke())}};p.extend(n.prototype,m.Events)})(r.viewer,Backbone,_,jQuery);(function(q,m,p,h){function n(b,a,e){this.model=b;this.viewer=e;this.rectangleStorage=a;this.onDocumentAttached=p.bind(this.documentAttached,this);this.onDocumentDettached=p.bind(this.documentDettached,this);this.onRectangleStorageFinished=p.bind(this.rectangleStorageFinished,
this);this.onIndexFileReturned=p.bind(this.indexFileReturned,this);this.onIndexFileFailed=p.bind(this.indexFileFailed,this);e.on("document:attached",this.onDocumentAttached);e.on("document:dettached",this.onDocumentDettached);a.on("finished",this.onRectangleStorageFinished);this.longSearchAbortHandle=this.lastTextIndex=this.doc=this.waitFor=null;b.on("change:ui-state",function(a,b){b||a.decRefHandle()})}var l={FORWARD:1,BACKWARD:-1},f=/\u00a0/g;m=h.Model.extend({defaults:{result:{},mode:l.FORWARD,
text:null,cursor:null,beginPage:null,beginPagePass:0,endReached:0,longsearch:!1,rectangleHandle:null},documentEndReached:function(){this.set({endReached:this.get("endReached")+1});this.get("cursor").page===this.get("beginPage")?this.searchCompleted():this.trigger("search:end-reached")},searchCompleted:function(){return this.get("endReached")!==this.get("beginPagePass")?(this.set({beginPagePass:this.get("endReached")}),this.get("longsearch")&&this.set({longsearch:!1}),this.trigger("search:completed"),
!0):!1},decRefHandle:function(){var b=this.get("rectangleHandle");b&&b.decRef();this.set("rectangleHandle",null)}});h=n.prototype;h.documentAttached=function(b){this.doc=b;b.on("textindex:loaded",this.onIndexFileReturned)};h.documentDettached=function(){this.doc.off("textindex:loaded",this.onIndexFileReturned);this.doc=null;this.decRefHandle();this.model.set(p.extend({},this.model.defaults))};h.decRefHandle=function(){this.model.decRefHandle()};h.rectangleStorageFinished=function(b){this.waitFor===
b&&(this.waitFor=null,this.doSearchOnCursor(),this.model.set({longsearch:!1}))};h.search=function(b){if(!p.isEmpty(b)){var a=this.model,e=this.viewer.getCurrentPage(),k=0;this.model.get("mode")===l.BACKWARD&&(--e,0>e&&(e=this.viewer.getNumberOfPages()-1),k=-1);this.decRefHandle();a.set({text:b,result:{},cursor:{pos:k,page:e},beginPage:e});this.doSearchOnCursor()}};h.doSearchOnCursor=function(){var b=this.model,a=b.get("mode"),e=b.get("cursor");if(e.page!==b.get("beginPage")||!b.searchCompleted()){var k=
this.rectangleStorage.getRectangles(e.page,e.pos,a===l.FORWARD);if(p.isArray(k))if(0===k.length)this.nextPage();else if(a=this.doSearchOnRectangles(k,a,b.get("text"),e),null===a)this.nextPage();else{k=this.rectangleStorage.getHandle(e.page);k.incRef();var c=b.get("rectangleHandle");c&&c.decRef();b.set("rectangleHandle",k);k={};k[e.page]=a;b.set({result:k});a=a[0].getStartPoint();this.viewer.scrollToPoint(e.page,a);b.trigger("changed",[e.page])}else this.findFirstOccurence()}};h.findFirstOccurence=
function(){var b=this.model,a=b.get("cursor");0>a.page?a.page=this.viewer.getNumberOfPages()+a.page:a.page>=this.viewer.getNumberOfPages()&&(a.page=0);var e=this.lastTextIndex;p.isObject(e)&&e[a.page]?this.searchOnIndexedFile(e):(b.set({longsearch:!0}),this.longSearchAbortHandle=this.doc.requestTextIndexFileForPage(a.page))};h.abortLongSearch=function(){this.longSearchAbortHandle&&this.longSearchAbortHandle();this.longSearchAbortHandle=null;this.model.set({longsearch:!1})};h.indexFileReturned=function(b,
a){this.longSearchAbortHandle=null;if("no-text"===a)this.nextPage();else{for(var e=a[0].data,k={},c=0,g=e.length;c<g;++c){var d=e[c];k[parseInt(d.page)-1]=d.text?d.text.replace(f," "):d.text}this.lastTextIndex=k;this.searchOnIndexedFile(k)}};h.searchOnIndexedFile=function(b){var a=this.model,e=a.get("mode"),k=a.get("text").toLowerCase(),c=a.get("cursor"),g=c.page,d=a.get("beginPage");if(e===l.FORWARD)for(var f=b[g];g!==d&&f&&-1===f.toLowerCase().indexOf(k);f=b[++g]);else for(f=b[g];g!==d&&f&&-1===
f.toLowerCase().indexOf(k);f=b[--g]);k=this.viewer.getNumberOfPages();g===d&&a.searchCompleted()||(0>g||g>=k?(c.page=0,c.pos=0,a.documentEndReached()):(c.page=g,b[g]?p.isArray(this.rectangleStorage.getRectangles(c.page,0,e===l.FORWARD))?this.doSearchOnCursor():(this.waitFor=g,a.set({longsearch:!0}),this.viewer.scrollTo(g)):this.findFirstOccurence()))};h.indexFileFailed=function(b){var a=this.model;a.set({longsearch:!1});a.trigger("longsearch:failed",b)};h.nextPage=function(){var b=this.model,a=b.get("mode"),
e=b.get("cursor");e.pos=a===l.FORWARD?0:-1;var k=e.page;e.page+=a;a=b.get("beginPage");e.page===a&&b.searchCompleted()||(a=this.viewer.getNumberOfPages(),0>e.page||e.page>=a?(b.set({longsearch:!1}),e.page>=a?(e.page=0,e.pos=0):(e.page=a+e.page,e.pos=-1),b.documentEndReached()):this.doSearchOnCursor(),b.trigger("changed",[k]))};h.next=function(){var b=this.model,a=b.get("mode"),e=b.get("cursor");e.pos=a===l.FORWARD?e.pos+b.get("text").length:e.pos-b.get("text").length;this.doSearchOnCursor()};h.doSearchOnRectangles=
function(b,a,e,k){for(var c=e.toLowerCase(),g=Array(b.length),d=0,h=b.length;d<h;++d)g[d]=b[d].d;g=(g=g.join("").toLowerCase())?g.replace(f," "):g;d=-1;d=a===l.FORWARD?g.indexOf(c):g.lastIndexOf(c);return-1!==d?(k.pos=a===l.FORWARD?k.pos+d:d,b.slice(d,d+e.length)):null};q.SearchModel=m;q.SearchController=n;q.SearchMode=l})(r.viewer,r,_,Backbone);(function(q,m,p){m=m.Model.extend({defaults:{id:"0",action:"open",type:null,name:null},initialize:function(h){h.list=h.list||[];h.actions=h.actions||[];h.nodes=
h.nodes||[];this.set(h)},mount:function(h){this.get("nodes").push(h);var n=this.get("list");n.push(h.toJSON());this.trigger("change:list",this,n);var l=this;h.on("change",function(){for(var f=h.get("id"),b=h.toJSON(),a=0,e=n.length;a<e;++a)if(f===n[a].id){n[a]=b;break}l.trigger("change:list-item",l,b)})},open:function(h,n){for(var l=this.get("nodes"),f=0,b=l.length;f<b;++f){var a=l[f];if(a.get("id")===h){n.push(a);break}}},name:function(h){for(var n=this.get("list"),l=0,f=n.length;l<f;++l){var b=
n[l];if(b.id===h)return b.name}return null}});q.FsNodeModel=m})(r.fs,Backbone,_);(function(q,m,p,h,n,l){function f(a,b,c,d,g){this.el=p(a);this.loadingImg=g||p(E);this.wrap=p("<div class='fs-wrap'>").appendTo(this.el);this.lockScreen=p("<div class='fs-lock-screen fs-lock-screen-off fs-lock-screen-none'></div>").appendTo(this.wrap);this.model=this.lockScreenAnimationTimer=null;this.elStack=[];this.uiHandlers=c;this.onOnNodePushed=m.bind(this.__onNodePushed,this);this.onOnNodePopped=m.bind(this.__onNodePopped,
this);this.duration=d?d:0;this.attachModel(b)}function b(a){var b=a.length-1;return 0>b?null:a[b]}function a(a,b){this.className=a;this.handlers=b}function e(a,b){this.id=u++;this.model=a;this.controller=b;this.tmpl=m.template("<div class='name'><% if (type != 'root') { %><button type='button' class='btn back'><i class='icon-arrow-left'></i></button><% } else {%><%}%></div><h3 class='fs-level-name'><%=name%></h3>");this.update=m.bind(this.__update,this);this.onPopped=m.bind(this.__onPopped,this);
this.onBack=m.bind(this.__onBack,this);a.on("node:popped",this.onPopped)}function k(a,b,c,d,g,e){this.id=u++;this.model=a;this.controller=b;this.icons=c;this.actions=d||[];this.tmpl=e||m.template("<tr data-item-id='<%=escape(item.id)%>'><td class='fs-node-type-<%=item.type%>' ><%=supported.actions||'' %><div class='name'><a href='#' data-action='<%=item.action %>'><i class='<%=icon %>'></i>&nbsp;<%=item.name%></a></div></td></tr>");this.actionsTemplate=m.template('<% for (var i = 0, len=item.actions.length; i < len; ++i) { %> \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<% if (i == 0) { %>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="fs-inline-actions btn-group">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<%} var action = item.actions[i]; %>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type="button" href="#" class="btn btn-small <%=action.cssClass||""%>" data-action="<%=action.id%>">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<%if (action.icon) {%>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="<%=action.icon%>"></i>&nbsp;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span><%=action.tile || i18n._T("fs-action-"+action.id+"-title") %></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<% if (i == len -1) { %>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<%} %>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<%}%>');
this.update=m.bind(this.__update,this);this.updateItem=m.bind(this.__updateItem,this);this.removeItem=m.bind(this.__removeItem,this);this.onPopped=m.bind(this.__onPopped,this);this.onAction=m.bind(this.__onAction,this);this.stack=[];this.filter=g?g:null;a.on("change:mode",this.onModeChanged,this);a.on("node:popped",this.onPopped)}function c(a,b,c){this.model=a;this.view=b;this.onPopped=m.bind(this.__onPopped,this);this.onSwitchButtonClicked=m.bind(this.__onSwitchButtonClicked,this);this.elements=
[];a.on("change:mode",this.onModeChanged,this);a.on("node:popped",this.onPopped)}function g(a,b,c,d){this.id=u++;this.model=a;this.controller=b;this.icons=c||{};this.displayAll=!!d;this.tmpl=m.template("<a class='btn btn-action' href='#' data-action='<%=action.id %>' <% if (action.title) { %> title='<%=action.title%>'  <% } %> ><% if (visual.icon) {%><i class='<%=visual.icon %>'></i>&nbsp;<%}%><span><% if (action.title){ %><%=action.title%><%} else { %><%=i18n._T('fs-action-'+action.id+'-title')%><%}%></span></a>");
this.update=m.bind(this.__update,this);this.onPopped=m.bind(this.__onPopped,this);this.onAction=m.bind(this.__onAction,this);a.on("node:popped",this.onPopped)}function d(a,b){this.view=a;var c=this.el=p("<div class='fs-center-parent'><div class='fs-dialog'></div></div>"),d=this.template=b.template||w,g=(this.buttonsTemplate=b.buttonsTemplate||x)({dialog:b}),e=null;if(m.isString(b.body))e=d({dialog:b,buttons:g}),e=p(e);else{var k=b.body;b.body=null;e=d({dialog:b,buttons:g});e=p(e);e.find(".modal-body").append(k)}d=
c.find(".fs-dialog");m.isString(b.cssClass)&&c.find(".modal").addClass(b.cssClass);this.content=e;d.append(e);c.on("tap click",".modal-header *[data-action], .modal-footer *[data-action]",m.bind(this.onButton,this));this.loadingImg=b.loadingImg||p(E);this.lockScreen=p("<div class='fs-lock-screen fs-lock-screen-off fs-lock-screen-none'></div>").appendTo(c.find(".modal"));this.lockScreenVisible=!1;this.onKeyPress=m.bind(this.__onKeyPress,this);this.messageContainer=new A(c.find(".modal-body"))}function t(a,
b){if(!b.field)throw Error("Field must be specified!");var c=(b.body||"")+(b.inputDialogTemplate||G)(b);b.body=c;this.validateAfter=b.field.validateAfter||[];d.call(this,a,b);this.on("view:show",m.bind(this.onShow,this))}function y(a){this.el.addClass("fs-screen-locked");var b=this.lockScreen;b.empty();a&&b.append(a);b.removeClass("fs-lock-screen-none");var c=this;this.lockScreenAnimationTimer=setTimeout(function(){b.removeClass("fs-lock-screen-off");c.lockScreenAnimationTimer=null},17);this.lockScreenVisible=
!0}function v(){function a(){b.addClass("fs-lock-screen-none").off("transitionend",a);clearTimeout(c)}this.el.removeClass("fs-screen-locked");var b=this.lockScreen,c=null;this.lockScreenAnimationTimer?(clearTimeout(this.lockScreenAnimationTimer),this.lockScreenAnimationTimer=null,b.addClass("fs-lock-screen-none")):(b.addClass("fs-lock-screen-off"),b.on("transitionend",a),c=setTimeout(a,1200*this.duration));this.lockScreenVisible=!1}function A(a,b){this.parentEl=a;this.el=p("<div class='"+(b||"fs-messages")+
"'></div>").hide().appendTo(a);this.messageCounter=0;this.state=B;this.messages=[]}function z(a,b){this.container=a;var c=b.type||"error",d=m.isString(b)?b:b.text,d=this.el=p("<div class='alert alert-"+c+"'>"+("error"===c?'<button type="button" class="close" data-dismiss="alert">&times;</button>':"")+r(d,b.args)+"</div>");if("error"===c||b.persistent)d.find("button").on("click",m.bind(this.close,this));else setTimeout(m.bind(this.close,this),2E3)}q.FSBrowserView=f;q.ContainerRenderer=a;q.NameView=
e;q.ListView=k;q.ActionView=g;q.Dialog=d;q.InputDialog=t;q.EditModeButton=c;q.generateViewID=function(){return u++};var r=n._T,E="<div class='fs-loading'></div>",u=0;f.prototype={attachModel:function(a){this.detachModel();this.model=a;a.on("node:pushed",this.onOnNodePushed);a.on("node:popped",this.onOnNodePopped);this.asyncTaskHandler=new q.AsyncTaskHandler(a,{start:m.bind(this.showLoading,this),completed:m.bind(this.hideLockscreen,this)})},detachModel:function(){this.model&&(model.off("node:pushed",
this.onOnNodePushed),model.off("node:popped",this.onOnNodePopped),this.model=null,this.asyncTaskHandler.destroy(),this.asyncTaskHandler=null)},showLoading:function(){this.showLockscreen(this.loadingImg)},showLockscreen:y,hideLockscreen:v,prepareRender:function(a){var b=a.get("type"),c=p("<div class='fs-level fs-level-new'>").addClass("fs-type-"+b);0!==this.elStack.length&&c.addClass("fs-level-top-animation");b=this.uiHandlers[b];a.views||(a.views={});for(var d=this.wrap,g=0,e=b?b.length:0;g<e;++g)b[g].render(a,
c);this.elStack.push(c);c.appendTo(d);return c},__onNodePushed:function(a,c){function d(){g.addClass("fs-level-up-done");e.removeClass("fs-level-new");g.off("transitionend",d);clearTimeout(k)}var g=b(this.elStack),e=this.prepareRender(c),k=null;g&&(g.addClass("fs-level-up"),setTimeout(function(){e.removeClass("fs-level-top-animation")},20),g.on("transitionend",d),k=setTimeout(d,1200*this.duration))},__onNodePopped:function(a,c){var d=this.elStack.pop(),g=b(this.elStack);this.el.height();d.addClass("fs-popped");
d.addClass("fs-level-new");g.removeClass("fs-level-up-done");var e=1200*this.duration;setTimeout(function(){g.removeClass("fs-level-up");g.on("transitionend",function H(){g.off("transitionend",H);d.remove();clearTimeout(a)});var a=setTimeout(function(){d.remove()},e)},20)}};a.prototype={render:function(a,b){for(var c=this.handlers,d=p("<div>").addClass(this.className),g=0,e=c?c.length:0;g<e;++g)c[g].render(a,d);d.appendTo(b)}};e.prototype={render:function(a,b){a.on("name:change",this.update);var c=
p(this.tmpl({type:a.get("type"),name:a.get("name")}));c.appendTo(b);c.on("tap click","button",this.onBack);a.views[this.id]=c},__update:function(a,b){var c=a.views[this.id];c.find("span").text(c)},__onBack:function(a){this.controller.pop()},__onPopped:function(a,b){b.off("name:change",this.update);b.views[this.id]=null}};k.prototype={render:function(a,b){a.on("change:list",this.update);a.on("change:list-item",this.updateItem);a.on("remove:list-item",this.removeItem);var c=p("<table class='fs-list table table-striped'></table>");
p.browser&&p.browser.safari&&c.addClass("fs-list-safari");this.stack.push({display:c,node:a});"view"===this.model.get("mode")&&c.addClass("fs-view-mode");var d=p("<div class='fs-list-wrap'></div>");d.append(c);a.views[this.id]={el:b,display:c,wrap:d};this.__update(a,a.get("list"))},__update:function(a,b){var c=a.views[this.id],d=c.display;c.wrap.remove();d.empty();var g=this.tmpl,e=this.actionsTemplate,k=this.icons,f=this.actions,l={item:null,supported:{}},h=this.filter,t=0;if(h)for(var n=b?b.length:
0;t<n;++t){var v=b[t];h(v)&&d.append(this.__renderItem(l,v,f,k,e,g))}else for(n=b?b.length:0;t<n;++t)v=b[t],d.append(this.__renderItem(l,v,f,k,e,g));0===t&&d.append("<tr class='fs-empty-row'><td>"+r("fs-empty-folder")+"</td></tr>");c.wrap.appendTo(c.el);d.on("tap click","a, button",this.onAction)},__renderItem:function(a,b,c,d,g,e){(d=d[b.type])||(d="fa fa-file-text-o");a.icon=d;a.item=b;d=[];b=b.editActions;if(!m.isEmpty(b))for(var k=0,f=c.length;k<f;++k){var l=c[k];-1!==b.indexOf(l.id)&&d.push(l)}a.supported.actions=
g({item:{actions:d},i18n:n});return p(e(a))},__updateItem:function(a,b,c){a=a.views[this.id].display.find("*[data-item-id='"+escape(c||b.id)+"']");p(this.__renderItem({supported:{}},b,this.actions,this.icons,this.actionsTemplate,this.tmpl)).insertAfter(a);a.remove()},__removeItem:function(a,b,c){a.views[this.id].display.find("*[data-item-id='"+escape(c||b.id)+"']").remove()},__onAction:function(a){"click"===a.type&&a.preventDefault();var b=p(a.currentTarget);(a=b.attr("data-action"))||(a=b.parents("*[data-action]").attr("data-action"));
b=unescape(b.parents("*[data-item-id]").attr("data-item-id"));this.controller.execute(a,b)},__onPopped:function(a,b){b.off("change:list",this.update);b.off("change:list-item",this.updateItem);b.off("remove:list-item",this.removeItem);b.views[this.id]=null;for(var c=this.stack,d=0,g=c.length;d<g;++d){var e=c[d];if(e.node===b){d+1==g?c.pop():this.stack=m.without(c,e);break}}},onModeChanged:function(a,b){for(var c=this.stack,d=0,g=c.length;d<g;++d)"view"===b?c[d].display.addClass("fs-view-mode"):c[d].display.removeClass("fs-view-mode")}};
c.prototype={render:function(a,b){var c=this.model,d=p('<div class="btn-group fs-mode"><button type="button" class="btn fs-action-switch"></a></div>');d.on("tap click","button.fs-action-switch",this.onSwitchButtonClicked);this.view.render(a,d);b.find(".btn-action").addClass("fs-hide");this.elements.push({node:a,el:d.appendTo(b)});this.onModeChanged(c,c.get("mode"))},onModeChanged:function(a,b){var c,d,g,e;if("view"===b)c=r("fs-mode-edit"),d="icon-pencil",g="btn-danger",e="btn-primary";else if("edit"===
b)c=r("fs-mode-view"),d="icon-eye-open",g="btn-primary",e="btn-danger";else return;for(var k=this.elements,f=0,l=k.length;f<l;++f){var h=k[f].el;"view"===b?p(h[0].parentElement).find(".btn-action").addClass("fs-hide"):p(h[0].parentElement).find(".btn-action").removeClass("fs-hide");h=h.find(".fs-action-switch");h.addClass(g).removeClass(e);h.html("<i class='"+d+"'></i>&nbsp;<span>"+c+"</span>")}},__onSwitchButtonClicked:function(a){a=this.model;var b="view"===a.get("mode")?"edit":"view";a.set("mode",
b)},__onPopped:function(a,b){var c=this.elements;if(0<c.length)if(c[c.length-1].node===b)c.pop();else for(var d=0,g=c.length;d<g;++d){var e=c[d];if(e.node===b){this.elements=m.without(c,e);break}}}};g.prototype={render:function(a,b){a.on("change:actions",this.update);a.views[this.id]={el:b,display:[]};this.__update(a,a.get("actions"))},__update:function(a,b){var c=a.views[this.id],d=c.display;c.el.hide();for(var g=0,e=d.length;g<e;++g)d[g].remove();c.display=[];for(var k=this.tmpl,f=this.icons,l=
{action:null,visual:{},i18n:n},h=this.displayAll,g=0,e=b?b.length:0;g<e;++g){var t=b[g];l.action=t;l.visual.icon=f[t.id];if(h||l.visual.icon)t=p(k(l)),t.click(this.onAction),d.push(t)}t=c.el;for(g=d.length;g--;)t.prepend(d[g]);t.show()},__onAction:function(a){a.preventDefault();a=p(a.currentTarget);if(!a.parent("ul").hasClass("fs-hide")){var b=a.attr("data-action");b||(b=a.parents("*[data-action]").attr("data-action"));this.controller.execute(b)}},__onPopped:function(a,b){b.off("change:actions",this.update);
b.views[this.id]=null}};var w=m.template('<div class="modal <%=dialog.cssClass||"" %>">\t\t  <div class="modal-header">\t\t\t<button type="button" class="close" aria-hidden="true" data-action="close"><i class="fa fa-times"></i></button>\t\t\t<h3><%=dialog.title||"&nbsp;" %></h3>\t\t  </div>\t\t  <div class="modal-body">\t\t\t<%=dialog.body||""%>\t\t  </div>\t\t\t<%=buttons %>\t</div>'),x=m.template('<% for (var i = 0, len=dialog.buttons.length; i < len; ++i) { %>\t\t  <% if (i == 0) { %><div class="modal-footer"><% } %> \t\t\t<% var button = dialog.buttons[i];%>\t\t\t<button type="button" class="btn <%=button.cssClass||"" %> btn-id-<%=button.id||"" %>" data-action="<%=button.id%>" title="<%=button.title || button.label%>"><%=button.label || button.title %></button>\t\t\t\t\t\t<% if (i == len -1) { %></div><% } %> \t\t  <% } %>');
d.prototype=m.extend({__onKeyPress:function(a){if(!this.lockScreenVisible){if(27===a.which)return this.keyDown=!0,this.triggerButtonAction("close"),a.preventDefault(),a.stopPropagation(),!1;if(13===a.which){var b=this.el.find(".btn-primary");if(1===b.length&&!b.hasClass("no-key"))return this.keyDown=!1,b.click(),a.preventDefault(),a.stopPropagation(),!1}}return!0},updateBody:function(a){m.isString(a)?this.el.find(".modal-body").html(a):this.el.find(".modal-body").empty().append(a)},updateTitle:function(a){this.el.find(".modal-header h3").html(a)},
updateButtons:function(a){a=this.buttonsTemplate({dialog:{buttons:a}}).replace(/^\s+|\s+$/g,"");this.el.find(".modal-footer").remove();p(a).insertAfter(this.el.find(".modal-body"))},show:function(a){this.el.removeClass("modal-hide");a||this.view.showLockscreen(this.el,this);this.trigger("view:show",!0,this);p(l).on("keyup",this.onKeyPress)},hide:function(a){p(l).off("keyup",this.onKeyPress);this.el.addClass("modal-hide");a||this.view.hideLockscreen(this.el,this);this.trigger("view:show",!1,this)},
onButton:function(a){"click"===a.type&&a.preventDefault();a=p(a.currentTarget).attr("data-action");m.isEmpty(a)||this.triggerButtonAction(a)},triggerButtonAction:function(a){var b={prevented:!1,target:this,preventDefault:function(){this.prevented=!0}};this.trigger("button:"+a,b);b.prevented||this.hide()},showLockscreen:y,hideLockscreen:v,showLoading:function(){this.showLockscreen(this.loadingImg)},hideLoading:function(){this.hideLockscreen(this.loadingImg)},displayMessages:function(a){for(var b=this.messageContainer,
c=0,d=a.length;c<d;++c)b.addMessage(a[c])},clearMessages:function(){this.messageContainer.remove()}},h.Events);var G=m.template('\t<div class="control-group"><label><%=field.label|| "" %></label>    <input type="text" placeholder="<%=field.placeholder || "" %>"  value="<%=field.value|| "" %>" />\t</div>\t<% if (field.help && field.help.length > 0) { %>\t<div class="messages">\t\t<span class="help-block message-default"><%=field.help|| "" %></span>   </div><%}%>\t');t.prototype=m.extend(m.clone(d.prototype),
{onShow:function(a){a?this.el.find("input").focus().select():p(this.el[0].parentElement).find(".fs-level").focus()},onButton:function(a){a.preventDefault();this.el.find(".control-group").removeClass("error");var b=p(a.currentTarget).attr("data-action");if(-1===this.validateAfter.indexOf(b))d.prototype.onButton.call(this,a);else{var c=this,g={stringValue:this.el.find(".control-group input").val(),waitCount:0,messages:[],wait:function(){this.waitCount+=1},post:function(){this.waitCount-=1;0===this.waitCount&&
(c.hideLoading(),0<this.messages.length?c.displayMessages(this.messages):d.prototype.onButton.call(c,a),this.waitCount=null)}};this.trigger("validate:"+b,g);0<g.waitCount?this.showLoading():0<g.messages.length&&null!==g.waitCount?c.displayMessages(g.messages):null!==g.waitCount&&d.prototype.onButton.call(c,a)}},displayMessages:function(a){var b=this.el.find(".control-group").addClass("error");b.find(".message-validation").remove();for(var b=b.find("input"),c=0,d=a.length;c<d;++c)p("<span class='help-inline message-validation'>"+
r(a[c])+"</span>").insertAfter(b)}});var B=0;A.prototype={destroy:function(){this.el&&(this.el.remove(),this.el=this.parentEl=null)},addMessage:function(a){++this.messageCounter;this.onMessageCounterChanged();a=new z(this,a);var b=this.messages.length;this.messages[b]=a;a.idx=b;a.el.appendTo(this.el)},remove:function(a){if(a){a.el.remove();--this.messageCounter;this.onMessageCounterChanged();a=a.idx;var b=this.messages;if(a===b.length-1)b.pop();else{for(var c=[],d=0,g=b.length;d<g;++d)a!==d&&c.push(b[d]);
d=0;for(g=c.length;d<g;++d)c[d].idx=d;this.messages=c}}else{b=this.messages;d=0;for(g=b.length;d<g;++d)b[d].close();this.messages=[]}},onMessageCounterChanged:function(){switch(this.state){case B:0<this.messageCounter&&(this.el.fadeIn("fast"),this.state=2);break;case 2:0===this.messageCounter&&(this.el.fadeOut("fast"),this.state=B)}}};z.prototype={close:function(){var a=this.container,b=this;this.el.fadeOut("fast",function(){a.remove(b)})}}})(r.fs,_,$,Backbone,r.i18n,document);(function(q,m,p,h){function n(a,
b,c){this.model=a;this.view=b;this.controller=c;this.validationEvent=this.currentDialog=null;this.onAction=p.bind(this.__onAction,this);this.onValidate=p.bind(this.__onValidate,this);this.onNotImplemented=p.bind(this.__notImplemented,this);this.onFolderCreated=p.bind(this.__onFolderCreated,this);this.onFolderCreationFailed=p.bind(this.__onFolderCreationFailed,this);a.on("action:create-folder",this.onAction);a.on("action:doCreateFolder",this.onNotImplemented);a.on("action-success:doCreateFolder",this.onFolderCreated);
a.on("action-error:doCreateFolder",this.onFolderCreationFailed)}function l(a,b,c){this.model=a;this.view=b;this.controller=c;this.validationEvent=this.currentDialog=null;this.onValidate=p.bind(this.__onValidate,this);a.on("action:item-rename",this.__onAction,this);a.on("action:doItemRename",this.__notImplemented,this);a.on("action-success:doItemRename",this.__onItemRenamed,this);a.on("action-error:doItemRename",this.__onItemRenameFailed,this);this.id=null}function f(a){for(var b=k,e=c,f=!1,l=0,h=
e.length;l<h&&!f;++l)f=a===e[l];l=0;for(h=b.length;l<h&&!f;++l)f=-1!==a.indexOf(b[l]);return!f}function b(a,b,c){this.model=a;this.view=b;this.controller=c;this.validationEvent=this.currentDialog=null;this.onDelete=p.bind(this.__onDelete,this);a.on("action:item-delete",this.__onAction,this);a.on("action:doItemDelete",this.__notImplemented,this);a.on("action-success:doItemDelete",this.__onItemDeleted,this);a.on("action-error:doItemDelete",this.__onItemDeleteFailed,this);this.id=null}function a(a,b,
c,e){this.model=a;this.view=b;this.controller=c;this.currentNode=this.currentController=this.currentDialog=null;this.animationTime=e||0.5;this.moveToNode=null;a.on("action:item-move",this.__onAction,this);a.on("action:doItemMove",this.__notImplemented,this);a.on("action-success:doItemMove",this.__onItemMoved,this);a.on("action-error:doItemMove",this.__onItemMoveFailed,this)}var e=h._T;q.CreateFolderActionView=n;q.RenameActionView=l;q.DeleteActionView=b;q.MoveActionView=a;var k=["/"],c=[];n.prototype=
{__onRefreshAll:function(){this.currentDialog&&(this.currentDialog.hide(),this.currentDialog=null,this.model.off("refreshAll",this.__onRefreshAll,this))},__onAction:function(){this.model.on("refreshAll",this.__onRefreshAll,this);var a=this.currentDialog=new q.InputDialog(this.view,{title:e("fs-action-create-folder-title"),field:{label:e("fs-action-create-folder-label"),placeholder:e("fs-action-create-folder-label"),validateAfter:["create"]},buttons:[{id:"close",title:e("fs-cancel")},{id:"create",
title:e("fs-action-create-folder-title"),cssClass:"btn-primary"}]});a.on("validate:create",this.onValidate);a.show()},__onValidate:function(a){var b=a.stringValue;p.isEmpty(b)||(b=b.replace(/^\s+|\s+$/g,""));p.isEmpty(b)?a.messages.push("fs-action-err-empty"):f(b)?(this.validationEvent=a,a.wait(),this.controller.execute("doCreateFolder",a.stringValue)):a.messages.push("fs-action-err-invalid")},__onFolderCreated:function(){this.validationEvent&&(this.validationEvent.post(),this.validationEvent=null,
this.model.off("refreshAll",this.__onRefreshAll,this))},__onFolderCreationFailed:function(a){this.validationEvent&&(p.isArray(a)||(a=[a]),this.validationEvent.messages.push.apply(this.validationEvent.messages,a),this.validationEvent.post(),this.validationEvent=null)},__notImplemented:function(){this.__onFolderCreationFailed("fs-action-create-folder-err-not-implemented")}};l.prototype={__onRefreshAll:function(a){this.currentDialog&&(a.preventDefault||this.currentDialog.hide(),this.currentDialog=null,
this.model.off("refreshAll",this.__onRefreshAll,this))},__onAction:function(a,b,c){a=c.name(b);this.id=b;this.model.on("refreshAll",this.__onRefreshAll,this);b=this.currentDialog=new q.InputDialog(this.view,{title:e("fs-action-item-rename-title"),field:{label:e("fs-action-item-rename-label",[a]),placeholder:e("fs-action-item-rename-label",[a]),validateAfter:["rename"],value:a},buttons:[{id:"close",title:e("fs-cancel")},{id:"rename",title:e("fs-action-item-rename-title"),cssClass:"btn-primary"}]});
b.on("validate:rename",this.onValidate);b.on("button:close",this.__onRefreshAll,this);b.show()},__onValidate:function(a){var b=a.stringValue;p.isEmpty(b)||(b=b.replace(/^\s+|\s+$/g,""));p.isEmpty(b)?a.messages.push("fs-action-err-empty"):f(b)?(this.validationEvent=a,a.wait(),this.controller.execute("doItemRename",{id:this.id,name:a.stringValue})):a.messages.push("fs-action-err-invalid")},__onItemRenamed:function(){this.validationEvent&&(this.validationEvent.post(),this.validationEvent=null,this.model.off("refreshAll",
this.__onRefreshAll,this))},__onItemRenameFailed:function(a){this.validationEvent&&(p.isArray(a)||(a=[a]),this.validationEvent.messages.push.apply(this.validationEvent.messages,a),this.validationEvent.post(),this.validationEvent=null)},__notImplemented:function(){this.__onItemRenameFailed("fs-action-item-rename-err-not-implemented")}};b.prototype={__onAction:function(a,b,c){this.model.on("refreshAll",this.__onItemDeleted,this);a=c.name(b);this.id=b;b=this.currentDialog=new q.Dialog(this.view,{title:e("fs-action-item-delete-title"),
body:e("fs-action-item-delete-question",[a]),buttons:[{id:"close",title:e("fs-cancel")},{id:"do-delete",title:e("fs-action-item-delete-title"),cssClass:"btn-primary btn-danger"}]});b.on("button:do-delete",this.onDelete);b.on("button:close",this.__onItemDeleted,this);b.show()},__onDelete:function(a){a.preventDefault();this.currentDialog.showLoading();this.controller.execute("doItemDelete",this.id)},__onItemDeleted:function(){this.currentDialog&&(this.currentDialog.hideLoading(),this.currentDialog.hide(),
this.model.off("refreshAll",this.__onItemDeleted,this));this.currentDialog=null},__onItemDeleteFailed:function(a){if(this.currentDialog){p.isArray(a)||(a=[a]);for(var b="",c=0,k=a.length;c<k;++c)b+="<div class='alert alert-error'>"+e(a[c])+"</div>";this.currentDialog.updateBody(b);this.currentDialog.hideLoading()}},__notImplemented:function(){this.__onItemDeleteFailed("fs-action-item-delete-err-not-implemented")}};a.prototype={__onAction:function(a,b,c){function k(a){f.pop(a)}this.model.on("refreshAll",
this.__onItemMoved,this);a=c.name(b);this.currentNode=c;this.id=b;c=new q.BrowserModel;c.on("node:popped",this.__onPopped,this);var f=this.currentController=new q.BrowserController(c),l=[new q.ContainerRenderer("fs-top",[new q.NameView(c,f)]),new q.ContainerRenderer("fs-cb",[]),new q.ListView(c,f,{folder:"icon-folder-open"},[],function(a){return"folder"===a.type&&a.id!==b},p.template("<tr data-item-id='<%=item.id%>'><td class='fs-node-type-<%=item.type%>' ><%=supported.actions||'' %><div class='name'><% if (item.type === 'folder') {%><a href='#' data-action='<%=item.action %>'><%}%><i class='<%=icon %>'></i>&nbsp;<%=item.name%><% if (item.type === 'folder') {%></a><%}%></div></td></tr>"))];
a=this.currentDialog=new q.Dialog(this.view,{cssClass:"fs-file-dialog",title:e("fs-action-item-move-dialog-title",[a]),body:"",buttons:[{id:"close",title:e("fs-cancel")},{id:"move",title:"",cssClass:"btn-primary"}]});new q.FSBrowserView(a.el.find(".modal-body"),c,{root:l,folder:l},this.animationTime);c.on("node:pushed",function(a,b){b.on("invalidate",k)});c.on("node:popped",function(a,b){b.off("invalidate",k)});for(var l=this.model.get("stack"),h=0,n=l.length;h<n;++h){if(h+1==n)c.on("node:pushed",
this.__onPushed,this);f.push(l[h])}a.on("button:move",p.bind(this.onMoveButton,this));a.on("button:close",p.bind(this.onCloseButton,this));a.show()},__onPushed:function(a,b){this.moveToNode=b;this.currentDialog.el.find(".btn-id-move").text(e("fs-action-item-move-to",[b.get("name")]))},__onPopped:function(a,b,c){this.moveToNode=c;this.currentDialog&&this.currentDialog.el.find(".btn-id-move").text(e("fs-action-item-move-to",[c.get("name")]))},onMoveButton:function(a){a.preventDefault();this.currentDialog.showLoading();
this.controller.execute("doItemMove",{id:this.id,destination:this.moveToNode.get("id")})},__onItemMoved:function(){this.currentDialog&&(this.currentDialog.hide(),this.onCloseButton())},__onItemMoveFailed:function(a){this.currentDialog&&(p.isArray(a)||(a=[a]),this.currentDialog.displayMessages(a),this.currentDialog.hideLoading())},__notImplemented:function(){this.__onItemMoveFailed("fs-action-item-move-err-not-implemented")},onCloseButton:function(){this.currentDialog=this.currentNode=this.currentController=
null;this.model.off("refreshAll",this.__onItemMoved,this)},refresh:function(){this.currentNode&&this.currentNode.refresh();this.currentController&&this.currentController.refreshAll()},onInvalidate:function(){this.currentDialog&&(this.currentDialog.hide(),this.currentNode.off("invalidate",this.onInvalidate,this))}}})(r.fs,Backbone,_,r.i18n);(function(q,m,p){function h(a){this.model=a}function n(a){var b=a.length-1;return 0>b?null:a[b]}function l(a,b,k){this._abort=a;this.model=b;this.name=k}function f(a,
b,k){this.model=a;k||(k=null);this.name=k;this.handlers=b||{};this.reg()}function b(a){return function(b,k){var c=this.handlers,g=c[a],d=this.name;g&&(null!==d&&d===b?g.apply(c,k):null===d&&g.apply(c,k))}}m=m.Model.extend({defaults:{mode:"view"},initialize:function(){this.set("stack",[])}});q.BrowserModel=m;q.BrowserController=h;q.AsyncTask=l;q.AsyncTaskHandler=f;h.prototype={push:function(a){var b=this.model,k=b.get("stack"),c=n(k);null!=c&&c.trigger("node:lost-top",c,a);k.push(a);b.trigger("node:pushed",
b,a,c);a.trigger("node:pushed",b,a,c);a.trigger("node:is-top",b,a,c)},pop:function(a){var b=this.model,k=b.get("stack");if(a){for(b=k.length;b--&&k[b].get("id")!==a;);if(-1!==b)for(b=k.length-b,k=0;k<b;++k)this.pop()}else 1<k.length&&(a=k.pop(),k=n(k),b.trigger("node:popped",b,a,k),a.trigger("node:popped",b,a,k),k.trigger("node:is-top",b,k,a))},execute:function(a,b){var k=this.model,c=n(k.get("stack")),g=c[a];g?g.call(c,b,this,c):g||((g=this["action-"+a])?g.call(this,b,c):k.trigger("action:"+a,this,
b,c))},trigger:function(){var a=[];a.push.apply(a,arguments);this.model.trigger(a[0],a.slice(1,a.length))},actionResultSuccess:function(){var a=[];a.push.apply(a,arguments);this.model.trigger("action-success:"+a[0],a.slice(1,a.length));this.model.trigger("action-success",a[0],a.slice(1,a.length))},actionResultError:function(){var a=[];a.push.apply(a,arguments);this.model.trigger("action-error:"+a[0],a.slice(1,a.length));this.model.trigger("action-error",a[0],a.slice(1,a.length))},refresh:function(a){for(var b=
this.model.get("stack"),k=0,c=b.length;k<c;++k){var g=b[k];if(g.get("id")===a){g.refresh();break}}},refreshAll:function(){for(var a=this.model.get("stack"),b=a.length;b--;)a[b].refresh();this.model.trigger("refreshAll")}};l.prototype={start:function(a){this.model.trigger("async:start",this.name,a,this)},end:function(a){this.model.trigger("async:end",this.name,a)},error:function(a){this.model.trigger("async:error",this.name,a)},abort:function(a){p.isFunction(this._abort)?(this._abort(),this.model.trigger("async:abort",
this.name,a)):this._abort&&p.isFunction(this._abort.abort)&&(this._abort.abort(),this.model.trigger("async:abort",this.name,a))}};f.prototype={onStart:b("start"),onEnd:b("end"),onError:b("error"),onAbort:b("abort"),onCompleted:b("completed"),reg:function(){var a=this.model,b=this.handlers;if(b.start){var k=this._start=p.bind(this.onStart,this);a.on("async:start",k)}b.end&&(k=this._end=p.bind(this.onEnd,this),a.on("async:end",k));b.error&&(k=this._error=p.bind(this.onError,this),a.on("async:error",
k));b.abort&&(k=this._abort=p.bind(this.onAbort,this),a.on("async:abort",k));b.completed&&(b=this._completed=p.bind(this.onCompleted,this),a.on("async:end",b),a.on("async:error",b),a.on("async:abort",b))},destroy:function(){var a=this.model,b=this._start,k=this._end,c=this._error,g=this._abort,d=this._completed;b&&(a.off("async:start",b),this._start=null);k&&(a.off("async:end",k),this._end=null);c&&(a.off("async:error",c),this._error=null);g&&(a.off("async:abort",g),this._abort=null);d&&(a.off("async:end",
d),a.off("async:error",d),a.off("async:abort",d),this._completed=null)}}})(r.fs,Backbone,_);(function(q,m,p){function h(){this.nodes=[]}function n(b){this.nodes=b}function l(b,a){this.storage=b;var e=a.rootNodeType||"root",k=a.rootNodeName||"/";this.actions=[{id:"rename"},{id:"create-folder"},{id:"delete"}];this.root=new f({id:"",service:this,type:e,name:k,actions:this.actions});this.delay=p.isUndefined(a.delay)?0:a.delay;this.fsNodesClass=a.fsNodesClass||n}q.FSServiceNode=f;q.SimpleFSService=l;q.InMemoryFSStorage=
h;q.FSNodes=n;var f=q.FsNodeModel.extend({initialize:function(b){var a=b.service;if(!a)throw Error("Service must be declared!");this._service=a;q.FsNodeModel.prototype.initialize.call(this,b)},open:function(b){return function(a,e){var k=new q.AsyncTask(function(){c&&c.abort&&c.abort()},e,b);k.start();var c=this._service[b](this,a,e,k);return k}}("open"),refresh:function(){this._service.refresh(this)},doCreateFolder:function(b,a){this._service.createFolder(this,b,function(b){a.actionResultSuccess("doCreateFolder",
b)},function(b){a.actionResultError("doCreateFolder",b)})},doItemRename:function(b,a){this._service.rename(this,b.id,b.name,function(b){a.actionResultSuccess("doItemRename",b)},function(b){a.actionResultError("doItemRename",b)})},doItemDelete:function(b,a){this._service.deleteItem(this,b,function(b){a.actionResultSuccess("doItemDelete",b)},function(b){a.actionResultError("doItemDelete",b)})},doItemMove:function(b,a){var e=b.destination;this._service.moveItem(this,b.id,e,function(b){a.refresh(e);a.actionResultSuccess("doItemMove",
b,e)},function(b){a.actionResultError("doItemMove",b)})},name:function(b){return this._service.name(b)}});h.prototype={load:function(b,a){var e=p.clone(this.nodes);setTimeout(function(){b(e,null)},0)},save:function(b,a,e,k){var c=p.clone(b),g=this;setTimeout(function(){g.nodes=c;a(null)},0)},deleteItems:function(b,a,e,k,c){var g=[a];g.push.apply(g,b);var d=this;setTimeou(function(){d.nodes=p.without.apply(p,g)},0)}};n.prototype={find:function(b){for(var a=this.nodes,e=0,k=a.length;e<k;++e){var c=
a[e];if(c.id===b)return c}return null},containsFolder:function(){for(var b=!1,a=this.nodes,e=0,k=a.length;e<k;++e)"folder"===a[e].type&&(b=!0);return b},hasFolderSiblings:function(b){for(var a=this.nodes,e=0,k=a.length;e<k;++e){var c=a[e];if("folder"===c.type&&c.id.split("/")[0]!==b)return!0}return!1},list:function(b){var a=this.containsFolder(),e=this.nodes,k=b.length,c=[];if(0===k)for(var g=0,d=e.length;g<d;++g){var f=e[g],l=f.id;-1===l.indexOf("/")&&("folder"===f.type?c.push(this.createModelItem(f,
this.hasFolderSiblings(l))):c.push(this.createModelItem(f,a)))}else for(g=0,d=e.length;g<d;++g)f=e[g],l=f.id,0===l.indexOf(b)&&"/"===l.charAt(k)&&l.lastIndexOf("/")===k&&c.push(this.createModelItem(f,a));c.sort(function(a,b){var c=a.type;return c===b.type?(a=a.name,b=b.name,a<b?-1:a>b?1:0):"folder"===c?-1:1});return c},createModelItem:function(b,a){b=p.clone(b);b.name=this.name(b.id);b.action="open";b.editActions=["item-delete","item-rename"];a&&b.editActions.push("item-move");return b},name:function(b){var a=
b.lastIndexOf("/");return-1!==a?b.substring(a+1,b.length):b},path:function(b){var a=b.lastIndexOf("/");return-1!==a?b.substring(0,a):""},listChildren:function(b){var a=this.nodes,e=[];b.split("/");for(var k=0,c=a.length;k<c;++k){var g=a[k];this.path(g.id)===b&&e.push(g)}return e}};l.prototype={getRoot:function(b,a){var e=this.root,k=this.fsNodesClass;this.storage.load(function(a){a=new k(a);e.set("list",a.list(""));b(e)},a)},refresh:function(b){var a=this.fsNodesClass;this.storage.load(function(e){var k=
b.get("id");e=new a(e);var c=b.get("type"),g=e.find(k);null===g&&"root"!==c||"folder"!==c&&"root"!==c||b.set("list",e.list(k));null===g&&"root"!==c&&b.trigger("invalidate",k)})},open:function(b,a,e,k){var c=this,g=this.fsNodesClass;return this.storage.load(function(b){b=new g(b);var l=b.find(a);null!==l?(b=new f({id:a,service:c,type:l.type,name:b.name(a),actions:c.actions,list:b.list(a),data:l}),k.end(b),e.push(b)):k.error("fs-node-not-found")},p.bind(k.error,k),a)},rename:function(b,a,e,k,c){var g=
this,d=this.fsNodesClass;this.storage.load(function(f,l){var h=new d(f),n=h.find(a),m=n.id,p=n.id=m.substring(0,m.lastIndexOf("/")+1)+e;if("folder"===n.type)for(var q=h.listChildren(a),u=0,w=q.length;u<w;++u){var x=q[u],r=x.id.substring(0,m.length);x.id=p+"/"+r}g.storage.save(f,function(){for(var a=b.get("list"),c=0,d=a.length;c<d;++c)if(a[c].id===m){d=-1===m.indexOf("/")&&h.hasFolderSiblings(m)||-1!==m.indexOf("/");a=a[c]=h.createModelItem(n,d);b.set("list",h.list(b.get("id")),{silent:!0});b.trigger("change:list-item",
b,a,m);break}k(n.id)},c,l)},c,null,!0)},deleteItem:function(b,a,e,k){var c=this,g=this.fsNodesClass;this.storage.load(function(d,f){var l=new g(d),h=l.find(a);if(null!==h){var n;"folder"===h.type?(n=l.listChildren(a),n.push(h)):n=[h];c.storage.deleteItems(n,d,f,function(){b.set("list",l.list(b.get("id")));e(a)},k)}else k("err-not-exists")},k,null,!0)},createFolder:function(b,a,e,k){var c=this,g=this.fsNodesClass;this.storage.load(function(d,f){var l=new g(d),h=b.get("id"),n;n=""!==h?h+"/"+a:a;null===
l.find(n)?(d.push({id:n,type:"folder"}),b.set("list",l.list(h)),c.storage.save(d,function(){e(n)},k,f)):k("err-folder-already-exists")},k,null,!0)},moveItem:function(b,a,e,k,c){var g=this,d=this.fsNodesClass;this.storage.load(function(f,l){var h=new d(f),n;n=0===e.length?{type:"folder",id:""}:h.find(e);if("folder"===n.type)if(h.path(a)===n.id)k(a,n.id,a);else{var m=h.list(e),p=0,q;q=0<e.length?e+"/"+h.name(a):h.name(a);var u,w=!1;do{w=!1;u=q;0<p&&(u+=" ("+p+")");for(var x=0,r=m.length;x<r;++x){var B=
m[x];if(B.id===u){w=!0;break}}++p}while(w);B=h.find(a);B.id=u;if("folder"===B.type)for(m=h.listChildren(a),x=0,r=m.length;x<r;++x)p=m[x],p.id=u+"/"+h.name(p.id);g.storage.save(f,function(){b.set("list",h.list(b.get("id")));k(a,n.id,u)},c,l)}else c("err-node-must-be-folder")},c,null,!0)},name:n.prototype.name}})(r.fs,Backbone,_);(function(q,m){q.setContextImageSmoothing=function(h,n){"mozImageSmoothingEnabled"in h?h.mozImageSmoothingEnabled=n:"webkitImageSmoothingEnabled"in h?h.webkitImageSmoothingEnabled=
n:"imageSmoothingEnabled"in h?h.imageSmoothingEnabled=n:"msImageSmoothingEnabled"in h&&(h.msImageSmoothingEnabled=n)};var p=function(){var h=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,h=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1;m.$.browser.firefox&&-1!==window.navigator.appVersion.indexOf("Android")&&(n=1.3333333);return n/h}();q.CANVAS_POOL={GLOBAL_PIXEL_RATIO:p,
__isIE:-1!==m.navigator.userAgent.indexOf("MSIE")||-1!==m.navigator.userAgent.indexOf("Trident"),__cache:[],__getCanvas:function(){var h=null;return h=document.createElement("canvas")},freeCanvas:function(h){h.width=h.height=0},getCanvas:function(h,n,l){var f=this.__getCanvas();this.setCanvasResolution(f,h,n,l);return f},setCanvasResolution:function(h,n,l,f){var b=h.getContext("2d");f=f?f(p):p;h.vitriumScaleRatio=f;h.vitriumRequestedWidth=n;h.vitriumRequestedHeight=l;var a=Math.round(n*f),e=Math.round(l*
f);if(a!=h.width||h.height!=e)h.width=a,h.height=e;b.setTransform(f,0,0,f,0,0);b.fillStyle="white";b.fillRect(0,0,n,l);return h}}})(r.ui,I);(function(q,m,p,h){function n(b,c){this.formDef=c;for(var g=m.extend(m.extend({},a),c.renderers||{}),d=c.formatter||e,f=this.el=d.createBaseContainer(c),l=c.fields,h=this.fields=[],n=0,p=l.length;n<p;++n){var q=l[n],r=new g[q.type](b,q,c),q=d.createFieldContainer(r,q,c);h.push(q);q.el.appendTo(f)}}function l(a,b,g){this.id=b.id;this.field=a;var d=this.el=p('<div class="form-group control-group field-class-'+
a.constructor.name+" field-id-"+b.id+'"><label class="control-label" for="'+g.idPrefix+b.id+'">'+b.label+'</label><div class="controls"></div></div>');m.isEmpty(b.cssClass)||d.addClass(b.cssClass);m.isArray(b.cssClasses)&&m.each(b.cssClasses,function(a){d.addClass(b.clazz)});a.el.appendTo(d.find(".controls"));this.lastMessageType=null}function f(a,b,g){var d=this.createElement(b,g);d.addClass("form-control");this.id=b.id;this.el=d;this.model=a;a.on("change:"+b.id,this.onModelChange,this);g.manualSync?
this.__onSync=null:(this.__onSync=m.bind(this.sync,this),d.on("keyup",this.__onSync).on("change",this.__onSync));this.syncInProgress=!1;this.val(a.get(b.id))}function b(a,b,g){f.call(this,a,b,g)}var a={text:f,textarea:b};q.Form=n;n.prototype={sync:function(){for(var a=this.fields,b=0,g=a.length;b<g;++b)a[b].sync()},destroy:function(){for(var a=this.fields,b=0,g=a.length;b<g;++b)a[b].destroy()},displayMessages:function(a){for(var b=this.fields,g=!1,d=0,e=b.length;d<e;++d){var f=b[d],l=a[f.id];l&&(f.displayMessage(l),
g=!0)}return g},removeMessages:function(){for(var a=this.fields,b=0,g=a.length;b<g;++b)a[b].removeMessage()},focus:function(a){for(var b=this.fields,g=0,d=b.length;g<d;++g){var e=b[g];e.id===a&&e.focus()}},disable:function(a,b){for(var g=this.fields,d=0,e=g.length;d<e;++d){var f=g[d];f.id===a&&f.disable(b)}}};n.registerFieldType=function(b,c){a[b]=c};var e={createFieldContainer:function(a,b,g){return new l(a,b,g)},createBaseContainer:function(a){a.idPrefix=a.idPrefix||Math.round(1E6*Math.random());
return a.el||p("<div>")}};l.prototype={sync:function(){this.field.sync()},val:function(a){return this.field.val(a)},destroy:function(){this.field.destroy()},focus:function(){this.field.focus()},disable:function(a){this.field.disable(a)},displayMessage:function(a){var b=a.type||"error",g=this.el.find(".controls");this.lastMessageType&&(this.el.removeClass(this.lastMessageType),this.lastMessageType=null);this.el.addClass(b);this.lastMessageType=b;a=a.text?h._T(a.text,a.args):a;b=g.find("span.message");
0===b.length?g.append('<span class="message">'+a+"</span>"):b.html(a)},removeMessage:function(){var a=this.el;this.lastMessageType&&(a.removeClass(this.lastMessageType),this.lastMessageType=null);a.find(".controls .message").remove()}};f.prototype={createElement:function(a,b){var g=p('<input type="text" placeholder="'+(a.placeholder||"")+'" id="'+b.idPrefix+a.id+'"/>');a.maxlength&&g.attr("maxlength",a.maxlength);return g},disable:function(a){this.el.prop("disabled",a)},sync:function(){this.model.set(this.id,
this.val())},val:function(){return this.el.val.apply(this.el,arguments)},onModelChange:function(a,b){this.val()!==b&&this.val(b)},destroy:function(){this.__onSync&&(this.el.off("keyup",this.__onSync).off("change",this.__onSync),this.__onSync=null);this.model.off("change:"+this.id,this.onModelChange,this)},focus:function(){this.el.focus()}};f.prototype.constructor=f;m.extend(b.prototype,f.prototype);m.extend(b.prototype,{createElement:function(a,b){return p('<textarea id="'+b.idPrefix+a.id+'" rows="'+
(a.rows||5)+'"></textarea>')}});b.prototype.constructor=b})(r.ui,_,jQuery,r.i18n);(function(q,m,p,h,n,l,f){function b(a,b){var c=b.view.viewer;if(c){var e=g[c];e||(e=g[c]={});if(a){var k=++d;b.DIALOG_ID=k;e[k]=b}else delete e[b.DIALOG_ID];n.isEmpty(e)&&!c.DIALOG_LIST_CALLBACK?(c.off("document:detached",c.DIALOG_LIST_CALLBACK),c.DIALOG_LIST_CALLBACK=null):c.DIALOG_LIST_CALLBACK||(k=c.DIALOG_LIST_CALLBACK=function(){for(var a in e){var b=e[a];b.triggerButtonAction("close");b.hide()}},c.on("document:detached",
k))}}function a(a,b){a.currentOverlay&&a.currentOverlay!==b&&a.currentOverlay.destroyAll();a.currentOverlay=b}function e(a,b){for(var c=["transition","webkitTransition","MozTransition","msTransition"],d=0,g=c.length;d<g;++d){var e=c[d];if(e in a)return a[e]=b,!0}return!1}function k(a){this.viewer=a;this.stack=[]}function c(a){return 0!==a.find(".modal.alert-error").length||0!==a.find(".modal.alert-info").length}q.showDismissBox=function(c,d,g,e,l){var h=(l?l.view:null)||new k(c);a(c,h);c=new m.Dialog(h,
{title:g,cssClass:"alert-"+d,body:e,buttons:l&&l.buttons?l.buttons:[{id:"close",title:f._T("menu-close")}]});c.on("view:show",b);c.show();return c};q.showMenuScreen=function(c,d,g){function e(a,b){var c=n;c.css({display:"none"});c.empty();for(var d=0,g=b.length;d<g;++d){var k=b[d];0===(k.toolHidden&2)&&h("<li  choice-id='"+k.id+"'><a src='#' choice-id='"+k.id+"'>"+k.title+"</a></li>").appendTo(c)}c.css({display:"block"})}function l(a,b){p.updateTitle(b)}g=(g?g.view:null)||new k(c);a(c,g);var n=h("<ul class='nav nav-tabs nav-stacked'></ul>");
n.on("tap click","li",function(a){"click"===a.type&&a.preventDefault();var b=h(a.target).attr("choice-id");d.trigger("action:"+b,p,a);d.trigger("clicked",b,p,a)});var p=new m.Dialog(g,{title:d.get("title"),body:n,buttons:[{id:"close",title:f._T("menu-close")}]});d.on("change:choices",e);d.on("change:title",l);e(d,d.get("choices"));p.on("button:close",function(){c.setControlsLock(!1);d.trigger("closed");d.off("change:choices",e);d.off("change:title",l)});p.on("view:show",b);p.show();return p};q.showProgressScreen=
function(c,d,g){g=(g?g.view:null)||new k(c);a(c,g);var e=h("<div class='progress progress-striped active'><div class='bar'style='width: 0%;'></div>"),f=new m.Dialog(g,{cssClass:"progress-dialog",title:d.get("title"),body:e,buttons:d.get("buttons")});d.on("change:title",function(a,b){f.updateTitle(b)});d.on("change:progress",function(a,b){"done"===b?e.removeClass("active").remove():e.find(".bar").css({width:b+"%"})});d.on("change:buttons",function(a,b){f.updateButtons(b)});f.on("view:show",b);f.show();
return f};q.MenuItemsModel=l.Model.extend({defaults:{title:"",choices:[]}});q.FSDialogViewAdapter=k;q.$fadeIn=function(a,b){var c=a.style;e(c,"none")?(c.opacity=0,requestAnimationFrame(function(){e(c,"opacity 0.5s ease-out");c.opacity=1;b&&setTimeout(function(){requestAnimationFrame(function(){e(c,"none");b(a)})},600)})):b&&requestAnimationFrame(function(){b(a)})};q.$fadeOut=function(a,b){var c=a.style;e(c,"opacity 0.5s ease-out")?requestAnimationFrame(function(){c.opacity=0;b&&setTimeout(function(){requestAnimationFrame(function(){b(a);
e(c,"none")})},600)}):b&&requestAnimationFrame(function(){b(a)})};q.DialogWindowTracker=b;n.template("<button  type='button' class='btn <%=classes %>'  title='<%= title %>' ><%if (icon) { %> <i class='<%= icon %>'></i> <%}%> <%= label %> </button>");h(p);var g={},d=0;n.template("<li></li>");k.prototype={showLockscreen:function(a,b){var d=this.viewer;d.dialogParentEl.append(a);c(a)&&d.dialogParentEl.addClass("high-priority");var g=this.stack;0===g.length?d.setControlsLock(!0):g[g.length-1].dialog.hide(!0);
g.push({el:a,dialog:b})},hideLockscreen:function(a,b){var d=this.viewer,g=this.stack,e=g.pop();e&&e.el.remove();0===g.length?(d.dialogParentEl.removeClass("high-priority"),this.viewer.setControlsLock(!1)):(g=g[g.length-1],g.dialog.show(!0),c(g.el)?d.dialogParentEl.addClass("high-priority"):d.dialogParentEl.removeClass("high-priority"))},destroyAll:function(){for(var a=this.stack,b=a.length;b--;)a[b].dialog.hide()}}})(r.viewer,r.fs,I,jQuery,_,Backbone,r.i18n);(function(q,m,p,h,n,l,f,b,a){function e(c,
d,e){this.viewer=c;this.viewer.on("mousemove",this.onMouseMove,this);this.model=d;this.controller=e;var f=this.div=a("<div class='vitrium-fake-text-selection'></div>").css({width:g+"px",height:g+"px",fontSize:g/2+"px"});f[0].addEventListener("mouseup",function(){k(f[0])});this.eventPipes=new p.EventPipeGroup([new m.$EventPipe(f,"click keydown keyup keypress focus focusout",c),new m.$MouseWheelEventPipe(f,c),new m.$EventPipe(f,"mousedown",{trigger:b.bind(function(a,b){1===b.which&&this.viewer.trigger(a,
b,this.viewer.state)},this)})]);this.content=this.div;this.isInDOM=!1;this.updateSelection=new l.UISync(this.onUpdateSelection,this,0);this.updatePosition=new l.UISync(this.onUpdatePosition,this,1);d.on("changed",this.onSelectionChanged,this);this.rects={};this.activeSelection=!1;this.mousePosition=new h.Point(0,0)}function k(a){var b=f,c;b.body.createTextRange?(b=b.body.createTextRange(),b.moveToElementText(a),b.select()):window.getSelection&&(c=window.getSelection(),b=b.createRange(),b.selectNodeContents(a),
c.removeAllRanges(),c.addRange(b))}function c(){this.rect=null}q.CopyFakeView=e;q.selectText=k;var g=20,d=new n.Rectangle(0,0,0,0,0);e.prototype={destroy:function(){this.div.remove();this.rects=null;this.updatePosition.destroy();this.updateSelection.destroy();this.updateSelection=this.updatePosition=null;this.model.off("changed",this.onSelectionChanged,this);this.viewer.off("mousemove",this.onMouseMove,this);this.viewer=null},onViewportChanged:function(a,b,e){var f=this.rects;a=d;for(var l=new c,
h=0,n=b.length;h<n;++h){var m=b[h],w=f[m.number];if(w){var p=w.w*e|0,q=w.h*e|0,r=w.x*e|0,w=w.y*e|0;if(!(r>m.width||w>m.height)){var C=r+p-m.width;0<C&&(p-=C);C=w+q-m.height;0<C&&(q-=C);r+=m.x;w+=m.y;a.x=r;a.y=w;a.w=p;a.h=q;l.add(a)}}}null!==l.rect&&0===this.model.get("mode")?(a=l.rect,b=this.viewer.absoluteDim,a.x+=b.x,a.y+=b.y,e=this.mousePosition.clone(),e.x-=g/2+1,e.y-=g/2+1,e.x=Math.max(a.x,e.x),e.y=Math.max(a.y,e.y),e.x=Math.min(a.x+a.w,e.x),e.y=Math.min(a.y+a.h,e.y),e.x<b.left||e.y<b.top?(this.div.remove(),
this.eventPipes.off(),this.isInDOM=!1):(this.div.css({left:(e.x|0)+"px",top:(e.y|0)+"px"}),this.isInDOM||(this.div.prependTo("body"),this.isInDOM=!0,this.eventPipes.on()),k(this.content[0]))):(this.div.remove(),this.eventPipes.off(),this.isInDOM=!1)},onUpdatePosition:function(a){this.onViewportChanged(!0,a.pages,a.scale)},onUpdateSelection:function(a){if(this.activeSelection){a=this.model.get("selection");var d=b.uniq(a.getAffectedPages());d.sort();for(var g=[],e=0,k=d.length;e<k;++e){for(var f=d[e],
l=new c,h=a.getSelection(f),n=0,m=h.length;n<m;++n){var p=h[n];l.add(p);g.push(p.d)}g.push("\n");this.rects[f]=l.rect}this.content.text(g.join(""))}else this.rects={}},onSelectionChanged:function(a,b){if(!this.activeSelection&&b)this.viewer.on("change:viewport",this.onViewportChanged,this);else!b&&this.activeSelection&&this.viewer.off("change:viewport",this.onViewportChanged,this);this.activeSelection=b;this.viewer.uiLoop.runAsync(this.updateSelection);this.viewer.uiLoop.runAsync(this.updatePosition)},
onMouseMove:function(a){var b=this.mousePosition;b.x=a.pageX;b.y=a.pageY;this.viewer.uiLoop.runAsync(this.updatePosition)}};c.prototype={add:function(a){if(null===this.rect)this.rect=a.clone();else{this.rect.x=Math.min(a.x,this.rect.x);this.rect.y=Math.min(a.y,this.rect.y);var b=this.rect.getEndPoint();a=a.getEndPoint();b.x=Math.max(a.x,b.x);b.y=Math.max(a.y,b.y);this.rect.w=b.x-this.rect.x;this.rect.h=b.y-this.rect.y}}}})(r.viewer,r.viewer,r.utils,r.geometry,r.geometry2,r.ui,document,_,jQuery);(function(q,
m,p,h,n,l){function f(a,c,d){this.viewer=a;this.model=c;this.watermarkTypeHandlers=l.extend({fixedPositionTextbox:b,userSpecific:t,generic:y},d);c.on("watermarks:change",this.onChanged,this)}function b(b,c,d){b.save();var e=c.text;if(!l.isEmpty(e)){var k;var f=c.fontFamily;if(f){var h=g,n,t;n=0;for(t=h.length;n<t;++n){var v=h[n];if(-1!==(k=v.indexOf(f)))break}if(-1===k)k="'"+f+"','sans-serif'";else{var p=[],v=h[n];p.push("'"+f+"'");n=0;for(t=v.length;n<t;++n)n!==k&&p.push("'"+v[n]+"'");k=p.join(",")}}else k=
"'sans-serif'";var v=c.fontStyle,p=c.fontWeight,q=c.offsetXPosition,y=c.offsetYPosition,f=c.width,r=c.height,h=c.offsetX;n=c.offsetY;var F=c.__dimensions;F||(F=c.__dimensions={});t=-1*c.rotation%360;0>t&&(t+=360);var L=d.width+":"+d.height+":"+t+":"+e,H=F[L];if(!H){var e=e.split("_newLine_"),H=F,ba=r,F=f,I=k;if(90===t||270===t)var S=F,F=ba,ba=S;else F-=20,ba-=20;var ba=ba/e.length,M,S=[];do{b.font=v+" "+p+" "+ba+"px "+I;for(var Y=M=0;Y<e.length;++Y){var aa=S[Y]=b.measureText(e[Y]).width;M=Math.max(M,
aa)}if(M<=F)break;else ba*=F/M}while(0<ba);H[L]=H={height:ba*e.length,lineHeight:ba,width:M,lines:e,lineWidths:S}}"right"===q&&0<=h||"left"===q&&0>h?h=d.width-Math.abs(h)-f:"right"===q&&0>h&&(h*=-1);"bottom"===y&&0<=n||"top"===y&&0>n?n=d.height-Math.abs(n)-r:"bottom"===y&&0>n&&(n*=-1);h=Math.min(d.width-f,h);n=Math.min(d.height-r,n);d=c.horizontalAlignment;90===t||270===t?d="center":180===t&&(n-=H.height,"left"==d?d="right":"right"==d&&(d="left"));90===t||270===t?(n+=H.width/2-H.height/2,270===t&&
(h+=H.height)):n=180===t?n+(r-20)/2:n+(5+H.height-(r-20)/2+H.height/2);b.globalAlpha=c.opacity;b.fillStyle=m.viewer.convertColor(c.foregroundColor);b.font=v+" "+p+" "+H.lineHeight+"px  "+k;t&&(c=a(d,h,f,H.width)+H.width/2,k=n+H.height/2,b.translate(c,k),b.rotate(Math.PI/(180/t)),b.translate(-c,-k));c=0;for(t=H.lines.length;c<t;++c)k=a(d,h,f,H.lineWidths[c]),b.fillText(H.lines[c],k,n),n+=H.lineHeight;b.restore()}}function a(a,b,c,d){switch(a){case "left":b+=10;break;case "right":b+=c-d-10;break;case "center":b+=
c/2-d/2}return b}function e(a){a=a.replace(/ /g,"").split(",");for(var b=[],c=0,d=a.length;c<d;++c){var g=a[c].split("-");1===g.length?l.isEmpty(g[0])||(g=parseInt(g[0],10),b.push({from:g,to:g})):2!==g.length||l.isEmpty(g[0])||l.isEmpty(g[1])||b.push({from:parseInt(g[0],10),to:parseInt(g[1],10)})}b.sort(function(a,b){return a.from<b.from?-1:a.from>b.from?1:0});this._ranges=b}function k(a,b){if("VisibleOnScreen"in a&&!a.VisibleOnScreen)return!0;var c=a.__skipPagesRanges;c||(c=a.__skipPagesRanges=new e(a.SkipPages||
""));return c.isPageInRange(b.number)?!0:!1}function c(a){return a&&-1!==a.indexOf(",")?"rgb("+a+")":a?a.replace(/ /g,"").toLowerCase():"gray"}q.WatermarksLayer=f;f.prototype={onChanged:function(a){this.trigger("changed",a)},hasContent:function(a){a=this.model.getWatermarksForPage(a);return null!==a&&0<a.length},render:function(a,b,c){c=this.model.getWatermarksForPage(a);a=this.viewer.documentInfo.pages[a];b.save();for(var d=this.watermarkTypeHandlers,g=0,e=c.length;g<e;++g){var k=c[g],f=d[k.type];
f?f(b,k,a):m.log.warn("handler for watermark not found: "+k.type)}b.restore()}};l.extend(f.prototype,p.Events);var g=[["Georgia","serif"],["Palatino Linotype","Book Antiqua","Palatino","serif"],["Times New Roman","Times","serif"],["Arial","Helvetica","sans-serif"],["Arial Black","Gadget","sans-serif"],["Comic Sans MS","cursive","sans-serif"],["Impact","Charcoal","sans-serif"],["Lucida Sans Unicode","Lucida Grande","sans-serif"],["Tahoma","Geneva","sans-serif"],["Trebuchet MS","Helvetica","sans-serif"],
["Verdana","Geneva","sans-serif"],["Courier New","Courier","monospace"],["Lucida Console","Monaco","monospace"]],d=function(){var a={courier:"Courier, monospace",helvetica:"Helvetica, sans-serif",symbol:"symbol",times:"Times, serif",zapfdingbats:null},b={bold:"bold",oblique:"oblique",italic:"italic",bolditalic:"italic bold",boldoblique:"oblique bold",roman:""};return function(c,d){var g=c.split("-"),e=a[g[0].toLowerCase()];e||(h.debug("[Watermarks] unsupported font used ("+g[0]+") falling back to monospace."),
e="monospace");e=d+"px "+e;if(2===g.length){var k=b[g[1].toLowerCase()];k||h.debug("[Watermarks] unsupported effect used ("+g[1]+")");e=k+" "+e}return e}}();e.prototype.isPageInRange=function(a){for(var b=this._ranges,c=0,d=b.length;c<d;++c){var g=b[c];if(a<g.from)break;if(a>=g.from&&a<=g.to)return!0}return!1};var t=function(){function a(b){if(0>b)return-1;if(0===b)return 0;if(0<b)return 1}return function(b,g,e){if(!k(g,e)){b.save();var f=g.__boxRectangle;if(!f){var h,f=g.Width*v,t=g.Height*v,m=g.PositionX*
v;h=g.PositionY*v*-1;var p=e.width;e=e.height;f=1>=f?p*f:f>p?p:f;t=1>=t?e*t:t>e?e:t;m=Math.abs(m)+f>p?(p-f)*a(m):m;m=0<=m?1>=m?p*m:m:p+(-1<=m?p*m:m)-f;h=Math.abs(h)+t>e?(e-t)*a(h):h;h=new n.Rectangle(m,0<=h?1>=h?e*h:h:e+(-1<=h?e*h:h)-t,f,t,0);f=g.__boxRectangle=h}b.translate(f.x,f.y);b.beginPath();b.rect(0,0,f.w,f.h);b.clip();h=(g.FontSize||12)*v;b.font=d(g.FontName,h);b.fillStyle=c(g.Color);b.textBaseline="top";p=g.TextualContent.split(/_newLine_|\n/g);e=0;m=f.w/2;f=f.h/2;g=l.isUndefined(g.Rotation)?
0:g.Rotation;0!=g&&(b.translate(m,f),b.rotate(Math.PI*-g/180),b.translate(0,-h));g=0;for(f=p.length;g<f;++g){var t=p[g],q=b.measureText(t).width/2;b.fillText(t,m-q,e);e+=h}b.restore()}}}(),y=function(){return function(a,b,g){var e,f;if(!k(b,g)){a.save();a.globalAlpha=b.Opacity||1;a.fillStyle=c(b.Color);a.strokeStyle="red";var h=!!b.FontSize,n=l.isUndefined(b.Rotation)?0:-1*(0>b.Rotation?360+b.Rotation%360:b.Rotation%360),n=Math.PI*n/180,t=g.width,m=g.height;t<=m?(e=t,f=m):(e=m,f=t);var p=n-2*Math.floor((n+
Math.PI)/(2*Math.PI))*Math.PI,p=Math.abs(p);p>Math.PI/2&&(p=Math.PI-p);p=e/(f*Math.sin(p)+e*Math.cos(p));t<=m?(t=e*p,f*=p):(t=f*p,f=e*p);e=t;t=h?b.FontSize*v:f;a.translate(g.width/2,g.height/2);a.rotate(n);a.translate(-e/2,-f/2);g=b.TextualContent;a.textBaseline="top";n=t;a.font=d(b.FontName,t);t=a.measureText(g).width;!h&&t>e&&(n=(e-1)/t*f,a.font=d(b.FontName,n),t=e-1);a.fillText(g,0+e/2-t/2,0+f/2-n/2);a.restore()}}}(),v=96/72})(r.viewer,r,Backbone,r.log,r.geometry2,_);(function(q,m,p,h){function n(l){this.watermarks=
[];l&&(l.on("document:attached",this.onDocumentAttached,this),l.on("document:detached",this.onDocumentDetached,this))}q.WatermarksModel=n;q=n.prototype;p.extend(q,h.Events);q.onDocumentAttached=function(l){l.on("info:loaded",this.onInfoLoaded,this)};q.getWatermarks=function(){return p.clone(this.watermarks)};q.onDocumentDetached=function(l){l.off("info:loaded",this.onInfoLoaded,this)};q.onInfoLoaded=function(l){this.setWatermarks(l.watermarks||this.watermarks)};q.isWatermarkOnPage=function(l){return 0<
this.watermarks.length};q.getWatermarksForPage=function(l){return this.watermarks};q.addWatermarks=function(l){p.isArray(l)?this.watermarks.push.apply(this.watermarks,l):this.watermarks.push(l);this.trigger("watermarks:change")};q.clearWatermarks=function(){this.setWatermarks([])};q.setWatermarks=function(l){p.isEmpty(l)&&(l=[]);p.isArray(l)||(l=[l]);this.watermarks=l;this.trigger("watermarks:change")}})(r.viewer,r,_,Backbone);(function(q,m,p,h){function n(){this._pages={}}function l(a,b,c){var d=
null;h.find(a,function(a,g){return!!h.find(a,function(a){return b&&a.id===b||c&&a.cid===c?(d=a,!0):!1})});return d}function f(a){var b;switch(a.type){case "texthighlight":b=new c;break;case "freehighlight":b=new k;break;case "note":b=new g;break;default:return null}b.fromJSON(a);b.cid&&(a=parseInt(b.cid.split("-")[1],16),a=Math.max(a,y),h.isNumber(a)&&(y=a));return b}function b(a,b){if(null===b)return-1;if(null!==a)for(var c=0,d=a.length;c!==d;++c)if(a[c].id===b)return c;return-1}function a(a,b){if(null===
b)return-1;if(null!==a)for(var c=0,d=a.length;c!==d;++c)if(a[c].cid===b)return c;return-1}function e(a){this.type=a;this.user=this.date=this.id=this.page=null;this.cid=t+"-"+(++y).toString(16)}function k(){e.call(this,"freehighlight");this.color="blue";this.path=[];this.lineWidth=20}function c(){e.call(this,"texthighlight");this.color="blue";this.rectangles=[]}function g(){e.call(this,"note");this.text=this.position=null}function d(a,b){for(var c=Object.getOwnPropertyNames(a),d=0,g=c.length;d!==g;++d){var e=
c[d];if("cid"!==e||b.cid)a[e]=b[e]}}q.AnnotationsModel=n;q.FreeHighlightAnnotation=k;q.TextHighlightAnnotation=c;q.NoteAnnotation=g;n.prototype={clone:function(){var a=new n;h.each(this._pages,function(a,b){this._pages[b]=h.clone(a)},a);return a},deepClone:function(){var a=new n;a.parseFromJSON(this.toFlatRepr());return a},parseFromJSON:function(a){h.each(a,function(a){a=f(a);this.add(a.page,a)},this)},toFlatRepr:function(){var a=[];h.each(this._pages,function(a){for(var b=0,c=a.length;b<c;++b)this.push(a[b])},
a);return a},add:function(a,b){var c=this._pages[a];h.isEmpty(c)&&(c=[],this._pages[a]=c);b.page=a;c.push(b)},replace:function(a,b){var c=this.getAnnotations(a.page),d=c.indexOf(a);c[d]=b},changePage:function(a,b){a.page!==b&&(this._pages[a.page]=h.without(this._pages[a.page],a),this.add(b,a))},getAnnotations:function(a){return a in this._pages?this._pages[a]:null},removeAnnotation:function(a,b){var c=this.getAnnotations(a);if(null===c)throw Error("there are no annotations on page "+a);this._pages[a]=
h.without(c,c[b])},clearPage:function(a){this._pages[a]=null},clearDocument:function(){this._pages={}},getAllNotes:function(){var a=[];h.each(this._pages,function(a,b){h.each(a,function(a){"note"===a.type&&this.push(a)},this)},a);a.sort(function(a,b){return a.page===b.page?a.position.y-b.position.y:a.page-b.page});return a},applyUncommitedChanges:function(a,b){for(var c=0,d=a?a.length:0;c!==d;++c){var g=a[c],e=g.cmd,g=g.rowid;switch(e.action){case "save":e.annotation=this._handleSaveCmd(e.annotation);
break;case "saveMany":var k=[];h.each(e.annotations,function(a){k.push(this._handleSaveCmd(a))},this);e.annotations=k;break;case "delete":this._handleDeleteCmd(e.annotation);break;case "deleteMany":h.each(e.annotations,function(a){this._handleDeleteCmd(a)},this)}b({rowid:g,cmd:e,state:this.toFlatRepr()})}},findByCid:function(a){var b=h.find(this.toFlatRepr(),function(b){return b.cid===a});return b?b:null},_handleSaveCmd:function(c){var d=l(this._pages,c.id,c.cid);d&&d.page!==c.page&&this._handleDeleteCmd(d);
var d=this.getAnnotations(c.page),g=b(d,c.id),e=f(c);-1!==g||-1!==(g=a(d,c.cid))?d[g]=e:this.add(c.page,e);return e},_handleDeleteCmd:function(c){var d=this.getAnnotations(c.page),g=b(d,c.id);-1===g&&-1===(g=a(d,c.cid))||d.splice(g,1)}};var t=Math.round(Math.abs(Math.random()*Math.pow(10,10))).toString(16),y=0;k.prototype=Object.create(e.prototype);k.prototype.addPoint=function(a){this.path.push(a)};k.prototype.fromJSON=function(a){d(this,a);a=this.path;for(var b=0,c=a.length;b<c;++b)a[b]=m.Point.prototype.clone.call(a[b])};
k.prototype.simplify=function(a){this.path=m.simplifyPath(this.path,a)};c.prototype=Object.create(e.prototype);c.prototype.addRectangle=function(a){this.rectangles.push(a)};c.prototype.fromJSON=function(a){d(this,a);a=this.rectangles;for(var b=0,c=a.length;b<c;++b)a[b]=p.DataRectangle.prototype.clone.call(a[b])};c.prototype.simplify=function(a){};g.prototype=Object.create(g.prototype);g.prototype.clone=function(){var a=new g;a.page=this.page;a.position=this.position.clone();a.id=this.id;a.date=this.date;
a.user=this.user;a.text=this.text;a.cid=this.cid;return a};g.prototype.toString=function(){return this.text};g.prototype.fromJSON=function(a){d(this,a);this.position=m.Point.prototype.clone.call(this.position)}})(r.viewer,r.geometry,r.geometry2,_);(function(q,m,p){function h(l,f,b){this.history=l;this.action=f;this.state=b;this.active=!0;this.undoCmd=this.doCmd=null}function n(l){l=new h(this,null,l);l.active=!1;this._states=[l];this._undoneState=[]}q.HistoryModel=n;h.prototype={commit:function(l){this.history.commit(l)},
cancel:function(l){this.history.cancel(l)},triggerChange:function(l){this.history.triggerChange(l)}};n.prototype=Object.create(m.Events);n.prototype.getCurrentState=function(){return this._states[this._states.length-1]};n.prototype.edit=function(l,f,b){if(3!==arguments.length)throw Error("All arguments are mandatory!");var a=this._states[this._states.length-1];if(a.active)throw Error("State must be commited or reverted");a=new h(this,l,a.state.clone());a.doCmd=f;a.undoCmd=b;this._states.push(a);this.triggerHistoryChange();
return a};n.prototype.commit=function(l){var f=this.getCurrentState();if(!f.active)throw Error("current state must be active");f.active=!1;this._undoneState=[];this.triggerHistoryChange(l);this.syncDoCmd()};n.prototype.cancel=function(l){if(this.getCurrentState().active)this._states.pop(),this.triggerBoth(l);else throw Error("Current task cannot be canceled. It is not active.");};n.prototype.revertTo=function(l){var f=this._states.indexOf(l);if(-1!==f)this._states.length=f+1,this._undoneState.length=
0,this.triggerBoth();else if(f=this._undoneState.indexOf(l),-1!==f)for(l=this._undoneState.length-f,f=0;f<l;++f)this.redo(!0);else this.reset()};n.prototype.findByCid=function(l){for(var f=this._states,b=f.length-1;-1!==b;--b){var a=f[b].state.findByCid(l);if(null!==a)return a}return null};n.prototype.reset=function(){this._states.length=1;this._undoneState.length=0;this.triggerBoth()};n.prototype.undo=function(){if(this.getCurrentState().active)throw Error("Current task must be finished.");if(1<
this._states.length)this.syncUndoCmd(),this._undoneState.push(this._states.pop()),this.triggerBoth();else throw Error("There is nothing to be undone");};n.prototype.redo=function(l){if(!l&&this.getCurrentState().active)throw Error("Current task must be finished.");if(0<this._undoneState.length)this._states.push(this._undoneState.pop()),this.triggerBoth(),l||this.syncDoCmd();else throw Error("There is nothing to be redone");};n.prototype.triggerBoth=function(l){this.triggerChange(l);this.triggerHistoryChange()};
n.prototype.triggerHistoryChange=function(){var l=!this.getCurrentState().active;this.trigger("history:changed",this,1<this._states.length&&l,0<this._undoneState.length&&l)};n.prototype.triggerChange=function(l){this.trigger("changed",l)};n.prototype.syncDoCmd=function(l){l=this.getCurrentState().doCmd;null!==l&&this.trigger("model:sync",l,this.getCurrentState().state,!0)};n.prototype.syncUndoCmd=function(l){l=this.getCurrentState().undoCmd;null!==l&&this.trigger("model:sync",l,this.getCurrentState().state,
!1)};n.prototype.setModel=function(l){n.call(this,l);this.triggerChange();this.triggerHistoryChange()}})(r.utils,Backbone,_);(function(q,m,p,h,n,l,f,b,a){function e(a,b,e){this.viewer=a;this.controllerModel=b;this.model=e;this.controllers={freehighlight:new k,texthighlight:new g(this),eraser:new c,note:new d}}function k(){this.current=this.actionModel=this.model=this.viewer=null;this.activePaths=[]}function c(){this.annotationController=this.actionModel=this.model=this.viewer=null}function g(a){this.actionController=
a;this.actionModel=this.model=this.viewer=null}function d(){this.editState=this.controller=this.actionModel=this.model=this.viewer=null}function t(a,b,c,d,g){this.viewer=a;this.annotationsModel=b;this.notesSelectionController=c;this.annotationController=d;this.cursorModel=g;this.originalNote=this.note=this.findPoint=this.initialNotePosition=this.initialPosition=this.currentEditModel=null;this.changed=!1;this.firstMousePos=null;this.pointerCursor=m.Cursor.create("pointer",1);this.moveCursor=m.Cursor.create("move",
1);this.currentMousePosition=new h.Point(0,0);a.on("change:viewport",this.onRelativeMousePositionChanged,this).on("mousedown",this.onMouseDown,this,-2).on("dblclick",this.onDoubleClicked,this,-2).on("mouseup",this.onMouseUp,this,-2).on("mousemove",this.onMouseMove,this,-2).on("ftouchstart",this.onDragStart,this,-2).on("ftouchmove",this.onDrag,this,-2).on("ftouchend",this.onDragEnd,this,-2)}p=m.STATES;var y=p.get("READY"),v=p.declare("ST_HIGHLIGHT"),A=p.declare("ST_NOTE_DRAGGING");q.NotesInteractionController=
t;q.AnnotationsControlerModel=b.Model.extend({defaults:{activatedAction:null,activatedActionModel:null,colorSelectionModel:null,selectedToolModel:null},initialize:function(a,b){this.annotationsController=a;this.textSelectionModel=b;this.toolsModels=[];var c=new r;c.on("click:colorSelection",this.onColorClicked,this);this.set("colorSelectorModel",c);this.addToolSelectionModel("toolSelectorModel",new D);this.addToolSelectionModel("noteSelectorModel",new E);this.on("change:activatedAction",this.onChangeActivatedAction,
this)},destroy:function(){a.each(this.toolsModels,function(a){a.off()});this.get("colorSelectorModel").off()},addToolSelectionModel:function(a,b){b.on("click:toolSelection",this.onToolSelected,this);this.set(a,b);this.toolsModels.push(b);return b},onToolSelected:function(a){a=a.getSelectedTool();null===a?this.annotationsController.deactivate():this.annotationsController.activate(a,this.get("colorSelectorModel"));this.trigger("click:toolSelection",this)},onChangeActivatedAction:function(b,c){a.each(this.toolsModels,
function(a){a.selectTool(c)})},onColorClicked:function(){this.textSelectionModel.get("selection").isEmpty()?"texthighlight"!==this.get("activatedAction")&&this.annotationsController.activate("freehighlight",this.get("colorSelectorModel")):this.annotationsController.activate("texthighlight",this.get("colorSelectorModel"))}});var r=b.Model.extend({defaults:{colorSelectionList:"red OrangeRed Fuchsia Orange Yellow LawnGreen Blue LightBlue".split(" "),colorSelection:0},getSelectedColor:function(){var a=
this.get("colorSelection");return-1===a?null:this.get("colorSelectionList")[a]}}),D=b.Model.extend({defaults:{toolSelectionList:[null,"freehighlight","texthighlight","eraser"],toolSelection:0},getSelectedTool:function(){var a=this.get("toolSelection");return-1===a?null:this.get("toolSelectionList")[a]},selectTool:function(a){a=this.get("toolSelectionList").indexOf(a);-1!==a?this.set("toolSelection",a):this.set("toolSelection",0)}}),E=b.Model.extend({defaults:{toolSelectionList:[null,"note","eraser"],
toolSelection:0},getSelectedTool:function(){var a=this.get("toolSelection");return-1===a?null:this.get("toolSelectionList")[a]},selectTool:function(a){a=this.get("toolSelectionList").indexOf(a);-1!==a?this.set("toolSelection",a):this.set("toolSelection",0)}});q.AnnotationsController=e;e.prototype={activate:function(a,b){var c=this.controllerModel.get("activatedAction");c!==a&&(null!==c&&this.deactivate(c),this.onActivate(a,b))},deactivate:function(a){0===arguments.length&&(a=this.controllerModel.get("activatedAction"));
if(a)this.onDeactivate(a)},onActivate:function(a,b){this.controllers[a].activate(this.viewer,this.model,b,this);this.controllerModel.set("activatedAction",a);this.controllerModel.set("activatedActionModel",b)},onDeactivate:function(a){this.controllers[a].deactivate();this.controllerModel.set("activatedAction",null);this.controllerModel.set("activatedActionModel",null)},showAnnotation:function(a){if("note"===a.type)this.viewer.scrollToPoint(a.page,a.position);else throw Error("Annotation of type: "+
a.type+" is unsuported");},editNote:function(b){this.deactivate();if("note"===b.type)m.showNoteFormDialog(this.viewer,new m.NoteFormModel(b),a.bind(function(a,c){if(a){var d=new m.NoteAnnotation;d.fromJSON(c.toJSON());var g=this.model.edit("note",{action:"save",annotation:d},{action:"save",annotation:b});g.state.replace(b,d);g.triggerChange([d.page]);g.commit([d.page])}},this),!1);else throw Error("Only note is supported to edit");},deleteAnnotation:function(a){var b=this.model.edit("delete-"+a.type,
{action:"delete",annotation:a},{action:"save",annotation:a}),c=b.state.getAnnotations(a.page).indexOf(a);b.state.removeAnnotation(a.page,c);b.triggerChange([a.page]);b.commit([a.page])},findNoteAtPoint:function(a){var b=this.viewer.documentRenderer,c=b.getPageNumberByCoordinates(a.x,a.y,1);if(null!==c){b.translateCoordinatesToPage(a,c);for(var b=this.viewer.scale,c=this.model.getCurrentState().state.getAnnotations(c),d=0,g=null!==c?c.length:0;d<g;++d){var e=c[d];if("note"===e.type&&m.getPosibleNoteRectangle(e.position,
b).isPointIn(a))return e}}return null}};e.prototype.destroy=e.prototype.deactivate;k.prototype={activate:function(a,b,c){this.viewer=a;this.model=b;this.actionModel=c;a.on("mousedown",this.onMouseDown,this,-1).on("mouseup",this.onMouseUp,this,-1).on("mousemove",this.onMouseMove,this,-1).on("ftouchstart",this.onDragStart,this,-1).on("ftouchmove",this.onDrag,this,-1).on("ftouchend",this.onDragEnd,this,-1)},blockIfActive:function(){return null!==this.current},deactivate:function(){this.viewer.off("mousedown",
this.onMouseDown,this).off("mouseup",this.onMouseUp,this).off("mousemove",this.onMouseMove,this).off("ftouchstart",this.onDragStart,this).off("ftouchmove",this.onDrag,this).off("ftouchend",this.onDragEnd,this);this.actionModel=this.model=this.viewer=null;this.current&&this.current.cancel()},_getTouches:function(a){return a.gesture.touches},onDragStart:function(a){for(var b=this._getTouches(a),c=!1,d=this.activePaths.length,g=b.length;d<g;++d)var e=this.createNewPath(b[d]),c=c||e;c&&(a.preventDefault(),
a.stopPropagation());return c},onDragEnd:function(a){if(null!==this.current)return this.onCreationEnd(),a.preventDefault(),a.stopPropagation(),!0},onDrag:function(a){if(null!==this.current){for(var b=this._getTouches(a),c=this.activePaths,d=[],g=0,e=b.length;g<e;++g){var k=c[g];d.push(k.page);this.insertPagePointToPath(k,b[g])}this.current.triggerChange(d);a.preventDefault();a.stopPropagation();return!0}},onMouseDown:function(a){return this.createNewPath(a)},onMouseUp:function(a){if(null!==this.current)return this.onCreationEnd(),
!0},onMouseMove:function(a){if(null!==this.current)return"preventDefault"in a&&a.preventDefault(),this.insertPagePointToPath(this.activePaths[0],a),this.current.triggerChange([this.activePaths[0].page]),!0},onCreationEnd:function(){for(var a=[],b=this.activePaths,c=0,d=b.length;c<d;++c){var g=b[c];g.simplify(10);a.push(g.page)}this.current.triggerChange(a);this.current.commit(a);var e=this;setTimeout(function(){e.viewer.state.pop()},100);this.current=null;this.activePaths=[]},createNewPath:function(a){var b=
this.pageNumber=this.viewer.documentRenderer.getPageNumberByCoordinates(a.pageX,a.pageY,1);if(null!==b){"preventDefault"in a&&a.preventDefault();var c=new m.FreeHighlightAnnotation;null===this.current&&(this.current=this.model.edit("freehighlight",{action:"save",annotation:c},{action:"delete",annotation:c}),this.viewer.state.push(v));c.page=b;c.color=this.actionModel.getSelectedColor();this.current.state.add(b,c);this.insertPagePointToPath(c,a);this.activePaths.push(c);return!0}return!1},insertPagePointToPath:function(a,
b){var c=this.viewer.documentRenderer,d=new h.Point(b.pageX,b.pageY);c.translateCoordinatesToPage(d,a.page);a.addPoint(d)}};c.prototype={activate:function(a,b,c,d){this.viewer=a;this.model=b;this.actionModel=c;this.annotationController=d;a.on("mousedown",this.onClick,this,-3).on("tap",this.onTap,this,-3)},deactivate:function(){this.viewer.off("mousedown",this.onClick,this).off("tap",this.onTap,this)},onClick:function(a){return this.removeAnnotationOnPoint(new h.Point(a.pageX,a.pageY))},onTap:function(a){return this.onClick(a.gesture.touches[0])},
removeAnnotationOnPoint:function(a){var b=this.annotationController.findNoteAtPoint(a.clone());if(null!==b)return this.annotationController.deleteAnnotation(b),!0;var c=this.viewer.documentRenderer,b=c.getPageNumberByCoordinates(a.x,a.y,1);return null!==b&&(c.translateCoordinatesToPage(a,b),a=this.findAnnotationAt(b,a),-1!==a)?(c=this.model.getCurrentState().state.getAnnotations(b)[a],c=this.model.edit("eraser",{action:"delete",annotation:c},{action:"save",annotation:c}),c.state.removeAnnotation(b,
a),c.triggerChange([b]),c.commit([b]),!0):!1},findAnnotationAt:function(b,c){var d=this.model.getCurrentState().state.getAnnotations(b);if(!a.isEmpty(d)){for(var g=l.createHitTestCanvasContext(),e=d.length;e--;){var k=d[e];if("freehighlight"===k.type&&(m.renderFreehandHighlightPath(g,k,!1),g.isPointInStroke(c.x,c.y)))return e}for(e=d.length;e--;)if(k=d[e],"texthighlight"===k.type&&(g.beginPath(),m.renderTextHighlightPath(g,k),g.isPointInPath(c.x,c.y)))return e}return-1}};g.prototype={activate:function(b,
c,d){this.viewer=b;this.model=c;this.actionModel=d;this.createSelectionHighlight()&&(b.textSelectionController.cancelSelection(),setTimeout(a.bind(this.actionController.deactivate,this.actionController),0));b.textSelectionModel.on("finished",this.onSelectionFinished,this)},deactivate:function(){this.viewer.textSelectionModel.off("finished",this.onSelectionFinished,this)},onSelectionFinished:function(){this.createSelectionHighlight();this.viewer.textSelectionController.cancelSelection()},createSelectionHighlight:function(){var a=
this.viewer.textSelectionModel.get("selection");if(!a.isEmpty()){for(var b=a.getAffectedPages(),c={action:"saveMany",annotations:[]},d=this.model.edit("texthighlight",c,{action:"deleteMany",annotations:c.annotations}),g=this.actionModel.getSelectedColor(),e=0,k=b.length;e<k;++e){var f=b[e],l=a.getSelection(f),h=new m.TextHighlightAnnotation;h.color=g;for(var n=0,t=l.length;n<t;++n)h.addRectangle(l[n].clone());h.simplify();d.state.add(f,h);c.annotations.push(h)}d.triggerChange(b);d.commit(b);return!0}return!1}};
d.prototype={activate:function(a,b,c,d){this.viewer=a;this.model=b;this.actionModel=c;this.controller=d;a.on("mousedown",this.onClick,this,-1).on("tap",this.onTap,this,-1)},deactivate:function(){this.viewer.off("mousedown",this.onClick,this).off("tap",this.onTap,this);this.controller=this.actionModel=this.model=this.viewer=null},onClick:function(a){return this.addNoteAtPoint(new h.Point(a.pageX,a.pageY))},onTap:function(a){return this.onClick(a.gesture.touches[0])},addNoteAtPoint:function(b){var c=
this.viewer.documentRenderer,d=c.getPageNumberByCoordinates(b.x,b.y,1);return null!==d?(c.translateCoordinatesToPage(b,d),m.showNoteFormDialog(this.viewer,new m.NoteFormModel({position:b,page:d}),a.bind(this.onNoteDialogClosed,this),!0),!0):!1},onNoteDialogClosed:function(b,c){if(b){var d=new m.NoteAnnotation;a.extend(d,c.toJSON());var g=this.model.edit("note",{action:"save",annotation:d},{action:"delete",annotation:d});g.state.add(d.page,d);g.triggerChange([d.page]);g.commit([d.page])}this.controller.deactivate()}};
t.prototype={destroy:function(){this.viewer.off("change:viewport",this.onRelativeMousePositionChanged,this).off("mousedown",this.onMouseDown,this,-2).off("mouseup",this.onMouseUp,this,-2).off("mousemove",this.onMouseMove,this,-2).off("ftouchstart",this.onDragStart,this,-2).off("ftouchmove",this.onDrag,this,-2).off("ftouchend",this.onDragEnd,this,-2);this.viewer.state.current()===A&&this.viewer.state.pop()},onDragStart:function(a,b){return this.onMouseDown(a.gesture.touches[0],b)},onDragEnd:function(a,
b){return this.onMouseUp(a.gesture.touches[0],b)},onDrag:function(a,b){return this.onMouseMove(a.gesture.touches[0],b)},onDoubleClicked:function(a,b){},onMouseDown:function(a,b){if(b.current()===y){var c=new h.Point(a.pageX,a.pageY);this.firstMousePos=c.clone();var d=this.annotationController.findNoteAtPoint(c.clone());this.changed=!1;return null!==d?("preventDefault"in a&&a.preventDefault(),b.push(A),this.findPoint=c.clone(),this.initialPosition=this.viewer.translateCoordinatesToPage(c,d.page),this.initialNotePosition=
d.position.clone(),this.originalNote=d,this.note=d.clone(),this.currentEditModel=this.annotationsModel.edit("note-drag",{action:"save",annotation:this.note},{action:"save",annotation:d}),this.currentEditModel.state.replace(d,this.note),this.notesSelectionController.drag(this.note),this.notesSelectionController.select(this.note),!0):!1}},onMouseMove:function(a,b){if(b.current()===A){"preventDefault"in a&&a.preventDefault();var c=new h.Point(a.pageX,a.pageY);if(this.changed||5<c.distance(this.firstMousePos)){this.cursorModel.push(this.moveCursor);
this.changed=!0;var c=this.viewer.translateCoordinatesToPage(c,this.note.page),d=this.initialPosition.y-c.y;this.note.position.x=this.initialNotePosition.x-(this.initialPosition.x-c.x);this.note.position.y=this.initialNotePosition.y-d;this.currentEditModel.triggerChange([this.note.page])}return!0}c=this.currentMousePosition;c.x=a.pageX;c.y=a.pageY;this.onRelativeMousePositionChanged()},onRelativeMousePositionChanged:function(){this.annotationController.findNoteAtPoint(this.currentMousePosition.clone())?
this.cursorModel.push(this.pointerCursor):this.cursorModel.pop(this.pointerCursor)},onMouseUp:function(a,b){if(b.current()===A){var c=new h.Point(a.pageX,a.pageY),d=this.viewer.documentRenderer.getPageNumberByCoordinates(c.x,c.y,1);if(this.changed&&null!==d){this.cursorModel.pop(this.moveCursor);var g=[];this.note.page!==d&&(g.push(this.note.page,d),g.sort(),c=this.viewer.translateCoordinatesToPage(c,d),this.note.position=c,this.currentEditModel.state.changePage(this.note,d));this.currentEditModel.triggerChange(g);
this.currentEditModel.commit()}else this.currentEditModel.cancel(),d=this.annotationController.findNoteAtPoint(this.findPoint.clone()),this.notesSelectionController.select(d);this.notesSelectionController.drag(null);b.pop();return!0}}};q.AnnotationSelectionModel=b.Model.extend({defaults:{selected:null,dragged:null},isSelected:function(a){return a===this.get("selected")},isDragged:function(a){return a===this.get("dragged")},select:function(a){var b=this.get("selected");this.set("selected",a);this.triggerChange(b,
a)},drag:function(a){var b=this.get("dragged");this.set("dragged",a);this.triggerChange(b,a)},triggerChange:function(a,b){var c=[];null!==b&&c.push(b.page);null===a||null!==b&&a.page===b.page||(c.push(a.page),c.sort());this.trigger("changed",c)}})})(r.viewer,r.viewer,r.utils,r.geometry,r.geometry2,r.ui,r.i18n,Backbone,_);(function(q,m,p,h,n,l,f){function b(a,b,d){this.historyModel=a;this.serviceCaller=b;a.on("model:sync",this.onModelSync,this);this._persistentQueue=null;var e=this,m=new p.Completer;
this._persistentQueueFuture=m.future.then(function(){e._persistentQueueFuture=null});this.queueId=d;n.openPersistentQueue("sync:"+d,l.bind(this.queueErrorHandler,this)).then(function(a){e._persistentQueue=a;m.complete()}).error(function(a){h.error("[AnnotationServiceSync] unable to init persitent queue");e._persistentQueue=new n.DefferedQueue;m.complete()});this._currentlyExecuted=null;this._syncFailed=!1;this._syncFailedTimer=null;this._state=k.SYNCHRONIZED;this._lastSyncState={versionId:0,annotations:[]};
this._queue=[];f.Events.on("storage:erased",this.onStorageErased,this)}function a(a){var b=null;if(a.annotation)b=[a.annotation.cid];else if(a.annotations)b=l.pluck(a.annotations,"cid");else throw Error("annotation or annotations must be member of cmd");return b}function e(a){if(a=l.find(a,function(a){return!a.id}))throw h.debug(a),Error("id must be specified");}q.AnnotationServiceSync=b;var k={SYNCHRONIZED:0,SYNCHRONIZING:1,FAILED:2};q.AnnotationSyncState=k;b.prototype={onStorageErased:function(a){h.debug("[AnnotationServiceSync] onStorageErased",
a);-1!==this.queueId.indexOf(a)&&this.exec(function(){this._persistentQueue.deleteAll()})},destroy:function(){f.Events.off("storage:erased",this.onStorageErased,this)},changeState:function(a){this._state!==a&&(this._state=a,this.trigger("sync:state",a))},cancelSync:function(){this.historyModel.reset()},load:function(){h.debug("[AnnotationServiceSync] load");this.changeState(k.SYNCHRONIZING);var a=this.serviceCaller.call("Annotation","describe");a.then(l.bind(this.replaceModel,this));a.catchError(l.bind(function(a){h.error("[AnnotationServiceSync]",
a);this.trigger("error:load",a,this);this.replaceModel(this._lastSyncState)},this));return a},replaceModel:function(a){this._lastSyncState=a;h.debug("[AnnotationServiceSync] versionId:",a.versionId);var b=new m.AnnotationsModel;b.parseFromJSON(a.annotations);this.exec(function(){var a=this,c=[];this._persistentQueue.all().then(function(e){b.applyUncommitedChanges(e,function(a){c.push(a)});a.historyModel.setModel(b);a._queue=c;0!==c.length?a.executeIfPosible():a.changeState(k.SYNCHRONIZED)}).catchError(function(c){a.historyModel.setModel(b)})})},
exec:function(a){null===this._persistentQueue?this._persistentQueueFuture.then(l.bind(a,this)):a.call(this)},onModelSync:function(b,g){var d=a(b),e=[],k=l.filter(this._queue,function(a){if(a.cmd.annotation)return-1!==d.indexOf(a.cmd.annotation.cid);if(a.cmd.annotations){var b=l.filter(a.cmd.annotations,function(a){return-1!==d.indexOf(a.cid)});if(b.length===a.cmd.annotations.length)return!0;var c=[a.cmd.annotations];c.push.apply(c,b);a.cmd.annotations=l.without.apply(l,c);e.push(a);return!1}});if(0!==
k.length){var f=[this._queue];f.push.apply(f,k);this._queue=l.without.apply(l,f);h.debug("[AnnotationServiceSync] removed from queue",k)}"delete"===b.action?b.annotation.id&&(this._queue.push({cmd:b,state:g.toFlatRepr()}),h.debug("[AnnotationServiceSync] 0 pushed",b.action,b)):"deleteMany"===b.action?(f=l.filter(b.annotations,function(a){return!!a.id}),b.annotations=f,0!==f.length&&(this._queue.push({cmd:b,state:g.toFlatRepr()}),h.debug("[AnnotationServiceSync] 1 pushed",b.action,b))):(this._queue.push({cmd:b,
state:g.toFlatRepr()}),h.debug("[AnnotationServiceSync] 2 pushed",b.action,b));(l.find(e,function(a){return l.isNumber(a.rowid)})||l.find(k,function(a){return l.isNumber(a.rowid)}))&&this.exec(function(){this._persistentQueue.transaction(function(a){for(var b=0,c=e.length;b!==c;++b){var d=e[b];l.isNumber(d.rowid)&&a.push(d)}b=0;for(c=k.length;b!==c;++b)d=k[b],l.isNumber(d.rowid)&&a.deleteItem(d)})});this.executeIfPosible()},trySync:function(){this.clearTimer();this.executeIfPosible()},executeIfPosible:function(){if(null===
this._currentlyExecuted){this.changeState(k.SYNCHRONIZING);var a=this._queue.shift();if(a){var b=this;this._currentlyExecuted=this.doSync(a.cmd,a.state).whenComplete(function(){l.isNumber(a.rowid)&&!b._syncFailed&&b.exec(function(){h.debug("[AnnotationServiceSync] removing from storage",a);b._persistentQueue.deleteItem(a)});b._syncFailed&&(b._queue.unshift(a),l.find(b._queue,function(a){return!l.isNumber(a.rowid)})&&b.exec(function(){b._persistentQueue.transaction(function(a){l.each(b._queue,function(b){l.isNumber(b.rowid)||
(h.debug("[AnnotationServiceSync] saving to storage",b),a.push(b).then(function(a){b.rowid=a}))})})}))}).whenComplete(l.bind(this.cleanUpExecution,this))}else this.changeState(k.SYNCHRONIZED)}},queueErrorHandler:function(a){h.error("[AnnotationServiceSync] queueErrorHandler",a);this._currentlyExecuted=null},cleanUpExecution:function(){this._currentlyExecuted=null;this._syncFailed?null!==this._syncFailedTimer&&(this._syncFailedTimer=setTimeout(l.bind(function(){this._syncFailedTimer=null;this.executeIfPosible()},
this),3E4)):this.executeIfPosible()},clearTimer:function(){clearTimeout(this._syncFailedTimer);this._syncFailedTimer=null},doSync:function(a,b){var d=a.action,f={versionId:this._lastSyncState.versionId};"save"===d?f.annotation=a.annotation:"delete"===d&&null!==a.annotation.id?f.annotationId=a.annotation.id:"saveMany"===d?f.annotations=a.annotations:"deleteMany"===d&&(f.annotationIds=[],l.each(a.annotations,function(a){null!==a.id&&this.push(a.id)},f.annotationIds));f=this.serviceCaller.call("Annotation",
d,f);f.then(l.bind(function(k){if("save"===d){var f=a.annotation.cid;a.annotation.fromJSON(k.annotation);a.annotation.cid=f;this.historyModel.triggerChange([k.annotation.page])}else if("saveMany"===d){for(var h=[],n=0,t=k.annotations.length;n<t;++n){var m=a.annotations[n],f=m.cid;m.fromJSON(k.annotations[n]);m.cid=f;f=m.page;-1===h.indexOf(f)&&h.push(f)}h.sort();this.historyModel.triggerChange(h)}else"delete"===d?a.annotation.id=null:"deleteMany"===d&&l.each(a.annotations,function(a){a.id=null},this);
this._syncFailed=!1;b?(e(b),this._lastSyncState={versionId:k.newVersionId,annotations:b},this.trigger("model:synced",this._lastSyncState)):this.trigger("model:refresh")},this)).catchError(l.bind(function(a){409===a?(this._syncFailed=!1,this.trigger("model:refresh")):(this.trigger("error:sync",a,this),this._syncFailed=!0,this.changeState(k.FAILED))},this));this.serviceCaller.send();return f}};l.extend(b.prototype,f.Events)})(r.viewer,r.viewer,r.async,r.log,r.utils,_,Backbone);(function(q,m,p,h,n){function l(b,
g,d){this.model=b;this.viewer=g;this.annotationSelectionModel=d;this.noteIcon=a(!1,!1);this.selectedIcon=a(!0,!1);b=a(!0,!0);b.style.width=b.vitriumRequestedWidth+"px";b.style.height=b.vitriumRequestedHeight+"px";this.draggedIcon=new m.DomSizedWidget(b);this.noteBubble=new m.Bubble;this.noteInBubble=null;g.on("change:viewport",this.onViewportChanged,this)}function f(a,b,d){a.globalAlpha=0.5;a.strokeStyle=b.color;a.lineWidth=b.lineWidth;a.lineJoin="round";a.lineCap="round";a.beginPath();var k=b.path,
f=k.length;if(1===f){var l=k[0];a.moveTo(l.x,l.y);a.lineTo(l.x+1,l.y+1)}else if(1<f){var h=l=k[0];a.moveTo(l.x,l.y);for(var n=1;n<f;++n)l=k[n],a.lineTo(l.x,l.y);e.call(l,h)<b.lineWidth+5&&a.closePath()}d&&a.stroke()}function b(a,b){for(var d=b.rectangles,e=0,k=d.length;e<k;++e){var f=d[e];a.rect(f.x,f.y,f.w,f.h)}}function a(a,b){var d=m.CANVAS_POOL.getCanvas(k,k),e=d.getContext("2d");e.clearRect(0,0,d.width,d.height);e.save();e.fillStyle=a?"orange":"yellow";e.strokeStyle="black";e.lineCap="butt";
e.lineJoin="miter";e.miterLimit=4;e.lineWidth=1;e.beginPath();e.moveTo(16,8.07);e.bezierCurveTo(10.55,8.07,6.14,10.98,6.14,14.57);e.bezierCurveTo(6.14,17.43,8.91,19.85,12.76,20.72);e.bezierCurveTo(12.76,20.72,13.88,21.27,12.04,23.15);e.bezierCurveTo(11.28,23.93,15.08,21.94,15.89,21.39);e.bezierCurveTo(16.15,21.2,16.23,21.15,16.47,21.1);e.bezierCurveTo(16.69,21.06,16.87,21.06,16.96,21.06);e.bezierCurveTo(21.95,20.74,25.86,17.97,25.86,14.57);e.bezierCurveTo(25.86,10.98,21.45,8.07,16,8.07);e.closePath();
e.rect(4,4,24,24);e.fill();e.stroke();e.fillStyle="black";b&&(e.beginPath(),"setLineDash"in e?e.setLineDash([3]):"mozDash"in e&&(e.mozDash=[3]),e.rect(3,3,26,26),e.strokeStyle="red",e.stroke());e.restore();return d}q.AnnotationsLayerView=l;q.renderFreehandHighlightPath=f;q.renderTextHighlightPath=b;q.getPosibleNoteRectangle=function(a,b){var d=1/b*k,e=d/2;return new h.Rectangle(a.x-e,a.y-e,d,d,0)};l.prototype={destroy:function(){this.noteBubble.parent&&(this.viewer.remove(this.noteBubble),this.noteInBubble=
null);this.viewer.off("change:viewport",this.onViewportChanged,this)},on:function(){this.annotationSelectionModel.on.apply(this.annotationSelectionModel,arguments);return this.model.on.apply(this.model,arguments)},off:function(){this.annotationSelectionModel.off.apply(this.annotationSelectionModel,arguments);return this.model.off.apply(this.model,arguments)},getAnnotations:function(a){return this.model.getCurrentState().state.getAnnotations(a)},hasContent:function(a){var b=!n.isEmpty(this.getAnnotations(a));
b||null===this.noteBubble.parent||null===this.noteInBubble||this.noteInBubble.page!==a||this.removeBubble();return b},render:function(a,g,d){d=this.getAnnotations(a);if(!n.isEmpty(d)){g.save();g.globalAlpha=0.3;for(var e=null,k=0,l=d.length;k<l;++k){var p=d[k];if("texthighlight"===p.type){if(null===e||p.color!==e.color)null!==e&&g.fill(),g.fillStyle=p.color,g.beginPath();b(g,p);e=p}}null!==e&&g.fill();g.restore();k=0;for(l=d.length;k<l;++k)p=d[k],"freehighlight"===p.type&&(g.save(),f(g,p,!0),g.restore());
e=this.viewer.scale;g.save();m.setContextImageSmoothing(g,!1);for(var q=!1,r=!1,k=0,l=d.length;k<l;++k)if(p=d[k],"note"===p.type){var E=p.position,u=null;if(this.annotationSelectionModel.isDragged(p)){var q=!0,p=this.viewer.documentRenderer.translateCoordinatesFromPageToDOMRelative(E.clone(),a),w=this.draggedIcon.el.vitriumRequestedWidth/2;this.draggedIcon.dim=new h.Rectangle(p.x-w,p.y-w,0,0,0)}else this.annotationSelectionModel.isSelected(p)?(u=this.selectedIcon,this.noteInBubble=p,this.noteBubble.updateContent(p.text),
r=!0):u=this.noteIcon;null!==u&&(p=u.vitriumRequestedWidth/e/2,g.drawImage(u,0,0,u.width,u.height,E.x-p,E.y-p,u.vitriumRequestedWidth/e,u.vitriumRequestedHeight/e))}r&&null===this.noteBubble.parent?this.viewer.add(this.noteBubble):r||null===this.noteBubble.parent||null===this.noteInBubble||this.noteInBubble.page!==a||this.removeBubble();r&&(p=this.viewer.documentRenderer.translateCoordinatesFromPageToDOMRelative(this.noteInBubble.position.clone(),a),this.setBubblePosition(p));q&&null===this.draggedIcon.parent?
this.viewer.add(this.draggedIcon):q||null===this.draggedIcon.parent||this.viewer.remove(this.draggedIcon);m.setContextImageSmoothing(g,!0);g.restore()}},removeBubble:function(){this.viewer.remove(this.noteBubble);this.noteInBubble=null},onViewportChanged:function(a,b,d){if(null!==this.noteInBubble){var e=this.noteInBubble.page;n.find(b,function(a){return a.number===e})?(null===this.noteBubble.parent&&this.viewer.add(this.noteBubble),a=this.viewer.documentRenderer.translateCoordinatesFromPageToDOMRelative(this.noteInBubble.position.clone(),
e),this.setBubblePosition(a)):null!==this.noteBubble.parent&&this.viewer.remove(this.noteBubble)}},setBubblePosition:function(a){var b=this.viewer.dim,d=this.noteBubble.dim,e=this.viewer.documentRenderer.scrollableViewport,f=e.barThickness,l=b.w-d.w-(e.vScroll.visible?f+2:0),b=b.h-d.h-(e.hScroll.visible?f+2:0);this.noteBubble.dim=new h.Rectangle(Math.min(Math.max(a.x,0),l),Math.min(Math.max(a.y-k/2-d.h,0),b),0,0,0)}};var e=p.Point.prototype.distance,k=36})(r.viewer,r.ui,r.geometry,r.geometry2,_);
(function(q,m,p){function h(h,l,f){this.viewer=h;this.annotationsControllerModel=l;this.cursorModel=f;f=this.cursorCanvas=document.createElement("canvas");f.width=32;f.height=32;this.currentPage=this.cursor=null;h.on("change:pageUnderMouse",this.onChangePageUnderMouse,this);l.on("change:activatedAction",this.onUpdateAppearance,this);l.get("colorSelectorModel").on("change:colorSelection",this.onUpdateAppearance,this);this.displayedAction=this.image=this.renderedColor=null}q.AnnotationsActionCursorView=
h;h.prototype={destroy:function(){this.viewer.off("change:pageUnderMouse",this.onChangePageUnderMouse,this);this.cursorModel.pop(this.cursor)},onChangePageUnderMouse:function(h){this.currentPage=h;this.onUpdateAppearance()},onUpdateAppearance:function(){var h=this.annotationsControllerModel.get("activatedAction");null!==this.currentPage&&h===this.displayedAction||this.cursorModel.pop(this.cursor);if(null!==this.currentPage&&null!==h){if("freehighlight"===h){var l=this.annotationsControllerModel.get("colorSelectorModel").getSelectedColor();
if(l!==this.renderedColor){if(-1!==navigator.appVersion.indexOf("Trident"))this.image="crosshair";else{var f=this.cursorCanvas,b=f.getContext("2d");b.clearRect(0,0,f.width,f.height);b.globalAlpha=0.75;b.beginPath();b.arc(16,16,10,0,2*Math.PI);b.fillStyle=l;b.fill();this.image="url("+f.toDataURL()+") 16 16, auto"}this.renderedColor=l}this.cursor=new m.Cursor(this.image,1)}else this.cursor="texthighlight"==h?m.Cursor.create("text",1):m.Cursor.create("crosshair",2);this.displayedAction=h;this.cursorModel.push(this.cursor)}}}})(r.viewer,
r.viewer,jQuery);(function(q){function m(h,l,f,b,a){this.binded=!1;this.source=h;this.sourceEventId=l;this.selector=a?a:null;this.destination=f;this.destinationEventId=b?b:null;this.handler=_.bind(this._handler,this)}function p(h){this.group=h}q.pipeEvents=function(n,l,f,b){function a(){for(var a=h.create(arguments.length+1),k=0,c=arguments.length;k<c;++k)a[k+1]=arguments[k];a[0]=b;f.trigger.apply(f,a);a.free()}b||(b=l);n.on(l,a);return a};q.$pipeEvents=function(h,l,f,b,a){function e(e){b.trigger.call(b,
a,e)}a||(a=l);if(f)h.on(l,f,e);else h.on(l,e);return e};q.$EventPipe=m;q.EventPipeGroup=p;var h=q.pools.GLOBAL_ARRAY_POOL;m.prototype={on:function(){if(!this.binded){if(this.selector)this.source.on(this.sourceEventId,this.selector,this.handler);else this.source.on(this.sourceEventId,this.handler);this.binded=!0}},off:function(){this.binded&&(this.selector?this.source.off(this.sourceEventId,this.selector,this.handler):this.source.off(this.sourceEventId,this.handler),this.binded=!1)},destroy:function(){this.off();
this.handler=this.destinationEventId=this.destination=this.selector=this.sourceEventId=this.source=null},_handler:function(h){this.destinationEventId?this.destination.trigger(this.destinationEventId,h):this.destination.trigger(h.type,h)}};p.prototype={on:function(){for(var h=this.group,l=0,f=h.length;l<f;++l)h[l].on()},off:function(){for(var h=this.group,l=0,f=h.length;l<f;++l)h[l].off()},destroy:function(){for(var h=this.group,l=0,f=h.length;l<f;++l)h[l].destroy();this.group=null}}})(r.utils,_);
(function(q,m,p){function h(f,b,a,e,k){l.call(this,f,b,a,e,k);this.state=a.state}function n(f,b,a,e){h.call(this,f,"mousewheel",b,a,e)}var l=r.utils.$EventPipe;q.$EventPipe=h;q.$MouseWheelEventPipe=n;p.extend(h.prototype,l.prototype);h.prototype._handler=function(f){var b=this.state;this.destinationEventId?this.destination.trigger(this.destinationEventId,f,b):this.destination.trigger(f.type,f,b)};p.extend(n.prototype,l.prototype);n.prototype._handler=function(f,b,a,e){var k=this.state;this.destinationEventId?
this.destination.trigger(this.destinationEventId,f,b,a,e,k):this.destination.trigger(f.type,f,b,a,e,k)}})(r.viewer,r.utils,_);(function(q,m,p,h){function n(l){this.renderCallback=l;this.internalCallback=p.bind(this.render,this);this.renderRequested=!1;this.currentTime=this.reqId=null}q.RequestAnimationFrameHelper=n;n.prototype={request:function(l){this.reqId||(this.reqId=h.requestAnimationFrame(this.internalCallback));l||(this.renderRequested=!0)},render:function(l){this.currentTime=l;var f=this.renderRequested;
this.renderRequested=!1;this.reqId=null;f&&this.renderCallback(l)},cancel:function(){this.renderRequested&&h.cancelAnimationFrame(this.reqId)}};(function(){if(!h.requestAnimationFrame){for(var l=0,f=["ms","moz","webkit","o"],b=0;b<f.length&&!h.requestAnimationFrame;++b)h.requestAnimationFrame=h[f[b]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[f[b]+"CancelAnimationFrame"]||h[f[b]+"CancelRequestAnimationFrame"];h.resetLastTime=function(){l=Date.now()};h.requestAnimationFrame||(h.requestAnimationFrame=
function(a,b){var k=Date.now(),c=Math.max(0,16-(k-l)),g=h.setTimeout(function(){a(k+c)},c);l=k+c;return g});h.cancelAnimationFrame||(h.cancelAnimationFrame=function(a){clearTimeout(a)})}})()})(r.ui,r,_,I);(function(q,m,p,h){function n(b){this.context=b;this.callbacks=[];this.mainUIRefresh=this.i=this.current=null;this.frameRequester=new m.RequestAnimationFrameHelper(p.bind(this.step,this))}function l(b,a,e){this.funct=b;this.ctx=a;this.p=e;this.ignored=this.canceled=!1}function f(b,a){var e=b.p,k=
a.p;return e>k?1:e<k?-1:0}q.UILoop=n;q.UISync=l;n.prototype={lastFrameTime:function(){return this.frameRequester.currentTime},step:function(b){var a=this.current=this.callbacks;this.callbacks=[];a.sort(f);for(var e=this.context,k=0;k<a.length;++k){this.i=k;var c=a[k];c.canceled?c.ignored=!0:c.funct.call(c.ctx,e,b)}this.i=this.current=null},runAsync:function(b){var a=this.callbacks;-1===a.indexOf(b)&&(a.push(b),this.frameRequester.request())},runAsyncAsap:function(b){null===this.current?this.runAsync(b):
this.current.indexOf(b)<=this.i&&this.current.push(b)},refresh:function(){null!==this.mainUIRefresh&&this.runAsync(this.mainUIRefresh)}};p.extend(n.prototype,h.Events);l.prototype={destroy:function(){this.canceled=!0;this.ctx=this.funct=null},cancel:function(){this.canceled=!0},resume:function(){this.canceled=!1;var b=this.ignored;this.ignored=!1;return b}}})(r.ui,r.ui,_,Backbone);(function(q,m){function p(){this._handlers=null}q.EventLifecycleManager=p;p.prototype={on:function(h){null===this._handlers&&
(this._handlers=[]);for(var n=[],l=1,f=arguments.length;l<f;++l)n.push(arguments[l]);h.on.apply(h,n);n.push(h);this._handlers.push(n);return this},offAll:function(){var h=this._handlers;if(null!==h){for(var n=0,l=h.length;n<l;++n){var f=h[n],b=f.pop();b.off.apply(b,f)}this._handlers=null;return this}}}})(r.ui,_);(function(q,m,p,h,n,l){function f(a){this.containerWidget=a;this.defaultPriority=-15;this._uiCalculateLayout=new m.UISync(this.onLayout,this,this.defaultPriority);this._resetToDefaultSize=
!1}function b(a){f.call(this,a);this._center=this._right=this._left=null;this.centerVertical=!0}function a(a){f.call(this,a);this.align=u.LEFT;this.widgets=[];this.center=!1}function e(a){f.call(this,a);this._bottom=this._top=this._center=this._right=this._left=null}function k(a){this._ctx=a;this._list=[];this._eventSource=null}function c(a){this.el=a;this.el.style.position="absolute";this._dim=new p.Rectangle(0,0,0,0,0);this._pos=-1;this._parent=null;this._uiRender=new m.UISync(this.onRender,this,
-20);this._refreshAfterParent=!0;this._hasRoot=!1;this.events=new k(this);this.eventGuard=new m.EventLifecycleManager}function g(a){c.call(this,a);this.$el=h(this.el);this.priority=this.maxSize=this.currentSize=0;this._checkSizeRequested=null}function d(a){this.widget=a;this.on=a.on?this._on:null;this.off=a.off?this._off:null;this.onLayoutAttached=a.onLayoutAttached?this._onLayoutAttached:null;this.onLayoutDetached=a.onLayoutDetached?this._onLayoutDetached:null}function t(a,b){d.call(this,a);this.margin=
n.extend({top:0,bottom:0,left:0,right:0},b)}function y(a){d.call(this,a)}function v(a){d.call(this,a)}function A(){c.call(this,document.createElement("div"));this._containerEl=document.createElement("div");this._containerEl.className="vitrium-relative-container";this.el.appendChild(this._containerEl);this._widgets=[];this.layoutGuard=this.layoutManager=null;this.events.on("RefreshLayout",this.onTriggerRefreshLayout);this.onInit()}function z(a){A.call(this);this.el.className="vitrium-root-container";
this.el.style.position="static";this.$el=h(this.el);this._uiResize=new m.UISync(this._onResize,this,-16);this._$window=h(window);this.onResize=n.bind(this.refresh,this);this._$window.on("resize",this.onResize);this._dimValid=this._requested=this._paused=!1;this.parent={uiLoop:a};this._offset=this._dim.clone()}function D(a){this.containerWidget=a;this.currentSize=null;this.growing=!1}var E=new p.Rectangle(0,0,0,0,0),u=q.DIRECTION={LEFT:0,TOP:1,BOTTOM:2,RIGHT:4,CENTER:8};q.ORIENTATION={HORIZONTAL:16,
VERTICAL:32};q.BasicLayoutManager=e;q.BoxLayout=a;q.HorizontalAlignLayout=b;q.IntersectionLayoutGuard=D;q.DomWidget=c;q.DomSizedWidget=g;q.ContainerWidget=A;q.RootContainerWidget=z;q.LayoutWidgetProxy=d;q.LayoutMarginProxy=t;q.LayoutCenterVertical=y;q.LayoutCenterHorizontal=v;f.prototype={_calculateLayout:function(){},calculateLayout:function(a){var b=this.containerWidget.layoutGuard;this.containerWidget.broadcastEvent("layout:before",this.containerWidget,this,a);if(null!==b){b.begin(this._resetToDefaultSize,
a);this._resetToDefaultSize=!1;do this._calculateLayout(a);while(!b.checkLayout())}else this._calculateLayout(a);this.containerWidget.broadcastEvent("layout:after",this.containerWidget,this,a)},onLayout:function(a,b){this.calculateLayout(this.containerWidget.dim)},destroy:function(){this._uiCalculateLayout.destroy()},onSizeChanged:function(){this._resetToDefaultSize=!0;this.refresh()},refresh:function(){var a=this.containerWidget.uiLoop;null!==a&&(this._uiCalculateLayout.p=null===a.i?this.defaultPriority:
a.i+1,a.runAsyncAsap(this._uiCalculateLayout))},_attach:function(a,b){if(null!==a){if(a.on)a.on("size:change",this.onSizeChanged,this);if(a.onLayoutAttached)a.onLayoutAttached(b,this);this.refresh()}},_dettach:function(a){if(null!==a){a.off&&a.off("size:change",this.onSizeChanged,this);if(a.onLayoutDetached)a.onLayoutDetached(this);this.refresh()}},checkLayout:function(){return this.containerWidget.layoutGuard?this.containerWidget.layoutGuard.checkLayout():!0}};b.prototype=Object.create(f.prototype);
b.prototype._calculateLayout=function(a){var b=null===this._left?E:this._left.dim,c=null===this._right?E:this._right.dim,d=null===this._center?E:this._center.dim,g=b.clone(),e=c.clone(),k=d.clone(),f=a.h,l=f/2;g.x=0;this.centerVertical?g.y=l-b.h/2:(g.y=0,g.h=f);e.x=a.w-e.w;this.centerVertical?e.y=l-c.h/2:(e.y=0,e.h=f);k.x=a.w/2-d.w/2;this.centerVertical?k.y=l-d.h/2:(k.y=0,k.h=f);null===this._left||g.equals(b)||(this._left.dim=g);null===this._right||e.equals(c)||(this._right.dim=e);null===this._center||
k.equals(d)||(this._center.dim=k)};Object.defineProperties(b.prototype,{left:{set:function(a){this._dettach(this._left);this._left=a;this._attach(a,u.LEFT);return a},get:function(){return this._left}},right:{set:function(a){this._dettach(this._right);this._right=a;this._attach(a,u.RIGHT);return a},get:function(){return this._right}},center:{set:function(a){this._dettach(this._center);this._center=a;this._attach(a,u.CENTER);return a},get:function(){return this._center}}});a.prototype=n.extend(Object.create(f.prototype),
{add:function(a){this.widgets.push(a);this._attach(a,this.align);return a},replace:function(a,b){this._dettach(this.widgets[a]);this._attach(b,this.align);this.widgets[a]=b},remove:function(a){a=this.widgets[a];this.widgets=n.without(this.widgets,a);this._dettach(a);return a},removeWidget:function(a){a=this.widgets.indexOf(a);return-1!==a?(this.remove(a),!0):!1},prepend:function(a){this.widgets.unshift(a);this._attach(a,this.align);return a},_calculateLayout:function(a){var b=0,c=this.align,d=this.widgets;
if(c===u.LEFT)for(var c=a.h/2,g=0,e=d.length;g<e;++g){var k=d[g],f=k.dim,l=f.clone();l.x=b;this.center?l.y=c-l.h/2|0:l.h=a.h;b+=l.w;f.equals(l)||(k.dim=l)}else if(c===u.RIGHT)for(c=a.h/2,b=a.w,g=d.length;g--;)k=d[g],f=k.dim,l=f.clone(),b=l.x=b-l.w,this.center?l.y=(c-l.h/2|0)-1:l.h=a.h,f.equals(l)||(k.dim=l);else if(c===u.TOP)for(g=0,e=d.length;g<e;++g)k=d[g],f=k.dim,l=f.clone(),l.w=a.w,l.y=b,b+=l.h,f.equals(l)||(k.dim=l);else for(b=a.h,g=0,e=d.length;g<e;++g)k=d[g],f=k.dim,l=f.clone(),l.w=a.w,b=l.y=
b-l.h,f.equals(l)||(k.dim=l)}});e.prototype=n.extend(Object.create(f.prototype),{destroy:function(){this._dettach(this._left);this._dettach(this._right);this._dettach(this._top);this._dettach(this._bottom);this._dettach(this._center)},_calculateLayout:function(a){var b=null===this._top?E:this._top.dim,c=null===this._bottom?E:this._bottom.dim,d=null===this._left?E:this._left.dim,g=null===this._right?E:this._right.dim,e=b.clone(),k=c.clone(),f=d.clone(),l=g.clone(),h=a.h-(e.h+k.h);f.x=0;f.y=e.h;f.h=
h;e.x=0;e.y=0;e.w=a.w;k.x=0;k.y=f.y+f.h;k.w=a.w;l.x=a.w-l.w;l.y=e.h;l.h=h;if(null!==this._center){var n=this._center.dim.clone();n.x=f.w;n.y=e.h;n.w=a.w-(f.w+l.w);n.h=h;this._center.dim=n}null===this._top||e.equals(b)||(this._top.dim=e);null===this._bottom||k.equals(c)||(this._bottom.dim=k);null===this._left||f.equals(d)||(this._left.dim=f);null===this._right||l.equals(g)||(this._right.dim=l)}});Object.defineProperties(e.prototype,{left:{set:function(a){this._dettach(this._left);this._left=a;this._attach(a,
u.LEFT);return a},get:function(){return this._left}},right:{set:function(a){this._dettach(this._right);this._right=a;this._attach(a,u.RIGHT);return a},get:function(){return this._right}},center:{set:function(a){this._dettach(this._center);this._center=a;this._attach(a,u.CENTER);return a},get:function(){return this._center}},top:{set:function(a){this._dettach(this._top);this._top=a;this._attach(a,u.TOP);return a},get:function(){return this._top}},bottom:{set:function(a){this._dettach(this._bottom);
this._bottom=a;this._attach(a,u.BOTTOM);return a},get:function(){return this._bottom}}});k.prototype={set eventSource(a){this.uninstall();this._eventSource=a;this.install();return a},get eventSource(){return this._eventSource},on:function(a,b){this._list.push({name:a,funct:b,installed:!1})},install:function(){if(null!==this._eventSource){var a=this._eventSource;n.each(this._list,function(b){b.installed||(a.on(b.name,b.funct,this._ctx),b.installed=!0)},this)}},uninstall:function(){if(null!==this._eventSource){var a=
this._eventSource;n.each(this._list,function(b){b.installed&&(a.off(b.name,b.funct,this._ctx),b.installed=!1)},this)}}};c.prototype={listen:function(){this.eventGuard.on.apply(this.eventGuard,arguments);return this},set parent(a){this._parent=a;this.onParentAttached();return parent},get parent(){return this._parent},get dim(){return this.getDim()},set dim(a){this.setDim(a)},get absoluteDim(){if(null!==this._parent){var a=this._parent.absoluteDim;a.x+=this._dim.x;a.y+=this._dim.y;a.w=this._dim.w;a.h=
this._dim.h;return a}return this.dim},setDim:function(a){var b=this.el.style;b.left=(a.x+0.5|0)+"px";b.top=(a.y+0.5|0)+"px";b.width=(a.w+0.5|0)+"px";b.height=(a.h+0.5|0)+"px";this._dim=a},getDim:function(){return this._dim},onLayoutAttached:function(a,b){this._pos=a},onLayoutDetached:function(){this._pos=-1},get uiLoop(){return null!==this.parent?this.parent.uiLoop:null},refresh:function(){var a=this.uiLoop;null!==a?a.runAsync(this._uiRender):this._refreshAfterParent=!0},onRender:function(){},broadcastEvent:function(){var a=
this.uiLoop;null!==a&&a.trigger.apply(a,arguments)},onParentAttached:function(){var a=this.uiLoop;this.events.eventSource=a;null!==a&&this._refreshAfterParent&&(this._refreshAfterParent=!1,this.refresh());this._hasRoot&&null===a?(this._hasRoot=!1,this.onDeactivateInternal()):this._hasRoot||null===a||(this._hasRoot=!0,this.onActivate())},resetToDefaultSize:function(){},makeSmallerIfPosible:function(){return!1},makeBiggerIfPosible:function(){return!1},compareTo:function(a){return 0},isDetached:function(){return!1},
canDetachFromLayout:function(){return!1},detachFromLayout:function(){},onActivate:function(){},onDeactivateInternal:function(){this.eventGuard.offAll();this.onDeactivate()},onDeactivate:function(){}};g.prototype=Object.create(c.prototype);g.prototype.setDim=function(a){this._dim=a;var b=this.el.style;b.left=(a.x+0.5|0)+"px";b.top=(a.y+0.5|0)+"px"};g.prototype.getDim=function(a){a=this.$el;"none"===a.css("display")?(this._dim.w=0,this._dim.h=0):(this._dim.w=a.innerWidth(),this._dim.h=a.innerHeight());
return this._dim};g.prototype.resetToDefaultSize=function(){for(var a=this.$el,b=1,c=this.currentSize;b<=c;++b)a.removeClass("lmode-"+b);this.currentSize=0};g.prototype.makeSmallerIfPosible=function(){return this.currentSize<this.maxSize?(this.$el.addClass("lmode-"+ ++this.currentSize),!0):!1};g.prototype.makeBiggerIfPosible=function(){return 0<this.currentSize?(this.$el.removeClass("lmode-"+this.currentSize--),!0):!1};g.prototype.compareTo=function(a){return this.priority===a.priority?this.currentSize==
a.currentSize?0:this.currentSize>a.currentSize?-1:1:this.priority<a.priority?1:this.priority>a.priority?-1:0};d.prototype={get dim(){return this.dimOut(this.widget.dim)},set dim(a){return this.widget.dim=this.dimIn(a)},_on:function(a,b,c){this.widget.on(a,b,c)},_off:function(a,b,c){this.widget.off(a,b,c)},_onLayoutAttached:function(a,b){this.widget.onLayoutAttached(a,b)},_onLayoutDetached:function(a){this.widget.onLayoutDetached(a)},dimOut:function(a){return a},dimIn:function(a){return a},onParentAttached:function(){this.widget.onParentAttached()},
get parent(){return this.widget.parent}};t.prototype=n.extend(Object.create(d.prototype),{dimOut:function(a){a=a.clone();a.w+=this.margin.left+this.margin.right;a.h+=this.margin.top+this.margin.bottom;return a},dimIn:function(a){a.x+=this.margin.left;a.y+=this.margin.top;return a}});y.prototype=n.extend(Object.create(d.prototype),{dimIn:function(a){a.y+=this.widget.parent.dim.h/2-this.widget.dim.h/2;return a}});v.prototype=n.extend(Object.create(d.prototype),{dimIn:function(a){a.x+=a.w/2-this.widget.dim.w/
2;return a}});A.prototype=n.extend(Object.create(c.prototype),{onInit:function(){},prepend:function(a){this._widgets.push(a);a.el&&this._containerEl.insertBefore(a.el,this._containerEl.firstChild);a.parent=this;return a},insertBefore:function(a,b){this._widgets.push(a);a.el&&this._containerEl.insertBefore(a.el,b.el);a.parent=this;return a},add:function(a){this._widgets.push(a);a.el&&this._containerEl.appendChild(a.el);a.parent=this;return a},remove:function(a){this._widgets=n.without(this._widgets,
a);a.el&&this._containerEl.removeChild(a.el);a.parent=null;return a},replace:function(a,b){var c=this._widgets[a];this._containerEl.replaceChild(b.el,c.el);c.parent=null;b.parent=this;this._widgets[a]=b},setDim:function(a){var b=this.dim;null!==this.layoutManager&&((b.w>a.w||b.h>a.h)&&this.layoutManager.calculateLayout(a),this.layoutManager.refresh());c.prototype.setDim.call(this,a)},onParentAttached:function(){c.prototype.onParentAttached.call(this);n.each(this._widgets,function(a){a.onParentAttached()})},
onTriggerRefreshLayout:function(){this.layoutManager&&this.layoutManager.refresh()}});A.prototype.constructor=A;z.prototype=n.extend(Object.create(A.prototype),{pause:function(){this._paused=!0},resume:function(){var a=this._paused;this._paused=!1;a&&this._requested&&this.refresh()},destroy:function(){this._$window.off("resize",this.onResize);this._$window=null;this._box.destroy&&this._box.destroy();this._box=null},init:function(){this.el.style.position="relative";this.refresh()},refresh:function(){this.uiLoop.runAsync(this._uiResize)},
_onResize:function(){this._dimValid=!1;this.paused?this._requested=!0:(r.is_mobile&&h.browser.safari&&this._$window.scrollTop(0),null!==this.layoutManager&&this.layoutManager.refresh(),this._requested=!1)},getDim:function(){if(!this._dimValid){var a=this._$window,b=this.$el.width(),c=this.$el.height(),d=a.height();692===d&&-1!==navigator.appVersion.indexOf("iPad")&&(d=672);a=a.width();if(0===b||0===c){var g=this.$el.offset();0===b&&(this._dim.w=a-g.left);0===c&&(this._dim.h=d-g.top);this._offset.x=
g.left;this._offset.y=g.top}0!==b&&(this._dim.w=b);0!==c&&(this._dim.h=c);this._dimValid=!0}return this._dim}});Object.defineProperties(z.prototype,{absoluteDim:{get:function(){var a=this._dim.clone();a.x=this._offset.x;a.y=this._offset.y;return a}}});z.prototype.constructor=z;D.prototype={begin:function(a,b){var c=b.clone();null!==this.currentSize&&(c.w>this.currentSize.w?this.makeItBigger()&&(this.growing=!0):this.growing=!1,this.currentSize=c.clone());a&&(this.resetToDefaultSize(),this.growing=
!1);this.currentSize=c},resetToDefaultSize:function(){n.each(this.containerWidget._widgets,function(a){a.resetToDefaultSize()})},makeItBigger:function(){var a=!1;n.each(this.containerWidget._widgets,function(b){b=b.makeBiggerIfPosible();a=a||b});return a},findIntersectedWidgets:function(){for(var a=Math.sin,b=Math.cos,c=[],d=this.containerWidget._widgets,g=0,e=d.length;g<e;++g){var k=d[g],f=k.dim.clone();f.x-=5;f.w+=10;for(var l=g+1;l<e;++l){var h=d[l];if(f.isIntersectedFast(h.dim,b,a)){var n=h.compareTo(k),
t=k.compareTo(h);0<=n&&-1===c.indexOf(h)&&c.push(h);0<=t&&-1===c.indexOf(k)&&c.push(k)}}}return c},checkLayout:function(){var a=this.findIntersectedWidgets();if(0<a.length){for(var b=!1,c=0,d=a.length;c<d;++c)var g=a[c].makeSmallerIfPosible(),b=b||g;this.growing=!1;if(b)return!1;l.warn("Broken layout imposible to adjust it");return!0}return this.growing?!(this.growing=this.makeItBigger()):!0}}})(r.ui,r.ui,r.geometry2,jQuery,_,r.log);(function(q,m,p,h){function n(f){m.DomWidget.call(this,document.createElement("div"));
var b=this.i=document.createElement("i");this.el.className="icon";this.el.appendChild(b);b.className="fa fa-"+f}function l(){this._icons={}}q.IconCache=l;q.icon=function(f){if(window.__vitrium_icons__&&f in window.__vitrium_icons__){var b=(new DOMParser).parseFromString(window.__vitrium_icons__[f],"image/svg+xml");f=document.createElement("div");f.appendChild(b.firstChild);b=new m.DomWidget(f);f.className="icon";return b}return new n(f)};n.prototype=p.extend(Object.create(m.DomWidget.prototype),{setDim:function(f){m.DomWidget.prototype.setDim.call(this,
f);this.el.style.fontSize=f.h-8+"px"}});l.prototype={icon:function(f){return f in this._icons?this._icons[f]:this._icons[f]=m.icon(f)}}})(r.ui,r.ui,_,jQuery);(function(q){q.EasingFunctions={linear:function(m){return m},easeInQuad:function(m){return m*m},easeOutQuad:function(m){return m*(2-m)},easeInOutQuad:function(m){return 0.5>m?2*m*m:-1+(4-2*m)*m},easeInCubic:function(m){return m*m*m},easeOutCubic:function(m){return--m*m*m+1},easeInOutCubic:function(m){return 0.5>m?4*m*m*m:(m-1)*(2*m-2)*(2*m-2)+
1},easeInQuart:function(m){return m*m*m*m},easeOutQuart:function(m){return 1- --m*m*m*m},easeInOutQuart:function(m){return 0.5>m?8*m*m*m*m:1-8*--m*m*m*m},easeInQuint:function(m){return m*m*m*m*m},easeOutQuint:function(m){return 1+--m*m*m*m*m},easeInOutQuint:function(m){return 0.5>m?16*m*m*m*m*m:1+16*--m*m*m*m*m}}})(r.ui);(function(q,m,p,h,n,l,f){function b(){m.ContainerWidget.call(this);this.el.className="vitrium-toolbar";this.layoutManager=new m.BoxLayout(this);this.oldSelection=this.selected=this.requestSelected=
-1;this.calculatedOrientation=this.orientation=null;this.counter=this.currentX=0;this.doLayoutSort=!1;this.events.on("layout:before",function(a,b,d){this.doLayoutSort&&this===a&&(b.widgets.sort(function(a,b){var c=a._toolbarOrder,d=b._toolbarOrder;return c===d?a._toolbarIndex-b._toolbarIndex:c-d}),this.doLayoutSort=!1)})}function a(){m.ContainerWidget.call(this);this.el.className="vitrium-side-toolbar";this.el.style.zIndex=1;this.layoutManager=new m.BasicLayoutManager(this);this.toolbar=this.add(new b);
f(this.toolbar.el).on("tap click",".icon",l.bind(this._onBarIconClicked,this));this._panels=[];this._state=k;this._reqPanelIdx=this._panelIdx=-1;this._startTime=null;this._openDuration=500;this._closedSize=null;this._openSize=this._openOptimalSize=300;this._openDetached=!1;this.parentDim=this._removedPanel=null;this.events.on("action:ClosePanel",this.onClosePanel);this.events.on("action:ClosePanelIfDetached",this.closePanelIfDetached);this.events.on("SideToolbar:open",this.onSideToolbarOpened);this.events.on("layout:before",
function(a,b,d){a!==this.parent||d.equals(this.parentDim)||(a=40,this.toolbar.orientation===m.ORIENTATION.VERTICAL?(b=d.w/15,64<b?a=52:48<b&&(a=48),this.updatePanelAppearance(Math.min(d.w-a,this._openOptimalSize),3>d.w/this._openOptimalSize)):(b=d.h/20,64<b?a=52:48<b&&(a=48),this.updatePanelAppearance(Math.min(d.h-a,this._openOptimalSize),3>d.h/this._openOptimalSize)),this.setToolbarSize(a),this.parentDim=d.clone())})}function e(a){m.ContainerWidget.call(this);this.icon=null;this.setIcon(a);this.el.className=
h.is_mobile?"vitrium-side-panel":"vitrium-side-panel desktop";this.lastOpened=!1}q.SideToolbar=a;q.Toolbar=b;q.SidePanel=e;q.bootstrapIcon=function(a){var b=document.createElement("div");b.innerHTML="<i class='"+a+"'></i>";return b};var k=0;b.prototype=l.extend(Object.create(m.ContainerWidget.prototype),{add:function(a,b){m.ContainerWidget.prototype.add.call(this,a);this.layoutManager.add(a);this.calculatedOrientation=null;a._toolbarIndex=this.counter++;a._toolbarOrder="undefined"!==typeof b?b:0;
this.doLayoutSort=!0;var d=this.currentX;this.currentX=0;this.setIconsSize(d);return a},replace:function(a,b){this.calculatedOrientation=null;var d=this._findWidget(a),e=d.el;m.ContainerWidget.prototype.replace.call(this,this._findIdx(a),b);this.layoutManager.replace(this.layoutManager.widgets.indexOf(d),b);b._toolbarIndex=d._toolbarIndex;b._toolbarOrder=d._toolbarOrder;this.selected===a&&(this.select(a),f(e).removeClass("selected"));d=this.currentX;this.currentX=0;this.setIconsSize(d)},_findIdx:function(a){for(var b=
this._widgets,d=0,e=b.length;d<e;++d)if(b[d]._toolbarIndex===a)return d;return null},_findWidget:function(a){return this._widgets[this._findIdx(a)]},removeByIdx:function(a){var b=this._findWidget(a);this.remove(b);this.layoutManager.remove(this.layoutManager.widgets.indexOf(b));this.selected===a&&(this.selected=-1,f(b.el).removeClass("selected"));return b},select:function(a){-1===a||null!==this._findIdx(a)?(this.oldSelection=this.selected,this.requestSelected=a,this.refresh()):p.error("[Toolbar] selected index is out of range")},
onRender:function(){-1!==this.oldSelection&&(f(this._findWidget(this.oldSelection).el).removeClass("selected"),-1===this.requestSelected&&(this.selected=-1));-1!==this.requestSelected&&(f(this._findWidget(this.requestSelected).el).addClass("selected"),this.selected=this.requestSelected);this.oldSelection=this.requestSelected=-1},setIconsSize:function(a){if(this.currentX!==a){this.calculatedOrientation=null;for(var b=this._widgets,d=0,e=b.length;d<e;++d){var k=b[d],f=k.dim;f.w=f.h=a;k.dim=f}this.currentX=
a;this.orientation===m.ORIENTATION.VERTICAL?this._dim.w=a:this._dim.h=a;this.dim=this._dim;this.layoutManager.refresh()}},getDim:function(){if(null!==this.calculatedOrientation&&this.calculatedOrientation===this.orientation)return this._dim;var a=this._dim.clone(),b=this._widgets;if(this.orientation===m.ORIENTATION.VERTICAL){this.layoutManager.align=m.DIRECTION.TOP;a.w=Number.MIN_VALUE;for(var d=0,e=b.length;d<e;++d){var k=b[d].dim;a.w=Math.max(k.w,a.w)}}else for(this.layoutManager.align=m.DIRECTION.LEFT,
a.h=Number.MIN_VALUE,d=0,e=b.length;d<e;++d)k=b[d].dim,a.h=Math.max(k.h,a.h);this._dim=a;this.calculatedOrientation=this.orientation;return a}});l.extend(b.prototype,n.Events);a.prototype=l.extend(Object.create(m.ContainerWidget.prototype),{onActivate:function(){this._closedSize=this.parentDim=null;this.toolbar.currentX=0;this.layoutManager.refresh()},isOpenDetached:function(){return 1===this._state&&this._openDetached},updatePanelAppearance:function(a,b){this._state!==k&&3!==this._state&&(this._openDetached!==
b&&(b?this.layoutManager.center=null:(this.layoutManager.center=this._panels[this._panelIdx],1===this._state&&this._updateDim(this._closedSize+this._openSize))),this.refresh());this._openSize=a;this._openDetached=b},setToolbarSize:function(a){this._closedSize!==a&&(this._closedSize=a,1===this._state?this._updateDisplaySize(a,this._openSize,this._panels[this._panelIdx]):this._updateDim(a),this.toolbar.setIconsSize(a))},onLayoutAttached:function(a,b){m.DomWidget.prototype.onLayoutAttached.call(this,
a,b);a===m.DIRECTION.LEFT?(this.layoutManager.left=this.toolbar,this.toolbar.orientation=m.ORIENTATION.VERTICAL):a===m.DIRECTION.RIGHT?(this.layoutManager.right=this.toolbar,this.toolbar.orientation=m.ORIENTATION.VERTICAL):(a===m.DIRECTION.TOP?this.layoutManager.top=this.toolbar:this.layoutManager.bottom=this.toolbar,this.toolbar.orientation=m.ORIENTATION.HORIZONTAL);this._updateDim(this._closedSize)},addPanel:function(a,b){this._panels.push(a);var d=a.icon;d.el.setAttribute("idx",this._panels.length-
1);a._toolbarIndex=this.toolbar.add(d,b)._toolbarIndex;a.on("change:icon",this.onPanelIconChanged,this);return a},removePanel:function(a){var b=this._panels.indexOf(a);this._reqPanelIdx===b&&(this._reqPanelIdx=-1);this._panelIdx===b&&(this.remove(a),this._panelIdx=-1,this.layoutManager.center=null,this._state=k);a.off("change:icon",this.onPanelIconChanged,this);this._panels=l.without(this._panels,a);this.toolbar.removeByIdx(a._toolbarIndex)},onPanelIconChanged:function(a,b){var d=this._panels.indexOf(a);
b.el.setAttribute("idx",d);this.toolbar.replace(a._toolbarIndex,b)},onRender:function(a,b){var d=this._panels;3===this._state?(this._startTime=b,this._state=2,this._changePanel(d)):4===this._state&&(this._startTime=b,this._state=5);if(1===this._state)this._changePanel(d),d=d[this._panelIdx],this._updateDisplaySize(this._closedSize,this._openSize,d);else if(2===this._state){var d=d[this._panelIdx],e=b-this._startTime,e=this._ease(Math.min(e/this._openDuration,1));this._updateDisplaySize(this._closedSize,
e*this._openSize,d);1===e?this._state=1:this.refresh()}else 5===this._state&&(d=d[this._panelIdx],e=b-this._startTime,e=this._ease(Math.min(e/this._openDuration,1)),this._updateDisplaySize(this._closedSize,this._openSize-this._openSize*e,d),1===e?this._state=k:this.refresh());this._state===k&&(-1!==this._panelIdx&&(null!==this._removedPanel?(this.remove(this._removedPanel),this._removedPanel=null):this.remove(this._panels[this._panelIdx]),this.layoutManager.center=null,this.toolbar.select(-1),this.broadcastEvent("SideToolbar:closed",
this,this._panels[this._panelIdx])),this._panelIdx=-1)},_changePanel:function(a){if(-1!==this._reqPanelIdx){l.each(a,function(a){a.lastOpened=!1});var b=null;-1!==this._panelIdx&&(b=a[this._panelIdx],this.remove(b));this._openDetached?(this.prepend(a[this._reqPanelIdx]),this.layoutManager.center=null):this.layoutManager.center=this.prepend(a[this._reqPanelIdx]);this._panelIdx=this._reqPanelIdx;this._reqPanelIdx=-1;a=this._panels[this._panelIdx];a.lastOpened=!0;this.broadcastEvent("SideToolbar:opened",
this,a)}},_ease:function(a){return m.EasingFunctions.easeInOutQuint(a)},_updateDisplaySize:function(a,b,d){this._openDetached?(this._updateDim(a),this._updatePanelDim(d,b)):this._updateDim(a+b)},_updateDim:function(a){var b;this._pos==m.DIRECTION.LEFT||this._pos==m.DIRECTION.RIGHT?(b=this._dim.w,b!==a&&(this._dim.w=a)):(b=this._dim.h,b!==a&&(this._dim.h=a));b!==a&&(this.dim=this._dim,this.trigger("size:change"),this.layoutManager.refresh())},_updatePanelDim:function(a,b){var d=a._dim;this._pos==m.DIRECTION.LEFT||
this._pos==m.DIRECTION.RIGHT?(d.w=b,d.x=this._closedSize,d.h=this._dim.h):(d.h=b,d.y=this._closedSize,d.w=this._dim.w);a.dim=a._dim},_onBarIconClicked:function(a){this.openPanel(parseInt(f(a.currentTarget).attr("idx"),10));"click"===a.type&&(a.preventDefault(),a.stopPropagation())},openPanel:function(a){this._panelIdx===a?this.closePanels():this._reqPanelIdx!==a&&(this.toolbar.select(this._panels[a]._toolbarIndex),this._state=3===this._state||1===this._state?1:3,this._reqPanelIdx=a,this.refresh(),
this.broadcastEvent("SideToolbar:open",this,a))},closePanels:function(){this._state!==k&&5!==this._state&&4!==this._state&&(this._state=4,this.refresh())},onSideToolbarOpened:function(a,b){a!==this&&this.closePanels()},onClosePanel:function(a){1===this._state&&this._panels[this._panelIdx]===a&&this.closePanels()},closePanelIfDetached:function(){1===this._state&&this._openDetached&&this.closePanels()}});l.extend(a.prototype,n.Events);e.prototype=l.extend(Object.create(m.ContainerWidget.prototype),
{setDim:function(a){null===this.parent||2!==this.parent._state&&5!==this.parent._state||(this.parent._pos===m.DIRECTION.LEFT?(a.x-=this.parent._openSize-a.w,a.w=this.parent._openSize):this.parent._pos===m.DIRECTION.RIGHT?a.w=this.parent._openSize:(this.parent._pos===m.DIRECTION.TOP&&(a.y-=this.parent._openSize-a.h),a.h=this.parent._openSize));m.ContainerWidget.prototype.setDim.call(this,a)},setIcon:function(a){this.icon=l.isElement(a)?new m.DomWidget(a):a;this.trigger("change:icon",this,this.icon)}});
l.extend(e.prototype,n.Events)})(r.ui,r.ui,r.log,r,Backbone,_,jQuery);(function(q,m,p){function h(){m.ContainerWidget.call(this);this.el.className="vitrium-closable-label";this.layoutManager=new m.HorizontalAlignLayout(this);this.label=this.add(new m.DomSizedWidget(document.createElement("div")));this.layoutManager.left=new m.LayoutMarginProxy(this.label,{left:10});this.button=this.layoutManager.right=new m.LayoutMarginProxy(this.add(new m.DomSizedWidget(document.createElement("div"))),{right:10});
this.button.widget.$el.html("<button class='btn' type='button'><i class='fa fa-times'></i></button>");this.button.widget.$el.find("button").on("tap click",_.bind(function(){this.broadcastEvent("action:ClosePanel",this.parent)},this));this.dim.h=32}function n(l,f){m.SidePanel.call(this,l);this.layoutManager=new m.BasicLayoutManager(this);this.label=this.layoutManager.top=this.add(new h);this.labelKey=f;p.on("language:changed",this.onLanguageChanged,this);this.onLanguageChanged()}q.LabeledSidePanel=
n;h.prototype=Object.create(m.ContainerWidget.prototype);h.prototype.onActivate=function(){this.listen(p,"language:changed",this.onLanguageChanged,this);this.onLanguageChanged()};h.prototype.onLanguageChanged=function(){this.button.widget.$el.find("button").attr("title",p._T("side-panel-close"))};n.prototype=Object.create(m.SidePanel.prototype);n.prototype.onLanguageChanged=function(){var l=p._T(this.labelKey);this.setLabel(l);this.setIconLabel(l)};n.prototype.setIconLabel=function(l){$(this.icon.el).attr("title",
l);$(this.icon.i).attr("title",l)};n.prototype.setLabel=function(l){this.label.label.$el.text(l)}})(r.ui,r.ui,r.i18n);(function(q,m){function p(){this.vScroll=new h.ScrollBar;this.hScroll=new h.ScrollBar;this.barThickness=20;this.viewport={width:0,height:0,innerWidth:0,innerHeight:0,contentWidth:0,contentHeight:0}}var h=q;q.ScrollableViewport=p;p.prototype={changeDimensions:function(h,l,f,b){var a=this.viewport;a.width=h;a.height=l;a.innerWidth=h;a.innerHeight=l;a.contentWidth=f;a.contentHeight=b;
var e=this.vScroll.changeDimensions(l,b),k=this.vScroll.visible;k&&(h-=this.barThickness,a.innerWidth=h);e=this.hScroll.changeDimensions(h,f)||e;this.hScroll.visible&&(l-=this.barThickness,a.innerHeight=l,e=this.vScroll.changeDimensions(l,b)||e,!k&&this.vScroll.visible&&(h-=this.barThickness,a.innerWidth=h,e=this.hScroll.changeDimensions(h,f)||e));return e},changeViewportDimensions:function(h,l){var f=this.viewport;return this.changeDimensions(h,l,f.contentWidth,f.contentHeight)},changeContentDimensions:function(h,
l){var f=this.viewport;return this.changeDimensions(f.width,f.height,h,l)},setScrollPos:function(h,l){var f=this.hScroll.changeContentPosition(h);return f=this.vScroll.changeContentPosition(l)||f},setVScrollPos:function(h){return this.vScroll.changeContentPosition(h)},setHScrollPos:function(h){return this.hScroll.changeContentPosition(h)},setVHandlePos:function(h){return this.vScroll.setHandlePosition(h)},setHHandlePos:function(h){return this.hScroll.setHandlePosition(h)},scrollRelative:function(h,
l){var f=!1;0!==h&&(f=this.hScroll.scrollRelative(h));0!==l&&(f=this.vScroll.scrollRelative(l)||f);return f}}})(r.ui,r.geometry);(function(q,m,p,h,n){function l(f,b){m.DomWidget.call(this,document.createElement("div"));this.el.className="vitrium-list-view";this.$el=p(this.el);this.model=f;this.renderItem=b?b:null;this.hammer=p.browser.chrome?new Hammer(this.el,{stop_browser_behavior:{touchAction:""}}):new Hammer(this.el);this.hammer.on("tap",h.bind(this.onTap,this)).on("doubletap",h.bind(this.onDoubleTap,
this));this.hammer.on("dragend",function(){setTimeout(function(){0!==p(window).scrollTop()&&p(window).scrollTop(0)},0)});this.preventDefaultMouseBehavior=!0}q.ListView=l;l.prototype=Object.create(m.DomWidget.prototype);l.prototype.onActivate=function(){this.listen(this.model,"changed",this.refresh,this).listen(this.$el,"mousedown",".vitrium-list-item",h.bind(this.onListItemClicked,this)).listen(this.$el,"dblclick",".vitrium-list-item",h.bind(this.onDoubleClicked,this));this.refresh()};l.prototype.handleButton=
function(f){f=p(f.target);f.is("[data-action],button")||(f=f.parents("[data-action],button"),0===f.length&&(f=null));if(null!==f){var b=f.parents(".vitrium-list-item");if(1===b.length){var b=parseInt(b.attr("idx"),10),a=f.attr("data-action");this.trigger("button:clicked",this.model.getItem(b),b,f);h.isEmpty(a)||this.trigger("action:"+a,this.model.getItem(b),b,f);return!0}}return!1};l.prototype.onDoubleClicked=function(f){f.preventDefault();f.stopPropagation();f=p(f.currentTarget).attr("idx");f=parseInt(f,
10);this.trigger("item:doubleclicked",this.model.getItem(f),f,this,!1)};l.prototype.onDoubleTap=function(f){f=this.getItemIdx(f);null!==f&&this.trigger("item:doubleclicked",this.model.getItem(f),f,this,!0)};l.prototype.onTap=function(f){this.handleButton(f)||(f=this.getItemIdx(f),null!==f&&this.trigger("item:clicked",this.model.getItem(f),f,this,!0))};l.prototype.getItemIdx=function(f){var b=p(f.target).parents(".vitrium-list-item"),a=null;1===b.length?(a=b.attr("idx"),a=parseInt(a,10)):-1!==f.target.className.indexOf("vitrium-list-item")&&
(a=p(f.target).attr("idx"),a=parseInt(a,10));return a};l.prototype.onListItemClicked=function(f){this.preventDefaultMouseBehavior&&"mousedown"===f.type&&(f.preventDefault(),f.stopPropagation());this.handleButton(f)||(f=p(f.currentTarget).attr("idx"),f=parseInt(f,10),this.trigger("item:clicked",this.model.getItem(f),f,this,!1))};l.prototype.onRender=function(){for(var f=this.$el.find(".vitrium-list-item").attr("class","vitrium-list-item").empty(),b=this.model.getLength(),a=0;a<b;++a){var e=this.model.getItem(a),
k=p(f[a]);0===k.length&&(k=p("<div class='vitrium-list-item'>").attr("idx",a));null!==this.renderItem?this.renderItem(k,e,a):k.text(e.toString());this.$el.append(k)}a=b;for(b=f.length;a<b;++a)p(f[a]).remove()};h.extend(l.prototype,n.Events)})(r.ui,r.ui,jQuery,_,Backbone);(function(q,m,p,h,n,l,f){function b(b){h.DomSizedWidget.call(this,document.createElement("div"));this.$el.addClass("vitrium-SyncDisplay");this.$el.append("<div class='error-display'><i class='fa fa-refresh'></i><span class='msg'>"+
n._T("sync-display-error"+(r.is_mobile?"-mobile":"-desktop"))+"</span></div>");this.$el.append("<div class='sync-display'><i class='fa fa-refresh'></i></div>");this.$el.append("<div class='synced-display'><i class='fa fa-check'></i></div>");this._synchronizationService=b;this._runner=new a(1E3);this._hideAfterDelay=null;this._userTriggered=!1;this._lastState=null}function a(a){this._minTime=a;this._queue=[];this._lastExec=this._current=null}var e=m.STATES;e.get("READY");e.declare("SYNC_ERROR_SHONW");
q.SyncDisplay=b;e=["vst-synchronized","vst-synchronizing","vst-error"];b.prototype=Object.create(h.DomSizedWidget.prototype);b.prototype.onActivate=function(){h.DomSizedWidget.prototype.onActivate.call(this,arguments);this.listen(this._synchronizationService,"sync:state",this.onSyncStateChanged,this);this.listen(this.$el,"mousemove",function(a){a.stopPropagation();a.preventDefault()});this.listen(this.$el,"mouseenter",l.bind(function(a){this.parent.trigger("mouseleave",a)},this));this.listen(this._parent,
"tap",l.bind(function(a){if(2===this._lastState){if(a.target===this.el||0!==f(a.target).parents(".vitrium-SyncDisplay").length)return this.trySync(!0)||this._showMessage(),!0;this._hideMessage();return!1}},this),-10);this.listen(this.$el,"click",l.bind(function(a){2===this._lastState&&(a.stopPropagation(),a.preventDefault(),this.trySync(!1))},this))};b.prototype.trySync=function(a){this._runner.clear();if(this.$el.hasClass("show-msg")||!a&&this.$el.has(":hover"))return p.debug("[SyncDisplay] trySync executed"),
this._synchronizationService.trySync(),this._userTriggered=!0;p.debug("[SyncDisplay] trySync not executed");return!1};b.prototype.onSyncStateChanged=function(a){this._lastState=a;p.debug("[SyncDisplay] onSyncStateChanged ",e[a]);null!==this._hideAfterDelay&&clearTimeout(this._hideAfterDelay);0===a&&(this.$el.has("failed")&&(this._hideAfterDelay=setTimeout(l.bind(function(){this.$el.removeClass("failed")},this),3E3)),this.$el.removeClass("show-msg"),this._userTriggered=!1);1===a&&this.$el.removeClass("show-msg");
var b=this.$el.hasClass("failed");2===a&&this.$el.addClass("failed");this.$el.hasClass("failed")&&this._runner.run(l.bind(function(){this.$el.hasClass(e[a])||(l.each(e,function(b,c){c!==a&&this.$el.removeClass(b)},this),this.$el.addClass(e[a]),2!=a||!this._userTriggered&&b||(this._showMessage(),this._userTriggered=!1,this._hideAfterDelay=setTimeout(l.bind(function(){this.$el.removeClass("show-msg")},this),3E3)))},this))};b.prototype._showMessage=function(){this.$el.addClass("show-msg")};b.prototype._hideMessage=
function(){this.$el.removeClass("show-msg")};a.prototype.clear=function(){clearTimeout(this._current);this._lastExec=this._current=null;this._queue.length=0};a.prototype.run=function(a,b){this._queue.push({task:l.bind(function(){a();this._current=null;this._lastExec=Date.now();this._exec()},this),time:b||this._minTime});null===this._current&&this._exec()};a.prototype._exec=function(){var a=this._queue.shift();if(a)if(null===this._lastExec)this._current=setTimeout(a.task,1);else{var b=Date.now()-this._lastExec,
g=a.time,g=b>g?1:g-b;p.debug("Time: ",g,a.time);this._current=setTimeout(a.task,g)}}})(r.ui,r.viewer,r.log,r.ui,r.i18n,_,jQuery);(function(q){function m(m){this._minimumHandleSize=m||20;this._contentSize=this._viewportSize=0;this.handleSize=m;this.procentualContentPosition=this.contentPosition=this.handlePosition=0;this.visible=!1}q.ScrollBar=m;m.prototype={changeDimensions:function(m,h){h-=m;if(this._viewportSize===m&&this._contentSize===h)return!1;this._viewportSize=m;this._contentSize=h;if(1>h)this.procentualContentPosition=
this.contentPosition=this.handlePosition=0,this.visible=!1;else{var n;n=h/m+1;this.handleSize=Math.max(this._minimumHandleSize,m/n);this.visible=!0;this.changeProcentualContentPosition(this.procentualContentPosition)}return!0},changeProcentualContentPosition:function(m){if(!this.visible)return!1;m=Math.max(Math.min(100,m),0);this.contentPosition=m*this._contentSize;this.handlePosition=this._viewportSize*m-m*this.handleSize;if(m===this.procentualContentPosition)return!1;this.procentualContentPosition=
m;return!0},changeContentPosition:function(m){if(!this.visible||this.contentPosition===m)return!1;m=this.contentPosition=Math.min(Math.max(0,m),this._contentSize);return this.changeProcentualContentPosition(m/this._contentSize)},scrollRelative:function(m){return this.changeContentPosition(this.contentPosition+m)},setHandlePosition:function(m){var h=this._viewportSize-this.handleSize;m=Math.max(Math.min(m,h),0);return this.changeProcentualContentPosition(m/h)}}})(r.ui);(function(q,m){function p(h,
n,l){this._callback=m.bind(function(){h(this._arg);this._arg=null},this);this._preserveFirst=l;this._delay=n;this._timer=0;this._arg=null}q.DelayTask=p;p.prototype={execute:function(h){this._preserveFirst&&!this._arg?this._arg=h:this._preserveFirst||(this._arg=h);clearTimeout(this._timer);this._timer=setTimeout(this._callback,this._delay)},cancel:function(){clearTimeout(this._timer);this._timer=0;this._arg=null},destroy:function(){clearTimeout(this._timer);this._timer=0;this._arg=this._callback=null}}})(r.ui,
_);(function(q){function m(m,h,n){this._el=m;this._preprocessor=h?h:null;this._max=n||10;this._cache=[]}q.DOMElementPool=m;m.prototype={create:function(){var m=this._cache;return 0===m.length?(m=document.createElement(this._el),this._preprocessor(m),m):m.pop()},free:function(m){var h=this._cache;h.length<this._max&&h.push(m)}}})(r.ui);(function(q){function m(m){this.userdata=m?m:null;this._queue=[];this._backingQueue=[]}q.SingleInstanceTaskQueue=m;m.prototype={destroy:function(){this._queue=this.userdata=
null},execute:function(){var m=this._queue;this._queue=this._backingQueue;this._backingQueue=m;for(var h=this.userdata,n=0,l=m.length;n<l;++n)m[n](h);m.length=0},cancel:function(){this._queue.length=0},push:function(m){for(var h=this._queue,n=0,l=h.length;n<l;++n)if(h[n]===m)return!1;h.push(m);return!0}}})(r.ui);(function(q){function m(n,l,f,b){this.mMode=h;this.mStartX=this.mStartY=this.mFinalX=this.mFinalY=this.mMinX=this.mMaxX=this.mMinY=this.mMaxY=this.mCurrX=this.mCurrY=this.mStartTime=this.mDuration=
this.mDurationReciprocal=this.mDeltaX=this.mDeltaY=this.mViscousFluidScale=this.mViscousFluidNormalize=0;this.mFinished=!1;this.mCoeffX=0;this.mCoeffY=1;this.mVelocity=0;this.mDeceleration=61732.16*n*l;this.mInterpolator=f;this.mTimeFunct=b}function p(){this.mPastX=[0,0,0,0,0,0,0,0,0,0];this.mPastY=[0,0,0,0,0,0,0,0,0,0];this.mPastTime=[0,0,0,0,0,0,0,0,0,0];this.mXVelocity=this.mYVelocity=0}q.KineticScroller=m;q.VelocityTracker=p;var h=0;q.DIRECTION_HORIZONTAL=0;q.DIRECTION_VERTICAL=1;m.prototype=
{computeScrollOffset:function(){if(this.mFinished)return!1;var n=this.mTimeFunct()-this.mStartTime;if(n<this.mDuration)switch(this.mMode){case h:n*=mDurationReciprocal;n=null===mInterpolator?this.viscousFluid(n):this.mInterpolator(n);this.mCurrX=this.mStartX+Math.round(n*this.mDeltaX);this.mCurrY=this.mStartY+Math.round(n*this.mDeltaY);this.mCurrX===this.mFinalX&&this.mCurrY===this.mFinalY&&(this.mFinished=!0);break;case 1:n/=1E3,n=this.mVelocity*n-this.mDeceleration*n*n/2,this.mCurrX=this.mStartX+
Math.round(n*this.mCoeffX),this.mCurrX=Math.min(this.mCurrX,this.mMaxX),this.mCurrX=Math.max(this.mCurrX,this.mMinX),this.mCurrY=this.mStartY+Math.round(n*this.mCoeffY),this.mCurrY=Math.min(this.mCurrY,this.mMaxY),this.mCurrY=Math.max(this.mCurrY,this.mMinY),this.mCurrX===this.mFinalX&&this.mCurrY===this.mFinalY&&(this.mFinished=!0)}else this.mCurrX=this.mFinalX,this.mCurrY=this.mFinalY,this.mFinished=!0;return!0},startScroll:function(n,l,f,b,a){4===arguments.length&&(this.duration=250);this.mMode=
h;this.mFinished=!1;this.mDuration=a;this.mStartTime=this.mTimeFunct();this.mStartX=n;this.mStartY=l;this.mFinalX=n+f;this.mFinalY=l+b;this.mDeltaX=f;this.mDeltaY=b;this.mDurationReciprocal=1/this.mDuration;this.mViscousFluidScale=8;this.mViscousFluidNormalize=1;this.mViscousFluidNormalize=1/this.viscousFluid(1)},fling:function(h,l,f,b,a,e,k,c){this.mMode=1;this.mFinished=!1;var g=Math.sqrt(f*f+b*b);this.mVelocity=g;this.mDuration=1E3*g/this.mDeceleration;this.mStartTime=this.mTimeFunct();this.mStartX=
h;this.mStartY=l;this.mCoeffX=0==g?1:f/g;this.mCoeffY=0==g?1:b/g;f=g*g/(2*this.mDeceleration);this.mMinX=a;this.mMaxX=e;this.mMinY=k;this.mMaxY=c;this.mFinalX=h+Math.round(f*this.mCoeffX);this.mFinalX=Math.min(this.mFinalX,this.mMaxX);this.mFinalX=Math.max(this.mFinalX,this.mMinX);this.mFinalY=l+Math.round(f*this.mCoeffY);this.mFinalY=Math.min(this.mFinalY,this.mMaxY);this.mFinalY=Math.max(this.mFinalY,this.mMinY)},viscousFluid:function(h){h*=this.mViscousFluidScale;1>h?h-=1-Math.exp(-h):(h=1-Math.exp(1-
h),h=0.36787944117+h*(1-0.36787944117));return h*=this.mViscousFluidNormalize},abortAnimation:function(){this.mCurrX=this.mFinalX;this.mCurrY=this.mFinalY;this.mFinished=!0},extendDuration:function(h){this.mDuration=this.mTimeFunct()-this.mStartTime+h;this.mDurationReciprocal=1/this.mDuration;this.mFinished=!1},setFinalX:function(h){this.mFinalX=h;this.mDeltaX=this.mFinalX-this.mStartX;this.mFinished=!1},setFinalY:function(h){this.mFinalY=h;this.mDeltaY=this.mFinalY-this.mStartY;this.mFinished=!1}};
p.prototype={addMovement:function(h,l,f){for(var b=0,a=-1,e=this.mPastTime;10>b&&0!==e[b];++b)e[b]<f-200&&(a=b);10===b&&0>a&&(a=0);a===b&&a--;var k=this.mPastX,c=this.mPastY;if(0<=a){for(var g=a+1,d=10-a-1,m=0;m<d;++m)k[m]=k[m+g],c[m]=c[m+g],e[m]=e[m+g];b-=a+1}k[b]=h;c[b]=l;e[b]=f;b++;10>b&&(e[b]=0)},computeDirection:function(){for(var h=this.mPastX,l=this.mPastY,f=this.mPastTime,b=0;10>b&&0!=f[b];)++b;if(2>b)return null;for(var a=0,f=0,e=1,k=b;e<k;++e)a+=Math.abs(h[e-1]-h[e]),f+=Math.abs(l[e-1]-
l[e]);h=a/b;b=f/b;if(0===h&&0<b)return 1;if(0<h&&0===b)return 0;if(h===b)return null;b=h/b;return 0.5<b&&1.5>b?null:2<=b?0:1},computeCurrentVelocity:function(h,l){for(var f=this.mPastX,b=this.mPastY,a=this.mPastTime,e=f[0],k=b[0],c=a[0],g=0,d=0,m=0;10>m&&0!=a[m];)m++;3<m&&m--;for(var p=1;p<m;p++){var v=a[p]-c;if(0!==v)var q=f[p]-e,q=q/v*h,g=0==g?q:0.5*(g+q),q=b[p]-k,q=q/v*h,d=0==d?q:0.5*(d+q)}this.mXVelocity=0>g?Math.max(g,-l):Math.min(g,l);this.mYVelocity=0>d?Math.max(d,-l):Math.min(d,l)}}})(r.ui);
(function(q,m){function p(h){this.maxDimensionFunct=h}q.TilesCalculator=p;p.prototype={calculateTiles:function(h,n){var l=this.maxDimensionFunct();if(l.w<h.w||l.h<h.h){var f=this._calculatePivotRectangle(h,n,l),b=[f],a=this._createLeft(f,h),e=this._createRight(f,h),k=this._createTop(f,a,e,h),f=this._createBottom(f,a,e,h);this._splitToResult(b,a,l);this._splitToResult(b,e,l);this._splitToResult(b,k,l);this._splitToResult(b,f,l);return b}return[new m.Rectangle(0,0,h.w,h.h,0)]},_createLeft:function(h,
n){return 0<h.x?new m.Rectangle(0,0,h.x,n.h,0):null},_createRight:function(h,n){var l=h.x+h.w;return l<n.w?new m.Rectangle(l,0,n.w-l,n.h,0):null},_createTop:function(h,n,l,f){return 0<h.y?(n=null===n?0:n.x+n.w,new m.Rectangle(n,0,null===l?f.w-n:f.w-l.w-n,h.y,0)):null},_createBottom:function(h,n,l,f){h=h.y+h.h;return h<f.h?(n=null===n?0:n.x+n.w,new m.Rectangle(n,h,null===l?f.w-n:f.w-l.w-n,f.h-h,0)):null},_splitToResult:function(h,n,l){if(null!==n){if(n.w<=l.w&&n.h<=l.h)return h.push(n);var f=n.w/l.w+
(0<n.w%l.w?1:0)|0,b=n.h/l.h+(0<n.h%l.h?1:0)|0,a=Math.min(l.w,n.w);l=Math.min(l.h,n.h);for(var e=f-1,k=b-1,c=0;c<f;++c){var g=c*a,d=a;c===e&&(d-=g+a-n.w);for(var t=0;t<b;++t){var p=t*l,v=l;t===k&&(v-=p+l-n.h);h.push(new m.Rectangle(n.x+g,n.y+p,d,v,0))}}}},_calculatePivotRectangle:function(h,n,l){var f=h.intersectWithZeroAngle(n);n=h.getEndPoint();var b=f.getCenterPoint(),a=l.w/2,e=l.h/2,f=b.x+a;l=b.y+e;b=m.Rectangle.createFromCoordinates(b.x-a,b.y-e,f,l);a=0;0>b.x&&f>n.x?(b.x=0,b.w=h.w):0>b.x?a=-b.x:
f>n.x&&(a=n.x-f);f=0;0>b.y&&l>n.y?(b.y=0,b.h=h.h):0>b.y?f=-b.y:l>n.y&&(f=n.y-l);b.move(a,f);b.x=Math.max(b.x,0);b.y=Math.max(b.y,0);b.w=Math.min(b.w,h.w);b.h=Math.min(b.h,h.h);b.x|=0;b.y|=0;b.w|=0;b.h|=0;return b}}})(r.ui,r.geometry2);(function(q,m){var p=[].slice;q.Events={on:function(f,b,a,e){if(!n(this,"on",f,[b,a])||!b)return this;this._events||(this._events={});var k=this._events[f]||(this._events[f]=[]);k.push({callback:b,context:a,ctx:a||this,order:4===arguments.length?e:0,idx:k.length});k.sort(function(a,
b){return a.order===b.order?a.idx-b.idx:a.order-b.order});return this},once:function(f,b,a,e){if(!n(this,"once",f,[b,a])||!b)return this;var k=this,c=m.once(function(){k.off(f,c);b.apply(this,arguments)});c._callback=b;return this.on(f,c,a,e)},off:function(f,b,a){var e,k,c,g,d,h,l,p;if(!this._events||!n(this,"off",f,[b,a]))return this;if(!f&&!b&&!a)return this._events=void 0,this;g=f?[f]:m.keys(this._events);d=0;for(h=g.length;d<h;d++)if(f=g[d],c=this._events[f]){this._events[f]=e=[];if(b||a)for(l=
0,p=c.length;l<p;l++)k=c[l],(b&&b!==k.callback&&b!==k.callback._callback||a&&a!==k.context)&&e.push(k);e.length||delete this._events[f]}return this},trigger:function(f){if(!this._events)return this;var b=p.call(arguments,1);if(!n(this,"trigger",f,b))return this;var a=this._events[f],e=this._events.all;a&&l(a,b);e&&l(e,arguments);return this},stopListening:function(f,b,a){var e=this._listeningTo;if(!e)return this;var k=!b&&!a;a||"object"!==typeof b||(a=this);f&&((e={})[f._listenId]=f);for(var c in e)f=
e[c],f.off(b,a,this),(k||m.isEmpty(f._events))&&delete this._listeningTo[c];return this}};var h=/\s+/,n=function(f,b,a,e){if(!a)return!0;if("object"===typeof a){for(var k in a)f[b].apply(f,[k,a[k]].concat(e));return!1}if(h.test(a)){a=a.split(h);k=0;for(var c=a.length;k<c;k++)f[b].apply(f,[a[k]].concat(e));return!1}return!0},l=function(f,b){var a,e=-1,k=f.length,c=b[0],g=b[1],d=b[2],h=!1;switch(b.length){case 0:for(;++e<k&&!h;)h=!!(a=f[e]).callback.call(a.ctx);break;case 1:for(;++e<k&&!h;)h=!!(a=f[e]).callback.call(a.ctx,
c);break;case 2:for(;++e<k&&!h;)h=!!(a=f[e]).callback.call(a.ctx,c,g);break;case 3:for(;++e<k&&!h;)h=!!(a=f[e]).callback.call(a.ctx,c,g,d);break;default:for(;++e<k&&!h;)h=!!(a=f[e]).callback.apply(a.ctx,b)}}})(r.ui,_);(function(q,m){function p(h,n,l,f){return new m.Point(h.x+f/l*n.x,h.y+f/l*n.y)}q.createHitTestCanvasContext=function(){var h=document.createElement("canvas").getContext("2d");"isPointInStroke"in h||(h._moveTo=h.moveTo,h._lineTo=h.lineTo,h._closePath=h.closePath,h._beginPath=h.beginPath,
h._firstPoint=null,h.beginPath=function(){this._firstPoint=null;this._beginPath()},h.moveTo=function(h,l){this._lastPoint=new m.Point(h,l);null===this._firstPoint&&(this._firstPoint=this._lastPoint)},h.lineTo=function(h,l){var f=this.lineWidth/2,b=this._lastPoint,a=new m.Point(h,l),e=b.distance(a),k=new m.Point(a.x-b.x,a.y-b.y),k=new m.Point(k.y,-k.x),c=new m.Point(b.x-a.x,b.y-a.y),g=new m.Point(c.y,-c.x);new m.Point(b.x-a.x,b.y-a.y);var c=p(b,k,e,f),d=p(a,g,e,-f),g=p(a,g,e,f),f=p(b,k,e,-f);this._moveTo(c.x,
c.y);this._lineTo(d.x,d.y);this._lineTo(g.x,g.y);this._lineTo(f.x,f.y);this._closePath();this._lastPoint=a;null===this._firstPoint&&(this._firstPoint=this._lastPoint)},h.closePath=function(){null!==this._firstPoint&&this.lineTo(this._firstPoint.x,this._firstPoint.y)},h.isPointInStroke=function(h,l){return this.isPointInPath(h,l)});return h}})(r.ui,r.geometry);(function(q,m,p,h,n,l){function f(b,a,e,k){m.DomSizedWidget.call(this,document.createElement("div"));this.el.className="vitrium-choice-selector";
this.model=b;this.itemRenderer=a;this.itemName=e;this.itemListName=e+"List";this.itemListChanged=!0;this.onRenderCallback=k?k:null;this.reqSelection=this.model.get(this.itemName);this.lastMouseIdx=this.mouseDownIdx=this.selectedIdx=null;this.$el.on("tap click",".vitrium-choice",h.bind(this.onChoiceClicked,this));this.$el.on("mousedown",".vitrium-choice",h.bind(this.onMouseDown,this));this.$el.on("mouseleave",".vitrium-choice",h.bind(this.onMouseLeave,this));this.$el.on("mouseenter",".vitrium-choice",
h.bind(this.onMouseEnter,this));this.onMouseUpHandler=h.bind(function(){this.lastMouseIdx=null},this);this.refresh();this.$document=n(document)}q.ChoiceSelector=f;f.prototype=h.extend(Object.create(m.DomSizedWidget.prototype),{onActivate:function(){this.listen(this.model,"change:"+this.itemName,this.onSelectionChanged,this).listen(this.model,"change:"+this.itemListName,this.onItemsChanged,this).listen(this.$document,"mouseup",this.onMouseUpHandler).listen(l,"language:changed",this.onItemsChanged,
this);this.onItemsChanged();this.onSelectionChanged(this.model,this.model.get(this.itemName))},onMouseEnter:function(b){var a=parseInt(n(b.currentTarget).attr("idx"),10);if(this.lastMouseIdx===a)this.onMouseDown(b)},onMouseDown:function(b){this.lastMouseIdx=this.mouseDownIdx=parseInt(n(b.currentTarget).attr("idx"),10);this.refresh()},onMouseLeave:function(b){this.mouseDownIdx=null;this.refresh()},onChoiceClicked:function(b){this.mouseDownIdx=null;b=parseInt(n(b.currentTarget).attr("idx"),10);this.model.set(this.itemName,
b);this.model.trigger("click:"+this.itemName,this.model,b)},onItemsChanged:function(){this.itemListChanged=!0;this.refresh()},onSelectionChanged:function(b,a){this.reqSelection=a;this.refresh()},onRender:function(b,a){this.$el.find(".vitrium-choice.mousedown").removeClass("mousedown");null!==this.mouseDownIdx&&this.$el.find(".vitrium-choice[idx='"+this.mouseDownIdx+"']").addClass("mousedown");this.itemListChanged&&(this.$el.empty(),h.each(this.model.get(this.itemListName),function(a,b){this.itemRenderer(n("<div class='vitrium-choice'>").appendTo(this.$el).attr("idx",
b),a,b)},this),this.itemListChanged=!1,this.trigger("size:change"));null!==this.reqSelection&&(null!==this.selectedIdx&&this.$el.find(".vitrium-choice[idx='"+this.selectedIdx+"']").removeClass("selected"),this.$el.find(".vitrium-choice[idx='"+this.reqSelection+"']").addClass("selected"),this.selectedIdx=this.reqSelection,this.reqSelection=null);if(null!==this.onRenderCallback)this.onRenderCallback(b,a)}});h.extend(f.prototype,p.Events)})(r.ui,r.ui,Backbone,_,jQuery,r.i18n);(function(q,m){function p(){m.DomSizedWidget.call(this,
document.createElement("div"));this.el.className="vitrium-bubble";this.el.innerHTML="<div class='vitrium-bubble-content'></div>";this._content=null}q.Bubble=p;p.prototype=Object.create(m.DomSizedWidget.prototype);p.prototype.updateContent=function(h){return this._content!==h?(this.$el.find(".vitrium-bubble-content").text(h),!0):!1}})(r.ui,r.ui);(function(q){function m(f,b){this._options=b||{horizontalSeparator:30,verticalSepartor:30};this.boundingBox=this._ranges=null;f&&this.attachPages(f);this._cachedIt=
new p(this.boundingBox,this._ranges,0,0,this._options.horizontalSeparator);this._cachedViewportPages=[]}function p(f,b,a,e,k){this._itPage=new h;this._boundingBox=f;this._ranges=b;this._viewportHeight=e;this._rangeOutput=new n(0,0,0);this._horizontalSeparator=k;this._scrollY=a;this._rI=this._i=this._y=0;this._result=l}function h(){this.height=this.width=this.y=this.x=this.number=0}function n(f,b,a){this.width=b;this.height=a;this.start=f;this.length=1;this.totalHeight=null}var l=0;q.SequentialPageLayout=
m;m.prototype={attachPages:function(f){for(var b=n,a=this._ranges=[],e=null,k=0,c=f.length;k<c;++k){var g=f[k];e&&e.tryAdd(g.width,g.height)||(e=new b(k,g.width,g.height),a.push(e))}this.boundingBox=this.computeDocumentBoundingBox()},queryPages:function(f,b,a,e){f=this._cachedIt;p.call(f,this.boundingBox,this._ranges,b,e,this._options.horizontalSeparator);return f},visiblePages:function(f,b,a,e){var k=this._cachedViewportPages,c=0;f=this.queryPages(f,b,a,e);for(b=null;f.hasNext();)b=f.next(),k[c]=
b.number,++c;k.length=c;return k},getCurrentPageNumber:function(f,b,a,e){var k=0,c=null,g=Math.min;f=this.queryPages(f,b,a,e);for(a=null;f.hasNext();){a=f.next();var d=a.y-b,d=0>d?d+a.height:g(e-d,a.height);if(null!==c){if(d>c)return a.number;break}c=d;k=a.number}return k},getPage:function(f){for(var b=this.queryPages(0,0,this.boundingBox.width,this.boundingBox.height);b.hasNext();){var a=b.next();if(a.number===f)return a}return null},computeDocumentBoundingBox:function(){for(var f=this._ranges,b=
{width:0,height:0},a={width:0,height:0},e=this._options.horizontalSeparator,k=this._options.verticalSepartor,c=Math.max,g=0,d=f.length;g<d;++g)f[g].fillBoundingBox(b,e,k),a.width=c(a.width,b.width),a.height+=b.height;a.height+=k;return a}};p.prototype={hasNext:function(){var f=this._viewportHeight,b=this._horizontalSeparator,a=this._scrollY,e=this._ranges,k=this._rangeOutput,c=this._result;if(c===l){for(var g=this._y,d=this._i,h=e.length;d<h&&(c=e[d].fillVisibleRange(k,a,g,f-b,b),g+=k.totalHeight,
2!==(c&2)&&1!==(c&1));++d);this._i=d+1;this._rI=0;this._y=g;this._result=c;return 1===(c&1)}if(1===(c&1)){if(k.start+this._rI<k.start+k.length)return!0;if(2===(c&2))return!1;this._result=l;return this.hasNext()}},next:function(){if(1===(this._result&1)){var f=this._itPage,b=this._boundingBox.width,a=this._rangeOutput,e=this._horizontalSeparator;f.number=a.start+this._rI++;f.width=a.width;f.height=a.height;f.y=this._y+e;f.x=b/2-f.width/2;this._y=f.y+f.height;return f}throw Error("You have to call has next first!");
}};n.prototype={tryAdd:function(f,b){return f===this.width&&b===this.height?(++this.length,!0):!1},fillBoundingBox:function(f,b,a){var e=this.length;f.height=this.height*e+b*e;f.width=this.width+2*a},fillVisibleRange:function(f,b,a,e,k){var c=this.length,g=this.height*c+k*c,c=l,d=b-a;e=d+e;f.height=this.height;f.width=this.width;a+g<=b?(f.start=this.start,f.length=this.length,f.totalHeight=g):0>e?c=2:(b=this.height+k,a=f.start=Math.max(this.start+d/b|0,this.start),k=Math.max(Math.min(this.start+e/
b|0,this.start+this.length-1),this.start),f.length=k-a+1,f.totalHeight=b*(a-this.start),c=1,k+1<this.start+this.length&&(c|=2));return c}}})(r.viewer);(function(q,m,p,h,n,l,f,b,a){function e(a){p.DomWidget.call(this,document.createElement("div"));this.el.className="page-container scroll-master";this.viewer=a;this._uiRender.cancel();this.scrollableViewport=new p.ScrollableViewport;this.pageLayoutManager=new m.viewer.SequentialPageLayout;this.viewportDOMOffset=new c(0,0);this.pageElements={};this.resizeAfterUnlock=
!1;this.uiCalculateViewport=new p.UISync(this.calculateFrameViewport,this,-10);this._uiRender.p=10;this.markPagesDirty=!1;this.beforeFrameSynchronizedTasks=new p.SingleInstanceTaskQueue;this.afterFrameSynchronizedTasks=new p.SingleInstanceTaskQueue;this.horizontalScrollBarHandleEl=this.verticalScrollBarHandleEl=this.horizontalScrollBar=this.verticalScrollBar=null;this.pagesAttached=!1;this.pageElCache=new p.DOMElementPool("div",function(a){a.className="page"},10);this.tmpPoint=new c(0,0);this.tmpRectangle1=
new g(0,0,0,0,0,null);this.tmpRectangle2=new g(0,0,0,0,0,null);this.tmpDUVieportState={scrollX:0,scrollY:0,width:0,height:0,centerHorizontalConstant:0};this.createScrollBars();this.events.on("PageCanvasManager:contentChanged",this.refresh)}function k(a,b,c,g,e,k,f,h,l,m){this.init(a,b,c,g,e,k,f,h);this.baseRect=new n.Rectangle(0,0,0,0,0);this.viewportRect=new n.Rectangle(0,0,0,0,0);this.initQueryRectangles(k,f,l,m)}var c=m.geometry.Point,g=m.geometry2.DataRectangle;q.ScrollMasterDocumentRenderer=
e;q.PageInfo=k;q=m.viewer.STATES;q.get("READY");q.get("LOCKED");e.prototype=l.extend(Object.create(p.DomWidget.prototype),{destroy:function(){m.log.debug("document renderer destroy");this.pageElCache=this.pageElements=this.pages=null;this._uiRender.cancel()},createScrollBars:function(){var a=f("<div class='sb sb-vertical'><div class='sb-handle'></div></div>"),b=f("<div class='sb sb-horizontal'><div class='sb-handle'></div></div>");this.verticalScrollBarEl=a[0];this.horizontalScrollBarEl=b[0];this.verticalScrollBarHandleEl=
a.find(".sb-handle")[0];this.horizontalScrollBarHandleEl=b.find(".sb-handle")[0]},setViewportDimensions:function(a,b){this.scrollableViewport.changeViewportDimensions(a,b)},setPages:function(a){this._uiRender.resume();this.pageLayoutManager.attachPages(a);this.pagesAttached=!0;this.onViewportChanged(!1)},computeScale:function(){var a=this.scrollableViewport.viewport;return this.calcScale(a.width,a.height)},getDUViewportState:function(){var a=this.tmpDUVieportState,b=this.scrollableViewport,c=this.viewer.scale,
g=b.hScroll.contentPosition/c,e=b.vScroll.contentPosition/c,k=b.viewport.innerWidth/c,b=b.viewport.height/c,c=this.pageLayoutManager.boundingBox.width,f=0;c<k&&(f=k/2-c/2);a.scrollX=g;a.scrollY=e;a.width=k;a.height=b;a.centerHorizontalConstant=f;return a},viewportPages:function(){var a=this.getDUViewportState();return this.pageLayoutManager.visiblePages(a.scrollX,a.scrollY,a.width,a.height)},calcScale:function(a,b){var c=this.pageLayoutManager.boundingBox,g=this.viewer.limitScale(a/c.width);this.scrollableViewport.changeDimensions(a,
b,c.width*g,c.height*g);var e=this.scrollableViewport.viewport.innerWidth;e!==a&&(g=this.viewer.limitScale(e/c.width),this.scrollableViewport.changeDimensions(a,b,c.width*g,c.height*g));return g},calculateFrameViewport:function(a){var b=a.pages;b||(b=a.pages=[]);var c=this.scrollableViewport,g=c.hScroll.contentPosition,e=c.vScroll.contentPosition,f=this.getDUViewportState(),h=f.scrollX,l=f.scrollY,n=f.width,m=f.height;a=a.scale=this.viewer.scale;for(var p=f.centerHorizontalConstant*a,f=f.centerHorizontalConstant,
q=this.pageLayoutManager.queryPages(h,l,n,m),r=0,C=b.length;q.hasNext();){var J=q.next();if(r<C){var O=b[r];O.init(J,f,h,l,p,g,e,a);O.initQueryRectangles(g,e,c.viewport.width,c.viewport.height)}else b.push(new k(J,f,h,l,p,g,e,a,c.viewport.width,c.viewport.height));++r}b.length=r;c=this.pageLayoutManager.getCurrentPageNumber(h,l,n,m);this.viewer.trigger("change:viewport",this.markPagesDirty,b,a);this.markPagesDirty=!1;this.viewer.setProperty("currentPage",c)},onRender:function(a,b){function c(a,b){for(var d=
a.firstChild;null!==d;){var g=d.nextSibling;-1===b.indexOf(d)&&a.removeChild(d);d=g}}var g=this.el;g.style.display="none";var e=this.viewer;this.beforeFrameSynchronizedTasks.execute();for(var f=l.clone(this.pageElements),k={},e=e.pageCanvasManager,h=this.pageElCache,n=a.pages,m=a.scale,p=0,q=n.length;p<q;++p){var r=n[p],C=r.number,J=e.getPage(C),O=f[C];O?delete f[C]:(O=h.create(),g.appendChild(O));var Q=O.style;Q.width=r.width+"px";Q.height=r.height+"px";Q.left=r.x+"px";Q.top=r.y+"px";for(var Q=[],
r=J.getTiles(r,m,b),J=0,K=r.length;J<K;++J){var F=r[J],L=F.canvas,F=F.rect,H=L.style;H.left=(F.x+0.5|0)+"px";H.top=(F.y+0.5|0)+"px";H.width=(F.w+0.5|0)+"px";H.height=(F.h+0.5|0)+"px";H.position="absolute";O.appendChild(L);Q.push(L)}c(O,Q);k[C]=O}l.each(f,function(a){g.removeChild(a);for(var b=a.childNodes.length;b--;){var c=a.lastChild;c.className="";a.removeChild(c)}h.free(a)});this.pageElements=k;e.resetDirtyLayers(n);this.renderScrollbarsState(g);g.style.display="block";this.afterFrameSynchronizedTasks.execute()},
renderLayerCanvas:function(a,b,c,g,e,f,k){var h=b.layerCanvas,l=a.number,n=c.hasLayerContent(l);if(c.isLayerDirty(l)||null!==h&&(h.vitriumRequestedWidth!==g||h.vitriumRequestedHeight!==e)||null===h&&n){h=b.getLayerCanvas(g,e);c=c.layers;var m=h.getContext("2d");m.save();m.clearRect(0,0,g,e);m.scale(f,f);g=0;for(e=c.length;g<e;++g)f=c[g],f.hasContent(l)&&(m.save(),f.render(l,m,k,a),m.restore());m.restore()}n||b.freeLayerCanvas();return n?h:null},renderScrollbarsState:function(a){var b=this.scrollableViewport,
c=this.horizontalScrollBarEl,g=this.verticalScrollBarEl,e=b.hScroll,b=b.vScroll,f=!!c.parentElement,k=!!g.parentElement;if(e.visible){var h=this.horizontalScrollBarHandleEl.style;h.left=e.handlePosition+"px";h.width=e.handleSize+"px";f||a.appendChild(c)}else f&&a.removeChild(c);b.visible?(h=this.verticalScrollBarHandleEl.style,h.top=b.handlePosition+"px",h.height=b.handleSize+"px",k||a.appendChild(g)):k&&a.removeChild(g)},getScrollbarHandle:function(a,b,c){var g=this.tmpPoint;g.x=a;g.y=b;this.translateToViewportFill(g,
g);a=this.tmpRectangle1;a.init(g.x,g.y,c,c,0,null);c=this.scrollableViewport;var e=c.vScroll,g=Math.cos;b=Math.sin;if(e.visible){var f=this.tmpRectangle2;f.init(c.viewport.innerWidth,e.handlePosition,c.barThickness,e.handleSize,0,null);if(a.isIntersectedFast(f,g,b))return 1}e=c.hScroll;return e.visible&&(f.init(e.handlePosition,c.viewport.innerHeight,e.handleSize,c.barThickness,0,null),a.isIntersectedFast(f,g,b))?2:0},getDirectionFromScrollbarHandle:function(a,b,c){var g=this.tmpPoint;g.x=b;g.y=c;
this.translateToViewportFill(g,g);b=g.x;var e=g.y,g=this.tmpRectangle1;g.init(b,e,1,1,0,null);c=this.scrollableViewport;var f=c.vScroll,k=Math.cos,h=Math.sin,l=this.tmpRectangle2;if(1===a)return l.init(c.viewport.innerWidth,f.handlePosition,c.barThickness,f.handleSize,0,null),g.isIntersectedFast(l,k,h)?0:f.handlePosition>e?-1:1;a=c.hScroll;l.init(a.handlePosition,c.viewport.innerHeight,a.handleSize,c.barThickness,0,null);return g.isIntersectedFast(l,k,h)?0:a.handlePosition>b?-1:1},getScrollbarArea:function(a,
b,c){var g=this.tmpPoint;g.x=a;g.y=b;this.translateToViewportFill(g,g);a=this.tmpRectangle1;a.init(g.x-c/2,g.y-c/2,c,c,0,null);c=this.scrollableViewport;g=Math.cos;b=Math.sin;var e=this.tmpRectangle2;e.init(c.viewport.innerWidth,0,c.barThickness,c.viewport.innerHeight,0,null);if(a.isIntersectedFast(e,g,b))return 1;e.init(0,c.viewport.innerHeight,c.viewport.innerWidth,c.barThickness,0,null);return a.isIntersectedFast(e,g,b)?2:0},getScrollHandlePos:function(a){return 1===a?this.scrollableViewport.vScroll.handlePosition:
2===a?this.scrollableViewport.hScroll.handlePosition:null},translateCoordinatesToPage:function(a,b){this.translateToViewportFill(a,a);this.convertToDocumentUnitsFill(a,a);var c=this.pageLayoutManager.getPage(b),g=this.getDUViewportState();a.x+=g.scrollX-g.centerHorizontalConstant;a.y+=g.scrollY;a.x-=c.x;a.y-=c.y;return a},translateCoordiatesFromPageToDU:function(a,b){var c=this.pageLayoutManager.getPage(b);a.x+=c.x;a.y+=c.y;return a},translateCoordinatesFromPageToDOM:function(a,b){this.translateCoordiatesFromPageToDU(a,
b);var c=this.getDUViewportState();a.x-=c.scrollX-c.centerHorizontalConstant;a.y-=c.scrollY;c=this.viewer.scale;a.x*=c;a.y*=c;c=this.absoluteDim;a.x+=c.x;a.y+=c.y;return a},translateCoordinatesFromPageToDOMRelative:function(a,b){this.translateCoordiatesFromPageToDU(a,b);var c=this.getDUViewportState();a.x-=c.scrollX-c.centerHorizontalConstant;a.y-=c.scrollY;c=this.viewer.scale;a.x*=c;a.y*=c;return a},centerToPointOnPage:function(a,b){var c=this.pageLayoutManager.getPage(a),g=this.scrollableViewport.viewport,
e=this.viewer.scale;this.setScrollPosition2((c.x+b.x)*e-g.width/2,(c.y+b.y)*e-g.height/2)},scrollToPoint:function(a,b,c){c&&"center"!==c?"top"===c&&(a=this.pageLayoutManager.getPage(a),c=this.viewer.scale,this.setScrollPosition2((a.x+b.x)*c,(a.y+b.y)*c)):this.centerToPointOnPage(a,b)},scrollTo:function(a,b){b||(b=0);var c=this.pageLayoutManager.getPage(a);this.setVScrollPos(c.y*this.viewer.scale+b)},getCurrentPage:function(){return this.viewportPages()[0]},setScale:function(a,b){var c=this.pageLayoutManager.boundingBox,
g=this.scrollableViewport,e=(g.hScroll.contentPosition+g.viewport.innerWidth/2)/b,f=g.vScroll.contentPosition/b;g.changeContentDimensions(c.width*a,c.height*a);g.setScrollPos(g.hScroll.contentPosition+(e-(g.hScroll.contentPosition+g.viewport.innerWidth/2)/a)*a,f*a);this.onViewportChanged(!0)},onViewportChanged:function(a){this.pagesAttached&&(this.markPagesDirty=this.markPagesDirty||a,this.uiLoop.runAsyncAsap(this.uiCalculateViewport),this.refresh(),this.viewer.pauseRendering())},getPageNumberByCoordinates:function(a,
b,c){var g=this.tmpPoint;g.x=a;g.y=b;c||(c=1);this.translateToViewportFill(g,g);this.convertToDocumentUnitsFill(g,g);a=this.getDUViewportState();b=this.pageLayoutManager.queryPages(a.scrollX,a.scrollY,a.width,a.height);var e=this.tmpRectangle1;e.init(g.x+a.scrollX,g.y+a.scrollY,c,c,0,null);c=this.tmpRectangle2;for(var g=Math.cos,f=Math.sin;b.hasNext();){var k=b.next();c.init(k.x+a.centerHorizontalConstant,k.y,k.width,k.height,0,null);if(e.isIntersectedFast(c,g,f))return k.number}return null},getPageIteratorBetweenDU:function(a,
b){var c=a.x,g=b.x;g<c&&(c=g,g=a.x);var e=a.y,f=b.y;f<e&&(e=f,f=a.y);return this.pageLayoutManager.queryPages(c,e,g-e,f-e)},translateToViewportFill:function(a,b){var c=this.absoluteDim,g=c.y;a.x=b.x-c.x;a.y=b.y-g;return a},convertToDocumentUnitsFill:function(a,b){var c=this.viewer.scale;a.x=b.x/c;a.y=b.y/c;return a},scrollViewportPage:function(a){if(this.scrollableViewport.scrollRelative(0,this.scrollableViewport.viewport.innerHeight*a))this.onViewportChanged(!1)},setScrollPosition:function(a){return this.scrollableViewport.setScrollPos(a.x,
a.y)?(this.onViewportChanged(!1),!0):!1},setScrollPosition2:function(a,b){return this.scrollableViewport.setScrollPos(a,b)?(this.onViewportChanged(!1),!0):!1},setVScrollPos:function(a){return this.scrollableViewport.setVScrollPos(a)?(this.onViewportChanged(!1),!0):!1},setHScrollPos:function(a){return this.scrollableViewport.setHScrollPos(a)?(this.onViewportChanged(!1),!0):!1},setHHandlePos:function(a){return this.scrollableViewport.setHHandlePos(a)?(this.onViewportChanged(!1),!0):!1},setVHandlePos:function(a){return this.scrollableViewport.setVHandlePos(a)?
(this.onViewportChanged(!1),!0):!1},scrollToBeginning:function(){return this.scrollableViewport.setVScrollPos(0)?(this.onViewportChanged(!1),!0):!1},scrollToEnd:function(){var a=this.scrollableViewport;return a.setVScrollPos(a.vScroll._contentSize)?(this.onViewportChanged(!1),!0):!1},scrollByStep:function(a,b){var c=this.viewer.scale;if(this.scrollableViewport.scrollRelative(-(30*a*c),-(40*b*c)))this.onViewportChanged(!1)},fillScrollPosition:function(a){var b=this.scrollableViewport;a.x=b.hScroll.contentPosition;
a.y=b.vScroll.contentPosition;return a},setDim:function(a){p.DomWidget.prototype.setDim.call(this,a);if(this.pageLayoutManager.boundingBox&&this.viewer.resizeMode===m.viewer.ResizeMode.SCALE_CONTENT){var b=this.scrollableViewport,c=b.vScroll.contentPosition/this.viewer.scale;a=this.calcScale(a.w,a.h);this.viewer.setScaleInternal(a);b.vScroll.changeContentPosition(c*a);this.onViewportChanged(!0)}else this.setViewportDimensions(a.w,a.h),this.onViewportChanged(!1)},beforeFrame:function(a){this.beforeFrameSynchronizedTasks.push(a)},
afterFrame:function(a){this.afterFrameSynchronizedTasks.push(a)}});k.prototype={init:function(a,b,c,g,e,f,k,h){this.number=a.number;this.x=e+a.x*h-f+0.5|0;this.y=a.y*h-k+0.5|0;this.width=a.width*h+0.5|0;this.height=a.height*h+0.5|0;this.pX=e+a.x*h+0.5|0;this.pY=a.y*h+0.5|0;this.oX=a.x;this.oY=a.y;this.duX=b+a.x-c;this.duY=a.y-g;this.duWidth=a.width;this.duHeight=a.height},initQueryRectangles:function(a,b,c,g){this.baseRect.w=this.width;this.baseRect.h=this.height;this.viewportRect.x=a-this.pX+0.5|
0;this.viewportRect.y=b-this.pY+0.5|0;this.viewportRect.w=c;this.viewportRect.h=g}}})(r.viewer,r,r.ui,r.utils,r.geometry2,_,jQuery,Backbone,I);(function(q,m,p,h){function n(a,e){$super.call(this,a,e);(this.el=document.createElement("canvas")).className="canvas-renderer"}var l=m.CANVAS_POOL.GLOBAL_PIXEL_RATIO,$super=q.ScrollMasterDocumentRenderer,$superP=$super.prototype;q.CanvasDocumentRenderer=n;q=n.prototype=Object.create($superP);q.setImageSmoothing=function(a,e){"mozImageSmoothingEnabled"in a?
a.mozImageSmoothingEnabled=e:"webkitImageSmoothingEnabled"in a?a.webkitImageSmoothingEnabled=e:"imageSmoothingEnabled"in a?a.imageSmoothingEnabled=e:"msImageSmoothingEnabled"in a&&(a.msImageSmoothingEnabled=e)};q.prepareCanvas=function(a,e){var k=this.el,c=k.getContext("2d"),g=a*l-2+0.5|0,d=e*l+0.5|0;k.width!==g||k.height!==d?(k.width=g,k.height=d):c.clearRect(0,0,g,d);return c};q.onRender=function(a,e){this.beforeFrameSynchronizedTasks.execute();var k=this.viewer,c=this.scrollableViewport.viewport,
c=this.prepareCanvas(c.width,c.height);c.save();c.fillStyle="white";c.strokeStyle="#bbb";c.lineWidth=1;for(var k=k.pageCanvasManager,g=a.pages,d=Math.max,h=0,n=g.length;h<n;++h){var m=g[h],p=k.getPage(m.number),q=m.x*l,r=m.y*l,E=m.width*l,u=m.height*l;c.translate(q,r);for(var m=p.getTiles(m,a.scale,e),p={},w={},x=0,G=m.length;x<G;++x){var B=m[x],C=B.canvas,B=B.rect,C=p[B.x]=B.x*l;p[B.x+B.w]=C+B.w*l;C=w[B.y]=B.y*l;w[B.y+B.h]=C+B.h*l}x=0;for(G=m.length;x<G;++x)B=m[x],C=B.canvas,B=B.rect,E=d(E,p[B.x+
B.w]),u=d(u,w[B.y+B.h]),this.setImageSmoothing(c,(B.w*l+0.5|0)!==C.width),c.drawImage(C,0,0,C.width,C.height,B.x*l,B.y*l,B.w*l,B.h*l);c.translate(-q,-r);c.beginPath();c.rect(q+0.5,r+0.5,E-1,u-1);0===m.length&&c.fill();c.stroke()}c.restore();k.resetDirtyLayers(g);this.renderScrollbarsState(c,l);this.afterFrameSynchronizedTasks.execute()};q.renderScrollbarsState=function(a,e){a.fillStyle="DarkGray";var k=this.scrollableViewport,c=k.hScroll,g=k.vScroll,d=k.barThickness*e+0.5|0;if(c.visible){var h=c.handleSize*
e+0.5|0,c=c.handlePosition*e+0.5|0;a.fillRect(c,(k.viewport.height*e+0.5|0)-d,h,d)}g.visible&&(h=g.handleSize*e+0.5|0,c=g.handlePosition*e+0.5|0,a.fillRect(k.viewport.innerWidth*e+0.5|0,c,d,h))}})(r.viewer,r.ui,_,I);(function(q,m,p,h,n,l,f,b,a,e){function k(a,b){this.model=a;this.context=b;a.on("action:delete",this.onDocumentDelete,this);a.on("action:save",this.onDocumentSave,this);a.on("action:manage",this.onOpenStoredDocuments,this);a.on("action:about",this.onAbout,this)}function c(a){a=new Date(a);
var b=a.getMonth(),b=b+1;10>b&&(b="0"+b);var c=a.getDate();10>c&&(c="0"+c);var d=a.getHours();10>d&&(d="0"+d);var g=a.getMinutes();10>g&&(g="0"+g);return a.getFullYear()+"-"+b+"-"+c+"&nbsp;"+d+":"+g}function g(){f.FSNodes.apply(this,arguments)}var d=p._T;q.ToolsController=k;k.prototype.registerHideBoxLoading=function(a){this.model.on("change:refreshing",function z(b,c){c||(a.hideLoading(),a.hide(),b.off("change:refreshing",z))})};k.prototype.onDocumentDelete=function(){var a=this.context.viewer,b=
this.context.view,c=this.context.document.getContext(),g=c.cacheManager,e=this,f=r.viewer.showDismissBox(a,"",d("delete-current-document-title"),d("delete-current-document-question"),{view:b,buttons:[{id:"close",title:d("fs-cancel")},{id:"do-delete",title:d("fs-action-item-delete-title"),cssClass:"btn-primary btn-danger"}]});f.on("button:do-delete",function(a){a.preventDefault();f.showLoading();e.registerHideBoxLoading(f);g.forceInvalidate(c.url,function(){e.model.trigger("menuRefreshRequested")},
function(a){virtrium.log.error(a);f.hideLoading();f.displayMessages("fs-action-failed")})})};k.prototype.onAbout=function(){var a=n.template("<p><strong>Version</strong>: <%=version%></p>                                         <p><strong>Network status</strong>: <%=networkStatus%></p>                                         <p><strong>User agent</strong>: <%=userAgent%></p>                                         <% if (lastError) { %><p><strong>Last error</strong>: <%=lastError%></p><%}%>                                        "),
b=r.viewer.version,c,g=this.context.options.feedbackUrl;c=n.isEmpty(g)?[{id:"close",cssClass:"btn-primary",title:d("fs-close")}]:[{id:"feedback",title:d("about-send-feedback-button")},{id:"close",cssClass:"btn-primary",title:d("fs-close")}];var e=r.log.getCapture(function(a){return 3<=a.level}),f=null;0!==e.length&&(f=e[e.length-1].message.toString());var a=a({_T:r.i18n._T,version:b.toString(),lastError:f,userAgent:window.navigator.userAgent,networkStatus:window.navigator.onLine?"online":"offline"}),
k=this.context.viewer,l=this.context.view;r.viewer.showDismissBox(k,"",r.i18n._T("about-title"),a,{view:l,buttons:c}).on("button:feedback",function(a){setTimeout(function(){var a=new y,b=new r.ui.Form(a,{manualSync:!0,fields:[{id:"feedback",type:"textarea",label:d("send-feedback-feedback-label")},{id:"email",type:"text",label:d("send-feedback-email-label"),placeholder:d("send-feedback-email-placeholder")}]}),c=r.viewer.showDismissBox(k,"",r.i18n._T("send-feedback-title"),b.el,{view:l,buttons:[{id:"close",
title:d("fs-close")},{id:"feedback",title:d("about-send-feedback-button"),cssClass:"btn-primary no-key"}]});b.focus("feedback");c.on("button:feedback",function(e){function f(){c.hideLoading();c.hide();b.destroy();t(d("send-feedback-connection-error"))}function l(){c.hideLoading();c.hide();b.destroy()}function m(){for(var a=r.log.getCapture(),b=[],c=["d","i","w","e"],g=0,e=a.length;g<e;++g){var f=c[a[g].level];f||(f="unknown");b.push("["+f+"] "+a[g].message)}return d("send-feedback-problem-description")+
"\n"+p.feedback+"\nEmail:"+p.email+"\n\n"+d("send-feedback-system-information")+"\nURL:"+window.location.toString()+"\nUser Agent:"+window.navigator.userAgent+"\nNetwork Status: "+(window.navigator.onLine?"online":"offline")+"\n\nLog:\n"+b.join("\n")}function t(a,b){setTimeout(function(){b=b||m();var c=r.viewer.showDismissBox(k,"",r.i18n._T("send-feedback-title"),a+"<pre>"+b+"</pre>");r.is_mobile||r.viewer.selectText(c.el.find("pre")[0])},0)}b.sync();var p=a.toJSON();if(0===p.feedback.length)b.displayMessages({feedback:{type:"error",
text:"fs-action-err-empty"}}),b.focus("feedback"),e.preventDefault();else if(0===g.indexOf("mailto:")){e=g;var q=null;-1!==g.indexOf("?")?(e+="&subject=",q=g.substring(7,g.indexOf("?"))):(e+="?subject=",q=g.substring(7,g.length));e+=encodeURIComponent(d("send-feedback-subject"));var v=m();e+="&body="+encodeURIComponent(v);t(r.i18n._T("send-feedback-problem-text",[q]),v);window.location=e}else q=n.extend({log:r.log.getCapture(),userAgent:window.navigator.userAgent,url:window.location.toString()},p),
v=window.location.origin,0===g.indexOf("http")&&0!==g.indexOf(v)?r.utils.loadDataCORS({url:g,method:"POST",data:JSON.stringify(q),headers:[["Content-Type","application/json"]],success:l,error:f}):h.ajax({url:g,method:"POST",data:JSON.stringify(q),contentType:"application/json",success:l,error:f,dataType:"text"}),c.showLoading(),e.preventDefault()})},0)})};k.prototype.onDocumentSave=function(){if(null!==this.context.document){var b=this,c=this.context.viewer,d=[{id:"cancel",title:p._T("ui-tools-downloading-cancel")}],
g=new a.MenuItemsModel({title:p._T("ui-tools-downloading"),progress:0,buttons:d}),e=r.viewer.showProgressScreen(c,g,{view:this.context.view}),f=this.context.document.downloadToOfflineStorage().whenProgress(function(a){g.set("progress",a)}).then(function(){g.set({title:p._T("ui-tools-download-completed"),progress:"done",buttons:[{id:"close",title:p._T("ui-tools-download-close")}]});e.el.find(".modal-body").prepend(h("<div class='alert alert-success'>"+p._T("message-download-successful")+"</div>"));
b.model.trigger("menuRefreshRequested")}).catchError(function(a){g.set({title:p._T("ui-tools-download-failed"),progress:"done",buttons:[{id:"close",title:p._T("ui-tools-download-close")}]});e.el.find(".modal-body").prepend(h("<div class='alert alert-error'>"+p._T("ui-tools-download-failed-message")+"</div>"))}).whenComplete(function(){c.currentStorageAction=null});c.currentStorageAction={cancel:function(){e.hide()}};b=this;e.on("button:close",function(a){a.preventDefault();e.hide()});e.on("button:cancel",
function(){f.cancel()});e.on("view:show",function(a){a||(f.cancel(),c.currentStorageAction=null)});g.on("closed",function(){f.cancel()})}};k.prototype.onOpenStoredDocuments=function(){function a(b){n.pop(b)}function k(){null!==m&&J.loadDocument(function(a){},function(){null!==m&&(m.triggerButtonAction("close"),m=null)},q);n.refreshAll()}var l=new f.BrowserModel;l.set("mode","edit");var n=new f.BrowserController(l),m=null,q=null;l.on("node:pushed",function(b,c){c.on("invalidate",a)});l.on("node:popped",
function(b,c){c.off("invalidate",a)});var r=[{id:"item-delete",icon:"fa fa-trash-o",cssClass:"btn-danger"}],y=[new f.ContainerRenderer("fs-top",[new f.NameView(l,n)]),new f.ContainerRenderer("fs-cb",[]),new f.ListView(l,n,{folder:"fa fa-folder-open"},r)],r=[new f.ContainerRenderer("fs-top",[new f.NameView(l,n)]),new f.ContainerRenderer("fs-cb",[]),new f.ListView(l,n,{folder:"fa fa-folder-open"},r)];h(e).on("storage",k);var G=this.context.view,B=new f.Dialog(G,{cssClass:"fs-file-dialog",title:d("ui-tools-saved-documents-title"),
body:"",buttons:[{id:"close",title:d("fs-close")}]}),C=this;B.on("button:close",function(a){a.preventDefault();h(e).off("storage",k);C.model.trigger("menuRefreshRequested");B.hide()});this.context.viewer.on("document:detached",function(){G.destroyAll()});new f.FSBrowserView(B.el.find(".modal-body"),l,{root:y,folder:r},0.5);new f.CreateFolderActionView(l,G,n);new f.RenameActionView(l,G,n);new f.DeleteActionView(l,G,n);new f.MoveActionView(l,G,n);var J=b.CachableFileSystemContext.getCacheManager().getFSStorage();
(new f.SimpleFSService(J,{fsNodesClass:g})).getRoot(function(a){n.push(a)});l.on("action-success",function(a){B.displayMessages([{type:"success",text:"fs-action-"+a+"-success"}])});l.on("node:pushed",function(){B.clearMessages()});l.on("node:popped",function(){B.clearMessages()});l.on("action:open-document",function(a,b,g){B.showLoading();J.loadDocument(function(a){function g(a){k.off();q=m=null}B.hideLoading();q=b;var k=m=new f.Dialog(G,{cssClass:"vitrium-document-dialog",title:a.title,body:t({_T:p._T,
document:a,formatSize:e.formatSize,formatDateTime:c}),buttons:[{id:"close",title:d("btn-cancel")},{id:"open",title:d("ui-tools-open"),cssClass:"btn-primary"}]});k.on("button:open",function(b){g();e.location==a.location?e.location.reload():e.location=a.location;G.destroyAll()});k.on("button:close",g);k.show()},function(a){B.hideLoading()},b)});B.show()};var t=n.template('<div class="vitrium-document-thumbnail"><img src="<%=document.thumb||""%>" class="img-polaroid" /></div>    <div class="vitrium-document-info">    <h4><%=document.title%></h4>    <% if (document.author && document.author.length > 0) { %>    <p>      <strong><%=_T("document-author-label")%>:</strong> <%=document.author%>    </p>    <%}%>      <p><strong><%=_T("document-pages-label")%>:</strong> <%=document.pages%></p>      <p><strong><%=_T("document-size-label")%>:</strong> <%=formatSize(document.info.length, true) || "unknown"%></p>      <p><strong><%=_T("document-saved-label")%>:</strong> <%=formatDateTime(document.info.stateChanged) || "unknown"%></p></div>');
n.extend(g.prototype,f.FSNodes.prototype);n.extend(g.prototype,{createModelItem:function(){var a=f.FSNodes.prototype.createModelItem.apply(this,arguments);"document"===a.type&&(a.action="open-document");return a}});var y=l.Model.extend({defaults:{email:"",feedback:""}})})(r.viewer,r.ui,r.i18n,jQuery,_,Backbone,r.fs,r.io,r.viewer,I);(function(q,m,p,h,n,l,f,b,a,e){function k(a,b,c){m.ContainerWidget.call(this);this.layoutManager=new m.BoxLayout(this);this.layoutManager.align=m.DIRECTION.RIGHT;this.layoutManager.center=
!0;this.viewer=a;this.view=new y.FSDialogViewAdapter(this.viewer);this.options=c||{};this._renderedButtons=[];this._size=0;h(this._containerEl).addClass("btn-group");this.onStorageChanged=n.bind(this.__onStorageChanged,this);a.on("document:attached",this.documentAttached,this);a.on("document:detached",this.documentDetached,this);a.on("change:state",this.onStateChanged,this);r.i18n.on("language:changed",this.languageChanged,this);this.document=null;this.languageChanged(r.i18n);this.onStateChanged(a.state.current(),
a.state);h(e).on("storage",this.onStorageChanged);this.toolsMenuModel=b;this.updateMenutItemsCallback=this.toolsMenuScreen=null;this.events.on("action:DownloadCurrentDocument",this.onDocumentSave);this.events.on("action:ShowToolsMenu",this.showToolsMenu);this.events.on("action:HideToolsMenu",this.hideToolsMenu);b.on("change:refreshing",this.onRefreshingChanged,this);b.on("chnage:offlineState",this.onOfflineStateChanged,this);b.on("change:choices",this.onChoicesChanged,this);b.on("change:defaultChoices",
this.refreshToolsMenuItems,this);b.on("menuRefreshRequested",this.refreshToolsMenuItems,this);this.refreshToolsMenuItems();this.refreshAgain=!1;this.sortedWidgets=[]}function c(a){var b=a.fileSystem.entries,c=a.fileProvider().listFilesForDownload(),d=0;n.each(b,function(a){-1!==c.indexOf(a.filename)&&(d+=a.uncompressedSize)});return d}function g(a,b,c,d){m.DomSizedWidget.call(this,document.createElement("button"));this.id=a;this.priority=d;this.$el.append(c).attr("data-id",a).attr("title",b).attr("type",
"button").addClass("btn").addClass("toolbtn");"tools"!==a&&(this.maxSize=1)}function d(){this.dim=new a.Rectangle(0,0,5,5,0)}var t=p._T,y=q;l=y.STATES;var v=l.get("LOCKED");l.get("READY");l.get("NOT_READY");l.get("RENDERING_PAUSED");q.ToolsControl=k;k.prototype=n.extend(Object.create(m.ContainerWidget.prototype),{onRefreshingChanged:function(a,b){this.toolsMenuScreen&&(b?this.toolsMenuScreen.showLoading():this.toolsMenuScreen.hideLoading())},onOfflineStateChanged:function(){if(this.toolsMenuScreen){var a=
this.toolsMenuModel.get("offlineState"),b=this.toolsMenuScreen.el.find(".modal-body");"notsupported"===a?b.prepend("<div class='alert alert-info'>"+t("message-cache-is-disabled")+"</div>"):b.find(".alert.alert-info").remove()}},onActivate:function(){m.ContainerWidget.prototype.onActivate.call(this);this.listen(h(this.el),"tap click","button",n.bind(this.onButtonClicked,this))},onButtonClicked:function(a){var b=h(a.currentTarget).attr("data-id");"tools"===b?this.showToolsMenu():this.toolsMenuModel.trigger("action:"+
b);a.preventDefault()},close:function(){this.view&&this.view.destroyAll()},documentAttached:function(a){this.document=a;this.onCloseButtonChanged();var b=this,c=a.getContext(),d=2;c.on("file-system-initialized",function w(){c.off("file-system-initialized",w);--d;if(0==d)b.onStorageChanged()});a.on("info:loaded",function x(){a.off("info:loaded",x);--d;if(0==d)b.onStorageChanged()});a.on("offline-invalidated",this.refreshToolsMenuItems,this)},documentDetached:function(a){this.document=null;a.off("offline-invalidated",
this.refreshToolsMenuItems,this);h(e).off("storage",this.onStorageChanged);this.onCloseButtonChanged();this.refreshToolsMenuItems()},onStateChanged:function(a,b){var c=h(this.el).find("button");a===v?c.attr("disabled","disabled"):c.removeAttr("disabled")},hideToolsMenu:function(){this.toolsMenuScreen&&this.toolsMenuScreen.hide();h("body").css({overflow:"hidden"})},languageChanged:function(a){},showToolsMenu:function(a){h("body").css({overflow:"visible"});this.toolsMenuScreen=r.viewer.showMenuScreen(this.viewer,
this.toolsMenuModel,{view:this.view});this.toolsMenuScreen.on("button:close",this.onToolsMenuVisibilityChanged,this);this.refreshToolsMenuItems();this.onCloseButtonChanged()},onCloseButtonChanged:function(){this.toolsMenuScreen&&(this.document?this.toolsMenuScreen.el.find("button[data-action='close']").show():this.toolsMenuScreen.el.find("button[data-action='close']").hide())},onToolsMenuVisibilityChanged:function(){this.toolsMenuScreen.off("button:close",this.onToolsMenuVisibilityChanged,this);this.toolsMenuScreen=
null;h("body").css({overflow:"hidden"});this.viewer.parent.layoutManager.top.layoutManager.refresh()},getDownloadState:function(a,b){var c="notsupported";a.offlineStorageSupported&&(c="supported",null!==b&&null!==self.document&&(a.isCurrentDocumentDownloaded?c="downloaded":this.document.getContext().offlineStorage||(c="disabled")));null!==document.getElementsByTagName("html")[0].attributes.getNamedItem("manifest")||"downloaded"===c||(c="disabled");return c},refreshToolsMenuItems:function(){var a=
this.toolsMenuModel;if(a.get("refreshing"))this.refreshAgain=!0;else{a.set("refreshing",!0);var d=this,g=null!==this.document?this.document.getContext().url:null;b.CachableFileSystemContext.getCacheManager().loadStorageInfo(g,function(b){if(d.refreshAgain)d.refreshAgain=!1,a.set("refreshing",!1),d.refreshToolsMenuItems();else{var e=[];n.each(a.get("defaultChoices"),function(a){e.push(a)});if(d.document){var f=d.getDownloadState(b,g);"downloaded"===f?e.push({title:p._T("ui-tools-document-is-offline"),
id:"delete",icon:'<i class="fa fa-trash-o"></i>',priority:-1}):"supported"===f&&d.document.fileSystem.initialized&&e.push({title:p._T("ui-tools-save-document-offline",[formatSize(c(d.document),!0)]),id:"save",icon:"<i class='fa fa-download'></i>",priority:-1})}b.isAnyDocumentDownloaded&&e.push({title:p._T("ui-tools-manage-saved-documents"),id:"manage",toolHidden:1});d.broadcastEvent("ToolsMenuChange",e,a);e.push({title:p._T("ui-tools-menu-title"),id:"tools",icon:"<i class='fa fa-bars'>",toolHidden:2});
e.push({title:p._T("ui-tools-about"),id:"about",toolHidden:1});a.set("title",p._T("ui-tools-menu-title"));a.set("choices",e);a.set("offlineState","disabled");a.set("refreshing",!1)}})}},__onStorageChanged:function(){this.refreshToolsMenuItems()},onChoicesChanged:function(a,b){this._removeButtons();this._createButtonsForChoices(b)},_removeButtons:function(){for(var a=this._widgets,b=0,c=a.length;b!==c;++b){var d=a[b];this.remove(d);this.layoutManager.removeWidget(d)}},_createButtonsForChoices:function(a){for(var b=
0,c=0,e=a.length;c!==e;++c){var f=a[c];0===(f.toolHidden&1)&&(f=f.widget||new g(f.id,f.title,f.icon||"<i class='icon icon-star-empty'></i>",f.priority||0),this.add(this.layoutManager.add(f)),b+=f.dim.w)}this.layoutManager.add(new d);this.setWidth(b);this.sortedWidgets=this.getPrioritySortedWidgets();this._size=0},setWidth:function(a){var b=this.getDim();b.w=a;this.setDim(b);this.parent.layoutManager.refresh()},resetToDefaultSize:function(){for(var a=0;a!==this._size;++a)this.sortedWidgets[a].resetToDefaultSize();
this.setWidth(this.sumWidth())},getPrioritySortedWidgets:function(){var a=n.clone(this._widgets);a.sort(function(a,b){var c=a.priority,d=b.priority;return c<d?-1:c===d?0:1});return a},makeSmallerIfPosible:function(){for(var a=null,b=this._size,c=!1,d=this.sortedWidgets;!c&&b!==a;)null===a&&(a=b),c=d[b].makeSmallerIfPosible(),b=(b+1)%d.length;this._size=b;this.setWidth(this.sumWidth());return c},makeBiggerIfPosible:function(){for(var a=null,b=this._size,c=!1,d=this.sortedWidgets;!c&&b!==a;)null===
a&&(a=b),c=d[b].makeBiggerIfPosible(),b--,-1===b&&(b=d.length-1);this._size=b;this.setWidth(this.sumWidth());return c},sumWidth:function(){for(var a=this._widgets,b=0,c=0,d=a.length;c!==d;++c){var g=a[c].dim;1!==a[c].size&&(b+=g.w)}return b}});g.prototype=Object.create(m.DomSizedWidget.prototype)})(r.viewer,r.ui,r.i18n,jQuery,_,Backbone,r.fs,r.io,r.geometry2,I);(function(q,m,p,h,n,l,f){function b(b){m.DomSizedWidget.call(this,f.createElement("div"));this.el.className="vitrium-paging-controls input-prepend input-append";
l(a).appendTo(this.el);this.currentPageInput=this.$el.find(".current-page").val("-");this.viewer=b;b.on("change:currentPage",this.onPageChanged,this);b.on("change:state",this.onStateChanged,this);b.on("change:pageCount",this.onPageCountChanged,this);this.$el.on("keyup","input.current-page",h.bind(this.keyUp,this));this.$el.on("focus","input.current-page",h.bind(this.focusIn,this));this.$el.on("focusout","input.current-page",h.bind(this.focusOut,this));this.$el.on("tap click",".next-page",h.bind(this.nextPage,
this));this.$el.on("tap click",".prev-page",h.bind(this.prevPage,this));this.$el.on("mouseup","button",h.bind(this.onMouseUp,this));this.page=null;this.limit=0;this.onStateChanged(b.state.current(),b.state);this.onLanguageChanged(p.i18n);p.i18n.on("language:changed",this.onLanguageChanged,this);this.locked=!1;this.maxSize=3}var a='<button class="btn prev-page" type="button"><i class="fa fa-arrow-up"></i></button>    <button class="btn next-page" type="button"><i class="fa fa-arrow-down"></i></button>    <input type="text" class="input-mini current-page" >    <span class="add-on pages-total">of</span>';
n=q.STATES;var e=n.get("READY"),k=n.get("LOCKED"),c=n.get("NOT_READY");q.PagingControls=b;b.prototype=h.extend(Object.create(m.DomSizedWidget.prototype),{constructor:b,onMouseUp:function(){this.viewer.focus()},onLanguageChanged:function(a){var b=this.$el;b.find(".next-page").attr("title",a._T("ui-next-page"));b.find(".prev-page").attr("title",a._T("ui-previous-page"));b.find(".pages-total").html(a._T("ui-page-count",[0===this.limit?"-":this.limit]))},onPageChanged:function(a){this.page!==a&&(this.page=
a,this.refresh())},onRender:function(){null===this.page?this.currentPageInput.val("-"):this.currentPageInput.val(this.page+1)},focusOut:function(){p.is_mobile?this.keyUp({which:13,preventDefault:function(){}}):this.refresh()},focusIn:function(a){setTimeout(h.bind(function(){this.$el.find("input.current-page").select()},this),1)},onStateChanged:function(a,b){a!==k&&b.has(e)?(this.$el.find("button, input").removeAttr("disabled"),p.is_mobile?this.$el.find("input").attr("type","number"):this.$el.find("input").attr("type",
"text")):(this.$el.find("button, input").attr("disabled","disabled"),this.$el.find("input").attr("type","text"));b.has(c)&&(this.currentPageInput.val("-"),this.onPageCountChanged(0))},onPageCountChanged:function(a){this.limit=a;this.$el.find(".pages-total").html(p.i18n._T("ui-page-count",[0===a?"-":a]))},nextPage:function(){null!==this.page&&this.viewer.scrollTo(Math.min(this.page+1,this.limit))},prevPage:function(){null!==this.page&&this.viewer.scrollTo(Math.max(this.page-1,0))},keyUp:function(a){switch(a.which){case 13:return a.preventDefault(),
a=this.currentPageInput.val(),/^\d+$/.test(a)?(a=parseInt(a,10),this.viewer.scrollTo(a-1)):this.refresh(),!1;case 27:return a.preventDefault(),this.refresh(),!1;case 38:return a.preventDefault(),this.prevPage(),!1;case 40:return a.preventDefault(),this.nextPage(),!1}return!0}})})(r.viewer,r.ui,r,_,Backbone,jQuery,document);(function(q,m,p,h,n,l,f){function b(b){m.DomSizedWidget.call(this,f.createElement("div"));this.viewer=b;this.el.className="vitrium-scale-controls input-prepend input-append";this.controls=
l(a).appendTo(this.el);this.$el.on("tap click","button.lock",h.bind(this.lockClicked,this));this.$el.on("tap click","button.plus",h.bind(this.plusClicked,this));this.$el.on("tap click","button.minus",h.bind(this.minusClicked,this));this.$el.on("mouseup","button",h.bind(this.onMouseUp,this));this.scaleInput=this.$el.find("input.current-scale");this.scaleInput.focusout(h.bind(this.focusOut,this)).focus(h.bind(this.focusIn,this));this.scaleInput.keyup(h.bind(this.keyUp,this));b.on("change:resizeMode",
this.onModeChanged,this);b.on("change:scale",this.onScaleChanged,this);b.on("change:state",this.onStateChanged,this);this.scaleChanged=this.modeChanged=!1;this.scale=1;this.onModeChanged(b.resizeMode);this.onLanguageChanged(p.i18n);this.onStateChanged(b.state.current(),b.state);p.i18n.on("language:changed",this.onLanguageChanged,this);this.maxSize=3}var a='<button class="btn plus" type="button"><i class="fa fa-plus"></i></button>    <button class="btn minus" type="button"><i class="fa fa-minus"></i></button>    <input type="number" class="input-mini current-scale" value="100">    <span class="add-on">%</span>    <button class="btn lock" type="button"><i class="fa fa-arrows-h"></i></button>';
n=q.STATES;var e=n.get("READY"),k=n.get("LOCKED");q.ScaleControls=b;b.prototype=h.extend(Object.create(m.DomSizedWidget.prototype),{constructor:b,onMouseUp:function(){this.viewer.focus()},onLanguageChanged:function(a){var b=this.$el;b.find("button.plus").attr("title",a._T("ui-zoom-in"));b.find("button.minus").attr("title",a._T("ui-zoom-out"));b.find("button.lock").attr("title",a._T("ui-zoom-fit-to-window"))},focusOut:function(){if(p.is_mobile)this.keyUp({which:13,preventDefault:function(){}});else this.onScaleChanged(this.scale)},
focusIn:function(a){setTimeout(function(){l(a.target).select()},0)},onScaleChanged:function(a){this.scaleChanged=!0;this.scale=a;this.refresh()},onModeChanged:function(a){this.modeChanged=!0;this.refresh()},onRender:function(){this.scaleChanged&&(this.scaleInput.val(""+Math.ceil(100*this.scale)),this.scaleChanged=!1);this.modeChanged&&(this.viewer.resizeMode===p.viewer.ResizeMode.SCALE_CONTENT?this.$el.find("button.lock").addClass("btn-primary"):this.$el.find("button.lock").removeClass("btn-primary"),
this.modeChanged=!1)},plusClicked:function(){var a=Math.ceil(100*this.scale);this.viewer.setScale((a+(25-a%25))/100)},minusClicked:function(){var a=Math.ceil(100*this.scale),b=a%25;0===b&&(b=25);this.viewer.setScale((a-b)/100)},lockClicked:function(a){a=p.viewer.ResizeMode;this.viewer.resizeMode===a.SCALE_CONTENT?this.viewer.setResizeMode(a.FIXED_CONTENT):this.viewer.setResizeMode(a.SCALE_CONTENT)},onStateChanged:function(a,b){b.has(e)&&a!==k?this.controls.find("button, input").removeAttr("disabled"):
this.controls.find("button, input").attr("disabled","disabled")},keyUp:function(a){switch(a.which){case 13:a.preventDefault();a=this.scaleInput.val();if(/^\d+$/.test(a))this.viewer.setScale(a/100);else this.onScaleChanged(this.scale);return!1;case 27:return a.preventDefault(),this.onScaleChanged(this.scale),!1;case 38:return a.preventDefault(),this.plusClicked(),!1;case 40:return a.preventDefault(),this.minusClicked(),!1}return!0}})})(r.viewer,r.ui,r,_,Backbone,jQuery,document);(function(q,m,p){function h(h,
l,f){p.ContainerWidget.call(this);this.el.className="vitrium-toolbar";this.layoutManager=new p.BasicLayoutManager(this);l=new m.ToolsControl(h,f,h.options);new m.ToolsController(f,l);this.layoutManager.left=this.add(new m.LoadingIndicator(h,!1));f=this._mainView=this.layoutManager.center=this.add(new p.ContainerWidget);f.layoutGuard=new p.IntersectionLayoutGuard(f);f.layoutManager=new p.HorizontalAlignLayout(f);this.scaleControls=new m.ScaleControls(h);f.layoutManager.left=f.add(this.scaleControls);
f.layoutManager.center=f.add(new m.PagingControls(h));f.layoutManager.right=f.add(l);this.dim.h=40;h=l.dim;h.h=40;l.dim=h;this._actionBar=null}q.Toolbar=h;h.prototype=Object.create(p.ContainerWidget.prototype);h.prototype.showActionBar=function(h){this._actionBar=h;this.remove(this._mainView);this.layoutManager.center=this.add(h)};h.prototype.showStatusView=function(){this.remove(this._actionBar);this.layoutManager.center=this.add(this._mainView);this._actionBar=null}})(r.viewer,r.viewer,r.ui);(function(q,
m,p,h,n,l,f){function b(a,b,c){m.DomSizedWidget.call(this,f.createElement("div"));this.el.className="vitrium-search-controls";this.$el.css({position:""});this.controller=a;this.model=b;this.viewer=c;a=this.searchControls=l(g).appendTo(this.el);a.find("input.search").on("input",h.bind(this.inputChanged,this)).keyup(h.bind(this.searchKey,this));a.on("tap click","button.next",h.bind(this.next,this));a.on("tap click","button.prev",h.bind(this.prev,this));a.on("tap click","button.close-search",h.bind(this.searchClicked,
this));this.stateChanged();b.on("change:ui-state",this.stateChanged,this);b.on("search:end-reached",this.searchFinished,this);b.on("search:completed",this.searchCompleted,this);b.on("change:longsearch",this.longSearchChanged,this);c.on("document:attached",this.documentAttached,this);c.on("document:detached",this.documentDetached,this);c.on("change:state",this.updateControlsState,this);c.on("keydown",this.searchKey,this);l(f).keydown(h.bind(this.onDocumentKeyDown,this));this.lastVal=null;this.languageChanged(p.i18n);
p.i18n.on("language:changed",h.bind(this.languageChanged,this));this.searchInProgress=!1;this.lastTop=0;this.updateControlsState();this.maxSize=2}var a={OPEN:!0,CLOSED:!1},e=q.STATES,k=e.get("LOCKED"),c=e.get("READY");q.SearchControls=b;q.SearchControlsState=a;var g="<div class='afix' style='display:none; z-index:2;'><div class='input-prepend input-append'><button class='btn btn-danger vitrium-tool-margin close-search'  type='button' ><i class='fa fa-search'></i></button><input class='span2 search' type='text'/><div class='btn-group'><button type='button' class='btn prev' disabled type='button' >&nbsp;<i class='fa fa-chevron-left'></i>&nbsp;</button>\t<button type='button' class='btn btn-primary next' disabled>&nbsp;<i class='fa fa-chevron-right'></i></button></div></div></div>";
b.prototype=h.extend(Object.create(m.DomSizedWidget.prototype),{constructor:b,setDim:function(a){m.DomSizedWidget.prototype.setDim.call(this,a);this.isUIOpen()&&this.updatePosition()},onActivate:function(){m.DomSizedWidget.prototype.onActivate.call(this)},getDim:function(){var a=m.DomSizedWidget.prototype.getDim.call(this);0<this.currentSize&&this.isUIOpen()&&(a=a.clone(),a.w=1);return a},updatePosition:function(){},isUIOpen:function(){return this.model.get("ui-state")===a.OPEN},detachFromLayout:function(){this._detached=
!0},onInfoLoaded:function(b){this.setEnabled(!0);this.model.set({"ui-state":a.CLOSED});this.searchControls.find("input").val("")},updateControlsState:function(){var a=this.searchControls.find("button, input");this.isSearchPosible()?a.removeAttr("disabled"):a.attr("disabled","disabled")},longSearchChanged:function(a,b){b?this.longSearchBegin():this.longSearchEnd()},longSearchBegin:function(){if(!this.searchInProgress)(this.searchInProgress=p.viewer.showDismissBox(this.viewer,"info",p.i18n._T("ui-search-in-progress-title"),
p.i18n._T("ui-search-in-progress"),{buttons:[{id:"close",title:p.i18n._T("ui-search-document-end-cancel-btn-label")}]})).on("button:close",this.cancelClicked,this)},cancelClicked:function(){this.controller.abortLongSearch()},longSearchEnd:function(){var a=this.searchInProgress;a&&(a.off("button:close",this.cancelClicked,this),a.hide(),this.searchInProgress=null);p.is_mobile||this.searchControls.find("input.search").focus();this.viewer.$el.find(".vitrium-long-search-box").remove()},searchCompleted:function(){this.searchInProgress&&
this.searchInProgress.hide();var a=this.searchControls,b=this;(this.searchInProgress=p.viewer.showDismissBox(this.viewer,"info",p.i18n._T("ui-search-completed-title"),p.i18n._T("ui-search-completed"),{buttons:[{id:"close",title:p.i18n._T("menu-close"),cssClass:"btn-primary"}]})).on("view:show",function(c){c||(p.is_mobile||a.find("input.search").focus().select(),b.searchInProgress=null)})},languageChanged:function(a){var b=this.searchControls;b.find("button.next").attr("title",a._T("ui-search-next"));
b.find("button.prev").attr("title",a._T("ui-search-prev"));b.find("button.close-search").attr("title",a._T("ui-search-close"));b.find("input").attr("title",a._T("ui-search"))},searchFinished:function(){var b=this.controller,c=this;this.searchInProgress&&this.searchInProgress.hide();this.searchInProgress=null;var g=this.model.get("mode")===p.viewer.SearchMode.FORWARD?"end":"beg",g=p.viewer.showDismissBox(this.viewer,"success",p.i18n._T("ui-search-document-"+g+"-reached-title"),p.i18n._T("ui-search-document-"+
g+"-reached"),{buttons:[{id:"start",title:p.i18n._T("ui-search-document-"+g+"-start-btn-title"),label:p.i18n._T("ui-search-document-"+g+"-start-btn-label"),cssClass:"btn-primary"},{id:"close",title:p.i18n._T("ui-search-document-"+g+"-cancel-btn-title"),label:p.i18n._T("ui-search-document-"+g+"-cancel-btn-label")}]});g.on("button:start",function(a){setTimeout(function(){c.longSearchBegin();b.next()},0)});g.on("button:close",function(b){setTimeout(function(){c.cancelClicked();c.model.set({"ui-state":a.CLOSED})},
0)})},stateChanged:function(){if(this.model.get("ui-state")===a.OPEN){this.priority=-1;var b=this.searchControls;p.viewer.$fadeIn(b[0]);b.css({display:"block"}).removeClass("closed").addClass("opened").find("input.search").focus().select();this.inputChanged()}else this.priority=0,this.lastVal=null,b=this.searchControls,b.removeClass("opened").addClass("closed"),b.css({display:"none"}),b=this.model.get("cursor"),this.model.set(h.extend({},this.model.defaults)),b&&this.model.trigger("changed",[b.page]),
this.viewer.focus(),this._detached=!1;this.trigger("size:change")},searchClicked:function(){this.model.get("ui-state")?this.model.set({"ui-state":a.CLOSED}):this.model.set({"ui-state":a.OPEN})},inputChanged:function(){if(this.searchInProgress)return!0;var a=this.searchControls.find("input.search").val();h.isEmpty(a)?this.searchControls.find("button.next, button.prev").attr("disabled","disabled"):this.searchControls.find("button.next, button.prev").removeAttr("disabled")},searchKey:function(b){if(this.searchInProgress||
this.viewer.controlsLock)return!0;if(this.model.get("ui-state")===a.OPEN){this.inputChanged();if(13===b.which){b.preventDefault();var c=this.searchControls.find("input.search").val();h.isEmpty(c)||(b.ctrlKey?this.prev():this.next());return!1}return 27===b.which?(b.preventDefault(),this.model.set({"ui-state":a.CLOSED}),!1):!0}},next:function(){this.searchInProgress||(this.model.set({mode:p.viewer.SearchMode.FORWARD}),this.search())},search:function(){if(!this.searchInProgress){var a=this.searchControls.find("input.search").val();
a!==this.lastVal?this.controller.search(a):this.controller.next();this.lastVal=a}},prev:function(){this.searchInProgress||(this.model.set({mode:p.viewer.SearchMode.BACKWARD}),this.search())},onDocumentKeyDown:function(b){return b.ctrlKey&&70===b.which&&this.isSearchPosible()?(this.model.set({"ui-state":a.OPEN}),this.searchControls.find("input.search").focus().select(),b.preventDefault(),!1):!0},isSearchPosible:function(){var a=this.viewer.state;return a.current()!==k&&a.has(c)}});h.extend(b.prototype,
n.Events)})(r.viewer,r.ui,r,_,Backbone,jQuery,document);(function(q,m,p,h,n){function l(a,b){m.LabeledSidePanel.call(this,m.icon("pencil"),"highlight-panel-title");this.originalIcon=this.icon;this.textHighlightIcon=m.icon("highlight-text");this.eraserIcon=m.icon("eraser");this.layoutManager.center=this.add(new f(a,b));this.annotationControllerModel=b;b.on("change:activatedAction",this.onActivatedActionChanged,this);b.get("colorSelectorModel").on("change:colorSelection",this.updateIconColor,this)}
function f(a,e){m.ContainerWidget.call(this);this.layoutManager=new m.BoxLayout(this);this.layoutManager.align=m.DIRECTION.TOP;var f=this.toolSelectorModel=e.get("toolSelectorModel"),c=new m.IconCache,f=this.toolSelector=new m.ChoiceSelector(f,function(a,b,g){a.attr("title",n._T("tool-"+b));g=null;null===b?g=c.icon("null-tool"):"freehighlight"===b?g=c.icon("pencil"):"eraser"===b?g=c.icon("eraser"):"texthighlight"===b&&(g=c.icon("highlight-text"));a.append(g.el);a.attr("tool",b)},"toolSelection",function(){b(this.$el.find("[tool='freehighlight'] .icon"),
g.getSelectedColor());b(this.$el.find("[tool='texthighlight'] .icon"),g.getSelectedColor())});this.layoutManager.add(this.add(f));var g=this.colorSelectorModel=e.get("colorSelectorModel"),f=new m.ChoiceSelector(g,function(a,b,c){a.css("background-color",b)},"colorSelection");f.$el.addClass("vitrium-color-selector");this.layoutManager.add(this.add(f))}function b(a,b){a.css("background",b).css("background","-webkit-linear-gradient("+b+", white)").css("background","-o-linear-gradient("+b+", white)").css("background",
"-moz-linear-gradient("+b+", white)").css("background","linear-gradient("+b+", white)")}q.HighlightPanel=l;l.prototype=Object.create(m.LabeledSidePanel.prototype);l.prototype.onActivatedActionChanged=function(a,b){"texthighlight"===b&&this.lastOpened?this.icon!==this.textHighlightIcon&&this.setIcon(this.textHighlightIcon):"eraser"===b&&this.lastOpened?this.icon!==this.textHighlightIcon&&this.setIcon(this.eraserIcon):this.icon!==this.originalIcon&&this.setIcon(this.originalIcon);this.updateIconColor();
this.onLanguageChanged()};l.prototype.onLanguageChanged=function(){m.LabeledSidePanel.prototype.onLanguageChanged.call(this);if(this.annotationControllerModel){var a=this.annotationControllerModel.get("activatedAction"),b=this.annotationControllerModel.get("toolSelectorModel").get("toolSelectionList");null!==a&&-1!==b.indexOf(a)&&this.setIconLabel(n._T("selected-tool-"+a))}};l.prototype.updateIconColor=function(){var a=this.annotationControllerModel.get("activatedAction"),b=$(this.icon.el).find("i");
$(this.icon.el).removeClass("active");var f=$(this.icon.el).find("path");if(!this.lastOpened||"freehighlight"!==a&&"texthighlight"!==a)b.css("color",""),f.css("fill","");else{var c=this.annotationControllerModel.get("colorSelectorModel").getSelectedColor();b.css("color",c);f.css("fill",c);$(this.icon.el).addClass("active")}"eraser"===a&&this.lastOpened&&$(this.icon.el).addClass("active")};f.prototype=Object.create(m.ContainerWidget.prototype);f.prototype.onActivate=function(){this.listen(this.colorSelectorModel,
"change:colorSelection",this.toolSelector.refresh,this.toolSelector)}})(r.viewer,r.ui,_,Backbone,r.i18n);(function(q,m,p){function h(h){m.DomSizedWidget.call(this,document.createElement("div"));this.$el.addClass("vitrium-history-controls");this.historyModel=h;this.$el.append("<button type='button' class='btn' data-action='repeat'><i class='fa fa-repeat'></i></button><button type='button' class='btn' data-action='undo'><i class='fa fa-undo'></i></button>");this.$el.on("tap click","button",_.bind(this.onButtonClicked,
this))}q.HistoryControls=h;h.prototype=Object.create(m.DomSizedWidget.prototype);h.prototype.onActivate=function(){this.listen(this.historyModel,"history:changed",this.onHistoryChanged,this);this.listen(p,"language:changed",this.onLanguageChanged,this);this.onLanguageChanged();this.historyModel.triggerHistoryChange()};h.prototype.onLanguageChanged=function(){this.$el.find("button[data-action='undo']").attr("title",p._T("tool-undo"));this.$el.find("button[data-action='repeat']").attr("title",p._T("tool-repeat"))};
h.prototype.onButtonClicked=function(h){h=$(h.currentTarget).attr("data-action");"undo"===h?this.historyModel.undo():"repeat"===h&&this.historyModel.redo()};h.prototype.setDim=function(h){this.$el.css({left:0,bottom:0})};h.prototype.onHistoryChanged=function(h,l,f){h=this.$el.find("button[data-action='undo']");var b=this.$el.find("button[data-action='repeat']");l?h.removeAttr("disabled"):h.attr("disabled","disbled");f?b.removeAttr("disabled"):b.attr("disabled","disbled")}})(r.viewer,r.ui,r.i18n);
(function(q,m,p,h){function n(b,a,e,f){m.LabeledSidePanel.call(this,m.icon("comment-o"),"notes-panel-title");this.annotationControllerModel=a;this.originalIcon=this.icon;this.eraserIcon=m.icon("eraser");this.layoutManager.center=this.add(new l(b,a,e,f));this.annotationControllerModel.on("change:activatedAction",this.onActivatedActionChanged,this)}function l(b,a,e,k){m.ContainerWidget.call(this);this.layoutManager=new m.BasicLayoutManager(this);var c=new m.IconCache;a=new m.ChoiceSelector(a.get("noteSelectorModel"),
function(a,b,e){a.attr("title",p._T("tool-"+b));e=null;null===b?e=c.icon("null-tool"):"eraser"===b?e=c.icon("eraser"):"note"===b&&(e=c.icon("comment-o"));a.append(e.el);a.attr("tool",b)},"toolSelection");this.layoutManager.top=new m.LayoutMarginProxy(this.add(a),{bottom:10});this.listView=this.layoutManager.center=this.add(new m.ListView(new f(e),function(a,b,c){c=document.createElement("div");c.className="vitrium-note-page";c.innerHTML=p._T("note-page")+"&nbsp;"+(b.page+1);a.append(c);$("<div class='vitrium-note-content'>").text(b.toString()).appendTo(a);
k.isSelected(b)?(a.addClass("selected"),a.prepend("<button class='btn vitrium-note-edit' type='button' data-action='note-edit'><i class='fa fa-pencil-square-o'></i></button><button class='btn vitrium-note-delete' type='button' data-action='note-delete'><i class='fa fa-trash-o'></i></button>")):a.removeClass("selected")}));this.noteSelectionModel=k;this.annotationController=b}function f(b){this.model=b;this.filtered=null;this.on=h.bind(b.on,b);this.off=h.bind(b.off,b)}q.NotesPanel=n;n.prototype=Object.create(m.LabeledSidePanel.prototype);
n.prototype.onLanguageChanged=function(){m.LabeledSidePanel.prototype.onLanguageChanged.call(this);if(this.annotationControllerModel){var b=this.annotationControllerModel.get("activatedAction"),a=this.annotationControllerModel.get("noteSelectorModel").get("toolSelectionList");null!==b&&-1!==a.indexOf(b)&&this.setIconLabel(p._T("selected-tool-"+b))}};n.prototype.onActivatedActionChanged=function(b,a){$(this.icon.el).removeClass("active");"eraser"===a&&this.lastOpened?this.icon!==this.textHighlightIcon&&
this.setIcon(this.eraserIcon):this.icon!==this.originalIcon&&this.setIcon(this.originalIcon);!this.lastOpened||"eraser"!==a&&"note"!==a||$(this.icon.el).addClass("active");this.onLanguageChanged()};l.prototype=Object.create(m.ContainerWidget.prototype);l.prototype.onActivate=function(){this.listen(this.listView,"item:clicked",this.onListItemClick,this).listen(this.listView,"item:doubleclicked",this.onListItemDoubleClick,this).listen(this.listView,"action:note-edit",this.onNoteEditClicked,this).listen(this.listView,
"action:note-delete",this.onNoteDeleteClicked,this).listen(this.noteSelectionModel,"change:selected",this.listView.refresh,this.listView)};l.prototype.onListItemClick=function(b,a){this.noteSelectionModel.select(b);this.annotationController.showAnnotation(b)};l.prototype.onNoteEditClicked=function(b,a,e){this.annotationController.editNote(b)};l.prototype.onNoteDeleteClicked=function(b,a,e){this.annotationController.deleteAnnotation(b)};l.prototype.onListItemDoubleClick=function(b,a){this.onListItemClick(b,
a);this.broadcastEvent("action:ClosePanelIfDetached")};f.prototype.getLength=function(){this.filtered=this.model.getCurrentState().state.getAllNotes();return this.filtered.length};f.prototype.getItem=function(b){return this.filtered[b]}})(r.viewer,r.ui,r.i18n,_);(function(q,m,p,h,n,l){q.NoteFormModel=n.Model.extend({defaults:{id:null,cid:null,text:"",page:null,position:null}});q.showNoteFormDialog=function(f,b,a,e){var k=new h.Form(b,{manualSync:!0,fields:[{id:"text",type:"textarea",label:p._T("note-text-label")}]});
k.el.addClass("vitrium-note-form");f=m.showDismissBox(f,null,p._T("note-form-title-"+(e?"new":"edit")),k.el,{buttons:[{id:"close",title:p._T("note-cancel-label")},{id:"save",title:p._T("note-save-label"),cssClass:"btn-primary no-key"}]});r.is_mobile&&$.browser.safari&&k.el.find("textarea").focusout(function(){$(window).scrollTop(0)});k.focus("text");f.on("button:save",function(c){k.sync();l.isEmpty(b.get("text"))?(k.displayMessages({text:{type:"error",text:"note-form-validation-empty-note"}}),k.focus("text"),
c.preventDefault()):(k.destroy(),a(!0,b))});f.on("button:close",function(){a(!1,b)})}})(r.viewer,r.viewer,r.i18n,r.ui,Backbone,_);(function(q,m,p,h){function n(f){m.LabeledSidePanel.call(this,m.icon("bookmark"),"bookmarks-panel-title");this.model=f;this.bookmarksView=this.layoutManager.center=this.add(new m.ListView(f,function(b,a,e){b.css("paddingLeft",a.level+"em");e=document.createElement("div");e.className="vitrium-bookmark-content";var f=$(e).text(a.title);a.documentVisible&&b.addClass("vitrium-bookmark-visible");
a.selected&&b.addClass("vitrium-bookmark-selected");a.nullOperation&&b.addClass("vitrium-bookmark-null");a.bold&&f.addClass("vitrium-bookmark-bold");a.italic&&f.addClass("vitrium-bookmark-italic");a.color&&!a.selected&&f.css("color",a.color);a.children&&(a.opened?$("<span class='vitrium-bookmark-tree-node vitrium-bookmark-close' data-action='node-close'><i class = 'fa fa-minus-square-o'></i></span>").appendTo(b):$("<span class='vitrium-bookmark-tree-node vitrium-bookmark-open' data-action='node-open'><i class = 'fa fa-plus-square-o'></i></span>").appendTo(b));
b.append(e)}));this.bookmarksView.$el.attr("tabindex",0);this.lastActionTime=0;this.keyHandled=this.selectionChanged=!1;f.on("selection-changed",function(){this.selectionChanged=!0;this.refresh()},this)}function l(f){this.flatNodeList=[];this.nodes=[];this._buildNodes(f);this.currentNodes=null;this.nodesChanged=!0;this.currentViewport=this.timer=this.selectedIdx=this.selected=this.currentVisibleNode=null}q.BookmarksPanel=n;q.BookmarksListModel=l;n.prototype=Object.create(m.LabeledSidePanel.prototype);
n.prototype.onActivate=function(){this.listen(this.bookmarksView,"item:clicked",this.onBookmarkItemClicked,this).listen(this.bookmarksView,"item:doubleclicked",this.onBookmarkItemDoubleClicked,this).listen(this.bookmarksView,"action:node-close",this.onNodeClose,this).listen(this.bookmarksView,"action:node-open",this.onNodeOpen,this).listen(this.bookmarksView.$el,"keydown",p.bind(this.onKeyDown,this));setTimeout(p.bind(function(){this.scrollTo($(this.bookmarksView.el).find(".vitrium-bookmark-visible"))},
this),50);this.refresh()};n.prototype.onRender=function(){if(this.selectionChanged){var f=this.bookmarksView.$el.find(".vitrium-bookmark-selected");f.removeClass("vitrium-bookmark-selected");var b=parseInt(f.attr("idx"),10);(b=this.model.getItem(b))&&b.color&&f.find(".vitrium-bookmark-content").css("color",b.color);f=this.bookmarksView.$el.find("[idx='"+this.model.selectedIdx+"']").addClass("vitrium-bookmark-selected");(b=this.model.getItem(this.model.selectedIdx))&&b.color&&f.find(".vitrium-bookmark-content").css("color",
"white");this.selectionChanged=!1}this.keyHandled&&(this.scrollTo(this.bookmarksView.$el.find(".vitrium-bookmark-selected")),this.keyHandled=!1)};n.prototype.scrollTo=function(f){if(0<f.length){var b=this.bookmarksView.$el.scrollTop(),a=this.bookmarksView.$el.offset().top,e=f.offset().top;f=f.height();var k=this.bookmarksView.dim.h,a=e-a;0>a-2*f?this.bookmarksView.$el.scrollTop(b+a-2*f):a+f+2*f>k&&this.bookmarksView.$el.scrollTop(b+(a+f-k)+2*f)}};n.prototype.onKeyDown=function(f){var b=this.model,
a=!1;switch(f.which){case 38:b.selectPrev();this.refresh();a=!0;break;case 40:b.selectNext();this.refresh();a=!0;break;case 37:b.closeSelected();a=!0;this.refresh();break;case 39:b.openSelected();a=!0;this.refresh();break;case 13:null!==b.selected&&(this.broadcastEvent("action:openBookmark",b.selected._data),a=!0)}a&&(this.keyHandled=!0,f.preventDefault())};n.prototype.onBookmarkItemClicked=function(f,b,a,e){a.$el.focus();this.model.select(b);this.broadcastEvent("action:openBookmark",f._data);e&&
this.notIgnored()&&(f.opened?this.model.closeNode(b):this.model.openNode(b))};n.prototype.onBookmarkItemDoubleClicked=function(f,b,a,e){!e&&this.notIgnored()&&(f.opened?this.model.closeNode(b):this.model.openNode(b));e&&this.broadcastEvent("action:ClosePanelIfDetached")};n.prototype.onNodeOpen=function(f,b){!f.opened&&this.notIgnored()&&this.model.openNode(b)};n.prototype.onNodeClose=function(f,b){f.opened&&this.notIgnored()&&this.model.closeNode(b)};n.prototype.notIgnored=function(){var f=Date.now();
return 500<f-this.lastActionTime?(this.lastActionTime=f,!0):!1};l.prototype={getLength:function(){this.nodesChanged&&(this.currentNodes=this._prepareNodes(this.nodes),this.markVisible(this.currentVisibleNode),this.selectedIdx=this.currentNodes.indexOf(this.selected),-1===this.selectedIdx&&(this.selectedIdx=null),this.nodesChanged=!1);return this.currentNodes.length},getItem:function(f){return this.currentNodes[f]},openNode:function(f){f=this.currentNodes[f];null!==f.children&&(f.opened=!0,this.triggerChange())},
closeNode:function(f){f=this.currentNodes[f];null!==f.children&&(f.opened=!1,this._isChildOf(f,this.selected)&&(this.selected=f),this.triggerChange())},select:function(f){0>f?(f=this.currentNodes.length-1,this.select(f)):(this.selected=this.currentNodes[f],this.selectedIdx=f,this.trigger("selection-changed",this))},selectNext:function(){null===this.selectedIdx?this.select(0):this.select((this.selectedIdx+1)%this.currentNodes.length)},selectPrev:function(){null===this.selectedIdx?this.select(-1):this.select(this.selectedIdx+
-1)},openSelected:function(){null!==this.selectedIdx&&this.openNode(this.selectedIdx)},closeSelected:function(){if(null!==this.selectedIdx)if(this.selected.opened)this.closeNode(this.selectedIdx);else for(var f=this.selected.parent;null!==f;){if(f.opened){f=this.currentNodes.indexOf(f);-1!==f&&this.closeNode(f);break}f=f.parent}},_isChildOf:function(f,b){for(var a=null!==f.children&&-1!==f.children.indexOf(b),e=0,k=null===f.children?0:f.children.length;e<k&&!a;++e)a=this._isChildOf(f.children[e],
b);return a},_prepareNodes:function(f){var b=[];this._traverseForPreparation(b,f);return b},_traverseForPreparation:function(f,b){for(var a=0,e=b.length;a<e;++a){var k=b[a];f.push(k);k.opened&&this._traverseForPreparation(f,k.children)}},_buildNodes:function(f){for(var b=this.nodes,a=0,e=f.length;a<e;++a)b.push(this._createNode(f[a],0,null))},_createNode:function(f,b,a){var e=null,k=f.Children;0<k.length&&(e=[]);f={_model:this,_data:f,parent:a,level:b,children:e,documentVisible:!1,opened:!1,get title(){return this._data.Title},
get pageIdx(){return this._data.Operation.PageIdx},get nullOperation(){return p.isEmpty(this._data.Operation)},get bold(){return!!this._data.Bold},get italic(){return!!this._data.Italic},get color(){return this._data.Color},get verticalPosition(){var a=this._data.Operation;return"Y"in a?a.Y:0},get selected(){return this._model.selected===this}};a=0;for(var c=k.length;a<c;++a)e.push(this._createNode(k[a],b+1,f));this.flatNodeList.push(f);return f},triggerChange:function(){this.nodesChanged=!0;this.trigger("changed",
this)},setVisiblePages:function(f){this.currentViewport=f;var b=this;null===this.timer&&(this.timer=setTimeout(function(){b.computeActiveBookmark(b.currentViewport);b.triggerChange();b.timer=null},500))},computeActiveBookmark:function(f){for(var b=p.pluck(f,"number"),a=Math.min.apply(Math,b),e=-1,k=null,c=[],g=this.flatNodeList,d=0,h=g.length;d<h;++d){var l=g[d];if(l.nullOperation)l.documentVisible=!1;else{var n=l.pageIdx;l.documentVisible=!1;n<a?null!==k?n>k.pageIdx?k=l:n===k.pageIdx&&l.verticalPosition>=
k.verticalPosition&&(k=l):k=l:-1!==(e=b.indexOf(n))&&c.push({node:l,vert:f[e].duY+l.verticalPosition})}}c.sort(function(a,b){return a.vert-b.vert});f=k;b=null;for(d=0;d<c.length;++d)a=c[d],120>a.vert&&(f=a.node),null==b&&0<a.vert&&120>a.vert&&(b=a.node);null!==b&&(f=b);this.markVisible(f)},markVisible:function(f){this.currentVisibleNode=f;for(var b=[];null!==f;)f.documentVisible=!1,b.unshift(f),f=f.parent;f=0;for(var a=b.length;f<a;++f){var e=b[f];if(!e.opened||f+1===a){e.documentVisible=!0;break}}}};
p.extend(l.prototype,h.Events)})(r.viewer,r.ui,_,Backbone);(function(q,m,p){function h(){m.LabeledSidePanel.call(this,m.icon("th"),"thumbnails-panel-title")}q.ThumbnailsPanel=h;h.prototype=Object.create(m.LabeledSidePanel.prototype)})(r.viewer,r.ui,_);(function(q,m,p,h,n){function l(){m.ContainerWidget.call(this);this.layoutManager=new m.HorizontalAlignLayout(this);this.layoutManager.left=this.add(new f("text-selection-done",m.icon("check")));this.layoutManager.right=this.add(new f("text-selection-highlight",
m.icon("pencil")));$(this.el).on("tap click",".btn",n.bind(this.onButtonClicked,this))}function f(b,a){m.DomSizedWidget.call(this,document.createElement("div"));this.$el.append($("<button>").attr("data-action",b).attr("type","button").attr("class","btn").text(p._T(b)).prepend(a.el.firstChild))}q.SelectedTextActionBar=l;l.prototype=Object.create(m.ContainerWidget.prototype);l.prototype.onButtonClicked=function(b){"click"===b.type&&b.preventDefault();this.broadcastEvent("action:"+$(b.currentTarget).attr("data-action"))};
f.prototype=Object.create(m.DomSizedWidget.prototype)})(r.viewer,r.ui,r.i18n,Backbone,_);(function(q,m,p,h,n,l,f){function b(a,b){m.DomWidget.call(this,document.createElement("div"));this.el.className="vitrium-loading-indicator";var k=this.dim;k.w=52;this.dim=k;k=new Image;k.src=f.utils.Pool.resourceUrl(f.base_path+"ajax-loader.gif");this.el.appendChild(k);a.on("document:attached",p.bind(this.documentAttached,this));a.on("document:detached",p.bind(this.documentDetached,this));this.onLoadingBegin=
p.bind(this.loadingBegin,this);this.onLoadingEnd=p.bind(this.loadingEnd,this);if(this.showIO=b){k=n("<button type='button' class='btn btn-mini vitrium-io-stats-button'><i class='icon-signal'></i></button>");k.appendTo(n("body"));this.iostats=n("<div class='vitrium-io-stats'>");var c=this,g=function(){c.statsOn?c.iostats.remove():c.iostats.appendTo(n("body"));c.statsOn=!c.statsOn};this.iostats.click(g);k.click(g);this.statsOn=!1;this.stats={requestedTotal:0,downloadedTotal:0,unzipedTotal:0};this.statsTmpl=
p.template("<table> \t\t\t<tr><th>Requested total:</th><td><%= formatSize(requestedTotal, true) %></td></tr>\t\t\t<tr><th>Downloaded total:</th><td><%= formatSize(downloadedTotal, true) %></td></tr>\t\t\t<tr><th>Unzipped total:</th><td><%= formatSize(unzipedTotal, true) %></td></tr>\t\t\t</table>");this.iostats.html(this.statsTmpl(this.stats));this.statsInvalid=this.isLoading=!1}}l.formatSize=function(a,b){var f=b?1E3:1024;if(a<f)return a+" B";var c=b?"KB MB GB TB PB EB ZB YB".split(" "):"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),
g=-1;do a/=f,++g;while(a>=f);return a.toFixed(1)+" "+c[g]};q.LoadingIndicator=b;b.prototype=p.extend(Object.create(m.DomWidget.prototype),h.Events);q=b.prototype;q.setDim=function(a){m.DomWidget.prototype.setDim.call(this,a);this.el.style.lineHeight=(a.h+0.5|0)+"px"};q.documentAttached=function(a){a.on("loading:begin",this.onLoadingBegin);a.on("loading:end",this.onLoadingEnd);this.showIO&&(this.stats={requestedTotal:0,downloadedTotal:0,unzipedTotal:0},a.getContext().on("fileSystem:remoteRead",this.onRemoteRead,
this))};q.documentDetached=function(a){a.off("loading:begin",this.onLoadingBegin);a.off("loading:end",this.onLoadingEnd);a.getContext().off("fileSystem:remoteRead",this.onRemoteRead,this)};q.loadingBegin=function(){this.isLoading=!0;this.refresh()};q.loadingEnd=function(){this.isLoading=!1;this.refresh()};q.onRender=function(){this.el.style.display=this.isLoading?"block":"none";this.statsInvalid&&(this.iostats.html(this.statsTmpl(this.stats)),this.statsInvalid=!1)};q.onRemoteRead=function(a,b,f){var c=
this.stats;"requested"===a?c.requestedTotal+=b:"finished"===a&&(c.downloadedTotal+=b,c.unzipedTotal+=f);this.refreshStats(c)};q.refreshStats=function(a){this.statsInvalid=!0;this.refresh()}})(r.viewer,r.ui,_,Backbone,jQuery,I,r);(function(q,m){function p(h){this._fonts={};this._readyPages={};this._pages={};this._loadedFontFiles=[];this._initializedFontFiles=[];this._fontsInitializedCallback=h}q.FontsManager=p;p.prototype.canRenderPage=function(h){return!!this._readyPages[h]};p.prototype.initPageFonts=
function(h,n){this._pages.hasOwnProperty(h)||(this._pages[h]=n);return _.difference(n,this._loadedFontFiles)};p.prototype.pushFonts=function(h){for(var n=[],l=this._fonts,f=this._loadedFontFiles,b=[],a=h.length;a--;){var e=h[a];if(-1===f.indexOf(e)){f.push(e);b.push(e);e=h[a].data;n.push.apply(n,e);for(var k=e.length;k--;){var c=e[k];l[c.key]=c}}}var g=this;h=function(){g._initializedFontFiles.push.apply(g._initializedFontFiles,b);g._markPagesThatHaveFontsFullyLoaded()};m.load({fonts:n,success:h,
error:h,timeout:400})};p.prototype._markPagesThatHaveFontsFullyLoaded=function(){var h=!1,n=this._readyPages;_.each(this._pages,function(l,f){0===_.difference(l,this).length&&(h=n[f]=!0)},this._initializedFontFiles);h&&this._fontsInitializedCallback(this._pages)};p.prototype.glyphIdxToChar=function(h,n){var l=this._fonts[h];if(l){for(var f=l.ranges,b=f.length;b--;){var a=f[b];if(a[0]<=n&&a[1]>=n)return l=n-a[2],0>l?l+=65536:65535<l&&(l-=65536),String.fromCharCode(l)}if(0==f.length&&0==n)return" ";
f=l.ucs4Ranges;for(b=f.length;b--;)if(a=f[b],a[0]<=n&&a[1]>=n)return l=n+a[2],f=(l-65536)%1024+56320,String.fromCharCode(Math.floor((l-65536)/1024)+55296)+String.fromCharCode(f)}return 0===n?"":null}})(r.viewer,r.fonts);(function(q,m,p,h,n,l,f,b,a){function e(a,b,c,d,g){this.uiLoop=a;this.uiRenderVisiblePages=new m.UISync(this.renderVisiblePages,this,0);this.refresCalled=this.refreshAllPages=!1;this.fontsManager=g;this.taskScheduler=new h.TaskScheduler(this);var e=null,e=h.is_mobile&&-1===window.navigator.appVersion.indexOf("Trident")?
new p.Rectangle(0,0,1024,1024,0):new p.Rectangle(0,0,2048,2048,0);this.tilesCalculator=new m.TilesCalculator(function(){return e});var f=b.length;a=this.pages=Array(f);for(g=0;g<f;++g)a[g]=new k(b[g],d,this);this.dirtyLayers={};this.layers=c;g=0;for(f=c.length;g<f;++g)c[g].on("changed",this.onLayerChanged,this)}function k(a,b,d){this.info=a;this.status=this.contentState=0;this.data=this.renderer=null;this.manager=d;this.tryGetThumbnailFunct=b;this._thumbnail=null;this.thumbnailTile=new c(new p.Rectangle(0,
0,0,0,0));this.initialRenderingTask=this.layerTiles=this.oldTiles=this.currentTiles=null}function c(a){this.rect=a;this.task=this.canvas=null;this.rendered=!1}function g(a){this.tiles=null;this.creationScale=this.scale=a;this.independent=!0}q.PageCanvasManager=e;e.prototype={destroy:function(){for(var a=this.pages,b=0,c=a.length;b<c;++b)a[b].free();a.length=0;a=this.layers;b=0;for(c=a.length;b<c;++b)a[b].off("changed",this.onLayerChanged,this);this.pause()},getPage:function(a){return this.pages[a]},
freePageRange:function(a,b){for(var c=this.pages,d=a;d<=b;++d)c[d].free()},addLayer:function(a){-1===this.layers.indexOf(a)&&this.layers.push(a);a.on("changed",this.onLayerChanged,this)},removeLayer:function(a){a.off("changed",this.onLayerChanged,this);this.layers=f.without(this.layers,a);this.onLayerChanged()},onLayerChanged:function(a,b){var c=this.dirtyLayers;if(a)for(d=0,g=a.length;d<g;++d)c[a[d]]=!0;else for(var d=0,g=this.pages.length;d<g;++d)c[d]=!0;b||this.broadcastContentChanged()},broadcastContentChanged:function(){this.uiLoop.trigger("PageCanvasManager:contentChanged",
this)},resetDirtyLayers:function(a){a||(this.resetDirtyLayers={});for(var b=0,c=a.length;b<c;++b)delete this.dirtyLayers[a[b].number]},isLayerDirty:function(a){return!!this.dirtyLayers[a]},hasLayerContent:function(a){for(var b=!1,c=this.layers,d=0,g=c.length;!b&&d<g;++d)b=c[d].hasContent(a);return b},renderLayers:function(a,b,c,d){for(var g=this.layers,e=0,f=g.length;e<f;++e){var k=g[e];k.hasContent(a)&&(b.save(),k.render(a,b,c,d),b.restore())}},refresh:function(){this.refresCalled=!0;this.uiLoop.runAsync(this.uiRenderVisiblePages)},
refreshAll:function(){this.refreshAllPages=!0;this.refresh()},pause:function(){this.uiRenderVisiblePages.cancel()},resume:function(){this.uiRenderVisiblePages.resume()&&this.uiLoop.runAsync(this.uiRenderVisiblePages)},renderVisiblePages:function(a){var b=this.taskScheduler;b.markFrame();this.refresCalled&&(this.__refreshPages(a),this.refresCalled=!1);b.execute();b.delayed&&this.uiLoop.runAsync(this.uiRenderVisiblePages);this.__shouldRefreshMainUI(a)&&this.broadcastContentChanged()},__refreshPages:function(a){var b=
this.taskScheduler,c=a.pages,d=this.pages;this.refreshAllPages=!1;for(var g=this.tilesCalculator,e=this.fontsManager,f=0,k=c.length;f<k;++f){var h=c[f];if(e.canRenderPage(h.number))for(var h=d[h.number].prepareVisiblePartRendering(h,g,a),l=0,n=h.length;l<n;++l)b.addTask(h[l])}},__shouldRefreshMainUI:function(a){a=a.pages;for(var b=this.pages,c=!1,d=this.fontsManager,g=0,e=a.length;g<e;++g){var f=a[g];if(d.canRenderPage(f.number)){var k=b[f.number],f=k.checkRenderingTasks(f.viewportRect);f===r?(c=
!0,null!==k.oldTiles&&(k.oldTiles.free(),k.oldTiles=null)):f===t?c=!0:f===v&&(c=!0,this.refresh())}}return c}};f.extend(e.prototype,b.Events);k.prototype={free:function(){this._thumbnail=null;this.thumbnailTile.canvas=null;0!==this.contentState&&this.renderer&&this.renderer.free();null!==this.currentTiles&&this.currentTiles.free();null!==this.oldTiles&&this.oldTiles.free();null!==this.layerTiles&&this.layerTiles.free();if(null!==this.initialRenderingTask){var a=this.initialRenderingTask;a.interrupt();
a.tile.task=null;a.tile.free();a.tile=null}this.initialRenderingTask=this.layerTiles=this.oldTiles=this.currentTiles=null;this.status=this.contentState=0;this.data=null},getTiles:function(a,b,c){var d=a.viewportRect;this.thumbnailTile.rect.assign(a.baseRect);var g=null,e=null,f=!0;if(null!==this.currentTiles){this.currentTiles.scaleTo(b);var k=this.currentTiles.queryRenderedTilesForViewport(d),g=k.tiles,f=!k.predResult}f&&null!==this.oldTiles&&(this.oldTiles.scaleTo(b),k=this.oldTiles.queryRenderedTilesForViewport(d),
e=k.tiles,f=!k.predResult);k=[];f&&(null===this._thumbnail&&(this.thumbnail=this.tryGetThumbnailFunct(a.number)),null!==this._thumbnail&&k.push(this.thumbnailTile));null!==e&&k.push.apply(k,e);null!==g&&k.push.apply(k,g);this.renderLayers(k,a,d,b,c);return k},renderLayers:function(a,b,c,d,e){var f=this.manager.hasLayerContent(b.number),k=this.manager.isLayerDirty(b.number);f||null===this.layerTiles||(this.layerTiles.free(),this.layerTiles=null);var h=null!==this.currentTiles?this.currentTiles:null!==
this.oldTiles?this.oldTiles:null;f&&(null===this.layerTiles||this.layerTiles.independent&&null!==h)&&(null!==h?this.layerTiles=h.createDependendLayerManager():null!==this._thumbnail&&(h=this.manager.tilesCalculator.calculateTiles(b.baseRect,c),this.layerTiles=new g(d),this.layerTiles.init(h)));null!==this.layerTiles&&this.layerTiles.scaleTo(d);h=null;if(k&&null!==this.layerTiles)for(var h=this.layerTiles.queryTilesForViewport(c,function(a){return!0}).tiles,l=this.layerTiles.queryNotIntersectedTilesForViewport(c,
function(a){return!0}),f=0,k=l.length;f<k;++f)l[f].free();else f&&null!==this.layerTiles&&(h=this.layerTiles.queryNonRenderedAndNotAllocatedTilesForViewport(c).tiles);if(null!==h&&0<h.length)for(f=0,k=h.length;f<k;++f){l=h[f];null===l.canvas&&l.allocate();var n=l.rect,m=l.canvas.getContext("2d");m.clearRect(n.x,n.y,n.w,n.h);m.save();m.scale(d,d);this.manager.renderLayers(b.number,m,e,b);l.rendered=!0;m.restore()}null!==this.layerTiles&&(h=this.layerTiles.queryRenderedTilesForViewport(c).tiles,null!==
h&&a.push.apply(a,h))},prepareVisiblePartRendering:function(a,b,c){if(null===this.data||null!==this.initialRenderingTask&&!this.initialRenderingTask.done)return[];var d=a.baseRect,e=a.viewportRect;this.thumbnailTile.rect.assign(d);if(null!==this.currentTiles&&this.currentTiles.creationScale!==c.scale){null!==this.oldTiles&&this.oldTiles.free();var f=this.oldTiles=this.currentTiles;null===f.tiles?this.oldTiles=null:(f.freeNonRendered(),f.scaleTo(c.scale),f.freeNotInViewport(e));this.currentTiles=null}null===
this.currentTiles?(this.currentTiles=new g(c.scale),this.currentTiles.init(b.calculateTiles(d,e))):this.currentTiles.freeNotInViewportPreserve(e);null!==this.layerTiles&&this.layerTiles.creationScale!==c.scale?(this.layerTiles.free(),this.layerTiles=null):null!==this.layerTiles&&this.layerTiles.freeNotInViewportPreserve(e);b=this.currentTiles.queryNonRenderedAndNotAllocatedTilesForViewport(e).tiles;d=[];if(null===this.initialRenderingTask){if(0<b.length){var e=b[0],k=e.allocate();this.initialRenderingTask=
k=e.task=this.renderer.createAsyncRenderer(k,c.scale,a.number,this.info,this.data,!0);k.number=a.number;k.initial=!0;k.tile=e;d.push(k)}}else for(var f=0,h=b.length;f<h;++f)e=b[f],k=e.allocate(),k=e.task=this.renderer.createAsyncRenderer(k,c.scale,a.number,this.info,this.data,!1),k.initial=!1,d.push(k);return d},checkRenderingTasks:function(a){return null===this.data?d:null!==this.initialRenderingTask&&this.initialRenderingTask.done&&2!==this.initialRenderingTask.done?(this.initialRenderingTask.done=
2,this.currentTiles.checkRenderingTasks(a),v):this.currentTiles.checkRenderingTasks(a)}};Object.defineProperty(k.prototype,"thumbnail",{get:function(){return this._thumbnail},set:function(a){return this._thumbnail=this.thumbnailTile.canvas=a},enumerable:!0,configurable:!0});c.prototype={allocate:function(){var a=this.canvas=m.CANVAS_POOL.getCanvas(this.rect.w,this.rect.h),b=a.getContext("2d");b.save();b.translate(-this.rect.x,-this.rect.y);return a},free:function(){null!==this.task&&this.task.initial||
(null!==this.canvas&&(this.canvas=null),null!==this.task&&(this.task.interrupt(),this.task=null),this.rendered=!1)}};var d=0,t=1,r=2,v=3;g.prototype={init:function(a){for(var b=this.tiles=Array(a.length),d=0,g=a.length;d<g;++d)b[d]=new c(a[d])},createDependendLayerManager:function(){for(var a=this.tiles,b=Array(a.length),c=0,d=a.length;c<d;++c)b[c]=a[c].rect;a=new g(this.scale);a.init(b);a.independent=!1;return a},free:function(){for(var a=this.tiles,b=0,c=a.length;b<c;++b)a[b].free();this.tiles=
null},scaleTo:function(a){if(this.scale!==a&&this.independent){var b=this.scale;this.scale=a;for(var c=this.tiles,d={},g={},e=0,f=c.length;e<f;++e){var k=c[e].rect,h=k.x/b,l=k.y/b,n=k.w/b,m=k.h/b,h=h*a,l=l*a,n=n*a,m=m*a;d[k.x]=h;d[k.x+k.w]=h+n;g[k.y]=l;g[k.y+k.h]=l+m}e=0;for(f=c.length;e<f;++e)k=c[e].rect,h=d[k.x],l=g[k.y],n=d[k.x+k.w]-h,m=g[k.y+k.h]-l,k.x=h,k.y=l,k.w=n,k.h=m}},freeNonRendered:function(){for(var a=this.tiles,b=[],c=0,d=a.length;c<d;++c){var g=a[c];g.rendered?b.push(g):g.free()}this.tiles=
a},freeNotInViewport:function(a){for(var b=this.tiles,c=Math.sin,d=Math.cos,g=[],e=0,f=b.length;e<f;++e){var k=b[e];a.isIntersectedFast(k.rect,d,c)?g.push(k):k.free()}this.tiles=g},freeNotInViewportPreserve:function(a){for(var b=this.tiles,c=Math.sin,d=Math.cos,g=0,e=b.length;g<e;++g){var f=b[g];a.isIntersectedFast(f.rect,d,c)||f.free()}},checkRenderingTasks:function(a){a=this.queryTilesForViewport(a,function(a){return!0}).tiles;for(var b=!1,c=!0,g=0,e=a.length;g<e;++g){var f=a[g];null!==f.task&&
f.task.done||f.rendered?(b=!0,f.task=null,f.rendered=!0):c=!1}return b&&c?r:b?t:d},queryTilesForViewport:function(a,b){for(var c=this.tiles,d=[],g=Math.sin,e=Math.cos,f=!0,k=0,h=null===c?0:c.length;k<h;++k){var l=c[k];if(a.isIntersectedFast(l.rect,e,g)){var n=b(l),f=f&&n;n&&d.push(l)}}return{tiles:d,predResult:f}},queryNotIntersectedTilesForViewport:function(a,b){for(var c=this.tiles,d=[],g=0,e=null===c?0:c.length;g<e;++g){var f=c[g];b(f)&&!a.isIntersected(f.rect)&&d.push(f)}return d},queryNonRenderedAndNotAllocatedTilesForViewport:function(a){return this.queryTilesForViewport(a,
function(a){return!a.rendered&&null===a.canvas})},queryRenderedTilesForViewport:function(a){return this.queryTilesForViewport(a,function(a){return a.rendered})}}})(r.viewer,r.ui,r.geometry2,r,r.viewer,r.log,_,Backbone,jQuery);(function(q,m,p,h,n,l,f,b,a){function e(d){m.ContainerWidget.call(this);this.layoutManager=new m.BasicLayoutManager(this);var e=this.$el=l(this.el);this.options=d;this.uiFreePages=new m.UISync(n.bind(A,this),-5);var f=this.hammer=new b(this.el);f.options.prevent_default=!0;f.options.prevent_mouseevents=
!0;this.lockOverlay=l("<div class='vitrium-lock-overlay'>");this.dialogParentEl=d.dialogParentEl||this.lockOverlay;this.document=null;this.resizeMode=n.isUndefined(d.resizeMode)?C.SCALE_CONTENT:d.resizeMode;this.documentRendererClass=d.documentRendererClass||h.viewer.ScrollMasterDocumentRenderer;this.pageRenderClass=d.pageRendererClass||h.viewer.PageRenderer;this.releasePagesNotVisiblePages=d.releasePagesNotVisiblePages||1;this.renderAhead=d.renderAhead||1;this.layers=d.layers||[];this.onInfoLoaded=
n.bind(k,this);this.onPageLoaded=n.bind(c,this);this.onLoadingError=n.bind(g,this);this.onFontsInitialized=n.bind(function(){this.pageCanvasManager&&this.pageCanvasManager.refresh()},this);this.currentOverlay=null;this.onConnectionChanged=n.bind(t,this);this.scrollTimer=this.resizeTimer=null;this.scale=0.1;this.uiInitialized=!1;this.documentRenderer=this.documentInfo=null;this.controlsLock=!1;this.initialPageLoadCompleter=new h.async.Completer;this.isIE9=-1!==navigator.userAgent.indexOf("MSIE 9.0");
this.isIOSMobile=-1!==navigator.userAgent.indexOf("iPhone")||-1!==navigator.userAgent.indexOf("iPod");this.maxScale=0;this.online=!0;this.state=new h.State(D.STATES);h.utils.pipeEvents(this.state,"change",this,"change:state");this.state.push(x);this.on("change:state",n.bind(this.onStateChanged,this));f=l(a.document);this.eventPipes=new E([new u(e,"mousedown mouseleave click dblclick keydown keyup keypress focus focusout",this),new w(e,this),new u(f,"mousemove mouseup",this),new u(this.hammer,"ftouchstart ftouchend ftouchmove touch transformstart transform transformend rotate pinch pinchin pinchout tap touchmove doubletap dragstart drag dragend release hold",
this)]);this.pageCanvasManager=null;this.lastPagesEnd=this.lastPagesStart=-1;this.pageUnderMouse=this.freePagesIntervals=null;this.canvasLayers=[];this.pagesRequestedDuringLock=0;f=n.bind(function(a,b){b.current()===G&&this.focus()},this);this.on("mousedown",f).on("tap",f);e.on("contextmenu",function(a){a.preventDefault();return!1});this.currentStorageAction=null;this.onAfterViewportChange=new m.DelayTask(n.bind(v,this),d.renderDelay||250,!0);this.on("change:viewport",r,this);this.renderingPaused=
!1;this.events.on("action:openBookmark",z)}function k(a){this.documentInfo=a;var b=a.pages;this.pageCanvasManager=new D.PageCanvasManager(this.uiLoop,b,this.canvasLayers,n.bind(this.tryGetThumbnail,this),this.document.fontsManager);this.maxScale=4;a.maxScale=this.maxScale;a=this.documentRenderer;a.setPages(b);d.call(this,a.computeScale());h.log.debug("info loaded");this.trigger("change:pageCount",b.length);this.trigger("change:currentPage",0);this.trigger("document:info-loaded");this.state.changeState(x,
G)}function c(a,b,c){var d=this.pageCanvasManager.getPage(a);if(d.contentState===J.LOAD_REQUESTED||d.status<=c)2===c?(d.thumbnail=b,h.log.debug("thumb loaded:"+a),this.pageCanvasManager.broadcastContentChanged()):(d.data=b,h.log.debug("page data loaded:"+a),this.pageCanvasManager.refresh()),d.contentState=J.LOADED,d.status=c}function g(a,b){if(0===a){var c=this.pageCanvasManager.getPage(b);c.contentState=this.online?J.LOAD_FAILED:J.NOT_LOADED_OFFLINE;c.data={};this.pageCanvasManager.refresh();h.log.error("page load failed:"+
b)}}function d(a){if(n.isNumber(a)){var b=this.scale;a=this.limitScale(a);this.setProperty("scale",a);if((a=this.pageCanvasManager.pages)&&0<a.length)for(var c=Math.max(this.lastPagesStart,0),d=this.lastPagesEnd,g=a.length;c<g&&c<=d;++c)a[c].contentState=J.NOT_LOADED;return b}throw Error("Error: scale must be a number");}function t(a){var b=this.online;if((this.online=a)&&!b)if(null!==this.documentInfo){var c=this;setTimeout(function(){c.uiLoopContext&&c.uiLoopContext.pages&&c.requestPagesInViewer(c.uiLoopContext.pages)},
1E3)}else null!==this.document&&this.document.load()}function r(a,b){this.pauseRendering();a?this.pageCanvasManager.refreshAll():this.pageCanvasManager.refresh();this.onAfterViewportChange.execute(b)}function v(a){this.resumeRendering();this.requestPagesInViewer(a);this.trigger("viewport:done")}function A(){var a=this.freePagesIntervals;a.substract(this.lastPagesStart-1,this.lastPagesEnd+1);a.compact();for(var a=a.intervals,b=this.document,c=this.pageCanvasManager,d=0,g=a.length;d<g;++d){var e=a[d],
f=e.start,k=e.end;h.log.debug("freeing pages:"+e.toString());b.freePageRange(f,k);c.freePageRange(f,k)}a.length=0}function z(a){a=a.Operation;if("PageIdx"in a){var b=new h.geometry.Point(a.X,a.Y);b.x||(b.x=0);b.y||(b.y=0);this.scrollToPoint(a.PageIdx,b,"top")}else"URI"===a.Type&&D.openLink(a.Uri)}var D=q,E=h.utils.EventPipeGroup,u=D.$EventPipe,w=D.$MouseWheelEventPipe;f=D.STATES;var x=f.declare("NOT_READY"),G=f.declare("READY"),B=f.declare("LOCKED");f.declare("RENDERING_PAUSED");var C={NONE:0,SCALE_CONTENT:1,
FIXED_CONTENT:2},J={LOAD_FAILED:-2,NOT_LOADED:0,NOT_LOADED_OFFLINE:-1,LOAD_REQUESTED:1,LOADED:2};q.ResizeMode=C;q.DocumentViewer=e;q.PageContentState=J;e.prototype=n.extend(Object.create(m.ContainerWidget.prototype),{initUI:function(){this.$el.addClass("vitrium-document-viewer");h.is_mobile||this.$el.addClass("desktop");this.$el.removeAttr("tabindex");this.uiInitialized=!0;this.trigger("ui:initialized",this.$el,this)},destroy:function(){null!==this.parent&&this.parent.remove(this);this.dettachDocument();
this.eventPipes.destroy();this.trigger("viewer:destroyed",this.$el,this);this.off()},attachDocument:function(a){if(!this.uiInitialized)throw Error("Error: you have to call initUI method first!");this.document?this.dettachDocument():this.documentRenderer&&(this.remove(this.documentRenderer),this.documentRenderer.destroy(),this.documentRenderer=null);this.freePagesIntervals=new p.IntIntervalGroup;a.on("info:loaded",this.onInfoLoaded);a.on("page-fonts:initialized",this.onFontsInitialized);a.on("page:loaded",
this.onPageLoaded);a.on("loading:error",this.onLoadingError);a.on("connection:changed",this.onConnectionChanged);this.document=a;this.initDocumentRenderer();var b=this;a.on("page:loaded",function F(){b.initialPageLoadCompleter.complete();a.off("page:loaded",F)});this.trigger("document:attached",a,this)},dettachDocument:function(){this.state.reset(x);var a=this.document;a&&(a.off("info:loaded",this.onInfoLoaded),a.off("page-fonts:initialized",this.onFontsInitialized),a.off("page:loaded",this.onPageLoaded),
a.off("loading:error",this.onLoadingError),a.off("connection:changed",this.onConnectionChanged),this.document=null,this.trigger("document:detached",a,this),this.initialPageLoadCompleter=new h.async.Completer);this.pageCanvasManager&&(this.pageCanvasManager.destroy(),this.pageCanvasManager=null);this.documentRenderer&&(this.remove(this.documentRenderer),this.documentRenderer.destroy(),this.documentRenderer=null);if(this.documentInfo&&this.documentInfo.pages){for(var a=this.documentInfo.pages,b=0,c=
a.length;b<c;++b){var d=a[b];d.renderer&&d.renderer.releaseMemory()}this.documentInfo=null}this.freePagesIntervals=null;this.lastPagesEnd=this.lastPagesStart=-1;h.fonts.free()},setResizeMode:function(a){if(a<C.NONE||a>C.FIXED_CONTENT)throw Error("Error: resizeMode  must be value from vitrium.viewer.ResizeMode (NONE, SCALE_CONTENT, FIXED_CONTENT)");this.setProperty("resizeMode",a);this.documentRenderer.dim=this.documentRenderer.dim},setScale:function(a){this.trigger("manualscale:begin");a=d.call(this,
a);this.documentRenderer.setScale(this.scale,a);this.setResizeMode(C.FIXED_CONTENT);this.trigger("manualscale:end")},limitScale:function(a){return Math.max(Math.min(a,this.maxScale),0.1)},translateCoordinatesToPage:function(a,b){return this.documentRenderer.translateCoordinatesToPage(a,b)},getPageNumberByCoordinates:function(a,b){return this.documentRenderer.getPageNumberByCoordinates(a,b,1)},getPageInfo:function(a){return this.documentInfo.pages[a]},isBellowPage:function(a,b){return this.documentRenderer.isBellowPage(a,
b)},getCurrentPage:function(){return this.documentRenderer.getCurrentPage()},getNumberOfPages:function(){return this.documentInfo.pages.length},scrollTo:function(a){this.documentRenderer.scrollTo(Math.min(a,this.documentInfo.pages.length-1))},scrollToPoint:function(a,b,c){this.documentRenderer.scrollToPoint(Math.min(a,this.documentInfo.pages.length-1),b,c)},setScaleInternal:d,requestPagesInViewer:function(a){for(var b=this.pageCanvasManager.pages,c=b.length,d=this.pageRenderClass,g=c-1,e=0,f=this.document,
k=f.fileProvider(),l=this.layers,n=this.online,m=0,t=a.length;m<t;++m){var q=a[m].number,g=Math.min(q,g),e=Math.max(q,e),v=b[q],r=v.contentState;if(r==J.NOT_LOADED||r==J.NOT_LOADED_OFFLINE&&n||r==J.LOAD_FAILED)v.renderer||(v.renderer=new d(f,k,l)),r==J.LOAD_FAILED&&v.free(),v.contentState=J.LOAD_REQUESTED,this.trigger("page:requested",q),f.requestPage(q),h.log.debug("request loading: "+q)}0!==g&&(g-=this.releasePagesNotVisiblePages);e<c-1&&(e+=this.releasePagesNotVisiblePages);m=this.lastPagesStart;
t=this.lastPagesEnd;if(-1!==t&&(m!==g||t!==e)){a=p.intSubstract1D(m,t,g-1,e+1);b=this.freePagesIntervals;t=a?a.length:0;for(m=0;m<t;++m)b.addInterval(a[m]);0<t&&this.uiLoop.runAsync(this.uiFreePages)}this.lastPagesStart=g;this.lastPagesEnd=e},forceRequestPages:v,refresh:function(){this.uiLoopContext.pages&&this.forceRequestPages(this.uiLoopContext.pages)},changeDocumentRenderer:function(a){if(a!==this.documentRendererClass){this.documentRendererClass=a;var b=this.documentRenderer;if(null!==b){var c=
null,g=null,e=this.documentInfo;e&&!n.isEmpty(e.pages)&&(g=e.pages,c=b.getCurrentPage());this.remove(b);b.destroy();this.documentRenderer=b=new a(this,this.options);this.layoutManager.center=this.prepend(b);b.setPages(g);d.call(this,b.computeScale());null!==c&&b.scrollTo(c)}}},pauseRendering:function(){null!==this.pageCanvasManager&&this.pageCanvasManager.pause();this.renderingPaused=!0},resumeRendering:function(){null!==this.pageCanvasManager&&this.pageCanvasManager.resume();this.renderingPaused=
!1},setControlsLock:function(a){var b=this.state.current();if(a&&b!==B)this.lockOverlay.appendTo("body"),this.hammer.options.prevent_default=!1,this.hammer.options.prevent_mouseevents=!1,this.state.push(B),l("body").addClass("vitrium-locked");else if(!a&&b===B||this.controlsLock&&!a)this.hammer.options.prevent_default=!0,this.hammer.options.prevent_mouseevents=!0,this.lockOverlay.remove(),l("body").removeClass("vitrium-locked"),b===B&&(this.broadcastEvent("RefreshLayout"),this.state.pop());this.setProperty("controlsLock",
a)},initDocumentRenderer:function(){this.documentRenderer=new this.documentRendererClass(this,this.options);this.layoutManager.center=this.prepend(this.documentRenderer);this.trigger("change:controlsLock",this.controlsLock)},onStateChanged:function(a,b){b.has(G)?(this.eventPipes.on(),this.$el.attr("tabindex","0"),this.$el.focus()):(this.eventPipes.off(),this.$el.removeAttr("tabindex"));h.log.debug("[state] "+D.STATES.name(a))},tryGetThumbnail:function(a){return this.document.fileProvider().tryGetThumbnail(a)},
afterFrame:function(a){this.documentRenderer.afterFrame(a)},beforeFrame:function(a){this.documentRenderer.beforeFrame(a)},getPageIteratorBetweenDU:function(a,b){return this.documentRenderer.getPageIteratorBetweenDU(a,b)},addCanvasLayer:function(a){this.canvasLayers.push(a);null!==this.pageCanvasManager&&this.pageCanvasManager.addLayer(a)},removeCanvasLayer:function(a){null!==this.pageCanvasManager?this.pageCanvasManager.removeLayer(a):this.canvasLayers=n.without(this.canvasLayers,a)},focus:function(){this.$el.focus();
this.broadcastEvent("viewer:focused",this)},cancelCurrentStorageAction:function(){return this.currentStorageAction?(this.currentStorageAction.cancel(),!0):!1}});n.extend(e.prototype,m.Events);n.extend(e.prototype,h.events);Object.defineProperties(e.prototype,{uiLoopContext:{get:function(){return null===this.uiLoop?null:this.uiLoop.context}}});navigator.userAgent.indexOf("MSIE 9.0")})(r.viewer,r.ui,r.utils,r,_,jQuery,Backbone,Hammer,I);(function(q,m,p){function h(h){this._viewer=h;this._document=null;
h.on("document:attached",this.onDocumentAttached,this);h.on("document:detached",this.onDocumentDettached,this);h.on("viewport:done",this.onPageChanged,this)}q.PageSaver=h;h.prototype.onDocumentAttached=function(h){this._document=h;h.on("info:loaded",this.onInfoLoaded,this)};h.prototype.onDocumentDettached=function(h){this._document.off("info:loaded",this.onInfoLoaded,this);this._document=null};h.prototype.onInfoLoaded=function(){var h=this;this._document.context.openStorage().then(function(l){l.loadInfo("||last-position||",
function(f){f&&p.isNumber(f.position)&&h._viewer.documentRenderer.setVScrollPos(f.position*h._viewer.scale)})})};h.prototype.onPageChanged=function(){this._document&&this._document.context.openStorage().then(p.bind(function(h){h.storeInfo("||last-position||",{page:this._viewer.getCurrentPage(),position:this._viewer.documentRenderer.getDUViewportState().scrollY})},this))}})(r.viewer,r.log,_);(function(q,m,p,h,n,l){function f(){return k?performance.now():Date.now()}function b(a){this.viewer=a;a.on("dragstart",
this.onDragStart,this).on("drag",this.onDrag,this).on("dragend",this.onDragEnd,this).on("touch",this.onTouch,this);this.documentRenderer=null;this.dragStart=new p.Point(0,0);this.currentPos=new p.Point(0,0);this.scroller=new h.KineticScroller(1/h.CANVAS_POOL.GLOBAL_PIXEL_RATIO,0.2,null,n.bind(this.getCurrentTime,this));this.velocityTracker=new h.VelocityTracker;this.performScrolling=new h.UISync(this.onPerformScrolling,this,-11);this.animationStart=0;this.dragEnd=!1;this.lastDeltaY=this.lastDeltaX=
0}q.TouchScroll=b;q=m.STATES;var a=q.get("READY"),e=q.declare("TOUCH_SCROLL"),k=!(!l.performance||!l.performance.now);b.prototype={refresh:function(){this.viewer.uiLoop.runAsync(this.performScrolling)},onTouch:function(a,b){b.current()===e&&(this.scroller.mFinished||this.scroller.abortAnimation(),this.dragEnd=!1,b.pop())},onDragStart:function(b,g){g.current()===a&&"mouse"!==b.gesture.pointerType&&(this.dragEnd=!1,g.push(e),this.animationStart=f(),(this.documentRenderer=this.viewer.documentRenderer).fillScrollPosition(this.dragStart),
this.lastDeltaY=this.lastDeltaX=0)},onDragEnd:function(a,b){if(b.current()===e){var d=this.documentRenderer,k=d.fillScrollPosition(this.currentPos),l=a.gesture,d=d.scrollableViewport.viewport,n=this.velocityTracker;n.addMovement(l.center.pageX,l.center.pageY,f());n.computeCurrentVelocity(1E3,5E3);l=this.velocityTracker.computeDirection();null!==l?l===h.DIRECTION_VERTICAL?this.scroller.fling(k.x,k.y,0,-n.mYVelocity,0,d.contentWidth,0,d.contentHeight):this.scroller.fling(k.x,k.y,-n.mXVelocity,0,0,d.contentWidth,
0,d.contentHeight):this.scroller.fling(k.x,k.y,-n.mXVelocity,-n.mYVelocity,0,d.contentWidth,0,d.contentHeight);this.dragEnd=!0;this.refresh()}},onDrag:function(a,b){if(b.current()===e){var d=this.dragStart,k=a.gesture;this.velocityTracker.addMovement(k.center.pageX,k.center.pageY,f());k.preventDefault();var l=this.velocityTracker.computeDirection();null!==l?l===h.DIRECTION_HORIZONTAL?(this.scroller.startScroll(d.x,d.y,-k.deltaX,-this.lastDeltaY),this.lastDeltaX=k.deltaX):(this.scroller.startScroll(d.x,
d.y,-this.lastDeltaX,-k.deltaY),this.lastDeltaY=k.deltaY):(this.scroller.startScroll(d.x,d.y,-k.deltaX,-k.deltaY),this.lastDeltaX=k.deltaX,this.lastDeltaY=k.deltaY);this.refresh()}},onPerformScrolling:function(a,b){var d=this.scroller;if(!d.mFinished){var e=d.computeScrollOffset(),f=this.currentPos;f.x=d.mCurrX;f.y=d.mCurrY;this.documentRenderer.setScrollPosition(f);e&&this.refresh()}this.dragEnd&&(this.viewer.state.pop(),this.dragEnd=!1)},getCurrentTime:function(){if(0<this.animationStart){var a=
this.animationStart;this.animationStart=0;return a}return this.viewer.uiLoop.lastFrameTime()}}})(r.viewer.events,r.viewer,r.geometry,r.ui,_,I);(function(q,m,p){function h(h){this.viewer=h;h.on("mousewheel",this.onMouseWheel,this)}q.MouseWheelScroll=h;var n=m.STATES.get("READY");h.prototype={onMouseWheel:function(h,f,b,a,e){e.current()===n&&(this.viewer.documentRenderer.scrollByStep(b,a),h.preventDefault())}}})(r.viewer.events,r.viewer,_);(function(q,m,p,h,n){function l(a){this.viewer=a;a.on("mousedown",
this.onMouseDown,this).on("mouseup",this.onMouseUp,this).on("mousemove",this.onMouseMove,this);this.documentRenderer=null;this.handle=k;this.startPosition=this.dragStartValue=null;this.mousePosition=new e(0,0);this.performScroll=new p.UISync(this.onPerformScroll,this,-11);this.startDirection=this.timer=this.lastScrollTime=this.startTime=0}q.MouseScrollbar=l;q=m.STATES;var f=q.get("READY"),b=q.declare("MOUSE_SCROLLBAR"),a=q.declare("MOUSE_SCROLLBAR_AUTO"),e=h.Point,k=0;l.prototype={onMouseDown:function(c,
g){if(g.current()===f){var d=this.documentRenderer=this.viewer.documentRenderer,e=this.viewer.uiLoop,h=this.handle=d.getScrollbarHandle(c.pageX,c.pageY,1);this.dragStartValue=d.getScrollHandlePos(h);if(h===k){if(h=this.handle=d.getScrollbarArea(c.pageX,c.pageY,1),h!==k){g.push(a);this.lastScrollTime=0;this.startTime=Date.now();var l=this.mousePosition;l.x=c.pageX;l.y=c.pageY;this.startDirection=d.getDirectionFromScrollbarHandle(h,l.x,l.y);clearTimeout(this.timer);this.timer=setTimeout(n.bind(function(){e.runAsync(this.performScroll)},
this),250)}}else g.push(b);1===h?(this.startPosition=c.pageY,c.preventDefault()):2===h&&(this.startPosition=c.pageX,c.preventDefault())}},onMouseUp:function(c,g){var d=g.current();if(d===b)c.preventDefault(),this.handle=k,g.pop();else if(d===a&&(g.pop(),500>Date.now()-this.startTime)){clearTimeout(this.timer);this.timer=0;var d=this.viewer.documentRenderer,e=d.tmpPoint;e.x=c.pageX;e.y=c.pageY;d.translateToViewportFill(e,e);var f=d.getScrollbarArea(c.pageX,c.pageY,1);1===f?(d.setVHandlePos(e.y),c.preventDefault()):
2===f&&(d.setHHandlePos(e.x),c.preventDefault())}},onMouseMove:function(c,g){var d=g.current();d===b?(c.preventDefault(),1===this.handle?(d=this.dragStartValue+c.pageY-this.startPosition,this.documentRenderer.setVHandlePos(d)):(d=this.dragStartValue+c.pageX-this.startPosition,this.documentRenderer.setHHandlePos(d))):d===a&&(c.preventDefault(),d=this.mousePosition,d.x=c.pageX,d.y=c.pageY)},onPerformScroll:function(b,g){if(this.viewer.state.current()===a){var d=this.viewer.documentRenderer,e=this.viewer.uiLoop,
f=this.mousePosition,k=d.getDirectionFromScrollbarHandle(this.handle,f.x,f.y),h=g-this.lastScrollTime;0===k?this.viewer.state.pop():(0===this.lastScrollTime||50<h)&&this.startDirection===k&&d.getScrollbarArea(f.x,f.y,1)===this.handle&&(d.scrollViewportPage(k),this.lastScrollTime=g);e.runAsync(this.performScroll)}}}})(r.viewer.events,r.viewer,r.ui,r.geometry,_);(function(q,m,p){function h(a){this.viewer=a;a.on("dragstart",this.onDragStart,this).on("drag",this.onDrag,this).on("dragend",this.onDragEnd,
this).on("tap",this.onTap,this);this.documentRenderer=null;this.handle=b;this.dragStartValue=null}q.TouchScrollbar=h;q=m.STATES;var n=q.get("READY"),l=q.declare("TOUCH_SCROLLBAR"),f=h.SCROLLBAR_TOUCH_TOLERANCE=30,b=0;h.prototype={onDragStart:function(a,b){if(b.current()===n&&"mouse"!==a.gesture.pointerType){var k=a.gesture.center,c=this.documentRenderer=this.viewer.documentRenderer,k=this.handle=c.getScrollbarHandle(k.pageX,k.pageY,f);this.dragStartValue=c.getScrollHandlePos(k);switch(k){case 1:b.push(l);
break;case 2:b.push(l)}}},onDragEnd:function(a,e){e.current()===l&&(this.handle=b,e.pop())},onDrag:function(a,b){if(b.current()===l){var f=a.gesture;f.preventDefault();1===this.handle?this.documentRenderer.setVHandlePos(this.dragStartValue+f.deltaY):this.documentRenderer.setHHandlePos(this.dragStartValue+f.deltaX)}},onTap:function(a,b){if(b.current()===n){var k=a.gesture,c=a.gesture.touches[0],g=this.viewer.documentRenderer;if(1===g.getScrollbarArea(c.pageX,c.pageY,f)){var d=g.tmpPoint;d.x=c.pageX;
d.y=c.pageY;g.translateToViewportFill(d,d);g.setVHandlePos(d.y);k.preventDefault()}}}}})(r.viewer.events,r.viewer,_);(function(q,m,p){function h(h){this.viewer=h;h.on("keydown",this.onKeyDown,this)}q.KeyScroll=h;var n=m.STATES.get("READY");h.prototype={onKeyDown:function(h,f){if(f.current()===n){var b=this.viewer.documentRenderer,a=!1;switch(h.which){case 34:b.scrollViewportPage(1);a=!0;break;case 33:b.scrollViewportPage(-1);a=!0;break;case 38:b.scrollByStep(0,1);a=!0;break;case 40:b.scrollByStep(0,
-1);a=!0;break;case 39:b.scrollByStep(-1,0);a=!0;break;case 37:b.scrollByStep(1,0);a=!0;break;case 36:b.scrollToBeginning();a=!0;break;case 35:b.scrollToEnd(),a=!0}a&&h.preventDefault()}}}})(r.viewer.events,r.viewer,_);(function(q,m,p,h,n){function l(a){this.viewer=a;a.on("drag",this.onDrag,this).on("touchend",this.onTouchEnd,this).on("dragend",this.onTouchEnd,this).on("release",this.onTouchEnd,this).on("hold",this.onHold,this);this.documentRenderer=null;this.handle=k;this.direction=this.speed=0;
this.performScrolling=new p.UISync(this.onPerformScrolling,this,-11);this.renderState=new p.UISync(this.onRenderState,this,11);this.lastRequestTime=this.beginTime=this.lastTime=null;this.center=new e(0,0);this.finger=new e(0,0);this.inRun=!1}q.JoystickScroll=l;var f=p.CANVAS_POOL.GLOBAL_PIXEL_RATIO;q=m.STATES;var b=q.get("READY"),a=q.declare("JOYSTICK_SCROLL"),e=h.Point,k=0;l.prototype={onHold:function(c,g){if(g.current()===b){var d=this.viewer.documentRenderer,e=c.gesture.touches[0];"mouse"!==c.gesture.pointerType&&
null===d.getPageNumberByCoordinates(e.pageX,e.pageY,2)&&(g.push(a),this.center.x=e.pageX,this.center.y=e.pageY,this.inRun=!1,this.viewer.uiLoop.runAsync(this.performScrolling))}},onTouchEnd:function(b,g){g.current()===a&&(this.direction=this.speed=0,this.lastTime=null,this.inRun=!1,g.pop(),this.viewer.documentRenderer.refresh())},onDrag:function(b,g){if(g.current()===a){var d=b.gesture;d.preventDefault();this.direction=0<d.deltaY?-1:1;this.speed=Math.min(Math.abs(d.deltaY),400)/400;this.finger.x=
this.center.x+d.deltaX;this.finger.y=this.center.y+d.deltaY}},onPerformScrolling:function(b,g){var d=this.viewer;if(d.state.current()===a){var e=d.documentRenderer;e.refresh();if(null==this.lastTime)this.lastRequestTime=this.beginTime=this.lastTime=g;else{var f=g-this.lastTime,k=this.speed;0.05>k&&(k=0);0<k&&(this.inRun=!0,e.scrollByStep(0,f/(1E3/60)*this.direction*k),0.25>k&&0<k&&500<g-this.lastRequestTime&&(d.forceRequestPages(b.pages),this.lastRequestTime=g));this.lastTime=g}this.viewer.uiLoop.runAsync(this.performScrolling);
e.el.getContext&&this.viewer.uiLoop.runAsyncAsap(this.renderState)}},onRenderState:function(){var b=this.viewer,g=b.documentRenderer;if(b.state.current()===a){b=g.el.getContext("2d");g.setImageSmoothing(b,!0);b.strokeStyle="#696969";b.fillStyle="#696969";b.lineWidth=1.5*f;if(this.inRun){var d=this.finger,e=this.center,g=30*f;b.beginPath();var k=d.x*f,d=d.y*f-g,h=e.x*f,e=e.y*f-g;b.arc(k,d,g,0,2*Math.PI);b.globalAlpha=0.3;b.fill();b.globalAlpha=1;b.stroke();b.beginPath();b.lineWidth=1;b.moveTo(k,d);
b.lineTo(h,e);b.stroke();b.beginPath();g=50*f;b.arc(h,e,g,0,2*Math.PI);b.lineWidth=1.5*f;b.globalAlpha=0.3}else{var k=(this.lastTime-this.beginTime)/1E3%2/2+1,g=30*k*f,e=this.center;b.beginPath();b.arc(e.x*f,e.y*f-g,g,0,2*Math.PI);b.globalAlpha=0.3*k}b.fill();b.globalAlpha=1;b.stroke()}}}})(r.viewer.events,r.viewer,r.ui,r.geometry,_);(function(q,m,p,h){function n(b){this.viewer=b;b.on("transformstart",this.onTransformStart,this).on("pinch",this.onPinch,this).on("transformend",this.onTransfromEnd,
this);this.center=new p.Point(0,0);this.scale=0}q.PinchToZoom=n;q=m.STATES;var l=q.get("READY"),f=q.declare("ST_PINCH_TO_ZOOM");n.prototype={onTransformStart:function(b,a){a.current()===l&&(this.scale=this.viewer.scale,a.push(f),b.gesture.preventDefault())},onPinch:function(b,a){a.current()===f&&(this.viewer.setScale(this.scale*b.gesture.scale),b.gesture.preventDefault())},onTransfromEnd:function(b,a){a.current()===f&&a.pop()}}})(r.viewer.events,r.viewer,r.geometry,_);(function(q,m,p,h,n){function l(b,
c){this.viewer=b;this.selectionController=c;b.on("mousedown",this.onMouseDown,this).on("mouseup",this.onMouseUp,this).on("mousemove",this.onMouseMove,this).on("dblclick",this.onDblClick,this);this.documentRenderer=null;this.handle=e;this.duSelectionStart=new a(0,0);this.duSelectionEnd=new a(0,0);this.duScrollSpeed=new a(0,0);this.vpLastMousePosition=new a(0,0);this.performScroll=new p.UISync(this.onPerformScroll,this,-11);this.lastScrollTime=0;this.isMouseDown=!1;this.pauseScrollingUntilPage=null}
q.MouseTextSelection=l;q=m.STATES;var f=q.get("READY"),b=q.declare("MOUSE_TEXT_SELECTING"),a=h.Point,e=0;l.prototype={onMouseDown:function(a,b){if(b.current()===f){if(1===a.which){var g=this.documentRenderer=this.viewer.documentRenderer;if(null!==g.getPageNumberByCoordinates(a.pageX,a.pageY,1)){this.lastScrollTime=0;var d=this.duSelectionStart,e=this.vpLastMousePosition;e.x=d.x=a.pageX;e.y=d.y=a.pageY;g.translateToViewportFill(d,d);g.convertToDocumentUnitsFill(d,d);g=g.getDUViewportState();this.cleanFromViewport(d,
g);this.pauseScrollingUntilPage=null;this.isMouseDown=!0}}this.selectionController.cancelSelection()}},onMouseUp:function(a,c){var g=!1;c.current()===b&&(a.preventDefault(),c.pop(),this.pauseScrollingUntilPage=null,this.selectionController.finish(),g=!0);this.isMouseDown=!1;return g},onMouseMove:function(a,c){var g=c.current();if(this.isMouseDown){var d=this.vpLastMousePosition;if(d.x!==a.pageX||d.y!==a.pageY){g!==b&&c.push(b);a.preventDefault();var e=this.documentRenderer,g=this.duSelectionEnd;d.x=
g.x=a.pageX;d.y=g.y=a.pageY;d=e.getDUViewportState();e.translateToViewportFill(g,g);e.convertToDocumentUnitsFill(g,g);e=this.duScrollSpeed;e.y=0>=g.y?g.y:g.y>=d.height?g.y-d.height:0;e.x=0>=g.x?g.x:g.x>=d.width?g.x-d.width:0;0===e.x&&0===e.y||this.viewer.uiLoop.runAsync(this.performScroll);this.cleanFromViewport(g,d);this.selectionController.setSelectionPoints(this.duSelectionStart,g)}}},onDblClick:function(b){var c=this.viewer.documentRenderer,g=c.getPageNumberByCoordinates(b.pageX,b.pageY,1);null!==
g&&(b=new a(b.pageX,b.pageY),c.translateCoordinatesToPage(b,g),this.selectionController.selectWord(g,b),this.selectionController.finish())},cleanFromViewport:function(a,b){a.x+=b.scrollX-b.centerHorizontalConstant;a.y+=b.scrollY},onRectanglesReady:function(a){this.viewer.state.current()===b&&this.pauseScrollingUntilPage===a&&(this.selectionController.rectangleStorage.off("finished",this.onRectanglesReady,this),this.viewer.uiLoop.runAsync(this.performScroll))},onPerformScroll:function(a,c){var g=this.viewer.state.current(),
d=this.duScrollSpeed;if(g!==b||0===d.x&&0===d.y)0===d.x&&0===d.y&&(this.lastScrollTime=0);else{var g=this.viewer.documentRenderer,e=(c-this.lastScrollTime)/1E3;if(0!==this.lastScrollTime){g.scrollByStep(-d.x*e,-d.y*e);var e=this.vpLastMousePosition,f=this.duSelectionEnd,h=g.getDUViewportState();g.translateToViewportFill(f,e);g.convertToDocumentUnitsFill(f,f);this.cleanFromViewport(f,h);this.selectionController.setSelectionPoints(this.duSelectionStart,f)}this.lastScrollTime=c;this.selectionController.canScrollMore(d.y)?
this.viewer.uiLoop.runAsync(this.performScroll):(g=g.viewportPages(),d=this.pauseScrollingUntilPage=this.selectionController.getNextPageForDirection(d.y),g[g.length-1]!==d?this.viewer.uiLoop.runAsync(this.performScroll):(this.lastScrollTime=0,this.selectionController.rectangleStorage.on("finished",this.onRectanglesReady,this)))}}}})(r.viewer.events,r.viewer,r.ui,r.geometry,_);(function(q,m,p,h){function n(a,e,f,c){this.viewer=a;this.selectionController=e;this.selectionModel=f;this.handleSize=c;a.on("hold",
this.onHold,this).on("dragstart",this.onDragStart,this).on("drag",this.onDrag,this).on("dragend",this.onDragEnd,this).on("tap",this.onTap,this).on("mousedown",this.onMouseDown,this).on("mouseup",this.onMouseUp,this).on("mousemove",this.onMouseMove,this);this.state=b;this.holding=!1;this.tmpRect=new h.Rectangle(0,0,1,1,0);this.tmpPosition=new p.Point(0,0);this.activePageNumber=this.mouseDownPoint=this.staticPoint=this.startPoint=null;f.on("changed",this.onSelectionChanged,this)}m=m.STATES;var l=m.get("READY"),
f=m.declare("TOUCH_TEXT_SELECTING"),b=0;q.TouchTextSelection=n;n.prototype={onSelectionChanged:function(a,e){e&&!this.selectionModel.get("selection").isEmpty()?this.holding&&(this.state=1):(this.state=b,this.activePageNumber=null)},onHold:function(a,b){if(b.current()===l){this.holding=!0;var f=this._getPosition(a),c=this._getPageNumber(f);null!==c&&(this._translateToPage(c,f),this.activePageNumber=c,this.selectionController.selectWord(c,f),this.selectionModel.set("mode",this.selectionModel.MODE.TOUCH));
this.holding=!1}},onTap:function(a,e){if(1===this.state)return this.selectionController.cancelSelection(),this.state=b,this.activePageNumber=null,!0},onMouseDown:function(a,b){var f=this._getPositionMouse(a),c=f.clone();if(this.dragStart(f,b))return this.mouseDownPoint=c,a.preventDefault(),!0},onMouseUp:function(a,b){if(this.onDragEnd(a,b))return this.mouseDownPoint=null,!0},onMouseMove:function(a){if(null!==this.mouseDownPoint&&this.state!==b)return a=this._getPositionMouse(a),a.x-=this.mouseDownPoint.x,
a.y-=this.mouseDownPoint.y,this.drag(a)},onDragStart:function(a,b){if(this.dragStart(this._getPosition(a),b))return a.gesture.preventDefault(),!0},dragStart:function(a,b){if(b.current()===l&&1===this.state){var k=this.activePageNumber;if(this._getPageNumber(a)===k){this._translateToPage(k,a);var c=this.selectionModel.get("selection")[k],g=c[0].clone(),c=c[c.length-1].clone(),d=this.tmpRect;d.x=a.x;d.y=a.y;var h=g.clone();h.x-=6*this.handleSize;h.y-=6*this.handleSize;h.h+=6*this.handleSize;h.w+=6*
this.handleSize;if(h.isIntersected(d))return this.startPoint=this._translateFromPageToDU(k,g.getCenterPoint()),this.staticPoint=this._translateFromPageToDU(k,c.getCenterPoint()),this.state=2,b.push(f),!0;h=c.clone();h.h+=6*this.handleSize;h.w+=6*this.handleSize;if(h.isIntersected(d))return this.startPoint=this._translateFromPageToDU(k,c.getCenterPoint()),this.staticPoint=this._translateFromPageToDU(k,g.getCenterPoint()),this.state=3,b.push(f),!0}}return!1},onDragEnd:function(a,b){if(b.current()===
f)return this.state=1,this.startPoint=null,b.pop(),!0},drag:function(a){this._convertToDU(a);var b=this.startPoint.clone();b.add(a);this.selectionController.setSelectionPoints(b,this.staticPoint.clone());return!0},onDrag:function(a,e){if(e.current()===f&&this.state!==b){var k=a.gesture;k.preventDefault();var c=this.tmpPosition;c.x=k.deltaX;c.y=k.deltaY;return this.drag(c)}},_getPosition:function(a){a=a.gesture.touches[0];this.tmpPosition.x=a.pageX;this.tmpPosition.y=a.pageY;return this.tmpPosition},
_getPositionMouse:function(a){this.tmpPosition.x=a.pageX;this.tmpPosition.y=a.pageY;return this.tmpPosition},_getPageNumber:function(a){return this.viewer.documentRenderer.getPageNumberByCoordinates(a.x,a.y,1)},_translateToPage:function(a,b){return this.viewer.documentRenderer.translateCoordinatesToPage(b,a)},_translateFromPageToDU:function(a,b){return this.viewer.documentRenderer.translateCoordiatesFromPageToDU(b,a)},_convertToDU:function(a){return this.viewer.documentRenderer.convertToDocumentUnitsFill(a,
a)}}})(r.viewer.events,r.viewer,r.geometry,r.geometry2);(function(q,m){function p(){this.crc=-1}var h=p.prototype;h.table=function(){var h,l,f,b=[];for(h=0;256>h;h++){f=h;for(l=0;8>l;l++)f=f&1?f>>>1^3988292384:f>>>1;b[h]=f}return b}();h.append=q.ArrayBuffer?function(h){var l,f=this.table,b=this.crc;for(l=0;l<h.length;l++)b=f[(b^h[l])&255]^b>>>8;this.crc=b}:function(h){var l,f=this.table,b=this.crc;if(h.readNumber)for(l=0;l<h.length;l++)b=b>>>8^f[(b^h.readNumber(1,l))&255];else for(l=0;l<h.length;l++)b=
b>>>8^f[(b^h[l])&255];this.crc=b};h.get=function(){return~this.crc>>>0};h.equals=function(h){return h===this.get()};q.CRC32=p})(I,r.bin);(function(q,m){q.getDataHelper=m.ArrayBuffer?function(m,h){var n,l;n=new ArrayBuffer(m);l=new Uint8Array(n);h&&l.set(h,0);return{buffer:n,array:l,view:new DataView(n)}}:function(m,h){var n;n=new q.DataBufferView(h,0,m);return{buffer:n,array:n,view:n}}})(r.bin,I);(function(q,m,p,h,n,l){function f(a,b,c,d,g,e,f,k,h,l){var n=new m;l=new E;var p=new q.Inflater;l.req=
O(p,a,b,c,d,function(a,b){g&&!a&&n.append(b)},f,function(a){e(a,n.get())},k,h);return l}function b(a,b,c,d,g,e,f,k,h){function l(){var m=n*C;m<d?t.req=a.readUint8Array(c+m,Math.min(C,d-m),function(a){g&&p.append(a);f&&f(m,d,a);b.writeUint8Array([a],function(){n++;l()},h)},k):e(d,p.get())}var n=0,p=new m,t=new E;l();return t}function a(a,b){hash=n.enc.u8array.stringify({words:a.hasher.hash,sigBytes:20});if(b.readByteAt)for(var c=0;10>c;++c){if(hash[c]!=b.readByteAt(c))return!1}else for(c=0;10>c;++c)if(hash[c]!=
b[c])return!1;return!0}function e(b,c,d,g,e,f,k,h,l,m,p,t){function q(){var w=v*C;if(w<g)r.req=b.readUint8Array(d+w,Math.min(C,g-w),function(a){var b=n.enc.u8array.parse(a);m.update(b);b=l.process(b);f&&f(w,g,a);0<b.sigBytes?(a=n.enc.u8array.stringify(b),c.writeUint8Array([a],function(){v++;q()},h)):(v++,q())},k);else if(m.finalize(),a(m,p)){var u=l.finalize();0<u.sigBytes?(u=n.enc.u8array.stringify(u),c.writeUint8Array(u,function(){e(g)},h)):e(g)}else t()}var v=0,r=new E;q();return r}function k(a,
b,c,d,e,f,k,h,l,n,p,t,v){var r=new m,w=new E,u=new q.Inflater;w.req=g(u,a,b,c,d,function(a,b){e&&!a&&r.append(b)},k,function(a){f(a,r.get())},h,l,n,p,t,v);return w}function c(a){if(!B){var b=new p.DataBuffer;b.attachData(a);a=b}return a}function g(b,d,g,e,f,k,h,l,m,p,t,q,v,r){function w(){var E;A=u*C;if(z)(E=b.flush())?(y+=E.length,g.writeUint8Array(E,function(){k(!1,E);l(y)},p)):l(y);else if(A<f)x.req=d.readUint8Array(e+A,Math.min(C,f-A),function(a){a=n.enc.u8array.parse(a);q.update(a);a=t.process(a);
u++;h&&h(e+A,f);if(0<a.sigBytes){a=c(n.enc.u8array.stringify(a));var d=b.append(a,function(){});-1===d&&w();y+=d.length;k(!0,a);g.writeUint8Array(d,function(){k(!1,d);w()},p)}else w()},m);else if(q.finalize(),a(q,v)){var s=t.finalize();z=!0;0<s.sigBytes?(s=c(n.enc.u8array.stringify(s)),E=b.append(s,function(){}),y+=E.length,k(!0,s),g.writeUint8Array(E,function(){k(!1,E);w()},p)):w()}else r()}var u=0,A,y=0,z=!1,x=new E;w();return x}function d(a){var b,c="",d,g="\u00c7\u00fc\u00e9\u00e2\u00e4\u00e0\u00e5\u00e7\u00ea\u00eb\u00e8\u00ef\u00ee\u00ec\u00c4\u00c5\u00c9\u00e6\u00c6\u00f4\u00f6\u00f2\u00fb\u00f9\u00ff\u00d6\u00dc\u00f8\u00a3\u00d8\u00d7\u0192\u00e1\u00ed\u00f3\u00fa\u00f1\u00d1\u00aa\u00ba\u00bf\u00ae\u00ac\u00bd\u00bc\u00a1\u00ab\u00bb___\u00a6\u00a6\u00c1\u00c2\u00c0\u00a9\u00a6\u00a6++\u00a2\u00a5++--+-+\u00e3\u00c3++--\u00a6-+\u00a4\u00f0\u00d0\u00ca\u00cb\u00c8i\u00cd\u00ce\u00cf++__\u00a6\u00cc_\u00d3\u00df\u00d4\u00d2\u00f5\u00d5\u00b5\u00fe\u00de\u00da\u00db\u00d9\u00fd\u00dd\u00af\u00b4\u00ad\u00b1_\u00be\u00b6\u00a7\u00f7\u00b8\u00b0\u00a8\u00b7\u00b9\u00b3\u00b2_ ".split("");
for(b=0;b<a.length;b++)d=a.charCodeAt(b)&255,c=127<d?c+g[d-128]:c+String.fromCharCode(d);return c}function t(a){var b=[],c=0,d=0,g=0,e=0,f=0;for(a+="";c<a.length;)g=a.charCodeAt(c),128>g?(b[d++]=String.fromCharCode(g),c++):191<g&&224>g?(e=a.charCodeAt(c+1),b[d++]=String.fromCharCode((g&31)<<6|e&63),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b[d++]=String.fromCharCode((g&15)<<12|(e&63)<<6|f&63),c+=3);return b.join("")}function r(a){var b,c="";for(b=0;b<a.length;b++)c+=String.fromCharCode(a[b]);
return c}function v(a,b,c,d,g){a.version=b.view.getUint16(c,!0);a.bitFlag=b.view.getUint16(c+2,!0);a.compressionMethod=b.view.getUint16(c+4,!0);a.lastModDateRaw=b.view.getUint32(c+6,!0);var e;a:{var f=a.lastModDateRaw,k=(f&4294901760)>>16,f=f&65535;try{e=new Date(1980+((k&65024)>>9),((k&480)>>5)-1,k&31,(f&63488)>>11,(f&2016)>>5,2*(f&31),0);break a}catch(h){}e=void 0}a.lastModDate=e;if(d||8!=(a.bitFlag&8))a.crc32=b.view.getUint32(c+10,!0),a.compressedSize=b.view.getUint32(c+14,!0),a.uncompressedSize=
b.view.getUint32(c+18,!0);4294967295===a.compressedSize||4294967295===a.uncompressedSize?g(u):(a.filenameLength=b.view.getUint16(c+22,!0),a.extraFieldLength=b.view.getUint16(c+24,!0))}function A(a,b,c){for(var d=c,g=null,e=b+c;b<e;b+=d)if(d=a.view.getUint16(b,!0),b+=2,c=a.view.getUint16(b,!0),b+=2,39169===d){c=a.view.getUint16(b,!0);b+=2;g=a.view.getUint16(b,!0);b+=2;e=a.view.getUint8(b);b+=1;a=a.view.getUint16(b,!0);g={version:c,vendorId:g,strength:e,method:a};break}else d=c;return g}function z(a,
b,c,d){var g=new E;g.req=a.readUint8Array(a.size-b,b,function(e){e=J(e.length,e).view;1347093766!=e.getUint32(0)?g.req=z(a,b+1,c,d):c(e)},d);return g}function D(){this.encryptionHeader=this.commentLength=this.comment=this.offset=this.directory=this.extraFieldLength=this.filenameLength=this.uncompressedSize=this.compressedSize=this.crc32=this.lastModDate=this.lastModDateRaw=this.compressionMethod=this.bitFlag=this.version=this.filename=null}function E(){this.worker=this.req=null}var u="File is using Zip64 (4gb+ file size).",
w="Error while writing file data.",x="Error while reading file data.",G="Wrong password.",B="function"===typeof l.ArrayBuffer||"object"===typeof l.ArrayBuffer,C=B?1E6:5E5,J=p.getDataHelper,O;O=B?function(a,b,c,d,g,e,f,k,h,l){function n(){var v;p=m*C;p<g?q.req=b.readUint8Array(d+p,Math.min(C,g-p),function(b){var k=a.append(b,function(){f&&f(d+p,g)});-1===k&&(m++,n());t+=k.length;e(!0,b);c.writeUint8Array(k,function(){e(!1,k);m++;n()},l);f&&f(p,g)},h):(v=a.flush())?(t+=v.length,c.writeUint8Array(v,
function(){e(!1,v);k(t)},l)):k(t)}var m=0,p,t=0,q=new E;n();return q}:function(a,b,c,d,g,e,f,k,h,l){function n(){var v;p=m*C;p<g?q.req=b.readUint8Array(d+p,Math.min(C,g-p),function(b){function k(){if(0<v){var r=h+Math.min(v,1024),s;s=0==d&&r===v?b:b.subarray(h,r);r-=h;h+=r;v-=r;var w=a.append(s,function(){f&&f(d+h,g)});e(!0,b);if(-1===w){var u=setTimeout(k,1);q.req={abort:function(){clearTimeout(u)}}}else t+=w.length,c.writeUint8Array(w,function(){e(!1,w);var a=setTimeout(k,1);q.req={abort:function(){clearTimeout(a)}}},
l);f&&f(p,g)}else m++,n()}var h=0,v=b.length;k()},h):(v=a.flush())?(t+=v.length,c.writeUint8Array(v,function(){e(!1,v);k(t)},l)):k(t)}var m=0,p,t=0,q=new E;n();return q};E.prototype.terminate=function(){this.req&&this.req.abort();this.worker&&this.worker.terminate()};E.prototype.abort=E.prototype.terminate;q.readEntries=function(a,b,c){if(a)if(22>a.size)c("File format is not recognized.");else{var g=z(a,22,function(e){var f=e.getUint32(16,!0),k=e.getUint16(8,!0);g.req=a.readUint8Array(f,a.size-f,
function(a){var g=0,e=Array(k),f,h,l=J(a.length,a);for(a=0;a<k;++a){f=new D;if(1347092738!=l.view.getUint32(g)){c("File format is not recognized.");return}v(f,l,g+6,!0,function(a){c(a)});f.commentLength=l.view.getUint16(g+32,!0);f.directory=16==(l.view.getUint8(g+38)&16);f.offset=l.view.getUint32(g+42,!0);h=r(l.array.subarray(g+46,g+46+f.filenameLength));f.filename=2048===(f.bitFlag&2048)?t(h):d(h);if(f.bitFlag&1&&(f.encryptionHeader=A(l,g+46+f.filenameLength,f.extraFieldLength),null===f.encryptionHeader)){c("AES header 0x9901 not found");
return}f.directory||"/"!=f.filename.charAt(f.filename.length-1)||(f.directory=!0);h=r(l.array.subarray(g+46+f.filenameLength+f.extraFieldLength,g+46+f.filenameLength+f.extraFieldLength+f.commentLength));f.comment=2048===(f.bitFlag&2048)?t(h):d(h);e[a]=f;g+=46+f.filenameLength+f.extraFieldLength+f.commentLength}b(e)},c)},c);return g}else c("reader must be specified")};q.readEntry=function(a,c,d){function g(){D.apply(c,arguments)}function l(a,b){N&&N.terminate();N=null;try{if(a)if(2<arguments.length){for(var c=
[],d=1,e=arguments.length;d<e;++d)c.push(arguments[d]);a.apply(null,c)}else a(b);A&&A.free&&A.free();R=null}catch(f){g(f)}}function m(a){var b=J(4);b.view.setUint32(0,a);return c.crc32==b.view.getUint32(0)}function t(a,b){if(O&&!m(b))q();else try{A.getData(function(a){l(y,a)})}catch(c){l(g,c)}}function q(a,b){l(g,x,a,b)}function r(){l(g,w)}function u(){l(g,G)}var A=d.writer,y=d.onend||function(){},z=d.onprogress||function(){},D=d.onerror||function(){},C=d.onrange||function(){},O=d.checkCrc32,I=d.password,
N=null,R=new E;R.req=a.readUint8Array(c.offset,30,function(d){d=J(d.length,d);var l;if(1347093252!=d.view.getUint32(0))g("File format is not recognized.");else{var m=!1;v(c,d,4,!1,function(a){g(a);m=!0});m||(l=c.offset+30+c.filenameLength+c.extraFieldLength,C(c.offset,l+c.compressedSize),A.init(function(){if(0===c.compressionMethod)N=b(a,A,l,c.compressedSize,O,t,z,q,r);else if(1!==(c.bitFlag&1)||99!==c.compressionMethod||!c.encryptionHeader||0!==c.encryptionHeader.method&&8!==c.encryptionHeader.method)8===
c.compressionMethod?N=f(a,A,l,c.compressedSize,O,t,z,q,r,c.filename):g("Unknown compression method");else if(I){var d=c.encryptionHeader.strength,m=4*(d&3)+4,v=8*(d&3)+8;R.req=a.readUint8Array(l,m+2,function(b){b=J(b.length,b);var d=b.array.subarray(0,m);b=b.view.getUint16(m,!0);d=n.enc.u8array.parse(d);d=h.PBKDF2(n.enc.Utf8.parse(I),d,(2*v+2)/4,1E3);d=n.enc.u8array.stringify(d);if(!B){var f=new p.DataBuffer;f.attachData(d);d=f}if(J(d.length,d).view.getUint16(2*v,!0)===b){b=n.enc.u8array.parse(d.subarray(0,
v));var d=n.enc.u8array.parse(d.subarray(v,v+v)),s=n.algo.AES.createDecryptor(b,{iv:n.enc.u8array.parse([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),mode:n.mode.CTRGladman,padding:n.pad.NoPadding}),w=new h.HMACSha1(d);R.req=a.readUint8Array(l+c.compressedSize-10,10,function(b){N=0===c.encryptionHeader.method?e(a,A,l+m+2,c.compressedSize-10-m-2,t,z,q,r,s,w,b,u):k(a,A,l+m+2,c.compressedSize-10-m-2,O,t,z,q,r,s,w,b,u)},q)}else g(G)},q)}else g("Required AES key")},r))}},q);N=R;return function(){l()}};q.errors={ERR_BAD_FORMAT:"File format is not recognized.",
ERR_ENCRYPTED:"File contains encrypted entry.",ERR_ZIP64:u,ERR_READ:"Error while reading zip file.",ERR_WRITE:"Error while writing zip file.",ERR_WRITE_DATA:w,ERR_READ_DATA:x,ERR_DUPLICATED_NAME:"File already exists.",ERR_HTTP_RANGE:"HTTP Range not supported.",ERR_AES_HEADER_MISSING:"AES header 0x9901 not found",ERR_COMPRESION_METHOD:"Unknown compression method",ERR_REQUIRED_AES_KEY:"Required AES key",ERR_AES_UNKNOWN_STRENGTH:"Unknown strength value.",ERR_AES_WRONG_PASSWORD:G}})(r.zip,CRC32,r.bin,
r.crypto,N,I);(function(q,m){function p(){function a(b,c,d,e,m,n,p,q,r,s,w){var u,A,y,x,E,D,G,ca,C,B;G=0;y=d;do g[b[c+G]]++,G++,y--;while(0!==y);if(g[0]==d)return p[0]=-1,q[0]=0,k;D=q[0];for(x=1;x<=J&&0===g[x];x++);E=x;D<x&&(D=x);for(y=J;0!==y&&0===g[y];y--);A=y;D>y&&(D=y);q[0]=D;for(q=1<<x;x<y;x++,q<<=1)if(0>(q-=g[x]))return t;if(0>(q-=g[y]))return t;g[y]+=q;l[1]=x=0;G=1;for(ca=2;0!==--y;)l[ca]=x+=g[G],ca++,G++;G=y=0;do 0!==(x=b[c+G])&&(w[l[x]++]=y),G++;while(++y<d);d=l[A];G=l[0]=y=0;c=-1;C=-D;for(B=
ca=h[0]=0;E<=A;E++)for(b=g[E];0!==b--;){for(;E>C+D;){c++;C+=D;B=A-C;B=B>D?D:B;if((u=1<<(x=E-C))>b+1&&(u-=b+1,ca=E,x<B))for(;++x<B&&!((u<<=1)<=g[++ca]);)u-=g[ca];B=1<<x;if(s[0]+B>z)return t;h[c]=ca=s[0];s[0]+=B;0!==c?(l[c]=y,f[0]=x,f[1]=D,x=y>>>C-D,f[2]=ca-h[c-1]-x,r.set(f,3*(h[c-1]+x))):p[0]=ca}f[1]=E-C;G>=d?f[0]=192:w[G]<e?(f[0]=256>w[G]?0:96,f[2]=w[G++]):(f[0]=n[w[G]-e]+16+64,f[2]=m[w[G++]-e]);u=1<<E-C;for(x=y>>>C;x<B;x+=u)r.set(f,3*(ca+x));for(x=1<<E-1;0!==(y&x);x>>>=1)y^=x;y^=x;for(x=(1<<C)-1;(y&
x)!=l[c];)c--,C-=D,x=(1<<C)-1}return 0!==q&&1!=A?v:k}function b(a){var k;c||(c=[],d=[],g=e(J+1),f=[],h=e(J),l=e(J+1));d.length<a&&(d=[]);for(k=0;k<a;k++)d[k]=0;for(k=0;k<J+1;k++)g[k]=0;for(k=0;3>k;k++)f[k]=0;h.set(g.subarray(0,J),0);l.set(g.subarray(0,J+1),0)}var c,d,g,f,h,l;this.inflate_trees_bits=function(g,e,f,k,h){b(19);c[0]=0;g=a(g,0,19,19,null,null,f,e,k,c,d);if(g==t)h.msg="oversubscribed dynamic bit lengths tree";else if(g==v||0===e[0])h.msg="incomplete dynamic bit lengths tree",g=t;return g};
this.inflate_trees_dynamic=function(g,e,f,h,l,m,n,p,q){b(288);c[0]=0;m=a(f,0,g,257,x,G,m,h,p,c,d);if(m!=k||0===h[0])return m==t?q.msg="oversubscribed literal/length tree":m!=r&&(q.msg="incomplete literal/length tree",m=t),m;b(288);m=a(f,g,e,0,B,C,n,l,p,c,d);return m!=k||0===l[0]&&257<g?(m==t?q.msg="oversubscribed distance tree":m==v?(q.msg="incomplete distance tree",m=t):m!=r&&(q.msg="empty distance tree with lengths",m=t),m):k}}function h(){var a,b=0,g,e=0,f=0,h=0,l=0,m=0,n=0,p=0,q,v=0,r,s=0;this.init=
function(b,c,d,e,f,k){a=O;n=b;p=c;q=d;v=e;r=f;s=k;g=null};this.proc=function(w,u,y){var x,z,E=0,D=0,G=0,C,B,J,G=u.next_in_index;C=u.avail_in;E=w.bitb;D=w.bitk;B=w.write;for(J=B<w.read?w.read-B-1:w.end-B;;)switch(a){case O:if(258<=J&&10<=C){w.bitb=E;w.bitk=D;u.avail_in=C;u.total_in+=G-u.next_in_index;u.next_in_index=G;w.write=B;a:{y=q;E=v;D=r;G=s;C=w;B=u;var P=void 0,V=void 0,Y=void 0,X=z=x=J=void 0,U=void 0,N=void 0,aa=void 0,R=void 0,ea=void 0,W=void 0,Z=P=P=void 0,X=B.next_in_index,U=B.avail_in;
x=C.bitb;z=C.bitk;N=C.write;aa=N<C.read?C.read-N-1:C.end-N;R=A[n];ea=A[p];do{for(;20>z;)U--,x|=(B.read_byte(X++)&255)<<z,z+=8;P=x&R;V=y;Y=E;Z=3*(Y+P);if(0===(J=V[Z]))x>>=V[Z+1],z-=V[Z+1],C.window[N++]=V[Z+2],aa--;else{do{x>>=V[Z+1];z-=V[Z+1];if(0!==(J&16)){J&=15;W=V[Z+2]+(x&A[J]);x>>=J;for(z-=J;15>z;)U--,x|=(B.read_byte(X++)&255)<<z,z+=8;P=x&ea;V=D;Y=G;Z=3*(Y+P);J=V[Z];do if(x>>=V[Z+1],z-=V[Z+1],0!==(J&16)){for(J&=15;z<J;)U--,x|=(B.read_byte(X++)&255)<<z,z+=8;P=V[Z+2]+(x&A[J]);x>>=J;z-=J;aa-=W;if(N>=
P)P=N-P,0<N-P&&2>N-P?(C.window[N++]=C.window[P++],C.window[N++]=C.window[P++]):(C.window.set(C.window.subarray(P,P+2),N),N+=2,P+=2),W-=2;else{P=N-P;do P+=C.end;while(0>P);J=C.end-P;if(W>J){W-=J;if(0<N-P&&J>N-P){do C.window[N++]=C.window[P++];while(0!==--J)}else C.window.set(C.window.subarray(P,P+J),N),N+=J;P=0}}if(0<N-P&&W>N-P){do C.window[N++]=C.window[P++];while(0!==--W)}else C.window.set(C.window.subarray(P,P+W),N),N+=W;break}else if(0===(J&64))P+=V[Z+2],P+=x&A[J],Z=3*(Y+P),J=V[Z];else{B.msg="invalid distance code";
W=B.avail_in-U;W=z>>3<W?z>>3:W;U+=W;X-=W;z-=W<<3;C.bitb=x;C.bitk=z;B.avail_in=U;B.total_in+=X-B.next_in_index;B.next_in_index=X;C.write=N;y=t;break a}while(1);break}if(0===(J&64)){if(P+=V[Z+2],P+=x&A[J],Z=3*(Y+P),0===(J=V[Z])){x>>=V[Z+1];z-=V[Z+1];C.window[N++]=V[Z+2];aa--;break}}else{0!==(J&32)?(W=B.avail_in-U,W=z>>3<W?z>>3:W,U+=W,X-=W,z-=W<<3,C.bitb=x,C.bitk=z,B.avail_in=U,B.total_in+=X-B.next_in_index,B.next_in_index=X,C.write=N,y=c):(B.msg="invalid literal/length code",W=B.avail_in-U,W=z>>3<W?
z>>3:W,U+=W,X-=W,z-=W<<3,C.bitb=x,C.bitk=z,B.avail_in=U,B.total_in+=X-B.next_in_index,B.next_in_index=X,C.write=N,y=t);break a}}while(1)}}while(258<=aa&&10<=U);W=B.avail_in-U;W=z>>3<W?z>>3:W;U+=W;X-=W;z-=W<<3;C.bitb=x;C.bitk=z;B.avail_in=U;B.total_in+=X-B.next_in_index;B.next_in_index=X;C.write=N;y=k}G=u.next_in_index;C=u.avail_in;E=w.bitb;D=w.bitk;B=w.write;J=B<w.read?w.read-B-1:w.end-B;if(y!=k){a=y==c?T:M;break}}f=n;g=q;e=v;a=Q;case Q:for(x=f;D<x;){if(0!==C)y=k;else return w.bitb=E,w.bitk=D,u.avail_in=
C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);C--;E|=(u.read_byte(G++)&255)<<D;D+=8}x=3*(e+(E&A[x]));E>>>=g[x+1];D-=g[x+1];z=g[x];if(0===z){h=g[x+2];a=I;break}if(0!==(z&16)){l=z&15;b=g[x+2];a=K;break}if(0===(z&64)){f=z;e=x/3+g[x+2];break}if(0!==(z&32)){a=T;break}a=M;u.msg="invalid literal/length code";y=t;w.bitb=E;w.bitk=D;u.avail_in=C;u.total_in+=G-u.next_in_index;u.next_in_index=G;w.write=B;return w.inflate_flush(u,y);case K:for(x=l;D<x;){if(0!==C)y=k;else return w.bitb=
E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);C--;E|=(u.read_byte(G++)&255)<<D;D+=8}b+=E&A[x];E>>=x;D-=x;f=p;g=r;e=s;a=F;case F:for(x=f;D<x;){if(0!==C)y=k;else return w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);C--;E|=(u.read_byte(G++)&255)<<D;D+=8}x=3*(e+(E&A[x]));E>>=g[x+1];D-=g[x+1];z=g[x];if(0!==(z&16)){l=z&15;m=g[x+2];a=L;break}if(0===(z&64)){f=z;e=x/3+g[x+2];break}a=M;u.msg=
"invalid distance code";y=t;w.bitb=E;w.bitk=D;u.avail_in=C;u.total_in+=G-u.next_in_index;u.next_in_index=G;w.write=B;return w.inflate_flush(u,y);case L:for(x=l;D<x;){if(0!==C)y=k;else return w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);C--;E|=(u.read_byte(G++)&255)<<D;D+=8}m+=E&A[x];E>>=x;D-=x;a=H;case H:for(x=B-m;0>x;)x+=w.end;for(;0!==b;){if(0===J&&(B==w.end&&0!==w.read&&(B=0,J=B<w.read?w.read-B-1:w.end-B),0===J&&(w.write=B,y=w.inflate_flush(u,
y),B=w.write,J=B<w.read?w.read-B-1:w.end-B,B==w.end&&0!==w.read&&(B=0,J=B<w.read?w.read-B-1:w.end-B),0===J)))return w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);w.window[B++]=w.window[x++];J--;x==w.end&&(x=0);b--}a=O;break;case I:if(0===J&&(B==w.end&&0!==w.read&&(B=0,J=B<w.read?w.read-B-1:w.end-B),0===J&&(w.write=B,y=w.inflate_flush(u,y),B=w.write,J=B<w.read?w.read-B-1:w.end-B,B==w.end&&0!==w.read&&(B=0,J=B<w.read?w.read-B-1:w.end-B),
0===J)))return w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);y=k;w.window[B++]=h;J--;a=O;break;case T:7<D&&(D-=8,C++,G--);w.write=B;y=w.inflate_flush(u,y);B=w.write;if(w.read!=w.write)return w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);a=S;case S:return y=c,w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);case M:return y=
t,w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y);default:return y=d,w.bitb=E,w.bitk=D,u.avail_in=C,u.total_in+=G-u.next_in_index,u.next_in_index=G,w.write=B,w.inflate_flush(u,y)}};this.free=function(){}}function n(b,g){var f=this,l=aa,m=0,n=0,q=0,r,w=[0],s=[0],u=new h,y=0,x=e(3*z),E=new p;f.bitk=0;f.bitb=0;f.window=a(g);f.end=g;f.read=0;f.write=0;f.reset=function(a,b){b&&(b[0]=0);l==ea&&u.free(a);l=aa;f.bitk=0;f.bitb=0;f.read=f.write=
0};f.reset(b,null);f.inflate_flush=function(a,b){var c,d,g;d=a.next_out_index;g=f.read;c=(g<=f.write?f.write:f.end)-g;c>a.avail_out&&(c=a.avail_out);0!==c&&b==v&&(b=k);a.avail_out-=c;a.total_out+=c;a.next_out.insert?a.next_out=a.next_out.insert(f.window.subarray(g,g+c),d):a.next_out.set(f.window.subarray(g,g+c),d);d+=c;g+=c;g==f.end&&(g=0,f.write==f.end&&(f.write=0),c=f.write-g,c>a.avail_out&&(c=a.avail_out),0!==c&&b==v&&(b=k),a.avail_out-=c,a.total_out+=c,a.next_out.insert?a.next_out=a.next_out.insert(f.window.subarray(g,
g+c),d):a.next_out.set(f.window.subarray(g,g+c),d),d+=c,g+=c);a.next_out_index=d;f.read=g;return b};f.proc=function(a,b){var g,e,h,v,z,D,G;v=a.next_in_index;z=a.avail_in;e=f.bitb;h=f.bitk;D=f.write;for(G=D<f.read?f.read-D-1:f.end-D;;)switch(l){case aa:for(;3>h;){if(0!==z)b=k;else return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);z--;e|=(a.read_byte(v++)&255)<<h;h+=8}g=e&7;y=g&1;switch(g>>>1){case 0:e>>>=3;h-=3;g=h&7;e>>>=g;h-=g;l=
V;break;case 1:g=[];var B=[],C=[[]],J=[[]];p.inflate_trees_fixed(g,B,C,J);u.init(g[0],B[0],C[0],0,J[0],0);e>>>=3;h-=3;l=ea;break;case 2:e>>>=3;h-=3;l=X;break;case 3:return e>>>=3,h-=3,l=ga,a.msg="invalid block type",b=t,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b)}break;case V:for(;32>h;){if(0!==z)b=k;else return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);z--;e|=(a.read_byte(v++)&
255)<<h;h+=8}if((~e>>>16&65535)!=(e&65535))return l=ga,a.msg="invalid stored block lengths",b=t,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);m=e&65535;e=h=0;l=0!==m?P:0!==y?R:aa;break;case P:if(0===z||0===G&&(D==f.end&&0!==f.read&&(D=0,G=D<f.read?f.read-D-1:f.end-D),0===G&&(f.write=D,b=f.inflate_flush(a,b),D=f.write,G=D<f.read?f.read-D-1:f.end-D,D==f.end&&0!==f.read&&(D=0,G=D<f.read?f.read-D-1:f.end-D),0===G)))return f.bitb=e,f.bitk=
h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);b=k;g=m;g>z&&(g=z);g>G&&(g=G);f.window.set(a.read_buf(v,g),D);v+=g;z-=g;D+=g;G-=g;if(0!==(m-=g))break;l=0!==y?R:aa;break;case X:for(;14>h;){if(0!==z)b=k;else return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);z--;e|=(a.read_byte(v++)&255)<<h;h+=8}n=g=e&16383;if(29<(g&31)||29<(g>>5&31))return l=ga,a.msg="too many length or distance symbols",
b=t,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);g=258+(g&31)+(g>>5&31);if(!r||r.length<g)r=[];else for(G=0;G<g;G++)r[G]=0;e>>>=14;h-=14;q=0;l=N;case N:for(;q<4+(n>>>10);){for(;3>h;){if(0!==z)b=k;else return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);z--;e|=(a.read_byte(v++)&255)<<h;h+=8}r[Y[q++]]=e&7;e>>>=3;h-=3}for(;19>q;)r[Y[q++]]=0;w[0]=7;g=E.inflate_trees_bits(r,
w,s,x,a);if(g!=k)return b=g,b==t&&(r=null,l=ga),f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);q=0;l=U;case U:for(;;){g=n;if(!(q<258+(g&31)+(g>>5&31)))break;for(g=w[0];h<g;){if(0!==z)b=k;else return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);z--;e|=(a.read_byte(v++)&255)<<h;h+=8}g=x[3*(s[0]+(e&A[g]))+1];C=x[3*(s[0]+(e&A[g]))+2];if(16>C)e>>>=g,h-=g,r[q++]=C;else{G=18==C?
7:C-14;for(B=18==C?11:3;h<g+G;){if(0!==z)b=k;else return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);z--;e|=(a.read_byte(v++)&255)<<h;h+=8}e>>>=g;h-=g;B+=e&A[G];e>>>=G;h-=G;G=q;g=n;if(G+B>258+(g&31)+(g>>5&31)||16==C&&1>G)return r=null,l=ga,a.msg="invalid bit length repeat",b=t,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);C=16==C?r[G-1]:0;do r[G++]=C;while(0!==--B);q=G}}s[0]=
-1;G=[];B=[];C=[];J=[];G[0]=9;B[0]=6;g=n;g=E.inflate_trees_dynamic(257+(g&31),1+(g>>5&31),r,G,B,C,J,x,a);if(g!=k)return g==t&&(r=null,l=ga),b=g,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);u.init(G[0],B[0],x,C[0],x,J[0]);l=ea;case ea:f.bitb=e;f.bitk=h;a.avail_in=z;a.total_in+=v-a.next_in_index;a.next_in_index=v;f.write=D;if((b=u.proc(f,a,b))!=c)return f.inflate_flush(a,b);b=k;u.free(a);v=a.next_in_index;z=a.avail_in;e=f.bitb;h=f.bitk;
D=f.write;G=D<f.read?f.read-D-1:f.end-D;if(0===y){l=aa;break}l=R;case R:f.write=D;b=f.inflate_flush(a,b);D=f.write;if(f.read!=f.write)return f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);l=fa;case fa:return b=c,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b);case ga:return b=t,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,
b);default:return b=d,f.bitb=e,f.bitk=h,a.avail_in=z,a.total_in+=v-a.next_in_index,a.next_in_index=v,f.write=D,f.inflate_flush(a,b)}};f.free=function(a){f.reset(a,null);x=f.window=null};f.set_dictionary=function(a,b,c){f.window.set(a.subarray(b,b+c),0);f.read=f.write=c};f.sync_point=function(){return l==V?1:0}}function l(){function a(b){if(!b||!b.istate)return d;b.total_in=b.total_out=0;b.msg=null;b.istate.mode=va;b.istate.blocks.reset(b,null);return k}var b=this;b.mode=0;b.method=0;b.was=[0];b.need=
0;b.marker=0;b.wbits=0;b.inflateEnd=function(a){b.blocks&&b.blocks.free(a);b.blocks=null;return k};b.inflateInit=function(c,g){c.msg=null;b.blocks=null;if(8>g||15<g)return b.inflateEnd(c),d;b.wbits=g;c.istate.blocks=new n(c,1<<g);a(c);return k};b.inflate=function(a,b){var e,f;if(!a||!a.istate||!a.next_in)return d;b=b==E?v:k;for(e=v;;)switch(a.istate.mode){case oa:if(0===a.avail_in)return e;e=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.read_byte(a.next_in_index++))&15)!=s){a.istate.mode=ja;
a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=ja;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=ha;case ha:if(0===a.avail_in)return e;e=b;a.avail_in--;a.total_in++;f=a.read_byte(a.next_in_index++)&255;if(0!==((a.istate.method<<8)+f)%31){a.istate.mode=ja;a.msg="incorrect header check";a.istate.marker=5;break}if(0===(f&na)){a.istate.mode=va;break}a.istate.mode=Oa;case Oa:if(0===a.avail_in)return e;e=b;a.avail_in--;
a.total_in++;a.istate.need=(a.read_byte(a.next_in_index++)&255)<<24&4278190080;a.istate.mode=Pa;case Pa:if(0===a.avail_in)return e;e=b;a.avail_in--;a.total_in++;a.istate.need+=(a.read_byte(a.next_in_index++)&255)<<16&16711680;a.istate.mode=Fa;case Fa:if(0===a.avail_in)return e;e=b;a.avail_in--;a.total_in++;a.istate.need+=(a.read_byte(a.next_in_index++)&255)<<8&65280;a.istate.mode=Qa;case Qa:if(0===a.avail_in)return e;a.avail_in--;a.total_in++;a.istate.need+=a.read_byte(a.next_in_index++)&255;a.istate.mode=
Ga;return g;case Ga:return a.istate.mode=ja,a.msg="need dictionary",a.istate.marker=0,d;case va:e=a.istate.blocks.proc(a,e);if(e==t){a.istate.mode=ja;a.istate.marker=0;break}e==k&&(e=b);if(e!=c)return e;a.istate.blocks.reset(a,a.istate.was);a.istate.mode=Ra;case Ra:return c;case ja:return t;default:return d}};b.inflateSetDictionary=function(a,b,c){var g=0,e=c;if(!a||!a.istate||a.istate.mode!=Ga)return d;e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,g=c-e);a.istate.blocks.set_dictionary(b,g,e);a.istate.mode=
va;return k};b.inflateSync=function(b){var c,g,e;if(!b||!b.istate)return d;b.istate.mode!=ja&&(b.istate.mode=ja,b.istate.marker=0);if(0===(c=b.avail_in))return v;g=b.next_in_index;for(e=b.istate.marker;0!==c&&4>e;)b.read_byte(g)==Ya[e]?e++:e=0!==b.read_byte(g)?0:4-e,g++,c--;b.total_in+=g-b.next_in_index;b.next_in_index=g;b.avail_in=c;b.istate.marker=e;if(4!=e)return t;c=b.total_in;g=b.total_out;a(b);b.total_in=c;b.total_out=g;b.istate.mode=va;return k};b.inflateSyncPoint=function(a){return a&&a.istate&&
a.istate.blocks?a.istate.blocks.sync_point():d}}function f(){}function b(){var b=new f,d=D,g=a(512);b.inflateInit();b.next_out=g;this.append=function(g){var e=[];if(0!==g.length){b.next_in_index=0;b.next_in=g;b.avail_in=g.length;do{b.next_out_index=0;b.avail_out=512;g=b.inflate(d);if(g!=k&&g!=c&&g!=v)throw"inflating: "+b.msg;b.next_out_index&&(512==b.next_out_index?e.push(a(b.next_out)):e.push(a(b.next_out.subarray(0,b.next_out_index))))}while(0===b.avail_out);return e}};this.flush=function(){b.inflateEnd()}}
var a,e;if("function"!==typeof m.Uint8Array&&"object"!==typeof m.Uint8Array){e=a=function(a){var b;if("number"==typeof a){b=Array(a);for(var c=0;c<a;++c)b[c]=0}else for(b=Array(a.length),c=0;c<a.length;++c)b[c]=a.readNumber?a.readNumber(1,c):a[c];b.subarray=function(a,b){1>arguments.length&&(a=0);2>arguments.length&&(b=this.length);return this.slice(a,b)};b.set=function(a,b){b||(b=0);for(var c=0;c<a.length;++c)this[c+b]=a[c];return this};return b};var k=0,c=1,g=2,d=-2,t=-3,r=-4,v=-5,A=[0,1,3,7,15,
31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],z=1440,D=0,E=4,u=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,
7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,
0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,
8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,
96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,
18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,
31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,
9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],w=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,
80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],C=[0,
0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=15;p.inflate_trees_fixed=function(a,b,c,d){a[0]=9;b[0]=5;c[0]=u;d[0]=w;return k};var O=0,Q=1,K=2,F=3,L=4,H=5,I=6,T=7,S=8,M=9,Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],aa=0,V=1,P=2,X=3,N=4,U=5,ea=6,R=7,fa=8,ga=9,na=32,s=8,oa=0,ha=1,Oa=2,Pa=3,Fa=4,Qa=5,Ga=6,va=7,Ra=12,ja=13,Ya=[0,0,255,255];f.prototype={inflateInit:function(a){this.istate=new l;a||(a=15);return this.istate.inflateInit(this,a)},inflate:function(a){return this.istate?
this.istate.inflate(this,a):d},inflateEnd:function(){if(!this.istate)return d;var a=this.istate.inflateEnd(this);this.istate=null;return a},inflateSync:function(){return this.istate?this.istate.inflateSync(this):d},inflateSetDictionary:function(a,b){return this.istate?this.istate.inflateSetDictionary(this,a,b):d},read_byte:function(a){return this.next_in.readNumber?this.next_in.readNumber(1,a):this.next_in[a]},read_buf:function(a,b){return this.next_in.subarray(a,a+b)}};q.Inflater=b}})(r.zip,I);(function(q,
m){function p(h){h||(h="");h=h.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);this.scheme=h[1]||null;this.authority=h[2]||null;this.path=h[3]||null;this.query=h[4]||null;this.fragment=h[5]||null}q.URI=p;p.prototype.toString=function(){var h="";this.scheme&&(h+=this.scheme+":");this.authority&&(h+="//"+this.authority);this.path&&(h+=this.path);this.query&&(h+="?"+this.query);this.fragment&&(h+="#"+this.fragment);return h};p.prototype.isCrossDomain=function(){return null===
this.authority?!1:this.authority!==m.location.host};(function(){function h(h){if(!h)return"";h=h.replace(/\/\.\//g,"/");for(h=h.replace(/\/\.$/,"/");h.match(m);)h=h.replace(m,"/");for(h=h.replace(/\/([^\/]*)\/\.\.$/,"/");h.match(/\/\.\.\//);)h=h.replace(/\/\.\.\//,"/");return h}var m=/\/((?!\.\.\/)[^\/]*)\/\.\.\//;p.prototype.resolve=function(l){var f=new p;if(this.scheme)f.scheme=this.scheme,f.authority=this.authority,f.path=h(this.path),f.query=this.query;else{if(this.authority)f.authority=this.authority,
f.path=h(this.path),f.query=this.query;else{if(this.path){if("/"===this.path.charAt(0))f.path=h(this.path);else{var b;b=this.path;var a=/^(.*)\//;b=l.authority&&!l.path?"/"+b:l.path.match(a)[0]+b;f.path=b;f.path=h(f.path)}f.query=this.query}else f.path=l.path,f.query=this.query?this.query:l.query;f.authority=l.authority}f.scheme=l.scheme}f.fragment=this.fragment;return f}})()})(r.utils,I);(function(q,m,p){function h(a,b,c){function g(a){if(a>=d||a<b)throw Error("Error: index out of bounds");}if(0>
c)throw Error("Error: length must be greater than zero!");if(a.length-b<c)throw Error("Error: offset+length must be less or equal of the original buffer size");this.buffer=a;this.offset=b;this.length=c;var d=b+c;this.getUint8=function(c){c+=b;g(c);return a.readNumber(1,c)};this.getUint16=function(c,d){var f=c+b;g(f);return d?a.readNumberLittleEndian(2,f):a.readNumberBigEndian(2,f)};this.getUint32=function(c,d){var f=c+b;g(f);return d?a.readNumberLittleEndian(4,f):a.readNumberBigEndian(4,f)};this.subarray=
function(d,f){2>arguments.length&&(f=c);f>c&&(f=c);var h=d+b;g(h);return a.subarray(h,f)};this.subview=function(a,b){b=2>arguments.length?c:b-a;return new h(this,a,b)};this.readNumber=function(c,d){2>arguments.length&&(d=0);return a.readNumber(c,d+b)};this.readByteAt=function(c){1>arguments.length&&(c=0);var d=c+b;g(d);return a.readByteAt(d)};this.readNumberLittleEndian=function(c,d){2>arguments.length&&(d=0);var f=d+b;g(f);return a.readNumberLittleEndian(c,f)};this.readNumberBigEndian=function(c,
d){2>arguments.length&&(d=0);var f=d+b;g(f);return a.readNumberBigEndian(c,f)};this.writeNumberLittleEndian=function(c,d,f){2>arguments.length&&(f=0);var h=f+b;g(h);a.writeNumberLittleEndian(c,d,h)};this.writeNumberBigEndian=function(c,d,f){2>arguments.length&&(f=0);var h=f+b;g(h);a.writeNumberBigEndian(c,d,h)};this.writeDataBuffer=function(c,d,f,h){c=b+d;g(c);a.writeDataBuffer(dataBuffer,c,f,h)}}function n(a){this.xhr=a}function l(a,b){a=-1===a.indexOf("?")?a+"?":a+"&";return a+b}function f(a,b,
c){return l(a,b+"="+encodeURIComponent(c))}var b=m.isFunction(p.ArrayBuffer)||m.isObject(p.ArrayBuffer),a=/^x-(.+)/;m.extend(q,{DataBuffer:function(a){function f(a){return p[a]}function c(a){return p.charCodeAt(a)&255}function g(){0>n&&d(l.NotLoaded)}function d(a){switch(a){case l.EOFReached:throw Error("Error: EOF reached");case l.NotLoaded:throw Error("Error: Data must be loaded first!");case l.MustDefined:throw Error("Error: Arugment must be an array like object or string");}}var l={NotLoaded:1,
EOFReached:2,MustDefined:3},n=-1,p;this.getFileContents=function(){g();for(var a=[],b=0;b<n;b++)a.push(this.readByteAt(b));return a};this.getFileSize=function(){return n};this.readNumberLittleEndian=this.readNumber=function(a,b){g();for(var c=0,d=b+(a||1);d>b;--d)c=256*c+this.readByteAt(d-1);return c};this.readNumberBigEndian=function(a,b){g();for(var c=b+(a||1),d=0,e=b;e<c;++e)d=256*d+this.readByteAt(e);return d};this.readString=function(a,b){g();for(var c="",d=b+(a||1),e=b;e<d;e++)c+=String.fromCharCode(this.readNumber(1));
return c};this.readUnicodeString=function(a,b){g();for(var c="",d=b+2*(a||1),e=b;e<d;e+=2)c+=String.fromCharCode(this.readNumber(2));return c};this.attachData=function(a){m.isString(a)?(p=a,n=p.length,this.readByteAt=c):a?(p=a,n=p.length,this.readByteAt=f):d(l.MustDefined);this.length=n;return this};this.readByteAt=function(){g()};this.init=function(a,b){this.size=n;a()};this.writeByte=function(a,b){0>a&&(a=255+a+1);p[b]=a};this.getArray=function(){return p};this.writeNumberBigEndian=function(a,b,
c){if(Math.pow(2,8*a)<=b)throw Error("Number out of range!");for(var d=8*a-8,g=0;g<a;++g){var e=b>>d;b&=~(e<<d);this.writeByte(e,c+g);d-=8}};this.writeNumberLittleEndian=function(a,b,c){if(Math.pow(2,8*a)<=b)throw Error("Number out of range!");var d=8*a-8;c=c+a-1;for(var g=0;g<a;++g){var e=b>>d;b&=~(e<<d);this.writeByte(e,c-g);d-=8}};this.cumulativeOffset=function(){return 0};b?(this.writeDataBuffer=function(a,b,c,d){if(p.slice)for(var g=0;g<d;++g)this.writeByte(a.readByteAt(g+c),g+b);else a=a.subarray(c,
c+d),p.set(a,b)},this.getOriginalData=function(){return p},this.subarray=function(a,b){b||0===b||(length=p.length);a||(a=0);return p.subarray?p.subarray(a,b):new Uint8Array(p.slice(a,b))},this.readUint8Array=function(a,b,c,d){g();c(new Uint8Array(p.subarray(a,a+b)))}):(this.getOriginalData=function(){return m.isString(p)?this.getFileContents():p},this.writeDataBuffer=function(a,b,c,d){if(p.slice)for(var g=0;g<d;++g)this.writeByte(a.readByteAt(g+c),g+b)},this.subarray=function(a,b){b||0===b||(b=p.end);
a||(a=0);return this.getOriginalData().slice(a,b)},this.readUint8Array=function(a,b,c,d){g();c(new h(this,a,b))});if(a)if(b)this.attachData(new Uint8Array(a));else{for(var q=Array(a),r=0;r<a;++r)q[r]=0;this.attachData(q)}},DataBufferView:h,loadData:function(e){var h=e.url,c=e.method||"GET",g=e.success||function(){},d=e.error||function(){},p=e.headers||[];m.isFunction(h)&&(h=h());if(!m.isString(h))throw Error("Error: url must be a string or function that returns a string");if(!m.isString(c))throw Error("Error: method must be a string");
if(!m.isFunction(g))throw Error("Error: success must be a function");if(!m.isFunction(d))throw Error("Error: error must be a function");for(var q=new XMLHttpRequest,v=p.length,r=0;r<v;++r){var z=p[r];if("Range"===z[0])h=l(h,z[1]);else if(a.test(z[0]))var D=z[0].split(a),h=f(h,D[1].replace(/-/g,""),z[1])}q.open(c,h,!0);for(r=0;r<v;++r)z=p[r],q.setRequestHeader(z[0],z[1]);b?(q.responseType="arraybuffer",q.onload=function(a){a=this.status;200<=a&&300>a||304===a?(a=this.response)?(a=new Uint8Array(a),
g(a,this)):g(null,this):d(this.status,this);this.ontimeout=this.onload=null},q.onerror=function(a){d(this.status)}):(q.overrideMimeType&&q.overrideMimeType("text/plain; charset=x-user-defined"),q.onreadystatechange=function(a){4===this.readyState&&(a=this.status,200<=a&&300>a||304===a?((a=this.overrideMimeType||e.directDecode?this.responseText:q.responseBody.toArray())||(a=null),g(a,this)):d(this.status,this),this.ontimeout=this.onreadystatechange=null)});q.ontimeout=function(){d(this.status,this)};
q.send(null);return new n(q)},createBinaryStructure:function(a,b){var c=function(a){this.buffer=a},g;g=a?function(a,b){return function(c){if(0==arguments.length)return this.buffer.readNumberLittleEndian(a[1],b);this.buffer.writeNumberLittleEndian(a[1],c,b)}}:function(a,b){return function(c){if(0==arguments.length)return this.buffer.readNumberBigEndian(a[1],b);this.buffer.writeNumberBigEndian(a[1],c,b)}};for(var d={},f=0,l=0;l<b.length;++l){var n=b[l];d[n[0]]=g(n,f);f+=n[1]}d.__size_of=function(){return f};
d._ref_in_array=function(a){return new c(new h(this.buffer,f*a,this.buffer.length-f*a))};m.extend(c.prototype,d);return c},base64_encode:function(a){var b,c,g,d,f=0,h=0,l="";if(!a)return a;var m=a.length,l=Array(m);do b=a[f++],c=a[f++],g=a[f++],d=b<<16|c<<8|g,b=d>>18&63,c=d>>12&63,g=d>>6&63,d&=63,l[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d);while(f<m);l=l.join("");a=m%3;return(a?l.slice(0,a-3):l)+"===".slice(a||3)},appendToUrl:f,appendEncodedToUrl:l,EXTENSION_MATCHER:a});n.prototype.abort=function(){var a=function(){},b=this.xhr;b.onreadystatechange=a;b.onload=a;b.ontimeout=a;b.abort()}})(r.bin,_,I);(function(q,m,p){function h(h,f){var b=new XMLHttpRequest;"withCredentials"in b?b.open(h,f,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest,b.open(h,
f)):b=null;return b}function n(h,f){var b=new XMLHttpRequest;b.open(h,f,!0);return b}q.loadDataCORS=function(l){var f=l.url,b=l.method||"GET",a=l.success||function(){},e=l.error||function(){},k=l.headers||[],c=l.data?l.data:null;_.isFunction(f)&&(f=f());var g=null;if(g=(new m.URI(f)).isCrossDomain()?h(b,f):n(b,f)){if(!_.isString(f))throw Error("Error: url must be a string or function that returns a string");if(!_.isString(b))throw Error("Error: method must be a string");if(g.setRequestHeader){f=k.length;
for(b=0;b<f;++b){var d=k[b];g.setRequestHeader(d[0],d[1])}g.onload=function(b){b=this.status;200<=b&&300>b||304===b?(b=this.responseText)?a.call(l,b,this):a.call(l,null,this):e.call(l,this.status,this);this.onerror=this.ontimeout=this.onload=null};g.onerror=function(a){e.call(l,this.status)}}else g.onload=function(b){a.call(l,this.responseText,this);this.onerror=this.ontimeout=this.onload=null},g.onerror=function(a){e.call(l,0)};g.ontimeout=function(){e.call(l,0,this)};g.send(c);return g}e.call(l,
"CORS not supported");return null}})(r.utils,r.utils,I);(function(q,m){var p=!!m.Blob,h=m.webkitURL||m.mozURL||m.msURL||m.URL||{},n=!!h.createObjectURL,l=0,f=!1;m.navigator&&m.navigator.userAgent&&(f=m.navigator.userAgent.toLowerCase(),f=-1<f.indexOf("safari/")&&!f.indexOf("chrome/"));f?l=0:p&&n?l=2:p&&(l=1);q.Blob={level:l,URL:h}})(r.features,I);(function(q,m,p,h,n){function l(a,b){this.limit=a;this.numRequest=0;this.queue=[];this.loader=b||m}function f(c,g){this.scheduler=c;var d=this.request=h.clone(g);
this.success=g.success||e;this.error=g.error||e;this.xhr=null;d.success=h.bind(b,this);d.error=h.bind(a,this)}function b(){this.success.apply(this,arguments);this.xhr=null;this.scheduler&&(this.scheduler.release(this),this.scheduler=null)}function a(){this.scheduler&&(this.scheduler.release(this),this.scheduler=null);this.error.apply(this,arguments);this.xhr=null}function e(){}var k=!!n.document;q.IOScheduler=l;q=l.prototype;q.loadData=function(a){a=new f(this,a);this.queue.push(a);this.execute();
return a};q.abort=function(a){this.queue=h.without(this.queue,a)};q.release=function(a){if(k){var b=this;setTimeout(function(){--b.numRequest;b.execute()},0)}else--this.numRequest,this.execute()};q.execute=function(){for(var a=this.queue,b=Math.min(this.limit-this.numRequest,a.length),d=b;d--;){var e=a.shift();e.xhr=this.loader.loadData(e.request)}this.numRequest+=b};f.prototype.abort=function(){this.xhr&&(this.xhr.abort(),this.xhr=null);this.scheduler&&(this.scheduler.abort(this),this.scheduler.release(this),
this.scheduler=null)}})(r.bin,r.bin,r,_,I);(function(q,m){q.DirectDecodeDataLoader={loadData:function(p){var h=p.url,n=p.method||"GET",l=p.success||function(){},f=p.error||function(){};p=p.headers||[];for(var b=new XMLHttpRequest,a=p.length,e=0;e<a;++e){var k=p[e];if("Range"===k[0])h=m.appendEncodedToUrl(h,k[1]);else if(m.EXTENSION_MATCHER.test(k[0]))var c=k[0].split(m.EXTENSION_MATCHER),h=m.appendToUrl(h,c[1].replace(/-/g,""),k[1])}b.open(n,h,!0);h=p.length;for(e=0;e<h;++e)k=p[e],b.setRequestHeader(k[0],
k[1]);b.onreadystatechange=function(a){4===this.readyState&&(a=this.status,200<=a&&300>a||304===a?((a=this.responseText)||(a=null),l(a,this)):f(this.status,this),this.ontimeout=this.onreadystatechange=null)};b.send(null);return b}}})(r.bin,r.bin);(function(q,m){function p(h,l){this.url=h;this.loader=l||m;this.size=this.etag=null}q.RemoteFile=p;var h=/.*["](.+)["]/;p.prototype={init:function(m,l,f){"undefined"===typeof f&&(f=2);var b=this,a=this.url,a=-1===a.indexOf("?")?a+"?":a+"&",a=a+("_ts="+Date.now().toString(16));
return this.loader.loadData({url:a,headers:[["Cache-Control","no-cache"],["Range","bytes=0-"+f],["x-dd-enabled","true"]],method:"GET",success:function(a,f){var c=f.getResponseHeader("Content-Range"),g=0;if(c){var d=c.indexOf("/");-1!==d&&d+1<c.length&&(g=c.substring(d+1,c.length))}(c=f.getResponseHeader("ETag"))?(d=c.match(h))&&2==d.length&&(c=d[1]):c=null;b.etag=c;0<g?(b.size=parseInt(g,10),m(b.size,b.etag,a,f.getResponseHeader("x-supports-dd"))):l()},error:l})},checkETag:function(m,l){var f=this.url,
f=-1==f.indexOf("?")?f+"?":f+"&",f=f+("_ts="+Date.now().toString(16)),b=this;this.loader.loadData({url:f,headers:[["Cache-Control","no-cache"],["Range","bytes=0-1"]],method:"GET",success:function(a,e){e.getResponseHeader("Content-Range");var f=e.getResponseHeader("ETag");if(f){var c=f.match(h);c&&2==c.length&&(f=c[1])}else f=null;m(b.etag===f)},error:l})},readAndDecode:function(m,l,f,b,a,e){m||(m=0);e||(e="text/plain; charset=utf-8");var k=this.size;if(0<k){var c=m;m=m+l-1;l=this.url;l=-1==l.indexOf("?")?
l+"?":l+"&";var g="_ts="+Date.now().toString(16);l+=g;if(c<k&&m<k){var d=this;return this.loader.loadData({method:"GET",directDecode:!0,url:l,headers:[["Range","bytes="+c+"-"+m],["Cache-Control","no-cache"],["x-dd-enabled","true"],["x-dd",a+"|"+e]],success:function(a,c){var g=c.getResponseHeader("ETag");if(g){var e=g.match(h);e&&2==e.length&&(g=e[1])}else g=null;g!==d.etag?b(65535,c):f(a)},error:function(a,c){var g=!1;if(416===a){var e=c.getResponseHeader("ETag");e||(e=null);e!==d.etag&&(b(65535,
c),g=!0)}g||b(a,c)}})}b("The requested range of bytes is out of range: fileLen:"+k+" start:"+c+" end:"+m)}else b("The file is empty or must be initialized first");return null},readUint8Array:function(n,l,f,b){n||(n=0);var a=this.size;if(0<a){var e=n;n=n+l-1;var k=this.url,k=-1==k.indexOf("?")?k+"?":k+"&",c="_ts="+Date.now().toString(16),k=k+c;if(e<a&&n<a){var g=this;return this.loader.loadData({method:"GET",url:k,headers:[["Range","bytes="+e+"-"+n],["Cache-Control","no-cache"]],success:function(a,
c){var e=new m.DataBuffer;e.attachData(a);var k=c.getResponseHeader("ETag");if(k){var n=k.match(h);n&&2==n.length&&(k=n[1])}else k=null;k!==g.etag?b(65535,c):e.readUint8Array(0,l,f,b)},error:function(a,c){var e=!1;if(416===a){var f=c.getResponseHeader("ETag");f||(f=null);f!==g.etag&&(b(65535,c),e=!0)}e||b(a,c)}})}b("The requested range of bytes is out of range: fileLen:"+a+" start:"+e+" end:"+n)}else b("The file is empty or must be initialized first");return null}}})(r.bin,r.bin);(function(q,m,p,
h,n,l){function f(a,b,c){this.script=b;this.jobsCounter=0;this.count=a;this.readyCount=0;this.workers=Array(a);this.onready=c||k;this.onErrorMessage=this.onDispatchMessage=null;this.jobs={}}function b(a){m.log.error("[Pool]",this.script);m.log.error(a.message);var b=a.stack;b?m.log.error(b):m.log.error(a);a.preventDefault()}function a(a){a=a.data;var b=a.id;switch(a.cmd){case d:var c=this.jobs[b];c?c.trigger("message",a):m.log.error("job "+b+" not exists");break;case t:(c=this.jobs[b])?(c.trigger("terminated",
c),c=this.jobs[b],c.pool=null,c.terminating=!0,delete this.jobs[b]):m.log.error("job "+b+" not exists");break;case g:p.debug("[Pool] response from WebWorker "+this.script+" CMD_INITIALIZED");a=++this.readyCount;a===this.count&&(p.debug("[Pool] all workers are ready"),this.onready(a));break;case r:if(c=this.jobs[b])m.log.error("jobId:"+b+" name: "+c.name+" error: "+a.data),c.trigger("error",a)}}function e(a,b,c){this.pool=a;this.id=b;this.terminating=!1;this.name=c}function k(){}function c(a){var b=
$("meta[name='resources-version']").attr("content");return b&&0<b.length?a+"?version="+b:a}q.Pool=f;f.workerPath=function(a){var b=l.ZIP_WORKER_PATH;b||(b=m.base_path);a&&(b+=a);return c(b)};f.resourceUrl=c;var g=2,d=3,t=5,r=6;q=f.prototype;q.start=function(c){this.onDispatchMessage=n.bind(a,this);this.onErrorMessage=n.bind(b,this);var d=this.workers,g=this.script;p.debug("[Pool] WebWorker start src="+g+" n="+d.length);for(var e=d.length;e--;){var f=d[e]=new Worker(g);f.onmessage=this.onDispatchMessage;
f.onerror=this.onErrorMessage;f.postMessage({cmd:1,id:e,data:c})}};q.stop=function(){var a=this.workers;p.debug("[Pool] WebWorker stop src="+this.script);this.jobsCounter=this.readyCount=0;for(var b=a.length;b--;){var c=a[b];c&&(c.onmessage=null,c.terminate())}n.each(this.jobs,function(a){a.trigger("terminated",a)});this.jobs={};this.onErrorMessage=this.onDispatchMessage=null};q.createJob=function(a){if(this.readyCount===this.count){var b=this.jobsCounter++;return this.jobs[b]=new e(this,b,a)}throw Error("Pool is not ready yet!");
};q.postMessage=function(a,b){this.workers[a%this.count].postMessage({cmd:d,id:a,data:b})};q.terminate=function(a){this.workers[a%this.count].postMessage({cmd:4,id:a})};q=e.prototype;n.extend(q,h.Events);q.addEventListener=q.on;q.removeEventListener=q.off;q.postMessage=function(a){if(this.terminating)return!1;this.pool.postMessage(this.id,a);return!0};q.terminate=function(){this.terminating||(this.terminating=!0,this.pool.terminate(this.id))};q.abort=q.terminate})(r.utils,r,r.log,Backbone,_,I);(function(q,
m,p){function h(a,b,c,e,f,h,k){this.magic=a;this.version=b;this.globalFlags=c;this.numberOfEntries=e;this.directoryOffset=f;this.directoryLen=h;this.directoryCRC32=k}function n(a,b,c,e,f,h,k,l){this.flags=a;this.offset=b;this.compressedSize=c;this.uncompressedSize=e;this.crc32=f;this.filename=h;this.metadata=k;this.size=l;this.hmacKey=this.aesDerivedKey=this.aesMode=this.aesPV=this.aesSalt=this.hmacChecksum=null}function l(a,b){var c=a.getUint8(b+7);if(127<c)throw Error("Value is negative!");c=[c.toString(16),
a.getUint8(b+6).toString(16),a.getUint8(b+5).toString(16),a.getUint8(b+4).toString(16),a.getUint8(b+3).toString(16),a.getUint8(b+2).toString(16),a.getUint8(b+1).toString(16),a.getUint8(b+0).toString(16)];1===c[0].length&&(c[0]="0"+c[0]);1===c[1].length&&(c[1]="0"+c[1]);1===c[2].length&&(c[2]="0"+c[2]);1===c[3].length&&(c[3]="0"+c[3]);1===c[4].length&&(c[4]="0"+c[4]);1===c[5].length&&(c[5]="0"+c[5]);1===c[6].length&&(c[6]="0"+c[6]);1===c[7].length&&(c[7]="0"+c[7]);return new R(c.join(""),16)}function f(a){return 0>=
a.compareTo(k)?a.intValue():-1}function b(b,d,e){e-=1;var f=new a(e);f.init(c);f.decodeUTF8(b.subarray(d,d+e));var h=null;f.getData(function(a){h=a});return h}var a=m.SimpleUTF8Decoder,e=!!p.ArrayBuffer,k=new R(Math.pow(2,53).toString());h.parse=function(a,b){b||(b=0);var c=a.view,e=b,k=c.getUint16(e,!0),e=e+2,m=c.getUint16(e,!0),e=e+2,n=c.getUint16(e,!0),e=e+2,p=c.getUint16(e,!0),e=e+2,q=f(l(c,e)),e=e+8,r=c.getUint32(e,!0),c=c.getUint32(e+4,!0);return new h(k,m,n,p,q,r,c)};h.SIZE=24;h.prototype.isValid=
function(){return 0<this.directoryOffset&&21300===this.magic};n.SIZE=34;n.parse=function(a,c){var h=a.view,k=c,p=h.getUint16(k,!0),k=k+2;c=f(l(h,k));var k=k+8,q=f(l(h,k)),k=k+8,r=f(l(h,k)),k=k+8,D=h.getUint32(k,!0),k=k+4,E=h.getUint16(k,!0),k=k+2,h=h.getUint16(k,!0),k=k+2,u=b(a.array,k,E),k=k+E,k=0<h?a.array.subarray(k,k+h):null;if(null!==k&&!e){var w=new m.DataBuffer;w.attachData(k);k=w}return new n(p,c,q,r,D,u,k,n.SIZE+E+h)};n.prototype.isValid=function(){return this.offset>=h.SIZE&&0<this.compressedSize&&
0<this.uncompressedSize};q.FileEntry=n;q.Header=h;var c=function(){}})(r.g4s,r.bin,I);(function(q,m,p,h,n,l,f){function b(a,b){var c=m.u8array.stringify({words:a.hasher.hash,sigBytes:20});if(b.readByteAt)for(var d=0;10>d;++d){if(c[d]!=b.readByteAt(d))return!1}else for(d=0;10>d;++d)if(c[d]!=b[d])return!1;return!0}function a(a){if(!k){var b=new p.DataBuffer;b.attachData(a);a=b}return a}function e(){this.worker=this.req=null}var k=!!h.ArrayBuffer,c=k?1E6:5E5,g;g=k?function(a,b,d,g,f,h,k,l,m,n){function p(){var e;
r=q*c;r<f?O.req=b.readUint8Array(g+r,Math.min(c,f-r),function(b){var c=a.append(b,function(){k&&k(g+r,f)});-1===c&&(q++,p());J+=c.length;h(!0,b);d.writeUint8Array(c,function(){h(!1,c);q++;p()},n);k&&k(r,f)},m):(e=a.flush())?(J+=e.length,d.writeUint8Array(e,function(){h(!1,e);l(J)},n)):l(J)}var q=0,r,J=0,O=new e;p();return O}:function(a,b,d,g,f,h,k,l,m,n){function p(){var e;r=q*c;r<f?O.req=b.readUint8Array(g+r,Math.min(c,f-r),function(b){function c(){if(0<l){var m=e+Math.min(l,1024),w;w=0==g&&m===
l?b:b.subarray(e,m);m-=e;e+=m;l-=m;var u=a.append(w,function(){k&&k(g+e,f)});h(!0,b);if(-1===u){var y=setTimeout(c,1);O.req={abort:function(){clearTimeout(y)}}}else J+=u.length,d.writeUint8Array(u,function(){h(!1,u);var a=setTimeout(c,1);O.req={abort:function(){clearTimeout(a)}}},n);k&&k(r,f)}else q++,p()}var e=0,l=b.length;c()},m):(e=a.flush())?(J+=e.length,d.writeUint8Array(e,function(){h(!1,e);l(J)},n)):l(J)}var q=0,r,J=0,O=new e;p();return O};var d;d=k?function(d,g,f,h,k,l,n,p,q,r,G,B,C,J){function O(){var e;
K=I*c;if(L)(e=d.flush())?(F+=e.length,f.writeUint8Array(e,function(){l(!1,e);p(F)},r)):p(F);else if(K<k)H.req=g.readUint8Array(h+K,Math.min(c,k-K),function(b){b=m.u8array.parse(b);B.update(b);b=G.process(b);I++;n&&n(h+K,k);if(0<b.sigBytes){b=a(m.u8array.stringify(b));var c=d.append(b,function(){});-1===c&&O();F+=c.length;l(!0,b);f.writeUint8Array(c,function(){l(!1,c);O()},r)}else O()},q);else if(B.finalize(),b(B,C)){var N=G.finalize();L=!0;0<N.sigBytes?(N=a(m.u8array.stringify(N)),e=d.append(N,function(){}),
F+=e.length,l(!0,N),f.writeUint8Array(e,function(){l(!1,e);O()},r)):O()}else J()}var I=0,K,F=0,L=!1,H=new e;O();return H}:function(d,g,f,h,k,l,n,p,q,r,G,B,C,J){function O(){var e;K=I*c;if(L)(e=d.flush())?(F+=e.length,f.writeUint8Array(e,function(){l(!1,e);p(F)},r)):p(F);else if(K<k)H.req=g.readUint8Array(h+K,Math.min(c,k-K),function(b){function c(){if(0<g){var p=e+Math.min(g,1024),q;q=0==h&&p===g?b:b.subarray(e,p);p-=e;e+=p;g-=p;q=m.u8array.parse(q);B.update(q);q=G.process(q);I++;n&&n(h+K,k);if(0<
q.sigBytes){q=a(m.u8array.stringify(q));var w=d.append(q,function(){});if(-1===w){var u=setTimeout(c,1);H.req={abort:function(){clearTimeout(u)}}}else F+=w.length,f.writeUint8Array(w,function(){l(!1,w);var a=setTimeout(c,1);H.req={abort:function(){clearTimeout(a)}}},r)}else I++,O()}else I++,O()}var g=b.length,e=0;c()},q);else if(B.finalize(),b(B,C)){var N=G.finalize();L=!0;0<N.sigBytes?(N=a(m.u8array.stringify(N)),e=d.append(N,function(){}),F+=e.length,l(!0,N),f.writeUint8Array(e,function(){l(!1,
e);O()},r)):O()}else J()}var I=0,K,F=0,L=!1,H=new e;O();return H};e.prototype.terminate=function(){this.req&&this.req.abort();this.worker&&this.worker.terminate()};e.prototype.abort=e.prototype.terminate;q.inflate=function(a,b,c,d,f,h,k,m,p){var q=new n,r=new e,B=new l.Inflater;r.req=g(B,a,b,c,d,function(a,b){f&&!a&&q.append(b)},k,function(a){h(a,q.get())},m,p);return r};q.copy=function(a,b,d,g,f,h,k,l,m){function p(){var e=q*c;e<g?C.req=a.readUint8Array(d+e,Math.min(c,g-e),function(a){f&&r.append(a);
k&&k(e,g,a);b.writeUint8Array([a],function(){q++;p()},m)},l):h(g,r.get())}var q=0,r=new n,C=new e;p();return C};q.aesCopy=function(a,d,g,f,h,k,l,n,p,q,r,B){function C(){var e=J*c;if(e<f)O.req=a.readUint8Array(g+e,Math.min(c,f-e),function(a){var b=m.u8array.parse(a);q.update(b);b=p.process(b);k&&k(e,f,a);0<b.sigBytes?(a=m.u8array.stringify(b),d.writeUint8Array([a],function(){J++;C()},n)):(J++,C())},l);else if(q.finalize(),b(q,r)){var K=p.finalize();0<K.sigBytes?(K=m.u8array.stringify(K),d.writeUint8Array(K,
function(){h(f)},n)):h(f)}else B()}var J=0,O=new e;C();return O};q.aesInflate=function(a,b,c,g,f,h,k,m,p,q,r,B,C){var J=new n,O=new e,I=new l.Inflater;O.req=d(I,a,b,c,g,function(a,b){f&&!a&&J.append(b)},k,function(a){h(a,J.get())},m,p,q,r,B,C);return O}})(r.g4s,r.utils,r.bin,I,CRC32,r.zip,N);(function(q,m,p,h,n,l){function f(){this.req=null}var b="file is too small to hold G4S format",a="invalid G4S header",e="invalid G4S directory checksum",k="Error while writing file data.",c="Error while reading file data.",
g="Wrong password.",d="Missing global AES metadata",t="Missing AES metadata",r=q.Header,v=q.FileEntry,A=q.inflate,z=q.copy,D=q.aesInflate,E=q.aesCopy,u=p.CRC32,w=!!p.ArrayBuffer;q.readEntries=function(c,g,h,k){function l(f){if(f.length<r.SIZE)h(b);else{f=m.getDataHelper(f.length,f);var k=r.parse(f);k.isValid()?n.req=c.readUint8Array(k.directoryOffset,k.directoryLen,function(a){var b=new u;b.append(a);if(b.equals(k.directoryCRC32)){var c=m.getDataHelper(a.length,a);a=[];for(var f=0,l=0,n=k.numberOfEntries;l<
n;++l){var p=v.parse(c,f);p.isValid()&&a.push(p);f+=p.size}if(k.globalFlags&3){var q=null,r=b=null;if(1===(k.globalFlags&1))if(0<c.array.length-f){var w=c.view,r=w.getUint8(f),l=f+1+2+(4*(r&3)+4);if(c.array.length<l){h(d);return}b=w.getUint16(f+1,!0);q=c.array.subarray(f+3,l)}else{h(d);return}l=0;for(n=a.length;l<n;++l)if(p=a[l],w=p.flags,2===(w&2)&&null!==q)p.hmacChecksum=p.metadata,p.aesSalt=q,p.aesPV=b,p.aesMode=r;else if(4===(w&4)&&0<p.metadata.length)if(w=m.getDataHelper(p.metadata.length,p.metadata).view,
c=4*((p.aesMode=w.getUint8(0))&3)+4,p.metadata.length===3+c+10)p.aesPV=w.getUint16(1,!0),p.aesSalt=p.metadata.subarray(3,3+c),p.hmacChecksum=p.metadata.subarray(3+c,3+c+10);else{h(t);return}else if(0!==(w&6)){h(t);return}}g(a,k.globalFlags)}else h(e)},h):h(a)}}if(c)if(c.size<r.SIZE)h(b);else{var n=new f;if(k)if(w)l(k);else{var p=new m.DataBuffer;p.attachData(k);l(p)}else n.req=c.readUint8Array(0,r.SIZE,l,h);return n}else h("reader must be specified")};q.readEntry=function(a,b,d){function e(){y.apply(b,
arguments)}function f(a,b){R&&R.terminate();R=null;try{if(a)if(2<arguments.length){for(var c=[],d=1,g=arguments.length;d<g;++d)c.push(arguments[d]);a.apply(null,c)}else a(b);v&&v.free&&v.free()}catch(h){e(h)}}function m(a,c){if(I&&c.equals(b.crc32))p();else try{v.getData(function(a){f(w,a)})}catch(d){f(e,d)}}function p(a,b){f(e,c,a,b)}function q(){f(e,k)}function t(){f(e,g)}var r=d.ddSupport,v=d.writer,w=d.onend||function(){},u=d.onprogress||function(){},y=d.onerror||function(){},I=!!d.checkCrc32,
R=null;v.init(function(){if(b.flags&6){var c=n.u8array.parse(b.aesDerivedKey),d=n.u8array.parse(b.hmacKey),g=b.hmacChecksum,c=l.createDecryptor(c,{iv:n.u8array.parse([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),mode:N.mode.CTRGladman,padding:N.pad.NoPadding}),d=new h.HMACSha1(d);R=b.flags&1?D(a,v,b.offset,b.compressedSize,I,m,u,p,q,c,d,g,t):E(a,v,b.offset,b.compressedSize,I,m,u,p,q,c,d,g,t)}else if(r){var e=null,e=b.flags&1?a.readAndDecode(b.offset,b.compressedSize,function(a){f(w,a)},p,"deflate"):a.readAndDecode(b.offset,
b.compressedSize,function(a){f(w,a)},p,"");R={terminate:function(){e.abort()}}}else R=b.flags&1?A(a,v,b.offset,b.compressedSize,I,m,u,p,q):z(a,v,b.offset,b.compressedSize,I,m,u,p,q)},q);return function(){R.terminate()}};f.prototype.terminate=function(){this.req&&this.req.abort()};f.prototype.abort=f.prototype.terminate})(r.g4s,r.bin,I,r.crypto,r.utils,N.algo.AES);(function(q,m){function p(h,n,l){return m.find(h,function(f){return f.id===n&&f.url!==l})}q.findFileById=function(h,n){return m.find(h,
function(h){return h.id===n})};q.findFileByIdAndUrl=function(h,n,l){return m.find(h,function(f){return f.id===n&&f.url===l})};q.findFileByIdAndNotUrl=p;q.findFileByUrl=function(h,n){return m.find(h,function(h){return h.url===n})};q.makeIdSafe=function(h,m,l){for(var f=m=m.replace(/\//g,"-"),b=1;p(h,f,l);)f=m+" ("+b++ +")";return f}})(r.fs,_);(function(q,m,p){function h(a){this.db=a}function n(a,b,d,e,f){this.name=a;this.tx=null;var h=this;f?b.readTransaction(function(a){h.tx=a;d(h)},e):b.transaction(function(a){h.tx=
a;d(h)},e)}function l(a,b){this.name=a;this.tx=b}function f(a,g,d,f,h){this.name=a;this.db=g;this.tx=g.transaction([b],h?e:k);d(this);this.tx.onerror=function(a){f&&f(a)}}var b="asyncStorage_data";q.TxStorage=h;var a={WebSQL:n,IndexedDB:f};h.prototype={transaction:function(b,g){var d=a[this.db.type];"undefined"===typeof d?(m.error("transactions are not supported on this type: "+this.db.type),g&&g("transactions are not supported on this type: "+this.db.type)):new d(this.db.name,this.db._db,b,g,!1)},
readTransaction:function(b,g){var d=a[this.db.type];"undefined"===typeof d?(m.error("transactions are not supported on this type: "+this.db.type),g&&g("transactions are not supported on this type: "+this.db.type)):new d(this.db.name,this.db._db,b,g,!0)}};l.prototype=n.prototype={abort:function(){this.tx.executeSql("ABORT",[],null,function(){return!0})},setItem:function(a,b,d,e){function f(a){e&&e(a)}var h=this.name;this.tx.executeSql("UPDATE "+h+" SET asyncStorage_value=? WHERE asyncStorage_key=?",
[b,a],function(e,k){0===k.rowsAffected?e.executeSql("INSERT INTO "+h+" (asyncStorage_key, asyncStorage_value) VALUES (?,?)",[a,b],function(e,f){d&&d(new l(h,e),b,a)},f):d&&d(new l(h,e),b,a)},f)},getItem:function(a,b,d){var e=this.name;this.tx.executeSql("SELECT * FROM "+e+" WHERE asyncStorage_key=?",[a],function(d,f){b&&(0===f.rows.length?b(new l(e,d),null,a):b(new l(e,d),f.rows.item(0).asyncStorage_value,a))},function(a){d&&d(a)})},listItems:function(a,b){this.tx.executeSql("SELECT asyncStorage_key FROM "+
this.name,[],function(b,g){for(var e=[],f=0,h=g.rows.length;f<h;++f)e.push(g.rows.item(f).asyncStorage_key);a(e)},function(a){b&&b(a)})},removeItem:function(a,b,d){var e=this.name;this.tx.executeSql("DELETE FROM "+e+" WHERE asyncStorage_key=?",[a],function(a,c){b&&b(new l(e,a))},function(a){d&&d(a)})},clear:function(a,b){var d=this.name;this.tx.executeSql("DELETE FROM "+d,[],function(b,g){a&&a(new l(d,b))},function(a){b&&b(a)})}};var e=p.IDBTransaction?IDBTransaction.READ_ONLY||"readonly":"readonly",
k=p.IDBTransaction?IDBTransaction.READ_WRITE||"readwrite":"readwrite";f.prototype={abort:function(){this.tx.abort()},setItem:function(a,g,d,e){var f=this,h=this.tx.objectStore(b).put({asyncStorage_key:this.name+"|-|"+a,asyncStorage_value:g,store:this.name});h.onsuccess=function(b){d&&d(f,g,a)};h.onerror=function(a){e&&e(a)}},getItem:function(a,g,d){var e=this,f=this.tx.objectStore(b).get(this.name+"|-|"+a);f.onsuccess=function(){g&&("undefined"===typeof f.result?g(e,null,a):g(e,f.result.asyncStorage_value,
a))};f.onerror=function(a){d&&d(a)}},removeItem:function(a,g,d){var e=this,f=this.tx.objectStore(b)["delete"](this.name+"|-|"+a);f.onsuccess=function(){g&&g(e,a)};f.onerror=function(a){d&&d(a)}},listItems:function(a,g){var d=this,e=this.tx.objectStore(b).index("by_store").openCursor(IDBKeyRange.only(this.name)),f=[];e.onsuccess=function(b){if(b=b.target.result){try{var g=b.primaryKey.substring(d.name.length+3,b.primaryKey.length);f.push(g)}catch(e){}b["continue"]()}else a(f)};e.onerror=g},clear:function(a,
g){function d(a){f=a}var e=this.tx.objectStore(b).index("by_store").openCursor(IDBKeyRange.only(this.name)),f=null;e.onsuccess=function(b){b=b.target.result;null!==f&&g&&g(f);b?(b["delete"]().onerror=d,b["continue"]()):a&&a()};e.onerror=function(a){g&&g(a)}}}})(r.utils,r.log,I);(function(q,m,p,h,n){function l(a,c,g){var h=e?b:"openDatabase"in n?f:null;if(null!==h)return new h(a,c,g);p.run(function(){g(d)})}function f(b,d,e){this.type="WebSQL";var f=this.name='"'+b+'"';this._db=null;try{(this._db=
n.openDatabase("asyncStorage","1.0","",null)).transaction(h.bind(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS schema_info (table_name TEXT NOT NULL PRIMARY KEY) ");b.executeSql("CREATE TABLE IF NOT EXISTS schema_erase_id (erase_id INTEGER NOT NULL PRIMARY KEY) ");b.executeSql("SELECT table_name FROM schema_info WHERE table_name=?",[f],function(a,b){0===b.rows.length&&a.executeSql("INSERT INTO schema_info  ( table_name) VALUES (?)",[f])});b.executeSql("CREATE TABLE IF NOT EXISTS "+f+" ("+g+
" TEXT NOT NULL, "+c+" TEXT NOT NULL PRIMARY KEY )",null,h.bind(function(){this.st=new m.TxStorage(this);d&&d(this)},this),e||a)},this),e||a)}catch(k){e&&p.run(function(){e(k)})}}function b(a,c,d,g){this.type="IndexedDB";this.name=a;this._db=null;try{var f=e.open(k,g||1);f.addEventListener("upgradeneeded",h.bind(this.onUpgradeNeeded,this));f.addEventListener("success",h.bind(function(e){var g=this._db=e.target.result;e=g.objectStoreNames;for(var f=!1,l=0,n=e.length;l<n&&!f;++l)f=e[l]===k;f?(this.st=
new m.TxStorage(this),c&&c(this)):setTimeout(h.bind(function(){var e=g.version;++e;b.call(this,a,c,d,e)},this),0)},this));d&&f.addEventListener("error",d)}catch(l){d&&p.run(function(){d(l)})}}function a(){}q.create=l;q.eraseLocalData=function(a,c,g){var h=e?b:"openDatabase"in n?f:null;null===h?p.run(function(){g(d)}):h.erase(a,function(){n.localStorage.setItem("fire","er,"+Date.now());c()},g)};var e=n.indexedDB||n.webkitIndexedDB||n.mozIndexedDB||n.msIndexedDB,k="asyncStorage_data",c="asyncStorage_key",
g="asyncStorage_value";f.erase=function(a,b,c){try{n.openDatabase("asyncStorage","1.0","",null).transaction(function(b){b.executeSql("SELECT erase_id as eraseId FROM schema_erase_id",null,function(b,d){var e=d.rows.length;(0!==e?d.rows.item(0).eraseId:0)<a&&b.executeSql("SELECT table_name FROM schema_info",null,function(b,c){var d=c.rows.length;if(0!==d){for(var g=[],f=0;f<d;++f)g.push(c.rows.item(f).table_name);for(f=0;f<d;++f)b.executeSql("DELETE FROM "+g[f]);0===e?b.executeSql("INSERT INTO schema_erase_id VALUES(?)",
[a]):b.executeSql("UPDATE schema_erase_id SET erase_id = ?",[a])}},function(){c()})},function(){c()})},function(a){c(a)},function(){b()})}catch(d){p.run(function(){c(d)})}};b.erase=function(a,b,c){l("erase_id",function(d){d.st.transaction(function(d){d.getItem("erase_id",function(d,e){if((null===e?0:parseInt(e,10))<a){var g=d.tx.objectStore(k).clear();g.onsuccess=function(){d.setItem("erase_id",a.toString(),b,c)};g.onerror=c}else b()},c)},c)},c)};b.prototype={onUpgradeNeeded:function(a){a.target.result.createObjectStore(k,
{keyPath:c,autoIncrement:!1}).createIndex("by_store","store",{unique:!1})}};q={setItem:function(b,c,d,e){this.st.transaction(function(g){g.setItem(b,c,function(a,b,c){d&&d(b,c)},e||a)},e||a)},getItem:function(b,c,d){this.st.readTransaction(function(e){e.getItem(b,function(a,b,d){c&&c(b,d)},d||a)},d||a)},removeItem:function(b,c,d){this.st.transaction(function(e){e.removeItem(b,function(a,b){c&&c(b)},d||a)},d||a)},clear:function(b,c){this.st.transaction(function(d){d.clear(b||a,c||a)},c||a)},listItems:function(b,
c){this.st.readTransaction(function(d){d.listItems(b,c||a)},c||a)}};h.extend(f.prototype,q);h.extend(b.prototype,q);var d="Unable to initialize an offline storage."})(r.utils.asyncStorage,r.utils,r.async,_,I);(function(q,m,p,h){function n(){return r&&!h.disableIndexedDb?e:"openDatabase"in h?k:function(){var a=new m.Completer;p.defer(function(){a.fail()});return a.future}}function l(a,b){this._db=a;this._name=b}function f(a,b){var c=new m.Completer;this.tx=a;this.objectStore=a.objectStore(b);this.future=
c.future;a.oncomplete=function(){c.complete()};a.onerror=function(){c.fail(a.error||a.errorCode)}}function b(a,b){f.call(this,a,b)}function a(a,b){f.call(this,a,b)}function e(a,b){var c=new m.Completer,d=r.open(a,b||1);d.onsuccess=function(b){c.complete(new l(d.result,a))};d.onupgradeneeded=function(b){d.result.objectStoreNames.contains(a)||d.result.createObjectStore(a,{keyPath:"rowid",autoIncrement:!0})};d.onerror=function(a){c.fail(d.error||d.errorCode)};return c.future}function k(a,b){function d(a){e.fail(a)}
var e=new m.Completer;try{var g=h.openDatabase(a,b,"",null);g.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS objects (rowid INTEGER PRIMARY KEY AUTOINCREMENT, object TEXT NOT NULL)",null,function(){p.defer(function(){e.complete(new c(g))})},d)},d)}catch(f){p.defer(function(){e.fail(f)})}return e.future}function c(a){this._db=a}function g(a,b){this._tx=a;this.future=b}function d(a,b){g.call(this,a,b)}function t(a){var b=JSON.parse(a.object);b.rowid=a.rowid;return b}var r=h.indexedDB||
h.webkitIndexedDB||h.mozIndexedDB||h.msIndexedDB;q.ObjectDatabase={open:function(a){return n()(a)}};l.prototype.transaction=function(b){var c=this._db.transaction([this._name],"readwrite");b(new a(c,this._name))};l.prototype.readTransaction=function(a,c){var d=this._db.transaction([this._name],"readonly");a(new b(d,this._name))};b.prototype=Object.create(f.prototype);b.prototype.getById=function(a){var b=new m.Completer,c=this.objectStore.get(a);c.onsuccess=function(){b.complete(c.result)};c.onerror=
function(){b.fail(c.error||c.errorCode)};return b.future};b.prototype.getAll=function(){var a=new m.Completer,b=[],c=this.objectStore.openCursor();c.onsuccess=function(){c.result?(b.push(c.result.value),c.result["continue"]()):a.complete(b)};c.onerror=function(){a.fail(c.error||c.errorCode)};return a.future};b.prototype.getFirst=function(){var a=new m.Completer,b=this.objectStore.openCursor();b.onsuccess=function(){b.result?a.complete(b.result.value):a.complete(null)};b.onerror=function(){a.fail(b.error||
b.errorCode)};return a.future};a.prototype=Object.create(b.prototype);a.prototype.put=function(a){var b=new m.Completer,c=this.objectStore.put(a);c.onsuccess=function(){b.complete(c.result)};c.onerror=function(){b.fail(c.error||c.errorCode)};return b.future};a.prototype.remove=function(a){var b=new m.Completer,c=this.objectStore["delete"](a);c.onsuccess=function(){b.complete(a)};c.onerror=function(){b.fail(c.error||c.errorCode)};return b.future};a.prototype.clearAll=function(){var a=new m.Completer,
b=this.objectStore.openCursor();b.onsuccess=function(){b.result?(b.result["delete"](),b.result["continue"]()):a.complete()};b.onerror=function(){a.fail(b.error||b.errorCode)};return a.future};c.prototype.transaction=function(a){var b=!1,c=new m.Completer;this._db.transaction(function(e){b=!0;a(new d(e,c.future))},function(d,e){b?c.fail(e):a(null)},function(){c.complete()})};c.prototype.readTransaction=function(a){var b=!1,c=new m.Completer;this._db.transaction(function(d){b=!0;a(new g(d,c.future))},
function(d,e){b?c.fail(e):a(null)},function(){c.complete()})};g.prototype.getById=function(a){var b=new m.Completer;this._tx.executeSql("SELECT rowid, object FROM objects WHERE rowid=?",[a],function(a,c){0===c.rows.length?b.complete(null):b.complete(t(c.rows.item(0)))},function(a){b.fail(a)});return b.future};g.prototype.getFirst=function(){var a=new m.Completer;this._tx.executeSql("SELECT rowid, object FROM objects ORDER BY rowid ASC LIMIT 1",null,function(b,c){0===c.rows.length?a.complete(null):
a.complete(t(c.rows.item(0)))},function(b){a.fail(b)});return a.future};g.prototype.getAll=function(){var a=new m.Completer;this._tx.executeSql("SELECT rowid, object FROM objects ORDER BY rowid ASC",null,function(b,c){if(0===c.rows.length)a.complete(null);else{for(var d=c.rows.length,e=[],g=0;g!==d;++g)e.push(t(c.rows.item(g)));a.complete(e)}},function(b){a.fail(b)});return a.future};d.prototype=Object.create(g.prototype);d.prototype.put=function(a){function b(){e.executeSql("INSERT INTO objects (rowid, object) VALUES (?, ?)",
[g,f],function(a,b){d.complete(b.insertId)},c)}function c(a){d.fail(a)}var d=new m.Completer,e=this._tx,g=a.rowid,f=JSON.stringify(a);g||0===g?e.executeSql("UPDATE objects SET object=? WHERE rowid=?",[f,a.rowid],function(a,c){0===c.rowsAffected?b():d.complete(g)},c):(g=null,b());return d.future};d.prototype.remove=function(a){var b=new m.Completer;this._tx.executeSql("DELETE FROM objects WHERE rowid=?",[a],function(a,c){b.complete()},function(a){b.fail(a)});return b.future};d.prototype.clearAll=function(){var a=
new m.Completer;this._tx.executeSql("DELETE FROM objects",null,function(b,c){a.complete()},function(b){a.fail(b)});return a.future}})(r.utils,r.async,_,I);(function(q,m,p,h){function n(b,a){this._db=b;this._globalErrorHandler=a;this.onItemDeleted=function(){}}function l(b,a){this._tx=b;this._parent=a;this.future=b.future}function f(){this._queue=[];this._rowIdCounter=0;this.onItemDeleted=function(){}}q.openPersistentQueue=function(b,a){var e=new p.Completer;m.ObjectDatabase.open(b).then(function(b){e.complete(new n(b),
a)}).chainError(e);e.future.catchError(a);return e.future};q.DefferedQueue=f;n.prototype._bindErrorHandler=function(b){null!==this._globalErrorHandler&&b.future.catchError(this._globalErrorHandler)};n.prototype.all=function(){var b=new p.Completer;this._db.readTransaction(function(a){a.getAll().chainSuccess(b).chainError(b)});this._bindErrorHandler(b);return b.future};n.prototype.top=function(){var b=new p.Completer;this._db.readTransaction(function(a){a.getFirst().chainSuccess(b).chainError(b)});
this._bindErrorHandler(b);return b.future};n.prototype.deleteItem=function(b){var a=new p.Completer,e=this;this._db.transaction(function(f){f.remove(b.rowid).then(function(){e.onItemDeleted(b)}).chainSuccess(a).chainError(a)});this._bindErrorHandler(a);return a.future};n.prototype.transaction=function(b){var a=this;this._db.transaction(function(e){b(new l(e,a))})};n.prototype.deleteAll=function(){var b=new p.Completer,a=this;this._db.transaction(function(e){e.clearAll().then(function(){a.onItemDeleted(null)}).chainSuccess(b).chainError(b)});
this._bindErrorHandler(b);return b.future};n.prototype.push=function(b){var a=new p.Completer;this._db.transaction(function(e){e.put(b).chainSuccess(a).chainError(a)});this._bindErrorHandler(a);return a.future};l.prototype.all=function(){return this._bindErrorHandler(this._tx.getAll())};l.prototype.top=function(){return this._bindErrorHandler(this._tx.getFirst())};l.prototype.push=function(b){return this._bindErrorHandler(this._tx.put(b))};l.prototype.deleteAll=function(){var b=this;return this._bindErrorHandler(this._tx.clearAll()).then(function(){b._parent.onItemDeleted(null)})};
l.prototype.deleteItem=function(b){var a=this;return this._bindErrorHandler(this._tx.remove(b.rowid)).then(function(){a._parent.onItemDeleted(b)})};l.prototype._bindErrorHandler=function(b){this._parent._globalErrorHandler&&b.catchError(this._parent._globalErrorHandler);return b};f.prototype.all=function(){var b=new p.Completer;h.defer(h.bind(function(){b.complete(h.clone(this._queue))},this));return b.future};f.prototype.top=function(){var b=new p.Completer;h.defer(h.bind(function(){0!==this._queue.length?
b.complete(this._queue[0]):b.complete()},this));return b.future};f.prototype.deleteItem=function(b){var a=new p.Completer;h.defer(h.bind(function(){var e=this._queue.indexOf(b);-1!==e&&(this._queue.splice(e,1),this.onItemDeleted(b));a.complete()},this));return a.future};f.prototype.deleteAll=function(){var b=new p.Completer;h.defer(h.bind(function(){this._queue.length=0;this.onItemDeleted(null);b.complete()},this));return b.future};f.prototype.push=function(b){var a=new p.Completer;h.defer(h.bind(function(){var e=
b.rowid=++this._rowIdCounter;this._queue.push(b);a.complete(e)},this));return a.future};f.prototype.transaction=function(b){b(this)}})(r.utils,r.utils,r.async,_);(function(q,m,p,h){function n(a){this.storage=new m.TxStorage(a)}function l(a){this.tx=a;this.valSuffix="-val";this.chksumSuffix="-chk"}function f(b){var c=new p.Sha1;b=a.parse(b);c.update(b);return e.stringify(c.finalize())}function b(){}q.VerifiableStorage=n;n.prototype={transaction:function(a,b){this.storage.transaction(function(b){a(new l(b))},
b)},readTransaction:function(a,b){this.storage.readTransaction(function(b){a(new l(b))},b)}};l.prototype={abort:function(){this.tx.abort()},clear:function(a,b){this.tx.clear(a,b)},setItem:function(a,c,e,d){d=(e=e||b)||b;var h=a+this.valSuffix;this.tx.setItem(a+this.chksumSuffix,f(c+h),function(b){b.setItem(h,c,function(b,c,d){e(b,c,a)},d)},d)},getItem:function(a,c,e){e=(c=c||b)||b;var d=a+this.valSuffix;this.tx.getItem(a+this.chksumSuffix,function(b,h){b.getItem(d,function(b,e){null===e?c(b,e,a):
f(e+d)!==h?c(b,null,a):c(b,e,a)},e)},e)},removeItem:function(a,c,e){e=(c=c||b)||b;var d=a+this.valSuffix;this.tx.removeItem(a+this.chksumSuffix,function(b){b.removeItem(d,function(b,d){c(b,a)},e)},e)}};var a=h.enc.Utf8,e=h.enc.Hex})(r.utils,r.utils,r.crypto,N);(function(q,m){function p(h,f,b,a){this.name=h;this.defaultValue=f;this.preSave=b?b:null;this.postSave=a?a:null}function h(h,f,b){this.prefix=h;this.defaultValue=f;this.preSave=b?b:null}function n(){}q.PersistentObjectManager=p;q.PrefixedPersistentObjectManager=
h;p.prototype={load:function(h,f,b){h.getItem(this.name,m.bind(function(a,b){if(null!==b)b=JSON.parse(b);else{var h=this.defaultValue;b=h=m.isFunction(h)?h():h?m.clone(h):{}}f(a,b)},this),b||n)},save:function(h,f,b,a){this.preSave&&(f=this.preSave(f));if(this.postSave){var e=this.postSave;h.setItem(this.name,JSON.stringify(f),function(){e.apply(null,arguments);b&&b.apply(null,arguments)},a||n)}else h.setItem(this.name,JSON.stringify(f),b||n,a||n)}};h.prototype={load:function(h,f,b,a){h.getItem(this.prefix+
":"+f,m.bind(function(a,f){if(null!==f)f=JSON.parse(f);else{var c=this.defaultValue;f=c=m.isFunction(c)?c():c?m.clone(c):{}}b(a,f)},this),a||n)},save:function(h,f,b,a,e){this.preSave&&(b=this.preSave(b));h.setItem(this.prefix+":"+f,JSON.stringify(b),a||n,e||n)}}})(r.utils,_);(function(q,m,p,h,n,l,f,b,a,e){function k(){this.db=null;this.limit=5E6;this.q=[];this.gcInProgress=!1;this.fileListManager=new p.PrefixedPersistentObjectManager("list",[]);this.statsManager=new p.PersistentObjectManager("stats",
function(){return{files:{}}});this.fileSystemManager=new p.PersistentObjectManager("fileSystem",[],function(a){a.sort(function(a,b){return a.id<b.id?-1:a.id>b.id?1:0});return a},a.bind(this.fireFsChanged,this));this._cacheRegistry=new c(this);this._initFuture=null;this._initFailed=!1}function c(a){this._cacheManager=a;this._caches={}}var g=0,d=2;q.CACHE_STATE={CAN_FREE:g,DOWNLOADING:1,DOWNLOADED:d};var t=0,r=1,v=2,A=3;q.CacheManager=k;k.prototype={fireFsChanged:function(){this.fireChanged("fs",null,
!0)},init:function(){var b=this;if(null!==this._initFuture||null!==this.db||this._initFailed){if(null!==this._initFuture)return this._initFuture;null!==this.db?(c=new l.Completer,l.asyncSuccess(c,this)):(c=new l.Completer,l.asyncError(c,"init failed"));return c.future}var c=new l.Completer,d=a.bind(c.fail,c);h.create("||global||",function(a){var e=new p.TxStorage(a);e.transaction(function(a){b.db=e;c.complete(b)},d)},d);var e=this._initFuture=c.future;e.catchError(function(){b._initFailed=!0}).completed(function(){b._initFuture=
null});return e},openCache:function(b,c,d,e){function g(){var b=f.initTask;f.state===t&&(f.instance.init(a.bind(b.complete,b),a.bind(b.fail,b)),f.state=r,b.future.then(function(){f.state=v}).catchError(function(){f.state=A}));if(f.state===r)b.future.then(c).catchError(d);else if(f.state===v)l.run(function(){c(f.instance)});else if(f.state===A)l.run(d);else throw Error("[CacheManager] the document cache is in invalid state");}var f=this._cacheRegistry.getCache(b,e?e:null);null===this.db?this.init().then(a.bind(g,
this)).catchError(d):g.call(this);return f.instance},getFSStorage:function(){return new n.StoredDocumentsCacheAdapter(this.db,this.fileSystemManager,this)},prepare:function(a,b,c){this.q.push({callback:b,error:c,requested:a});this.executeGC()},executeGC:function(){function c(b){for(var d=l,e=0,g=d.length;e<g;++e){var f=d[e].error;f&&f(b)}q.gcInProgress=!1;setTimeout(a.bind(q.executeGC,q),20)}function d(){for(var b=l,c=0,e=b.length;c<e;++c){var g=b[c].callback;g&&g()}q.gcInProgress=!1;setTimeout(a.bind(q.executeGC,
q),20)}var e=this.q;if(0!==e.length&&!this.gcInProgress){this.gcInProgress=!0;for(var f=0,k=this.limit,l=[],m=0,n=e.length;m<n;++m){var p=e[m];p.requested=Math.min(p.requested,k);if(f+p.requested>k)break;else f+=p.requested,l.push(p)}e.splice(0,m);var q=this;0===f?(b.debug("[cache] zero request"),d()):f<k?(b.debug("[cache] request: "+f),q.db.transaction(function(a){q.loadStats(a,function(a,e){var k=e.files,l=0,m=[],n=Date.now(),p;for(p in k){var t=k[p];t.downloaded===g?(t.url=p,l+=t.length,m.push(t)):
1===t.downloaded&&18E4<n-t.stateChanged&&(t.downloaded=g,t.url=p,l+=t.length,m.push(t))}b.debug("[cache] current size: "+l);if(q.limit<l){m.sort(function(a,b){var c=a.lastLoad,d=b.lastLoad;return c==d?0:c<d?-1:1});var r=f+l-q.limit;b.debug("[cache] schedule to free: "+r);var w=0,v=m.length,x=!1,y=function(){var g=m[w++];g.length<r?(r-=g.length,h.create(g.url,function(a){a.clear()}),delete k[g.url],b.debug("[cache] invalidate: "+g.url+" rem:"+r),x=!0,w<v&&y()):0<r?q.loadFileList(a,g.url,function(a,
f){f.sort(function(a,b){var c=a.time,d=b.time;return c==d?0:c<d?-1:1});for(var k=[],l=0,m=f.length;l<m&&0<r;++l){var n=f[l];r-=n.length;g.length-=n.length;b.debug("[cache] invalidate: "+g.url+"/"+n.name+" rem:"+r);k.push(n.name)}f.splice(0,l);0===f.length?h.create(g.url,function(a){a.clear()}):h.create(g.url,function(a){for(var b=0,c=k.length;b<c;++b)a.removeItem(k[b])},c);q.saveFileList(a,g.url,f,function(a){q.saveStats(a,e,d,c)},c)},c):x&&q.saveFileList(a,g.url,_list,function(a){q.saveStats(a,e,
d,c)},c)};y()}else d()},c)},c)):c("unable to fit file to cache")}},loadFileList:function(a,b,c,d){this.fileListManager.load(a,b,c,d)},saveFileList:function(a,b,c,d,e){this.fileListManager.save(a,b,c,d,e)},storeFileCachedInfo:function(a,b,c,d,e){var g=this;this.loadFileList(a,b,function(a,f){f.push({name:c,length:d,time:Date.now(),cached:Date.now()});g.saveFileList(a,b,f,e)})},getOfflineDownloadedDocumentsCount:function(b,c){var d=this;this.db.readTransaction(function(e){d.loadStats(e,function(c,d){var e=
0;a.each(d.files,function(a,b){2===a.downloaded&&++e});b(e)},c)},c)},loadStats:function(a,b,c){this.statsManager.load(a,b,c)},getDownloadState:function(a,b,c){var d=this;this.db.readTransaction(function(e){d.loadStats(e,function(c,e){var g=d.getStatsCounter(e,a);b(g.downloaded)},c)},c)},fireChanged:function(a,b,c){c&&localStorage.setItem("fire",a+","+Date.now())},increment:function(a,b,c){var d=this;this.db.transaction(function(e){d.loadStats(e,function(e,g){var f=d.getStatsCounter(g,a);f.length+=
c;f.lastLoad=Date.now();d.storeFileCachedInfo(e,a,b,c,function(a){d.saveStats(a,g)})})})},updateLastLoad:function(a,b){var c=this;this.db.transaction(function(d){c.loadStats(d,function(d,e){var g=c.getStatsCounter(e,a);g.lastLoad=Date.now();c.loadFileList(d,a,function(d,f){for(var h=0,k=f.length;h<k;++h){var l=f[h];if(l.name===b){l.time=g.lastLoad;break}}c.saveFileList(d,a,f,function(a){c.saveStats(a,e)})})})})},saveStats:function(a,b,c,d){this.statsManager.save(a,b,function(a){c&&c(a)},d)},getStatsCounter:function(a,
b){var c=a.files[b];c||(c=Date.now(),c={length:0,downloaded:g,stateChanged:c,lastLoad:c},a.files[b]=c);return c},setDownloadingState:function(a,b,c,e,g){function h(l){b===d?(l.removeItem("list:"+a),k.fileSystemManager.load(l,function(b,d){var h=f.makeIdSafe(d,g.documentInfo.title||a,a);f.findFileById(d,h)?c&&c():(d.push({id:h,type:"document",url:a}),k.fileSystemManager.save(b,d,function(){c()},e))},e)):(k.fireChanged("stats",null,!0),c&&c())}var k=this;this.db.transaction(function(c){k.loadStats(c,
function(c,d){var f=k.getStatsCounter(d,a);f.downloaded=b;f.stateChanged=(new Date).getTime();g?("size"in g&&(f.length=g.size),k.loadExtendedData(c,function(b,c){c[a]=g.documentInfo;k.saveExtendedData(b,c,function(){k.saveStats(b,d,h,e)},e)},e)):k.saveStats(c,d,h,e)},e)},e)},loadExtendedUIModel:function(a){function c(d){b.error(d);a({})}var d=this;this.db.readTransaction(function(b){d.loadExtendedData(b,function(b,c){a(c)},c)},c)},loadExtendedData:function(a,b,c){a.getItem("extended",function(a,c){null===
c?b(a,{}):b(a,JSON.parse(c))},c)},saveExtendedData:function(a,b,c,d){a.setItem("extended",JSON.stringify(b),c,d)},loadStorageInfo:function(b,c){function e(){c({offlineStorageSupported:!1})}var g=this;this.init().then(function(){g.db.readTransaction(function(f){g.loadStats(f,function(e,f){var h=!1;b&&(h=g.getStatsCounter(f,b).downloaded===d);var k=!!a.find(f.files,function(a){return a.downloaded===d});c({offlineStorageSupported:!0,isCurrentDocumentDownloaded:h,isAnyDocumentDownloaded:k})},e)},e)}).catchError(e)},
forceInvalidate:function(c,d,f,k){function l(){var a=m._cacheRegistry.findCache(c);null!==a&&(a.downloadState=g);d.apply(null,arguments)}var m=this;b.debug("[cache] forceInvalidate: "+c);h.create(c,function(b){b.clear(function(){m.db.transaction(function(b){b.removeItem("list:"+c);m.loadStats(b,function(b,d){k&&k(m.getStatsCounter(d,c).downloaded);m.loadExtendedData(b,function(b,e){delete e[c];m.saveExtendedData(b,e,function(){delete d.files[c];m.fileSystemManager.load(b,function(b,e){for(var g=null,
h=0,k=e.length;h<k&&(g=e[h],g.url!==c);++h)g=null;g?(e=a.without(e,g),m.fileSystemManager.save(b,e,function(){m.saveStats(b,d,l,f)},f)):m.saveStats(b,d,l,f)},f)},f)},f)},f)},f)},f)},f);e.Events.trigger("storage:erased",c)},storeGlobalDocumentInfo:function(c,d){function e(){b.error("Error during documentInfo updating.")}var g=this;this.db&&this.db.transaction(function(h){g.loadExtendedData(h,function(f,h){var k=h[c];a.isObject(k)&&(a.extend(k,d),g.saveExtendedData(f,h,function(){b.debug("extended data updated")},
e))});g.fileSystemManager.load(h,function(a,h){var k=f.makeIdSafe(h,d.title,c),l=f.findFileByUrl(h,c);l&&l.id!==k&&(l.id=k,g.fileSystemManager.save(a,h,function(){b.debug("fs data updated")},e))},e)},e)}};c.prototype={getCache:function(a,b){var c=null;return c=a in this._caches?this._caches[a]:this._caches[a]={instance:new m.DocumentCacheManager(this._cacheManager,a,b),initTask:new l.Completer,state:t}},findCache:function(a){return a in this._caches?this._caches[a].instance:null}}})(r.io,r.io.cache,
r.utils,r.utils.asyncStorage,r.io.documents,r.async,r.fs,r.log,_,Backbone);(function(q,m,p,h,n,l){function f(b,a,e){this._cacheManager=b;this._url=a;this._cipher=e;this._db=null;this.downloadState=m.CACHE_STATE.CAN_FREE;this._invalidating=!1;this._queue=[]}q.DocumentCacheManager=f;f.prototype={init:function(b,a){function e(){f._db=null;a(arguments)}var f=this;h.create(this._url,function(a){f._db=a;f.refreshStatus(function(){b(f);f._executeQueue()},e)},e)},erase:function(){function b(){a.downloadState=
m.CACHE_STATE.CAN_FREE;a._invalidating=!1;a._executeQueue()}this._invalidating=!0;var a=this;this._cacheManager.forceInvalidate(this._url,b,b)},_executeQueue:function(){var b=this._queue;this._queue=[];l.each(b,function(a){a()})},cacheFile:function(b,a){if(null!==this._cipher){var e=this;this._cipher.encrypt(a).then(function(a){e._execute("_doCacheFile",[b,a])}).catchError(function(a){n.error("Unable to encrypt: "+b+" -> ",a)})}else this._execute("_doCacheFile",[b,a])},storeFile:function(b,a,e,f){if(null!==
this._cipher){var c=this;this._cipher.encrypt(a).then(function(a){c._execute("_doStoreFile",[b,a,e,f])}).catchError(function(a){n.error("Unable to encrypt: "+b+" -> ",a);f(a)})}else this._execute("_doStoreFile",[b,a,e,f])},readFile:function(b,a,e){var f;if(null!==this._cipher){var c=this;f=[b,function(g){c._cipher.decrypt(g).then(function(b){a(b)}).catchError(function(a){n.error("Unable to decrypt: "+b+" -> "+JSON.stringify(a));e(a)})},e]}else f=[b,a,e];this._execute("_doReadFile",f)},deleteInfo:function(b,
a,e){this._execute("_doDeleteInfo",[b,a,e])},storeInfo:function(b,a,e,f){this._execute("_doStoreInfo",[b,a,e,f])},loadInfo:function(b,a,e){this._execute("_doLoadInfo",[b,a,e])},setDownloadState:function(b,a,e,f){this._execute("_doSetDownloadState",[b,a,e,f])},listStoredItems:function(b,a){this._execute("_doListStoredItems",[b,a])},storeFileSystemInfo:function(b,a,e){this.storeInfo("||info||",JSON.stringify(p.serializeFileSystemInfo(b)),a,e)},loadFileSystemInfo:function(b,a){this.loadInfo("||info||",
function(a){try{null===a?b(null):b(p.deserializeFileSystemInfo(JSON.parse(a)))}catch(f){n.warn("[DocumentCacheManager] unable to parse fileSystemInfo"),b(null)}},a)},storeGlobalDocumentInfo:function(b){this._execute("_doStoreGlobalDocumentInfo",[b])},refreshStatus:function(b,a){this._cacheManager.getDownloadState(this._url,l.bind(function(a){this.downloadState=a;b()},this),function(){a();n.error("[DocumentCacheManager] unable to retrive the download state")})},_doCacheFile:function(b,a){var e=this;
this._cacheManager.prepare(a.length,function(){e._db.setItem(b,a,function(){e._cacheManager.increment(e._url,b,a.length)},function(a){n.error("[LocalCacheFS] file cache failed");n.error(a)})})},_doStoreFile:function(b,a,e,f){this._db.setItem(b,a,e,f)},_doReadFile:function(b,a,e){var f=this;this._db.getItem(b,function(c){null===c?e(1404):(a(c),f._cacheManager.updateLastLoad(f._url,b))},e)},_doStoreInfo:function(b,a,e,f){this._db.setItem(b,a,e,f)},_doLoadInfo:function(b,a,e){this._db.getItem(b,a,e)},
_doDeleteInfo:function(b,a,e){this._db.removeItem(b,a,e)},_doListStoredItems:function(b,a){this._db.listItems(b,a)},_doStoreGlobalDocumentInfo:function(b){this._cacheManager.storeGlobalDocumentInfo(this._url,b)},_doSetDownloadState:function(b,a,e,f){var c=this;this._cacheManager.setDownloadingState(this._url,b,function(){c.downloadState=b;a()},e,f)},_execute:function(b,a){this._invalidating||null===this._db?this._queue.push(l.bind(function(){this._execute(b,a)},this)):this[b].apply(this,a)}}})(r.io.cache,
r.io,r.io.cache,r.utils.asyncStorage,r.log,_);(function(q,m){function p(h){var f=h.metadata,b=h.hmacChecksum,a=h.aesSalt,e=h.aesDerivedKey,k=h.hmacKey;h.metadata=null;h.hmacChecksum=null;h.aesSalt=null;h.aesDerivedKey=null;h.hmacKey=null;var c=m.clone(h);c.hmacChecksum=n(b);c.aesSalt=n(a);h.metadata=f;h.hmacChecksum=b;h.aesSalt=a;h.aesDerivedKey=e;h.hmacKey=k;return c}function h(h){if(null!==h){for(var f=h.length,b=new Uint8Array(f),a=0;a<f;++a)b[a]=h[a];return b}return null}function n(h){if(null!==
h){for(var f=h.length,b=Array(f),a=0;a<f;++a)b[a]=h[a];return b}return null}q.deserializeFileSystemInfo=function(l){if(l.globalFlags&3)for(var f=l.entries.length,b=l.entries,a=0;a<f;++a){var e=b[a];e.hmacChecksum=h(e.hmacChecksum);e.aesSalt=h(e.aesSalt)}return l};q.serializeFileSystemInfo=function(h){if(h.globalFlags&3){var f=m.clone(h);h=h.entries;for(var b=f.entries=[],a=0,e=h.length;a<e;++a)b.push(p(h[a]));return f}return h}})(r.io.cache,_);(function(q,m){function p(){this._cipher=null;this._queue=
[]}function h(h,l){this.encryption=h;this.data=l;this.completer=new m.Completer}q.LazyCipher=p;p.prototype.encrypt=function(m){if(null!==this._cipher)return this._cipher.encrypt(m);m=new h(!0,m);this._queue.push(m);return m.completer.future};p.prototype.decrypt=function(m){if(null!==this._cipher)return this._cipher.decrypt(m);m=new h(!1,m);this._queue.push(m);return m.completer.future};p.prototype.reset=function(){this._cipher=null};p.prototype.initCipher=function(h){this._cipher=h;for(var l=this._queue,
f=0,b=l.length;f!==b;++f){var a=l[f],e;e=a.encryption?h.encrypt(a.data):h.decrypt(a.data);e.chainSuccess(a.completer);e.chainError(a.completer)}this._queue=[]}})(r.io,r.async);(function(q,m,p,h,n,l,f,b,a){function e(a){this._context=a;this._cacheManager=a.cacheManager;this._lazyCipher=this._cache=null;this._state=k;this._info=null;this.on("fileSystem:changed",this.onFileSystemChanged)}q.LocalCacheFS=e;var k=0;e.prototype={isCacheEnabled:function(){return"cacheEnabled"in this._context?this._context.cacheEnabled:
!0},on:function(a,b){if("on"in this._context)this._context.on(a,b,this)},off:function(a,b){"off"in this._context&&this._context.off(a,b,this)},onFileSystemChanged:function(){null!==this._cache&&(f.debug("[LocalCacheFS] onFileSystemChanged"),this._cache.erase(),this._info=null)},init:function(){if(this._state===k){var a=!!this._context.encryptionKey;a&&(this._lazyCipher=new m.LazyCipher);var e=new p.Cancelable,d=new p.Completer(e.cancelCallback);this._state=1;var h=this,l=function(a){h._state=k;e.canceled||
(f.error("[LocalCacheFS] cache initializiation has failed"),a&&f.error(a),d.fail(a))};h._cache=h._cacheManager.openCache(this._context.url,function(m){e.canceled?h._state=k:m.loadFileSystemInfo(function(l){e.canceled?h._state=k:(null!==l&&(a&&!l.storageEncryption||!a&&l.storageEncryption)?(h._cache.erase(),f.warn("[LocalCacheFS] data were erased because of encryption method has changed"),l=null):a&&null!==l&&b.calcKeyHash(h._context.encryptionKey)!==l.storageEncryption&&(h._cache.erase(),f.warn("[LocalCacheFS] data were erased because encryption key has changed"),
l=null),a&&null!==l?h.initEncryptionFromInfo(l):f.info("[LocalCacheFS] RAW storage used."),h._state=2,h._info=l,d.complete())},l)},l,h._lazyCipher);return d.future}throw Error("[LocalCacheFS] needs to be fresh!");},initEncryptionFromInfo:function(c){function e(a){f.debug("[LocalCacheFS] _deriveKey");a=N.enc.Utf8.parse(a);a=l.u8array.stringify(b.PBKDF2(a,h._context.encryptionKey,h._context.encryptionKey.length/4*2,1E3));var c=a.subarray(0,h._context.encryptionKey.length);a=l.u8array.parse(a.subarray(h._context.encryptionKey.length,
a.length));var g=new b.Sha1,m=N.enc.Hex.stringify(g.finalize(a));h._cache.loadInfo("||auth||",function(a){null===a?(k=!0,h._cache.storeInfo("||auth||",m,function(){f.debug("[LocalCacheFS] auth info saved")},function(a){f.error("[LocalCacheFS] auth info saving failed")}),d(c)):a===m?(f.debug("[LocalCacheFS] auth info verified"),d(c)):f.warn("[LocalCacheFS] an incorrect password entered")},function(a){f.error("[LocalCacheFS] unable to get auth info");d(c)})}function d(a){f.debug("[LocalCacheFS] _initCipher");
var c=new b.AesStringWorkerClient(new b.AesCbcAlgorithmSettings);c.init(h._context.encryptionKey).then(function(){h._lazyCipher.initCipher(c)}).catchError(function(a){f.error("[LocalCacheFS] AES encryption initialization failed!");initializationErrorHandler(a)})}var h=this,k=!1;c.globalFlags&3?(c=this._context.passwordProvider.password,this._context.passwordProvider.on("passwordEntered",e),this._context.passwordProvider.on("invalidPassword",function(){k&&(h._lazyCipher.reset(),h._cache.deleteInfo("||auth||",
function(){f.debug("[LocalCacheFS] auth info deleted")},function(a){f.debug("[LocalCacheFS] unable to delete auth info "+(a?a.message?a.message:a:""));h._cache.erase()}))}),a.isEmpty(c)||e(c),f.info("[LocalCacheFS] AES storage with document password used.")):(f.info("[LocalCacheFS] AES storage used."),d(h._context.encryptionKey))},tryToGetDownloadedState:function(){return 2===this._state?this._cache.downloadState:!1},destroy:function(){this.off("fileSystem:changed",this.onFileSystemChanged)},verifyCache:function(a){this._throwIfNotIntialized();
if(null!==this._info){if(this._info.etag===a)return f.debug("[LocalCacheFS] verifyCache ok"),!0;f.debug("[LocalCacheFS] verifyCache fileSystem:changed");"trigger"in this._context?this._context.trigger("fileSystem:changed","cache-verification"):this._onFileSystemChanged();return!1}f.debug("[LocalCacheFS] verifyCache this._info === null");return!1},cacheFile:function(a,b,d){this._throwIfNotIntialized();this.isCacheEnabled()&&this._doCacheFile(a,b,d)},loadFileSystemInfo:function(){this._throwIfNotIntialized();
var a=new p.Completer;null!==this._info?p.asyncSuccess(a,this._info):p.asyncError(a);return a.future},attachFileSystemInfo:function(a){f.debug("[LocalCacheFS] attachFileSystemInfo");a.storageEncryption=this._context.encryptionKey?b.calcKeyHash(this._context.encryptionKey):null;if(this._checkInitialized()){if(null!==this._info&&this._info.etag!==a.etag)throw Error("[LocalCacheFS] this should never happen (this._info.etag !== fileSystemInfo.etag)");null===this._info&&(null!==this._lazyCipher&&this.initEncryptionFromInfo(a),
this._info=a,this.isCacheEnabled()&&this._doStoreFileSystemInfo(a))}else f.warn("[LocalCacheFS] attachFileSystemInfo (is not initialized)")},list:function(){this._throwIfNotIntialized();var b=new p.Completer;null!==this._info?p.asyncSuccess(b,a.clone(this._info.entries)):p.asyncError(b);return b.future},listPaths:function(){this._throwIfNotIntialized();var b=new p.Completer;null!==this._info?p.asyncSuccess(b,a.pluck(this._info.entries,"filename")):p.asyncError(b);return comleter.future},read:function(a,
b){this._throwIfNotIntialized();var d=new p.Cancelable,e=new p.Completer(d.cancelCallback);this._cache.readFile(a,function(a){d.canceled||e.complete(a)},function(a){d.canceled||e.fail(a)});return e.future},_checkInitialized:function(){return 2===this._state},_throwIfNotIntialized:function(){if(!this._checkInitialized())throw Error("[LocalCacheFS] must be initialized first!");},_doCacheFile:function(a,b,d){this._cache.cacheFile(a,d)},_doStoreFileSystemInfo:function(a){f.debug("[LocalCacheFS] _doStoreFileSystemInfo");
this._cache.storeFileSystemInfo(a,function(){f.debug("[LocalCacheFS] fileSystemInfo stored")},function(a){f.error("[LocalCacheFS] unable to store fileSystemInfo");f.error(a)})}}})(r.io,r.io,r.async,r.io.cache,r.utils.asyncStorage,r.utils,r.log,r.crypto,_);(function(q,m,p){function h(h,l,f){this.db=h;this.fileSystemManager=l;this.cacheManager=f}q.StoredDocumentsCacheAdapter=h;h.prototype={loadDocument:function(h,l,f){var b=this;this.db.readTransaction(function(a){b.fileSystemManager.load(a,function(a,
k){for(var c=null,g=0,d=k.length;g<d;++g){var m=k[g];if(m.id===f&&"document"===m.type){c=m;break}}c?b.cacheManager.loadExtendedData(a,function(a,d){var e=d[c.url];b.cacheManager.loadStats(a,function(a,b){e.info=b.files[c.url];h(e,a)},l)},l):l("document-not-found",a)},l)},l)},load:function(h,l,f,b){function a(a){e.fileSystemManager.load(a,function(a,b){var d=f;if(d){for(var k=null,m=0,p=b.length;m<p;++m){var q=b[m];if(q.id===d&&"document"===q.type){k=q;break}}k?e.cacheManager.loadExtendedData(a,function(a,
c){k.extendedData=c;h(b,a)},l):h(b,a)}else h(b,a)},l)}if(this.db){var e=this;b?this.db.transaction(a,l):this.db.readTransaction(a,l)}else l("db is not opened")},save:function(h,l,f,b){function a(a){e.fileSystemManager.save(a,h,l,f)}var e=this;b?a(b):this.db.transaction(a,f)},deleteItems:function(h,l,f,b,a){var e=[l];e.push.apply(e,h);e=p.without.apply(p,e);l.splice(0);l.push.apply(l,e);l=0;for(var k=h.length;l<k;++l){var c=h[l];"document"===c.type&&c.url&&this.cacheManager.forceInvalidate(c.url,function(){},
function(){})}this.save(e,b,a,f)},deleteDocumentByUrl:function(h,l,f){this.load(p.bind(function(b,a){var e=m.findFileByUrl(b,h);e?this.deleteItems([e],b,a,function(a,b){l(!0,b)},f):l(!1,a)},this),f,null,!0)}}})(r.io.documents,r.fs,_);(function(q,m,p,h,n,l,f){function b(a){this.context=a;var b=m.WebworkerBackend||m.DirectBackend;this._backend=new b(a.passwordProvider?a.passwordProvider:null);b===m.WebworkerBackend?h.debug("[PackageFS] backend=WebworkerBackend"):h.debug("[PackageFS] backend=DirectBackend");
this._initFuture=this._indexedEntries=this._packageHeaderBytes=this._entriesReader=this._fileSystemInfo=this._remoteFile=null;this._state=e;this._checkingForChanges=!1;this._lastCheckingForChanges=0}function a(a){for(var b={},e=0,d=a.length;e<d;++e){var f=a[e];b[f.filename]=f}return b}q.PackageFS=b;q.indexEntries=a;var e=0;b.prototype={destroy:function(){null!==this._initFuture&&this._initFuture.cancel();this._backend.destroy()},init:function(){if(this._state===e){var a=new p.Cancelable,b=new p.Completer(a.cancelCallback);
this._state=1;var g=this.context.url,d=this._remoteFile=this._backend.createRemoteFileInstanceForURL(g),f=this;a.asyncTask=d.init(function(a,d,k,m){h.debug("[PackageFS] init callback");var p=f._initFuture=null;if(24===k.length){if(80===k[0]&&75===k[1]||86===k[0]&&83===k[1])f._entriesReader=n,p="zip",h.debug("[PackageFS] The package is a ZIP file.");else if(52===k[0]&&83===k[1])f._entriesReader=l,f._packageHeaderBytes=k,p="g4s",h.debug("[PackageFS] The package is a G4S file.");else{h.error("[PackageFS] The package is not ZIP nor G4S.");
f._state=e;f.trigger("fileSystem:error","package",1551);b.fail(1551);return}f._state=2;f._fileSystemInfo={url:g,size:a,etag:d,format:p,ddSupport:m,globalFlags:null,entries:null};b.complete(d);h.debug("[PackageFS] state="+f._state)}else f._state=e,24<k.length?(h.error("[PackageFS] Your WebServer does not support the byte range access. You have to enable it."),f.trigger("fileSystem:error","server",1550),b.fail(1550)):(h.error("[PackageFS] The package is not valid. It is too small."),f.trigger("fileSystem:error",
"package",1551),b.fail(1551))},function(){h.error("[PackageFS] remoteFile.init failed");f._state=e;f._initFuture=null;b.fail.apply(b,arguments)},23);this._initFuture=b.future;b.future.catchError(function(a){f.trigger("fileSystem:error","server",a)});return b.future}throw Error("[PackageFS] is not fresh!");},loadFileSystemInfo:function(){h.debug("[PackageFS] loadFileSystemInfo state="+this._state);var b=new p.Cancelable,c=new p.Completer(b.cancelCallback);if(3===this._state)h.debug("[PackageFS] state=ST_FS_INFO_LOADED"),
p.asyncSuccess(c,this._fileSystemInfo);else if(2===this._state){h.debug("[PackageFS] state=ST_INITIALIZED");var e=this;b.asyncTask=this._entriesReader.readEntries(this._remoteFile,function(b,f){h.debug("[PackageFS] entries loaded: count="+(b?b.length:"null")+" globalFlags="+f);e._initFuture=null;e._fileSystemInfo.entries=b;e._fileSystemInfo.globalFlags=f;0!==(f&3)&&(e._fileSystemInfo.ddSupport=!1);e._indexedEntries=a(b);e._backend.init(e._fileSystemInfo,e._entriesReader);h.debug("[PackageFS] direct decode opt",
e._fileSystemInfo);e._state=3;h.debug("[PackageFS] state=ST_FS_INFO_LOADED");c.complete(e._fileSystemInfo)},function(a){h.debug("[PackageFS] loadFileSystemInfo failed: "+a);e._initFuture=null;c.fail.apply(c,arguments)},this._packageHeaderBytes);h.debug("[PackageFS] entries requested")}else throw h.error("[PackageFS] is not initialized"),Error("[PackageFS] must be initialized first to call loadFileSystemInfo");return this._initFuture=c.future},attachFileSystemInfo:function(b){h.debug("[PackageFS] attachFileSystemInfo state="+
this._state);var c=!1;this._state===e?(this._fileSystemInfo={url:b.url,size:b.size,etag:b.etag,format:b.format,ddSupport:b.directDecodeSupport,globalFlags:b.globalFlags,entries:b.entries},c=!0):2===this._state&&(c=this._fileSystemInfo,c.globalFlags=b.globalFlags,c.entries=b.entries,c=!0);0!==(b.globalFlags&3)&&(this._fileSystemInfo.ddSupport=!1);h.debug("[PackageFS] direct decode opt ="+this._fileSystemInfo.ddSupport);if(c)this._state=3,h.debug("[PackageFS] state=ST_FS_INFO_LOADED"),this._indexedEntries=
a(b.entries),this._remoteFile=this._backend.createRemoteFileInstanceForFileSystemInfo(this._fileSystemInfo),this._backend.init(this._fileSystemInfo,"g4s"===b.format?l:n),h.debug("[PackageFS] backend init requested");else{if(3!==this._state)throw Error("[PackageFS] Unable to attach file system info!");h.debug("[PackageFS] file system info has not been attached")}},read:function(a,b){this._checkFileSystemInfoLoaded();var e=this._indexedEntries[a];if(e){var d=this;d.trigger("fileSystem:remoteRead","requested",
e.compressedSize,e.uncompressedSize,a);var h=this._backend.read(e,b);h.then(function(){d.trigger("fileSystem:remoteRead","finished",e.compressedSize,e.uncompressedSize,a)}).catchError(function(b){d.trigger("fileSystem:remoteRead","failed",e.compressedSize,e.uncompressedSize,a);65535===b?d.trigger("fileSystem:changed","package"):f.isNumber(b)?d.trigger("fileSystem:error","server",b):d.trigger("fileSystem:error","package",b)});return h}h=new p.Completer;p.asyncError(h,1404);return h.future},list:function(){this._checkFileSystemInfoLoaded();
var a=new p.Completer;p.asyncSuccess(a,this._fileSystemInfo.entries);return a.future},listPaths:function(){this._checkFileSystemInfoLoaded();var a=new p.Completer;p.asyncSuccess(a,f.pluck(this._fileSystemInfo.entries,"filename"));return a.future},trigger:function(){"trigger"in this.context&&this.context.trigger.apply(this.context,arguments)},checkForChanges:function(){if(3===this._state&&!this._checkingForChanges&&Date.now()-this._lastCheckingForChanges>(this.context.checkForChangesInterval||1E4)){this._checkingForChanges=
!0;var a=this;this._remoteFile.checkETag(function(b){a._checkingForChanges=!1;a._lastCheckingForChanges=Date.now();a.trigger("fileSystem:checked",b);b||a.trigger("fileSystem:changed","package")},function(b){a.trigger("fileSystem:error","server",b)})}},_checkFileSystemInfoLoaded:function(){if(3!==this._state)throw Error("[PackageFS] File system info must be loaded or attached first!");}}})(r.io,r.io.package,r.async,r.log,r.zip,r.g4s,_);(function(q,m,p,h,n,l,f,b){function a(a){var b=new h.Completer;
this.passwordProvider=a;this.decompressor=new p.Pool(1,p.Pool.workerPath("zip-web-worker.js"),f.bind(b.complete,b));(this._initFuture=b.future).then(f.bind(this._onPoolInitialized,this));this.backgroundKeyGenerator=null;this._initializationRequested=!1;n.debug("[WebworkerBackend] constructor end")}function e(a,b,e){var h=this.worker=new Worker(p.Pool.workerPath("g4s-aes-key-worker.js"));h.onmessage=f.bind(this._onMessage,this);h.onerror=f.bind(this._onError,this);h.postMessage({cmd:k,data:{entries:b,
globalFlags:e}});this._state=c;this._passwordProvider=a;a.requestNewPassword(f.bind(this.verifyPassword,this));this._keyRequests={};this._indexedEntries=m.indexEntries(b)}"Worker"in b&&(q.WebworkerBackend=a);a.prototype={destroy:function(){this.decompressor.stop();this.decompressor=null;null!==this.backgroundKeyGenerator&&this.backgroundKeyGenerator.destroy()},createRemoteFileInstanceForURL:function(a){return new l.RemoteFile(a,null)},createRemoteFileInstanceForFileSystemInfo:function(a){var b=new l.RemoteFile(a.url,
null);b.etag=a.etag;b.size=a.size;return b},init:function(a){n.debug("[WebworkerBackend] init",a);if(this._initializationRequested)throw Error("[WebworkerBackend] initialization already requested!");if(0!==(a.globalFlags&3)){if(null===this.passwordProvider)throw Error("[WebworkerBackend] encrypted archives are unsupported.");this.backgroundKeyGenerator=new e(this.passwordProvider,a.entries,a.globalFlags)}var b=f.clone(a);b.url=this._toAbsoluteUrl(a.url);b.parser=b.format;this.decompressor.start(b);
this._initializationRequested=!0},read:function(a,b){var c=new h.Cancelable,e=new h.Completer(c.cancelCallback);this._doRead(a,b?b:null,e,c);return e.future},_createWaitForEntryReadCallback:function(a,b,c,e){return f.bind(function(){e.canceled||this._doRead(a,b,c,e)},this)},_doRead:function(a,b,c,e){if(null!==this._initFuture)this._initFuture.then(this._createWaitForEntryReadCallback(a,b,c,e));else if(a.flags&6&&null===a.aesDerivedKey)this.backgroundKeyGenerator.waitForKey(a,this._createWaitForEntryReadCallback(a,
b,c,e));else{var h=this.decompressor.createJob(a.filename);e.asyncTask=h;h.on("message",f.bind(function(b){b=b.data;switch(b.id){case 4660:c.complete(b.data,a.filename);break;case 57005:"Wrong password."===b.reason[0]?(this.backgroundKeyGenerator.waitForKey(a,this._createWaitForEntryReadCallback(a,c,e)),this.backgroundKeyGenerator.reportInvalidKey(),e.asyncTask=null):c.fail(null!==b.reason[1]?b.reason[1]:b.reason[0],a.filename)}},this));h.postMessage({entry:a,options:b})}},_onPoolInitialized:function(){this._initFuture=
null},_toAbsoluteUrl:function(a){if("/"!==a[0]){var c=b.location.pathname.split("/");c[c.length-1]=a;a=c.join("/")}return a}};var k=1,c=0;e.prototype={destroy:function(){this.worker.terminate();this.worker=null},verifyPassword:function(a){if(this._state===c)this.worker.postMessage({cmd:4,data:a}),this._state=1;else throw Error("[BackgroundKeyGenerator] Invalid state: "+this._state);},prioritizeEntry:function(a){this.worker.postMessage({cmd:6,data:a})},reportInvalidKey:function(){this._state!==c&&
(this._state=c,this._passwordProvider.requestNewPassword(f.bind(this.verifyPassword,this)))},_onError:function(a){this._passwordProvider.reportKeyDerivationError(a.message+" ("+a.filename+":"+a.lineno+")")},_onMessage:function(a){a=a.data;var b=a.data;switch(a.cmd){case 2:this.onKeysGenerated(b);break;case 5:this._state=c;b&&b.invalidPassword?(n.warn("[BackgroundKeyGenerator] password verification has failed [invalid password]"),this._passwordProvider.requestNewPassword(f.bind(this.verifyPassword,
this))):(n.error("[BackgroundKeyGenerator] password verification has failed ["+b+"]"),this._passwordProvider.reportKeyDerivationError(b));break;case 7:n.debug("[BackgroundKeyGenerator worker] "+b);break;case 3:this._state=2,n.debug("[BackgroundKeyGenerator] key derivation has finished")}},waitForKey:function(a,b){var c=a.filename;this.prioritizeEntry(c);c in this._keyRequests||(this._keyRequests[c]=[]);this._keyRequests[c].push(b)},onKeysGenerated:function(a){for(var b=0,c=a.length;b<c;++b){var e=
a[b],f=this._indexedEntries[e.filename];f.aesPV=e.aesPV;f.aesDerivedKey=e.aesDerivedKey;f.hmacKey=e.hmacKey;this._finishKeyRequests(f)}},_finishKeyRequests:function(a){a=this._keyRequests[a.filename];for(var b=0,c=a?a.length:0;b<c;++b)a[b]()}}})(r.io.package,r.io,r.utils,r.async,r.log,r.bin,_,I);(function(q,m,p,h,n,l,f,b,a){function e(a){this._passwordProvider=a;this._scheduler=new l.IOScheduler(2);this._fileSystemInfo=this._keyDerivationExecutor=this._entriesReader=this._remoteFile=null}function k(a,
e,d){this._queue=[];this._passwordProvider=a;this._keyDerivation=new f.SinglePasswordKeyDerivation(e,d);this._scheduledStep=null;this._passwordRequested=!1;this.step=b.bind(this._step,this)}q.DirectBackend=e;e.prototype={destroy:function(){this._keyDerivationExecutor&&this._keyDerivationExecutor.destroy()},init:function(a,b){this._entriesReader=b;0!==(a.globalFlags&3)&&(this._keyDerivationExecutor=new k(this._passwordProvider,a.entries,a.globalFlags));this._fileSystemInfo=a},createRemoteFileInstanceForURL:function(a){return this._remoteFile=
new l.RemoteFile(a,this._scheduler)},createRemoteFileInstanceForFileSystemInfo:function(a){var b=new l.RemoteFile(a.url,this._scheduler);b.etag=a.etag;b.size=a.size;return this._remoteFile=b},read:function(a,b){var d=new h.Cancelable,e=new h.Completer(d.cancelCallback);a.flags&6&&null===a.aesDerivedKey?this._deriveAesKeyThenRead(a,b,e,d,!1):this._doRead(a,b,e,d);return e.future},_deriveAesKeyThenRead:function(a,e,d,f,h){this._keyDerivationExecutor.waitForKey(a,f,b.bind(function(){this._doRead(a,e,
d,f)},this),h)},_doRead:function(a,b,d,e){var f=!1;"g4s"!==this._fileSystemInfo.format||a.flags&6||(f=this._fileSystemInfo.ddSupport);var h=l.Utf8Decoder;f&&(h=function(){this.init=function(a){a()}});b&&"BinaryImage"===b.type&&(h=l.Base64BinaryImageDecoder,f=!1);var k=this,f=this._entriesReader.readEntry(this._remoteFile,a,{ddSupport:f,writer:new h(a.uncompressedSize,a),onerror:function(f,h){"Wrong password."===f?(e.asyncTask=null,a.aesDerivedKey=null,k._keyDerivationExecutor.reportWrongKey(),k._deriveAesKeyThenRead(a,
b,d,e,!0)):(null!==k._keyDerivationExecutor&&k._keyDerivationExecutor.scheduleNextStep(),d.fail("undefined"===typeof h?f:h,a.filename))},onend:function(b){null!==k._keyDerivationExecutor&&k._keyDerivationExecutor.scheduleNextStep();d.complete(b,a.filename)}});e.asyncTask={cancel:f}}};k.prototype={destroy:function(){this._queue=this._step=null;clearTimeout(this._scheduledStep);this._scheduledStep=null;this._keyDerivation.setPassword(null)},waitForKey:function(a,b,d,e){e?this._queue.unshift({entry:a,
cancelable:b,callback:d}):this._queue.push({entry:a,cancelable:b,callback:d});this.scheduleNextStep()},_step:function(){var a=this._queue.shift();if(a&&!a.cancelable.canceled)if(n.debug("[KeyDerivationExecutor] deriving key for "+a.entry.filename),this._keyDerivation.deriveKeyForEntry(a.entry)){if(a.callback(),this._keyDerivation.singleKey){for(var b=0,d=this._queue.length;b<d;++b)a=this._queue[b],a.cancelable.canceled||a.callback();this._queue=[]}}else this._queue.unshift(a),this.reportWrongKey();
else 0<this._queue.length&&this._step();this._scheduledStep=null},scheduleNextStep:function(){null===this._scheduledStep&&!this._passwordRequested&&0<this._queue.length&&(this._scheduledStep=setTimeout(this.step,0))},_onPasswordResponse:function(a){this._passwordRequested=!1;this._keyDerivation.setPassword(a);this.scheduleNextStep()},reportWrongKey:function(){this._passwordRequested||(this._passwordRequested=!0,clearTimeout(this._scheduledStep),this._scheduledStep=null,this._passwordProvider.requestNewPassword(b.bind(this._onPasswordResponse,
this)))}}})(r.io.package,r.io,r.utils,r.async,r.log,r.bin,r.g4s,_,I);(function(q,m,p,h,n){function l(a){this.context=a;this.cacheFileSystem=a.cacheFileSystem||new m.LocalCacheFS(a);this.remoteFileSystem=a.remoteFileSystem||new m.PackageFS(a);this._state=f;this._paths=this._entries=this._initFuture=this._doRead=null}q.CachableFileSystem=l;var f=0,b=2;l.prototype={get entries(){if(this._state===b)return this._entries;throw Error("[CachableFileSystem] must be initialized");},get initialized(){return this._state===
b},init:function(){function a(a){l.push(a);return a}function e(a){h.error("[CachableFileSystem] unable to initialize remote file system ("+a+")");m=!0;a&&(z=a);c()}function k(a){h.error("[CachableFileSystem] unable to initialize cache("+a+")");q=!0;a&&(r=a);c()}function c(){m&&q&&(d.trigger("fileSystem:error","init",z,r),D.fail(z,r),d._state=f,d._initFuture=null)}function g(a){q||!G?(d._doRead=d._doReadRemoteOnly,h.debug("[CachableFileSystem] remote reading strategy used")):(d._doRead=d._doReadCacheFirst,
h.debug("[CachableFileSystem] cache first reading strategy used"));G||q||(h.debug("[CachableFileSystem] cache intialization is slower than remote response"),E.then(function(){h.debug("[CachableFileSystem] switched cache first reading strategy used");d._doRead=d._doReadCacheFirst}));d._entries=a;d._paths=n.pluck(a,"filename");d._state=b;d._initFuture=null;B=!0;D.complete();d.trigger("file-system-initialized");h.debug("[CachableFileSystem] ST_INITIALIZED")}var d=this,l=[],m=!1,q=!1,r=null,z=null,D=
new p.Completer(function(){n.each(l,function(a){a.cancel()});d._state=f});if(this._state===f){this._state=1;var E=a(this.cacheFileSystem.init()),u=a(this.remoteFileSystem.init()),w=null,x=null,G=!1,B=!1;E.catchError(k).then(function(){h.debug("[CachableFileSystem] cache intitialized");G=!0});u.then(function(b){h.debug("[CachableFileSystem] remote file system intitialized tag="+b);E.runWhenSucceed(function(){d.cacheFileSystem.verifyCache(b)?(h.debug("[CachableFileSystem] cache is valid for tag="+b),
B||(w=a(d.cacheFileSystem.loadFileSystemInfo()).then(function(b){null!==x&&x.cancel();d.remoteFileSystem.attachFileSystemInfo(b);h.debug("[CachableFileSystem] remote file system info attached");a(d.cacheFileSystem.list()).then(g).catchError(k)}).catchError(k))):h.debug("[CachableFileSystem] cache is not valid for tag="+b)});x=a(d.remoteFileSystem.loadFileSystemInfo()).then(function(b){h.debug("[CachableFileSystem] remote file system info loaded");null!==w&&w.cancel();E.runWhenSucceed(function(){d.cacheFileSystem.attachFileSystemInfo(b);
h.debug("[CachableFileSystem] cache file system info attached")});a(d.remoteFileSystem.list()).then(g).catchError(e)}).catchError(e)}).catchError(e).catchError(function(){h.debug("[CachableFileSystem] intializing fallback caching");E.runWhenSucceed(function(){w=a(d.cacheFileSystem.loadFileSystemInfo()).then(function(b){d.remoteFileSystem.attachFileSystemInfo(b);h.debug("[CachableFileSystem] remote file system info attached");a(d.cacheFileSystem.list()).then(g).catchError(k)}).catchError(k)})});return this._initFuture=
D.future}throw Error("[CachableFileSystem] is not fresh!");},destroy:function(){this._entries=null;null!==this._initFuture&&this._initFuture.cancel();this._initFuture=null;this.remoteFileSystem.destroy();this.cacheFileSystem.destroy();this._state=3},trigger:function(){"trigger"in this.context&&this.context.trigger.apply(this.context,arguments)},_checkInitialized:function(){if(this._state!==b)throw Error("[CachableFileSystem] is not initialized");},read:function(a,b){this._checkInitialized();if(-1===
this._paths.indexOf(a)){var f=new p.Completer;p.asyncError(f,1404);return f.future}return this._doRead(a,b?b:null)},list:function(){this._checkInitialized();var a=new p.Completer;p.asyncSuccess(a,n.clone(this._entries));return a.future},listPaths:function(){this._checkInitialized();var a=new p.Completer;p.asyncSuccess(a,n.clone(this._paths));return a.future},checkForChanges:function(){this.remoteFileSystem.checkForChanges()},_doReadRemoteOnly:function(a,b){return this.remoteFileSystem.read(a,b)},
_doReadCacheFirst:function(a,b){var f=new p.Cancelable,c=new p.Completer(f.cancelCallback);f.asyncTask=this.cacheFileSystem.read(a,b).then(n.bind(function(){this.remoteFileSystem.checkForChanges()},this)).catchError(n.bind(function(){f.asyncTask=this.remoteFileSystem.read(a,b).then(n.bind(function(c){this.cacheFileSystem.cacheFile(a,b,c)},this)).chainSuccess(c).chainError(c)},this)).chainSuccess(c);return c.future}}})(r.io,r.io,r.async,r.log,_);(function(q,m,p,h,n){function l(f){this.url=f;this.offlineStorage=
this.cacheEnabled=!0;this.encryptionKey=null;this.cacheFileSystem=new m.LocalCacheFS(this);this.passwordProvider=null}q.CachableFileSystemContext=l;l.getCacheManager=function(){return l.prototype.cacheManager};l.prototype={cacheManager:new m.CacheManager,destroy:function(){this.cacheFileSystem=null},tryToGetDownloaded:function(){return this.cacheFileSystem.tryToGetDownloadedState()===m.CACHE_STATE.DOWNLOADED},openStorage:function(){var f=new p.Completer;this.cacheManager.openCache(this.url,function(b){f.complete(b)},
function(b){f.fail(b)});return f.future}};n.extend(l.prototype,h.Events)})(r.io,r.io,r.async,Backbone,_);(function(q,m,p,h){function n(){this.tmp_arr=null}function l(b,a){this.tmp_arr=null;this.len=b;this.o1=this.o2=this.o3=this.ac=this.pos=0;this.userData=a.userData}p.extend(q,{Base64BinaryImageDecoder:l,ChunkBuffer:n});q=n.prototype;q.init=function(b){this.tmp_arr=[];b()};q.writeUint8Array=function(b,a){for(var e=0,f=b.length;e<f;++e)this.tmp_arr.push(b[e]);a()};q.getData=function(b,a){b(this.tmp_arr)};
var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("");q=l.prototype;q.init=function(b){this.tmp_arr=Array(this.len);b()};q.free=function(){this.tmp_arr=null};q.writeUint8Array=function(b,a){if(null!==this.tmp_arr){for(var e=0,f=b.length;e<f;++e)this.addToBase64(b[e]);a()}};q.getData=function(b,a){var e=this.pos%3,h=this.tmp_arr;if(0!==e){var c=this.o1,g=this.o2,d=this.o3;switch(e){case 1:g=0;case 2:d=0}c=c<<16|g<<8|d;g=c>>6&63;d=c&63;switch(e){case 1:g=64;case 2:d=64}h[this.ac]=
f[c>>18&63]+f[c>>12&63]+f[g]+f[d]}e=this.userData;b([{key:e.key,data:"data:"+e.mimetype+";base64,"+h.join(""),level:0,dpi:e.dpi}])};q.addToBase64=function(b){var a=this.o1,e=this.o2,h=this.o3,c=this.ac,g=this.pos,d=this.tmp_arr,l=b.length,m=0,n=0,p=0,q=0,q=0;if(b.readNumber)for(var r=0;r<l;++r)switch(m=(g+r+1)%3,n=b.readNumber(1,r),m){case 1:a=n;break;case 2:e=n;break;case 0:h=n,q=a<<16|e<<8|h,m=q>>18&63,n=q>>12&63,p=q>>6&63,q&=63,d[c++]=f[m]+f[n]+f[p]+f[q]}else for(r=0;r<l;++r)switch(m=(g+r+1)%3,
n=b[r],m){case 1:a=n;break;case 2:e=n;break;case 0:h=n,q=a<<16|e<<8|h,m=q>>18&63,n=q>>12&63,p=q>>6&63,q&=63,d[c++]=f[m]+f[n]+f[p]+f[q]}this.pos=g+l;this.ac=c;this.o1=a;this.o2=e;this.o3=h}})(r.bin,r.log,_,I);(function(q,m,p){q.applyOpacityMask=function(h,m){var l;l=h.data?h.data:new Uint8ClampedArray(h);var f;f=m.data?m.data:new Uint8ClampedArray(m);for(var b=0,a=l.length,e=f.length;b<a&&b<e;b+=4)l[b+3]=f[b+3]};m.Task&&(p=function(h,n,l){m.Task.call(this);this.data=h.data;this.maskData=n.data;this.callback=
l;this.i=0},p.prototype={step:function(){if(null!==this.parentTask&&this.parentTask.interrupted)this.done=!0,this.data=this.maskData=null;else{for(var h,m=h=this.i,l=this.maskData,f=this.data,b=f.length,a=l.length,e;(e=m<b&&m<a)&&1E5>m-h;m+=4)f[m+3]=l[m+3];this.i=m;e||(this.done=!0,this.data=this.maskData=null,this.callback(f))}}},q.OpacityMaskProcess=p)})(r.utils,r,I);(function(q,m,p,h,n){function l(){this.transferableObjectsSupported=!1;if(h.Worker){var e=h.Worker,c=h.ZIP_WORKER_PATH;c||(c=p.base_path);
this.worker=new e(c+"image-decoder-web-worker.js");this.worker.onmessage=_.bind(this.onmessage,this);this.worker.postMessage({cmd:f});this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage;try{var g=new ArrayBuffer(1);this.worker.postMessage({cmd:-1,array:g},[g]);0===g.byteLength&&n.browser.chrome&&(this.transferableObjectsSupported=!0)}catch(d){}this.requests=[];this.state=b}else this.state=a;this.blobLevel=0}q.ImageAsyncServiceClient=l;var f=1,b=0,a=1,e=null;l.getInstance=
function(){return null!==e?e:e=new l};l.prototype={onmessage:function(a){a=a.data;if(a.cmd===f)this.blobLevel=a.blobLevel,this.onInit();else if(2===a.cmd){var b=this.requests.shift();b.callback(a.blobURL,!0)}else if(4===a.cmd){var b=this.requests.shift(),e=b.context;e.putImageData(a.brushImageData,0,0);b.callback(e)}else 5===a.cmd?(b=this.requests.shift(),e=b.context,b.brushImageData.data.buffer=a.brushImageData,e.putImageData(b.brushImageData,0,0),b.callback(e)):-1!==a.cmd&&(p.log.error("Unable to create blob URL:"+
a.msg),b=this.requests.shift(),b.callback(b.dataURL,!1))},decode:function(a,c){switch(this.state){case 2:0===this.blobLevel?setTimeout(c(a,!1),0):setTimeout(function(){c(a,!1)},0);break;case b:this.requests.push({cmd:2,dataURL:a,callback:c});break;default:setTimeout(function(){c(a,!1)},0)}},applyOpacityMask:function(a,b,e){setTimeout(function(){var d=b.canvas,d=b.getImageData(0,0,d.width,d.height),f=a.canvas,f=a.getImageData(0,0,f.width,f.height);m.applyOpacityMask(f,d);a.putImageData(f,0,0);e(a)},
0)},onInit:function(){this.state=2;for(var a=this.requests.splice(0),b=0,e=a.length;b<e;++b){var d=a[b];2===d.msg?this.decode(d.dataURL,d.callback):4===d.msg&&this.applyOpacityMask(d.context,d.maskCtx,d.callback)}},destroy:function(){this.state===b&&(this.state=a);this.requests=null;this.worker.terminate()}}})(r.viewer,r.utils,r,I,jQuery);(function(q,m,p,h,n){function l(f){this.imageIndex=f.imageIndex}q.DataImageDecoder=l;l.prototype={getParser:function(){return n.bind(this.parse,this)},parse:function(f,
b,a){var e=null,e=n.isString(f)?JSON.parse(f):f;if(n.isArray(e)){a=e.length;var h=this.imageIndex,c=a,g=[],d=function(){var a=this.metadata;h.indexObject(a);g.push(a);this.onerror=this.onload=this.metadata.data=null;--c;0===c&&b(g)},l=function(){this.metadata=this.onerror=this.onload=this.metadata=null;--c;0===c&&b(g)},m=p.features.Blob.URL;for(f=0;f<a;++f){var q=e[f],r=new Image,z=q.level;z||(z=0);r.onload=d;r.onerror=l;var D=q.data;if(null===D)r.onerror();else 1===z&&(D=m.createObjectURL(D)),r.metadata=
{key:q.key,data:r,level:z,vDPI:q.vDpi?q.vDpi:96,hDPI:q.hDpi?q.hDpi:96},r.src=D}}else a("invalid Images file")}}})(r.viewer,r.bin,r,r.log,_);(function(q,m,p,h,n,l,f){function b(b,d){this.fileSytem=b;this.fontsManager=d;this.imageIndex=new z;this.resourceIndex=new z;this.pages=this.relIndex=this.fileIndex=null;this.imageFileFreedCallback=n.bind(E,this);this.onMandatoryPageFilesLoaded=n.bind(a,this);this.onMandatoryPageFilesLoadFailed=n.bind(k,this);this.onPageImageFilesLoaded=n.bind(c,this)}function a(a,
b){e(a);if(this.fileIndex){var c=b.userdata,d=c.pageObject;d.referencedFiles=n.clone(a);var f=d.state=2;n.isEmpty(d.thumbnailKey)||c.request.success(d.idx,f,this.getImage(d.thumbnailKey));f=new g({success:this.onPageImageFilesLoaded,error:this.onMandatoryPageFilesLoadFailed,userdata:c});d.req=f;var h=f.files,k=this.fileIndex.get(d.id);h[k]=k;var l=d.dep,m=this.fontsManager.initPageFonts(d.idx,l.Fonts);c.fonts=m;for(c=m.length;c--;){var q=m[c];h[q]=q}q=l.ContentResource;for(c=q.length;c--;){var r=
q[c];h[r]=r}r=p.viewer.DataImageDecoder;l=l.Images;for(c=l.length;c--;){var t=l[c];t.parser=(new r(this)).getParser();h[t]=t}d=d.dep.BinaryImage;for(c=d.length;c--;)t=d[c],t.parser=(new r(this)).getParser(),h[t]=t;for(c=m.length;c--;)m[c].request(f);k.request(f);for(c=q.length;c--;)q[c].request(f);for(c=l.length;c--;)l[c].request(f);for(c=d.length;c--;)d[c].request(f)}}function e(a){for(var b=a.length;b--;)a[b].incRef()}function k(a,b){if(this.fileIndex){for(var c=b.userdata,d=c.pageObject,e=d.state=
-1,f=0,g=a.length;f<g;++f)if(65535===a[f].error[1]){e=d.state=-2;break}d.req=null;c.request.error(d.idx,e)}}function c(a,b){if(this.fileIndex){e(a);var c=b.userdata,d=c.pageObject;d.req=null;this.fontsManager.pushFonts(c.fonts);d.referencedFiles.push.apply(d.referencedFiles,a);var f=d.state=3;c.request.success(d.idx,f,this.fileIndex.get(d.id).data)}}function g(a){this.reset();this.success=a.success||u;this.error=a.error||u;this.complete=a.complete||u;this.progress=a.progress||u;this.onpassword=a.onpassword||
u;this.userdata=a.userdata;this.completeHandler=!1}function d(a,b){b(JSON.parse(a))}function r(a,b,c){this.path=a;this.id=null;this.fileSystem=b;this.counter=0;this.onFree=this.type=this.data=null;this.requests=[];this.userData=this.abortRequest=null;this.parser=c||d;this.onLoadedCallback=n.bind(this.onLoaded,this);this.onFailedCallback=n.bind(this.onFailed,this);this.onParsedCallback=n.bind(this.onParsed,this)}function y(a){this.fileSystem=a;this.seq=[];this.files={};this.objects={}}function v(){this.Images=
[];this.Thumbnails=[];this.ContentResource=[];this.Fonts=[];this.Text=[];this.BinaryImage=[]}function A(a){this.fileIndex=a;this.objects={};this.empty=new v}function z(){this.objects={}}function D(a,b,c){if(b){var d=b.length;if(c)for(var e=0;e<d;++e){var f=b[e],g=a.indexObject(f);g&&"Images"===g.type||"Thumbnails"===g.type?g.onFree=c:g&&"BinaryImage"===g.type&&(g.onFree=c,g.userData={key:f.key,mimetype:f.mimetype,dpi:f.dpi})}else for(e=0;e<d;++e)f=b[e],a.indexObject(f)}}function E(a){a=a.data;var b=
p.features.Blob.URL;if(a)for(var c=a.length,d=this.imageIndex,e=l.browser.safari&&p.is_mobile,f=0;f<c;++f){var g=a[f];if(g.data){var h=g.data;0<g.level&&b.revokeObjectURL(h.src);e&&(h.src=null)}d.removeObject(g)}}function u(){}q.VitriumDocumentPackageFormatManager=b;b.prototype={destroy:function(){for(var a=this.pages,b=0,c=a?a.length:0;b<c;++b)0!==a[b].state&&this.freePage(b);this.fileSytem=this.onPageImageFilesLoaded=this.onMandatoryPageFilesLoadFailed=this.onMandatoryPageFilesLoaded=this.imageFileFreedCallback=
this.pages=this.relIndex=this.fileIndex=this.resourceIndex=this.imageIndex=null},loadInfo:function(){var a=new m.Cancelable,b=new m.Completer(a.cancelCallback),c=this;a.asyncTask=this.fileSytem.listPaths().then(function(d){if(-1===d.indexOf("index.js"))b.fail("index.js file not found, invalid document format");else{for(var e=c.fileIndex=new y(c.fileSytem),f=0,g=d.length;f<g;++f)e.index(d[f]);a.asyncTask=c.fileSytem.read("index.js").then(function(d){a.asyncTask=null;try{b.complete(c._processInfo(JSON.parse(d)))}catch(e){b.fail(e)}}).chainError(b)}}).chainError(b);
return b.future},_processInfo:function(a){if("FixedDocument"===a.documentType){var b=this.fileIndex;D(b,a.objects,this.imageFileFreedCallback);var c=this.relIndex=new A(b);D(c,a.relationships);for(var d=a.pageContentsMetadata,e=d.length,f=this.pages=Array(e),c={};e--;){var g=d[e],h=g.number-1;c[g.pageContentId]=h;f[h]={idx:h,id:g.pageContentId,thumbnailKey:g.thumbnailKey,req:null,dep:null,state:0,referencedFiles:null}}d=a.contentResourcesMetadata;f=this.resourceIndex;if(d)for(e=d.length;e--;)g=d[e],
f.indexObject({key:g.key,data:b.get(g.contentResourceId)});b=a.linkTargets;d={};if(b)for(e=b.length;e--;)f=b[e],d[f.name]=c[f.pageContentId];return{title:a.title,author:a.author,documentType:a.documentType,nonascii:a.nonascii,pages:a.pageContentsMetadata,linkTargets:d,watermarks:a.watermarks||[]}}throw Error("Unsupported document type: "+a.documentType);},loadPage:function(b){var c=this.pages[b.idx];if(c)if(3<=c.state)b.success(c.idx,c.state,this.fileIndex.get(c.id).data);else{var d;(d=c.dep)||(d=
c.dep=this.relIndex.get(c.id));b=c.req=new g({success:this.onMandatoryPageFilesLoaded,error:this.onMandatoryPageFilesLoadFailed,userdata:{pageObject:c,request:new g(b)}});c.state=1;c=b.files;d=d.Thumbnails;for(var e=d.length;e--;){var f=d[e];c[f]=f}c=p.viewer.DataImageDecoder;for(e=d.length;e--;)f=d[e],f.parser=(new c(this)).getParser(),f.request(b);0===d.length&&a.call(this,[],b)}else b.error("index out of bounds")},freePage:function(a){if((a=this.pages[a])&&0<a.state){var b=a.referencedFiles;if(b)for(var c=
b.length;c--;)b[c].decRef();a.referencedFiles=[];a.state=0;a.req&&(a.req.abort(),a.req=null)}},loadDocumentFonts:function(a){return this._loadByType("Fonts",a)},loadDocumentOutline:function(a){return this._loadByType("DocumentOutline",a)},loadTextIndex:function(a){var b=a.idx,c=this.pages[b];if(c){c=this.relIndex.get(c.id);if(n.isEmpty(c.Text)){var d=setTimeout(function(){a.success("no-text",{userdata:{idx:b}})},0);return function(){clearTimeout(d)}}var c=c.Text[0],e=new g(n.extend({userdata:{idx:b}},
a));c.request(e);return n.bind(c.free,c)}a.error("index out of bounds");return null},tryGetThumbnail:function(a){return(a=this.imageIndex.get(this.pages[a].thumbnailKey))?a:null},getImage:function(a){return this.imageIndex?this.imageIndex.get(a):null},getResource:function(a){return this.resourceIndex?this.resourceIndex.get(a).data:null},getNumberOfPages:function(){return this.pages.length},loadFirstPageThumbnail:function(){var a=new m.Cancelable,b=new m.Completer(a.cancelCallback),c=this.tryGetThumbnail(0);
if(null!==c)m.asyncSuccess(b,c.src);else{var d=this.pages[0],c=this.relIndex.get(d.id);0<c.Thumbnails.length?a.asyncTask=this.fileSytem.read(c.Thumbnails[0].path).then(function(a){try{var c=JSON.parse(a),e=n.find(c,function(a){return a.key===d.thumbnailKey});e?b.complete(e.data):b.complete(null)}catch(f){b.complete(null)}}).chainError(b):m.asyncSuccess(b,null)}return b.future},listFilesForDownload:function(){function a(b){-1===c.indexOf(b.path)&&c.push(b.path)}var b=this.pages,c=[];if(!b)return c;
for(var d=0,e=b.length;d<e;++d){var f=b[d],g=this.fileIndex.get(f.id);c.push(g.path);f=this.relIndex.get(f.id);n.each(f.Images,a);n.each(f.Thumbnails,a);n.each(f.Fonts,a);n.each(f.ContentResource,a);n.each(f.Text,a)}c.push("index.js");return c},_loadByType:function(a,b){for(var c=this.fileIndex.getByType(a),d=new g(b),e=c.length,f=d.files,h=0;h<e;++h){var k=c[h];f[k]=k}for(h=0;h<e;++h)k=c[h],k.request(d);0===e&&b.complete([],d);return d}};q=g.prototype;q.onRequestedCompleted=function(a){this.completeHandler=
!0;delete this.files[a];if(this.isCompleted()){a=this.failed;var b=this.succeeded;n.isEmpty(a)?this.success(b,this):this.error(a,this);this.complete(b,a,this);for(var c=a.length,d=0;d<c;++d){var e=a[d].file;0<e.counter&&e.decRef()}c=b.length;for(d=0;d<c;++d)e=b[d],0<e.counter&&e.decRef()}this.completeHandler=!1};q.onSucceeded=function(a){this.completeHandler?p.log.warn("success handler not called for the file: "+a):(this.progress(a,!0),this.succeeded.push(a),this.onRequestedCompleted(a))};q.onFailed=
function(a,b){!this.completeHandler&&a?(this.progress(a,!1,b),this.failed.push({file:a,error:b}),this.onRequestedCompleted(a)):a&&(p.log.error("error handler cannot be dispatched: "+a.path+" "+b.toString()),p.log.error(b),b.stack&&p.log.error(b.stack))};q.onRequested=function(a){this.files[a]=a;a.incRef()};q.reset=function(){this.files={};this.succeeded=[];this.failed=[]};q.abort=function(){n.each(this.files,n.bind(this.abortCallback,this))};q.abortCallback=function(a){a.abort(this);0<a.counter&&
a.decRef()};q.isCompleted=function(){return n.isEmpty(this.files)};q=r.prototype;q.toString=function(){return this?"F["+this.id+"]:"+this.path:null};q.incRef=function(){++this.counter};q.decRef=function(){var a=--this.counter;0===a&&this.free();if(0>a)throw Error("something went wrong, the counter must be >= 0 "+this.path);};q.free=function(){var a=this.onFree;n.isFunction(a)&&a(this);this.data=null;this.abortRequest&&this.abortRequest()};q.destroy=function(){this.onParsedCallback=this.onFailedCallback=
this.onLoadedCallback=this.onLoadedCallback=this.abortRequest=this.requests=this.fileSystem=null};q.request=function(a){a.onRequested(this);if(this.data)a.onSucceeded(this);else{var b=this.requests;b.push(a);1===b.length&&(a=this.fileSystem.read(this.path,{type:this.type,blobLevel:0,userData:this.userData}).then(this.onLoadedCallback).catchError(this.onFailedCallback),this.abortRequest=n.bind(a.cancel,a))}};q.onLoaded=function(a){try{this.abortRequest=null,this.parser(a,this.onParsedCallback,this.onFailedCallback)}catch(b){this.onFailedCallback(b)}};
q.onParsed=function(a){this.data=a;a=this.requests;for(var b=a.length,c=0;c<b;++c)a[c].onSucceeded(this);this.requests=[]};q.onFailed=function(a){this.abortRequest=null;for(var b=this.requests,c=b.length,d=0;d<c;++d)b[d].onFailed(this,a);this.requests=[]};q.abort=function(a){this.requests=n.without(this.requests,a)};q=y.prototype;q.index=function(a){var b=new r(a,this.fileSystem);this.seq.push(this.files["/"+a]=b);return b};q.indexObject=function(a){var b=a.uri;if(0===b.indexOf("/")){if(b=this.files[b]){var c=
a.id;b.type=a.type;b.id=c;return this.objects[c]=b}throw Error("file is not in package: "+a.uri);}p.log.warn("object uri not valid: "+b);return null};q.getByType=function(a){for(var b=[],c=this.seq,d=c.length,e=0;e<d;++e){var f=c[e];f.type===a&&b.push(f)}return b};q.get=function(a){return this.objects[a]};q.getFile=function(a){return this.files[a]};q=A.prototype;q.indexObject=function(a){var b=this.objects,c=a.sourceId,d=a.targetId;(a=this.objects[c])||(a=b[c]=new v);b=this.fileIndex.get(d);(c=a[b.type])&&
c.push(b)};q.get=function(a){var b=this.objects[a];if(b){a=new v;var c=n.clone(b.Images),d=n.clone(b.Fonts),e=n.clone(b.Text),f=n.clone(b.BinaryImage),g=n.clone(b.Thumbnails);if(!n.isEmpty(b.ContentResource))for(var b=a.ContentResource=n.clone(b.ContentResource),h=b.length,k=0;k<h;++k){var l=this.get(b[k].id);c.push.apply(c,l.Images);d.push.apply(d,l.Fonts);e.push.apply(e,l.Text);f.push.apply(f,l.BinaryImage);g.push.apply(g,l.Thumbnails)}a.Images=n.uniq(c);a.Fonts=n.uniq(d);a.Text=n.uniq(e);a.BinaryImage=
n.uniq(f);a.Thumbnails=n.uniq(g);b=a}else b=this.empty;return b};q=z.prototype;q.indexObject=function(a){this.objects[a.key]=a.data};q.removeObject=function(a){delete this.objects[a.key]};q.get=function(a){return a in this.objects?this.objects[a]:null}})(r.viewer,r.async,r,r.zip,_,jQuery,I);(function(q,m,p){function h(h){this.data={};this.viewer=h;this.startTime=null;this.onPageRequested=_.bind(this.pageRequested,this);this.onPageRenderedBegin=_.bind(this.pageRenderedBegin,this);this.onPageRenderedEnd=
_.bind(this.pageRenderedEnd,this);this.remoteLogger=null;this.runs=0}q.Benchmark=h;q=h.prototype;q.start=function(){m.benchmark=!0;this.remoteLogger||(this.remoteLogger=new m.utils.RemoteLogger);var h=this.viewer;h.changeDocumentRenderer(m.viewer.OnePageDocumentRenderer);h.on("page:requested",this.onPageRequested);h.on("page-render:begin",this.onPageRenderedBegin);h.on("page-render:end",this.onPageRenderedEnd);this.data={};this.startTime=(new Date).getTime()};q.pageRequested=function(h){this.data[h]||
(this.data[h]={requested:(new Date).getTime(),renderedBegin:0,renderedEnd:0,state:0})};q.pageRenderedBegin=function(h,l){var f=this.data[h];f.renderedBegin=(new Date).getTime();f.state=l};q.pageRenderedEnd=function(h,l){this.data[h].renderedEnd=(new Date).getTime();if(3===l&&this.viewer.documentInfo.pages.length-1===h)this.stop();else if(3===l){var f=this.viewer;setTimeout(function(){f.scrollTo(h+1)},500)}};q.stop=function(){m.benchmark=!1;var h=(new Date).getTime()-this.startTime;viewer.off("page:requested",
this.onPageRequested);viewer.off("page-render:begin",this.onPageRenderedBegin);viewer.off("page-render:end",this.onPageRenderedEnd);var l=this.data,f=_.keys(l),b=0,a=0;_.each(jQuery.browser,function(a,b){});for(var e=-1,k=5184E3,c=-1,g=5184E3,d=0,q=f.length;d<q;++d)var r=l[d],v=r.renderedBegin-r.requested,r=r.renderedEnd-r.renderedBegin,b=b+v,a=a+r,e=Math.max(v,e),k=Math.min(v,k),c=Math.max(r,c),g=Math.min(r,g);this.remoteLogger.debug(window.location.toString(),p.browser.name+"["+p.browser.version+
"]",this.runs,h,b,a,b/f.length,a/f.length,e,k,c,g);this.data={};10>this.runs&&(this.runs+=1,this.start(),viewer.scrollTo(0))}})(r.utils,r,jQuery);(function(q){q.loadByMultipleKeys=function(m,p,h,n){m.readTransaction(function(l){function f(a){e||(e=!0,n(a))}for(var b={},a=p.length,e=!1,k=0;k<a;++k)l.getItem(p[k],function(c,e,d){b[d]=null===e?null:JSON.parse(e);--a;0===a&&setTimeout(function(){h(b)},0)},f)},n)}})(r.utils);(function(q,m,p,h,n,l,f){function b(b,e,d,f,h){this.url=b;this.modelDescription=
e;this.serviceCaller=d;this.storage=new a(b,e);this.pollAgent=f;this.completer=null;this.args=h}function a(a,b){this.url=a;this.modelDescription=b;this.storage=null;this.state=k;this.completer=null}function e(a){return a.service+"."+a.action}q.DynamicEnvironment=b;b.prototype={getDbContextId:function(){return this.args.has("documentId")?this.args.get("documentId"):this.args.get("documentUrl")},destroy:function(){this.unbindUpdateEvents()},callRemote:function(a,b,d){var h=e(d);return b.call(d.service,
d.action,{}).then(function(b){a[h]=b}).catchError(function(b){a[h]=null;0!==b&&f.isFunction(d.remoteErrorHandler)&&d.remoteErrorHandler(b,h)})},propagateData:function(a){},init:function(){var a=this,b=this.serviceCaller;if(null===b)throw Error("[DynamicEnvironment.serviceCaller] must be not null");if(null===this.completer){for(var d=this.completer=new p.Completer,k={},l=this.modelDescription,m=0,n=l.length;m<n;++m)this.callRemote(k,b,l[m]);var q=this.storage,r=q.init();b.send().then(function(){r.runWhenSucceed(function(){q.save(k).then(function(){h.debug("[StorageManager.init] saved")}).catchError(function(){h.warn("[StorageManager.init] unable to save defaults")})}).runWhenFailed(function(){h.warn("[StorageManager.init] unable to init storage for defaults")});
E(k)}).catchError(function(a){r.runWhenSucceed(function(){q.load().then(E).catchError(function(a){h.error("[StorageManager.load] failed",a);d.fail()})}).runWhenFailed(function(){h.error("[StorageManager.init] failed");d.fail()})});var E=function(b){var g=!1;f.each(b,function(a,b){null===a&&(f.find(l,function(a){return e(a)===b}).optional||(g=!0))});g?d.fail():(f.each(b,function(a,b){f.find(l,function(a){return e(a)===b}).model.set(a)}),a.bindUpdateEvents(),d.complete())};d.future.whenComplete(f.bind(function(){this.completer=
null},this));return d.future}throw Error("[DocumentDescriptionProvider.init] can be called only once!");},update:function(a){var b=this.modelDescription;this.storage.save(a).then(function(){f.each(a,function(a,c){f.find(b,function(a){return e(a)===c}).model.set(a)})}).catchError(function(){h.error("[StorageManager.save] update environment failed")})},bindUpdateEvents:function(){f.each(this.modelDescription,f.bind(function(a,b){if(f.isString(a.updateEvent))this.pollAgent.on(a.updateEvent,function(b){var f=
{};f[e(a)]=b;this.update(f)},this)},this))},unbindUpdateEvents:function(){this.pollAgent.off(null,null,this)},refresh:function(a){var b=f.find(this.modelDescription,function(b){return e(b)===a});if(b){var d={},b=this.callRemote(d,this.serviceCaller,b);b.then(f.bind(function(){this.update(d)},this));this.serviceCaller.send();return b}throw Error("Unable to find "+a);},store:function(a,b){var d=f.find(this.modelDescription,function(b){return e(b)===a});if(d&&d.store)return d={},d[a]=b,this.storage.save(d);
throw Error("Unable to store");}};var k=0;a.prototype={init:function(){this.completer=new p.Completer;this.state=1;n.create("env:"+this.url,f.bind(this.onDbInit,this),f.bind(this.onDbInitFailed,this));return this.completer.future},load:function(){if(3===this.state)return this.completer=new p.Completer,this.state=2,m.loadByMultipleKeys(this.storage,this.buildKeys(),f.bind(this.onDataLoaded,this),f.bind(this.onDataLoadFailed,this)),this.completer.future;var a=new p.Completer;this.completer.future.then(f.bind(function(){this.load().then(function(){a.complete.call(a,
arguments)}).catchError(function(){a.fail.call(a,arguments)})},this));return a.future},save:function(a){if(3===this.state){var b=new p.Completer,d=0,e=!1,h=f.bind(function(a){e||b.fail(a);e=!0},this),k=f.bind(function(){0===--d&&b.complete(0)},this);this.storage.transaction(function(b){f.each(a,function(){++d});f.each(a,function(a,c){b.setItem(c,JSON.stringify(a),k,h)})},f.bind(b.fail,b))}else-1===this.state?(b=new p.Completer,setTimeout(function(){b.complete()},0)):(b=new p.Completer,this.completer.future.then(f.bind(function(){this.save(a).then(function(){b.complete.call(b,
arguments)}).catchError(function(){b.fail.call(b,arguments)})},this)));return b.future},buildKeys:function(){for(var a=this.modelDescription,b=[],d=0,f=a.length;d<f;++d)b[d]=e(a[d]);return b},onDbInit:function(a){this.storage=new m.VerifiableStorage(a);this.state=3;this.completer.complete(null)},onDataLoaded:function(a){this.state=3;this.completer.complete(a)},onDataLoadFailed:function(){this.state=3;this.completer.complete(null)},onDbInitFailed:function(){-1!==this.state&&(this.state=-1,this.completer.fail(0))}}})(r.viewer,
r.utils,r.service,r.log,r.utils.asyncStorage,Backbone,_);(function(q,m,p,h){function n(h){this.sc=h;this.pollMsg=this.interval=null;this.requested=!1}q.PollAgent=n;n.prototype={destroy:function(){this._cancelTimer();this.sc=null},init:function(l){this._cancelTimer();l&&(this.pollMsg=l,this.interval=setInterval(h.bind(this.poll,this),1E3*l.pollingIntervalSeconds))},poll:function(){this.requested||(this.requested=!0,this.sc.call("Event","poll",this.pollMsg).then(h.bind(this.onPollResult,this)).catchError(h.bind(this.onError,
this)),this.sc.send())},onPollResult:function(h){this.requested=!1;h=h.events;for(var f=0,b=h.length;f<b;++f){var a=h[f];this.trigger(a.channel+":"+a.name,a.data)}},onError:function(h){this.requested=!1;this.trigger("poll:error",h);m.error("[PollAgent] ERROR response: "+h)},_cancelTimer:function(h){null!==this.interval&&(clearInterval(this.interval),this.interval=null,m.debug("[PollAgent] timer canceled"))}};h.extend(n.prototype,p.Events)})(r.viewer,r.log,Backbone,_);(function(q){q.openNewWindow=
function(m){var p=window.document,h=p.createElement("a");h.setAttribute("href",m);h.setAttribute("target","_blank");m=p.createEvent("HTMLEvents");m.initEvent("click",!0,!0);h.dispatchEvent(m)}})(r.utils);(function(q,m){q.executeDialogAction=function(p){"redirect:"===p.substr(0,9)?(p=p.substring(9,p.length),window.location=p):"open:"===p.substr(0,5)?(p=p.substring(5,p.length),m.openNewWindow(p)):"refresh"===p&&window.location.reload()}})(r.actions,r.utils);(function(q,m,p,h,n,l){function f(a,b){this.viewer=
a;this.pollAgent=b;b.on("INTERACTION:BOX_SHOW_REQUESTED",this.onBoxShowRequested,this)}function b(a,b,f){a.on("button:"+b,function(a){h.executeDialogAction(f)})}q.InteractionChannelHandler=f;f.prototype={destroy:function(){this.pollAgent.off("INTERACTION:BOX_SHOW_REQUESTED",this.onBoxShowRequested,this)},onBoxShowRequested:function(a){if(l.isString(a.title)&&l.isString(a.body)){var e="";l.isString(a.type)&&(e=a.type);var f=null;if(l.isArray(a.buttons))for(var c=a.buttons,f=[],g=0,d=c.length;g<d;++g){var h=
c[g],q=[];(h["default"]||1===d)&&q.push("btn-primary");l.isString(h.cssClass)&&q.push(h.cssClass);l.isString(h.label)?(h={id:"id-"+g,cssClass:q.join(" "),title:h.label,action:h.action},f.push(h)):n.error("[InteractionChannelHandler] button label field is required")}g=!0;f&&0!==f.length||(g=!1,f=[{id:"close",title:p._T("fs-close"),cssClass:"btn-primary"}]);a=m.showDismissBox(this.viewer,e,a.title,a.body,{buttons:f});if(g)for(g=0,d=f.length;g<d;++g)h=f[g],h.action&&0<h.action.length&&b(a,h.id,h.action)}else n.error("[InteractionChannelHandler] Fields title and body are required to complete this task")}}})(r.viewer,
r.viewer,r.i18n,r.actions,r.log,_);(function(q){var m;m=function(m){function h(){}h.generate=function(){var m=h._getRandomInt,l=h._hexAligner;return l(m(32),8)+"-"+l(m(16),4)+"-"+l(16384|m(12),4)+"-"+l(32768|m(14),4)+"-"+l(m(48),12)};h._getRandomInt=function(h){return 0>h?NaN:30>=h?0|Math.random()*(1<<h):53>=h?(0|1073741824*Math.random())+1073741824*(0|Math.random()*(1<<h-30)):NaN};h._getIntAligner=function(h){return function(l,f){for(var b=l.toString(h),a=f-b.length,e="0";0<a;a>>>=1,e+=e)a&1&&(b=
e+b);return b}};h._hexAligner=h._getIntAligner(16);h.FIELD_NAMES="timeLow timeMid timeHiAndVersion clockSeqHiAndReserved clockSeqLow node".split(" ");h.FIELD_SIZES=[32,16,16,8,8,48];h.genV4=function(){var m=h._getRandomInt;return(new h)._init(m(32),m(16),16384|m(12),128|m(6),m(8),m(48))};h.parse=function(m){if(m=/^\s*(urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(\})?\s*$/i.exec(m)){var l=m[1]||"",f=m[8]||"";if(""===l+f||"{"===l&&"}"===f||"urn:uuid:"===
l.toLowerCase()&&""===f)return(new h)._init(parseInt(m[2],16),parseInt(m[3],16),parseInt(m[4],16),parseInt(m[5],16),parseInt(m[6],16),parseInt(m[7],16))}return null};h.prototype._init=function(){var m=h.FIELD_NAMES,l=h.FIELD_SIZES,f=h._binAligner,b=h._hexAligner;this.intFields=Array(6);this.bitFields=Array(6);this.hexFields=Array(6);for(var a=0;6>a;a++){var e=parseInt(arguments[a]||0);this.intFields[a]=this.intFields[m[a]]=e;this.bitFields[a]=this.bitFields[m[a]]=f(e,l[a]);this.hexFields[a]=this.hexFields[m[a]]=
b(e,l[a]/4)}this.version=this.intFields.timeHiAndVersion>>12&15;this.bitString=this.bitFields.join("");this.hexString=this.hexFields[0]+"-"+this.hexFields[1]+"-"+this.hexFields[2]+"-"+this.hexFields[3]+this.hexFields[4]+"-"+this.hexFields[5];this.urn="urn:uuid:"+this.hexString;return this};h._binAligner=h._getIntAligner(2);h.prototype.toString=function(){return this.hexString};h.prototype.equals=function(m){if(!(m instanceof h))return!1;for(var l=0;6>l;l++)if(this.intFields[l]!==m.intFields[l])return!1;
return!0};h.genV1=function(){var m=(new Date).getTime(),l=h._state;m!=l.timestamp?(m<l.timestamp&&l.sequence++,l.timestamp=m,l.tick=h._getRandomInt(4)):Math.random()<h._tsRatio&&9984>l.tick?l.tick+=1+h._getRandomInt(4):l.sequence++;var m=h._getTimeFieldValues(l.timestamp),f=m.low+l.tick,b=m.hi&4095|4096;l.sequence&=16383;var a=l.sequence>>>8|128,e=l.sequence&255;return(new h)._init(f,m.mid,b,a,e,l.node)};h.resetState=function(){h._state=new h._state.constructor};h._tsRatio=0.25;h._state=new function(){var m=
h._getRandomInt;this.timestamp=0;this.sequence=m(14);this.node=1099511627776*(m(8)|1)+m(40);this.tick=m(4)};h._getTimeFieldValues=function(h){h-=Date.UTC(1582,9,15);var l=h/4294967296*1E4&268435455;return{low:1E4*(h&268435455)%4294967296,mid:l&65535,hi:l>>>16,timestamp:h}};h.makeBackwardCompatible=function(){var m=h.generate;h.generate=function(l){return l&&1==l.version?h.genV1().hexString:m.call(h)};h.makeBackwardCompatible=function(){}};h.overwrittenUUID=m;return h}(m);q.UUID=m})(r.analytics);(function(q,
m){function p(h,l){this.page=h;this.totalPageCount=l;this.visitedAt=Date.now();this.destinationPage=this.duration=null}function h(h,l){h.on("change:currentPage",this.onPageChanged,this);h.on("change:pageCount",this.onPageCountChanged,this);this._viewer=h;this._analyticsProcessor=l;this._beaconInterval=this._pendingChange=this._lastChange=this._pageCount=null;this._viewer.initialPageLoadCompleter.future.runWhenSucceed(m.bind(function(){null!==this._lastChange&&(this._lastChange.page=this._viewer.currentPage,
null!==this._pendingChange&&(clearTimeout(this._pendingChange),this._pendingChange=null),this.fireBeacon());this._beaconInterval=setInterval(m.bind(this.fireBeacon,this),6E4)},this))}q.PageLeftCalculator=h;h.prototype.destroy=function(){this._viewer.off("change:currentPage",this.onPageChanged,this);this._viewer.off("change:pageCount",this.onPageCountChanged,this)};h.prototype.onPageCountChanged=function(h){this._pageCount=h};h.prototype.onPageChanged=function(h){if(null===this._lastChange)this._lastChange=
new p(h,this._pageCount),this._beaconInterval=setInterval(m.bind(this.fireBeacon,this),6E4);else if(this._lastChange.page!==h){null!==this._beaconInterval&&(clearInterval(this._beaconInterval),this._beaconInterval=null);var l=new p(h,this._pageCount);null!==this._pendingChange&&clearTimeout(this._pendingChange);null===this._lastChange.duration&&(this._lastChange.duration=l.visitedAt-this._lastChange.visitedAt);this._pendingChange=setTimeout(m.bind(function(){var f=this._lastChange;this._lastChange=
l;f.destinationPage=l.page;this._analyticsProcessor.processPageLeft(f);this._pendingChange=null;this._beaconInterval=setInterval(m.bind(this.fireBeacon,this),6E4)},this),5E3)}else null!==this._pendingChange&&(this._lastChange.duration=null,clearTimeout(this._pendingChange),this._pendingChange=null)};h.prototype.fireBeacon=function(){this._analyticsProcessor.processPageBeacon({page:this._lastChange.page,totalPageCount:this._pageCount})}})(r.analytics,_);(function(q,m,p,h,n){function l(a,e){this._url=
a;this._acceptedEvents=[];this._storage=null!==e?new f(e):new b;this._trackSession=m.UUID.generate();this._repeatSyncTimer=null}function f(a){this._storage=a}function b(){this._data=[]}q.AnalyticsProcessor=l;l.prototype.setAcceptedEvents=function(a){this._acceptedEvents=a};l.prototype.init=function(){this._restoreSync()};l.prototype.processPageLeft=function(a){h.debug("[AnalyticsProcessor] page-left ",a.page,a.duration,"=>",a.destinationPage);this._notifyServer(this._trackSession,"page-left",a,!1)};
l.prototype.processPageBeacon=function(a){h.debug("[AnalyticsProcessor] page-beacon ",a.page);this._notifyServer(this._trackSession,"page-beacon",a,!0)};l.prototype.processViewerOpened=function(){h.debug("[AnalyticsProcessor] viewer-opened ");this._notifyServer(this._trackSession,"viewer-opened",null,!0)};l.prototype._notifyServer=function(a,b,f,c){a={time:Date.now(),trackId:a,eventName:b,data:f};this._postEvents([a],!0,c)};l.prototype._handleFailedNotification=function(a){var b=this;this._storage.add(a).then(function(){b._repeatSync()})};
l.prototype._postEvents=function(a,b,f){var c=a;a=_.filter(a,function(a){return-1!==this._acceptedEvents.indexOf(a.eventName)},this);var g=new p.Completer;if(0!==a.length)if(null!==this._repeatSyncTimer&&b)h.debug("[AnalyticsProcessor] _postEvents buffering mode"),this._handleFailedNotification(a),_.defer(function(){g.complete()});else{var d=this;n.ajax({type:"POST",url:this._url,data:JSON.stringify(a),dataType:"json"}).success(function(){g.complete()}).fail(function(b){f||d._handleFailedNotification(a);
g.fail(b)})}else 0!==c.length&&h.debug("[AnalyticsProcessor] all events were filtered out"),_.defer(function(){g.complete()});return g.future};l.prototype._restoreSync=function(){null!==this._repeatSyncTimer&&clearTimeout(this._repeatSyncTimer);this._repeatSyncTimer=null;var a=this;this._storage.getAndRemove().then(function(b){0!==b.length&&a._postEvents(b,!1,!0).then(function(){a._restoreSync()})})};l.prototype._repeatSync=function(){null===this._repeatSyncTimer&&(this._repeatSyncTimer=setTimeout(_.bind(this._restoreSync,
this),3E4))};f.prototype.add=function(a){var b=new p.Completer;this._storage.transaction(function(f){_.each(a,function(a){f.put(a)});f.future.chainSuccess(b).chainError(b)});return b.future};f.prototype.getAndRemove=function(){var a=new p.Completer;this._storage.transaction(function(b){b.getAll().then(function(f){0!==f.length&&(f.sort(function(a,b){return a.time<b.time?-1:a.time>b.time?1:0}),_.each(f,function(a){b.remove(a.rowid)}));a.complete(f)});b.future.chainError(a)});return a.future};b.prototype.add=
function(a){var b=new p.Completer,f=this;p.callDefered(function(){_.each(a,function(a){f._data.push(a)});b.complete()});return b.future};b.prototype.getAndRemove=function(){var a=new p.Completer,b=this;p.callDefered(function(){var f=b._data;b._data=[];a.complete(f)});return a.future}})(r.analytics,r.analytics,r.async,r.log,jQuery);(function(q,m){function p(h,n){this._containerWidget=h;this._direction=n;this._counter=0;this._sidePanel=new m.SideToolbar}q.SideToolbarCountedGuard=function(h){this.left=
new p(h,"left");this.right=new p(h,"right");this.bottom=new p(h,"bottom")};p.prototype={incRef:function(){0==this._counter&&(this._containerWidget.layoutManager[this._direction]=this._containerWidget.add(this._sidePanel));++this._counter;return this._sidePanel},decRef:function(){--this._counter;if(0>this._counter)throw this._counter=0,Error("Unable to decRef! The count does not match");0===this._counter&&(this._containerWidget.remove(this._sidePanel),this._containerWidget.layoutManager[this._direction]=
null);return this._sidePanel}}})(r.viewer,r.ui);(function(q){function m(h){this.el=h}var p=document.documentElement,h=p.webkitRequestFullscreen||p.mozRequestFullScreen||p.requestFullscreen;h&&(h=_.bind(h,p));q.FullScreenController=m;q.isFullScreenSupported=!!h;m.prototype.requestFullScreen=function(){if(q.isFullScreenSupported){var h=this.el;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():
document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen(h):document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen(h):document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen(h):document.documentElement.webkitRequestFullscreen&&
document.documentElement.webkitRequestFullscreen(h)}else throw Error("FullScreen API is not supported!");}})(r.utils);(function(q,m,p,h,n,l){function f(){this.annotationsRelatedInstances=this.serviceCaller=this.dynamicEnv=null;var b=new p.TextFlowRectangleStorage,a=new p.GlyphsToRectanglesProcessorFactory(b),e=new p.RectangleStorage,f=new p.RectangleStorage,c=new p.LinkRectangleProcessorFactory(e,f),g=this._uiLoop=new n.UILoop({}),d=this._root=new n.RootContainerWidget(this._uiLoop),l=d.layoutManager=
new n.BasicLayoutManager(d),q=this.sideToolbars=new p.SideToolbarCountedGuard(d),r=this.viewer=new p.DocumentViewer({layers:[a.getInstance,c.getInstance]}),c=this.cursorModel=new p.CursorModel;new p.CursorView(r,this.cursorModel);var a=this._textSelectionModel=new p.TextSelectionModel,A=this._textSelectionController=new p.TextSelectionController(b,r,a);r.textSelectionModel=a;r.textSelectionController=A;new p.events.PinchToZoom(r);new p.events.JoystickScroll(r);new p.events.MouseScrollbar(r);new p.events.TouchTextSelection(r,
A,a,4);new p.events.TouchScrollbar(r);new p.events.TouchScroll(r);new p.events.MouseTextSelection(r,A);new p.events.MouseWheelScroll(r);new p.events.KeyScroll(r);l.center=d.add(r);new p.LinkController(e,f,r,c);var e=new p.SearchModel,b=new p.SearchController(e,b,r),z=new p.MenuItemsModel,f=[{id:"search",title:"Search",icon:"<i class='fa fa-search'></i>"}];if(h.isFullScreenSupported){f.push({id:"request-fullscreen",title:"Fullscreen",icon:"<i class='fa fa-arrows-alt'></i>",priority:-1,toolHidden:3});
var D=new h.FullScreenController(d.el);z.on("action:request-fullscreen",function(){d.broadcastEvent("action:HideToolsMenu");D.requestFullScreen()})}z.set("defaultChoices",f);this.toolbar=new p.Toolbar(r,{controller:b,model:e},z);if(h.isFullScreenSupported)$('<button class="btn" title="Fullscreen" type="button"><i class="fa fa-arrows-alt"></i></button>').appendTo(this.toolbar.scaleControls.$el).on("tap click",function(){z.trigger("action:request-fullscreen")});var E=new p.SearchControls(b,e,r);d.add(E);
z.on("action:search",function(){d.broadcastEvent("action:HideToolsMenu");E.searchClicked()});l.top=d.add(this.toolbar);l=this.watermarksModel=new p.WatermarksModel;r.addCanvasLayer(new p.RectangleRendererLayer(e,"result","changed"));r.addCanvasLayer(new p.RectangleRendererLayer(a,"selection","changed"));r.addCanvasLayer(new p.RectangleRendererLayer(a,"queryRect"));r.addCanvasLayer(new p.WatermarksLayer(r,l));r.addCanvasLayer(new p.TextSelectionTouchHandlesLayer(a,4));r.initUI();m.is_mobile&&r.changeDocumentRenderer(p.CanvasDocumentRenderer);
r.on("document:detached",function(a){setTimeout(function(){a.destroy()},0)});r.on("document:attached",function(a){a.on("document-outline:loaded",function(a){function b(a,c){d.setVisiblePages(c)}var c=q.left.incRef(),d=new p.BookmarksListModel(a),e=c.addPanel(new p.BookmarksPanel(d),3);r.on("change:viewport",b);r.on("document:detached",function O(){q.left.decRef().removePanel(e);r.off("document:detached",O);r.off("change:viewport",b)})});a.on("page:loaded",function x(b,c,d){g.trigger("initialPageLoaded",
a);a.off("page:loaded",x)})});this._uiLoop.on("viewer:focused",function(){setTimeout(function(){r.broadcastEvent("action:ClosePanelIfDetached")},0)});this._copyFakeView=null;new p.PageSaver(r)}q.WebViewerUI=f;f.prototype={get eventHub(){return this._uiLoop},get el(){return this._root.el},get textCopyEnabled(){return null!==this._copyFakeView},set textCopyEnabled(b){b&&!this.textCopyEnabled?this._copyFakeView=new p.CopyFakeView(this.viewer,this._textSelectionModel,this._textSelectionController):!b&&
this.textCopyEnabled&&(this._copyFakeView.destroy(),this._copyFakeView=null)},get annotationsEnabled(){return null!==this.annotationsRelatedInstances},set annotationsEnabled(b){this.annotationsEnabled&&!b?this.destroyAnnotations():!this.annotationsEnabled&&b&&this.initAnnotations()},destroy:function(){this.viewer.destroy();this._root.destroy();this._uiLoop.destroy();var b=this.el.parentElement;null!==b&&b.removeChild(this.el)},executeAction:function(b){this._root.broadcastEvent("action:"+b)},showToolsMenu:function(){this.executeAction("ShowToolsMenu")},
hideToolsMenu:function(){this.executeAction("HideToolsMenu")},downloadCurrentDocument:function(){this.executeAction("DownloadCurrentDocument")},updateUiAfterDomChange:function(){this._root.refresh()},showDismissBox:function(){for(var b=[this.viewer],a=0,e=arguments.length;a<e;++a)b.push(arguments[a]);return p.showDismissBox.apply(this,b)},destroyAnnotations:function(){null!==this.annotationsRelatedInstances&&(_.each(this.annotationsRelatedInstances,function(b){"destroy"in b&&b.destroy();"off"in b&&
b.off()}),_.each(this,function(b,a){-1!==this.annotationsRelatedInstances.indexOf(b)&&(this[a]=null)},this),this.sideToolbars.left.decRef());this.annotationsRelatedInstances=null},initAnnotations:function(){function b(){this.viewer.textSelectionController.finish();this.annotationController.activate("texthighlight",this.annotationControllerModel.get("colorSelectorModel"));this.annotationController.deactivate()}function a(){c.isOpenDetached()?c.closePanelIfDetached():q.select(null)}function e(a,b){setTimeout(_.bind(function(){!E&&
b?this.viewer.textSelectionModel.get("mode")===this.viewer.textSelectionModel.MODE.TOUCH&&(this.toolbar.showActionBar(D),E=!0):E&&!b&&(this.toolbar.showStatusView(),E=!1)},this),0)}function f(){c.broadcastEvent("action:ClosePanelIfDetached")}var c=this.sideToolbars.left.incRef(),g=this.annotationsRelatedInstances=[],d=this.annotationsModel=new h.HistoryModel(new p.AnnotationsModel);g.push(d);var q=new p.AnnotationSelectionModel;g.push(q);this.annotationControllerModel=new p.AnnotationsControlerModel(null,
this.viewer.textSelectionModel);g.push(this.annotationControllerModel);this.annotationController=new p.AnnotationsController(this.viewer,this.annotationControllerModel,this.annotationsModel);g.push(this.annotationController);this.annotationControllerModel.annotationsController=this.annotationController;g.push(new p.NotesInteractionController(this.viewer,this.annotationsModel,q,this.annotationController,this.cursorModel));var r=new p.AnnotationsLayerView(this.annotationsModel,this.viewer,q);this.viewer.addCanvasLayer(r);
g.push(r);g.push({destroy:_.bind(function(){this.viewer.removeCanvasLayer(r)},this)});g.push(new p.AnnotationsActionCursorView(this.viewer,this.annotationControllerModel,this.cursorModel));var v=[],A=new p.HighlightPanel(this.annotationController,this.annotationControllerModel);v.push(c.addPanel(A));v.push(c.addPanel(new p.NotesPanel(this.annotationController,this.annotationControllerModel,this.annotationsModel,q)));g.push({destroy:function(){_.each(v,function(a){c.removePanel(a)})}});var z=n.ContainerWidget.prototype.add.call(c.toolbar,
new p.HistoryControls(d));z.dim=z.dim;g.push({destroy:function(){c.toolbar.remove(z)}});var D=new m.viewer.SelectedTextActionBar,E=!1;this.viewer.textSelectionModel.on("changed",e,this);this._uiLoop.on("viewer:focused",a,this);this._uiLoop.on("action:text-selection-done",this.viewer.textSelectionController.cancelSelection,this.viewer.textSelectionController);this._uiLoop.on("action:text-selection-highlight",b,this);g.push({destroy:_.bind(function(){this.viewer.textSelectionModel.off("changed",e,this);
this._uiLoop.off("viewer:focused",a,this);this._uiLoop.off("action:text-selection-done",this.viewer.textSelectionController.cancelSelection,this.viewer.textSelectionController);this._uiLoop.off("action:text-selection-highlight",b,this)},this)});this.annotationControllerModel.on("change:activatedAction",function(a,b){null!==q.get("selected")&&null!==b&&q.select(null)},this);this.annotationControllerModel.on("click:toolSelection",f);this.annotationControllerModel.get("colorSelectorModel").on("click:colorSelection",
f);q.on("change:selected",function(a,b){null!==b&&this.annotationController.deactivate()},this);if(A=this.serviceCaller){var u=window.location.pathname;this.dynamicEnv?u=this.dynamicEnv.getDbContextId():l.warn("Set dynamicEnv property on WebViewerUI object instance to enable annotation synchronization.");d=new p.AnnotationServiceSync(d,A,u);g.push(d);d.on("error:sync",function(){},this).on("model:refresh",function(){this.dynamicEnv&&this.dynamicEnv.refresh("Annotation.describe")},this).on("model:synced",
function(a){this.dynamicEnv&&this.dynamicEnv.store("Annotation.describe",a).then(function(){l.debug("annotations saved")})},this);this.annotationsSync=d;this._root.layoutManager.center.add(new n.SyncDisplay(d))}else l.warn("Set serviceCaller property on WebViewerUI object instance to enable annotation synchronization.")}}})(r.viewer,r,r.viewer,r.utils,r.ui,r.log);(function(q){function m(m){if(_.isFunction(m)||"refresh"===m||0===m.indexOf("redirect:"))return m;r.log.warn("specified action is not supported! ("+
m+")");return null}q.validateServerActions=function(p){_.each(p,function(h,n){p[n]=m(h)});return p};q.validateServerAction=m;q.executeAction=function(m,h,n){m=h?h[n]||m:m;_.isFunction(m)?m(n):"refresh"===m?window.location.reload():0===m.indexOf("redirect:")&&(n=m.substring(9,m.length),window.location=n)}})(r.actions);(function(q,m,p,h,n,l){function f(b,a){this._viewerUI=b;this._alwaysTreatHttp404AsError=!!a.alwaysTreatHttp404AsError;this._defaultActionForServerError=m.validateServerAction(a.defaultActionForServerError||
"refresh");this._expiredDocumentDeletedAction=m.validateServerAction(a.expiredDocumentDeletedAction||"refresh");this._actionsForServerErrors=m.validateServerActions(_.isObject(a.actionsForServerErrors)?actionsForServerErrors:{});this._globalErrorHandler=_.isFunction(a.globalServerErrorHandler)?a.globalServerErrorHandler:function(){return!1};this._errorBox=this._fileSystemContext=null;this._fileSystemEventGuard=new h.EventLifecycleManager;this._documentEventGuard=new h.EventLifecycleManager;this._documentModel=
null;this._wasChanged=this._wasDownloaded=!1}q.ExceptionHandler=f;f.prototype={bindFileSystemContext:function(b){this.unBindFileSystemContext();this._fileSystemContext=b;this._fileSystemEventGuard.on(b,"fileSystem:error",this.onServerError,this).on(b,"fileSystem:changed",this.onFileSystemChanged,this)},unBindFileSystemContext:function(){null!==this._fileSystemContext&&(this._fileSystemEventGuard.offAll(),this._fileSystemContext.destroy(),this._fileSystemContext=null)},bindDocumentModel:function(b){this.unBindDocumentModel();
this._documentModel=b;this._documentEventGuard.on(b,"loading:error",this.onDocumentLoadingFailed,this).on(b,"info:loaded",this.onInfoLoaded,this).on(b,"offline-invalidated",this.onOfflineStorageInvalidated,this)},unBindDocumentModel:function(){this._documentEventGuard.offAll();this._documentModel=null},onDocumentLoadingFailed:function(b){if(2===b)this.onServerError(b)},onServerError:function(b,a){switch(b){case "init":this._displayErrorBox(a);break;case "server":this._globalErrorHandler(a)||(404==
a&&this._alwaysTreatHttp404AsError?this._displayErrorBox(a):404!==a&&0!==a?(401!=a&&403!=a&&409!=a||this._eraseLocalStorage(),this._displayErrorBox(a)):this._displayErrorIfDocumentIsAvailableOffline(a));break;case "package":this._displayErrorBox(a);break;default:this._displayErrorBox(b+"-"+a)}},_eraseLocalStorage:function(){l.eraseLocalData(Date.now(),function(){},function(){})},_displayErrorIfDocumentIsAvailableOffline:function(b){if(null===this._errorBox)var a=this,e=this._fileSystemContext.cacheManager.openCache(this._fileSystemContext.url,
function(){e.downloadState!==n.CACHE_STATE.DOWNLOADED&&a._displayErrorBox(b)},function(){a._displayErrorBox(b)})},_displayErrorBox:function(b){if(null===this._errorBox){var a=this;(this._errorBox=this._viewerUI.showDismissBox(403===b?"info":"error",p._TG("server-error-message-title",[b]),p._TG("server-error-message",[b]),{buttons:[{id:"close",title:p._TG("server-error-button-title",[b]),cssClass:"btn-primary"}]})).on("button:close",function(){a._errorBox=null;m.executeAction(a._defaultActionForServerError,
a._actionsForServerErrors,b)})}},onKeyDerivationError:function(){this._displayErrorBox("key-derivation")},onFileSystemChanged:function(b){if(!this._wasChanged)if(this._wasDownloaded=this._fileSystemContext.tryToGetDownloaded(),"package"===b)this._wasChanged=!0,this._documentModel.trigger("reload-requested");else if("cache-verification"===b&&this._wasDownloaded)this.onDocumentChanged(!0)},onInfoLoaded:function(){this._wasChanged&&(this._wasChanged=!1,this.onDocumentChanged(this._wasDownloaded),this._wasDownloaded=
!1)},onDocumentChanged:function(b){if(b){var a=this._viewerUI.showDismissBox("warn",p._T("message-document-updated-title"),p._T("message-document-updated-previous-copy-deleted"),{buttons:[{id:"close",title:p._T("document-updated-dont-save-button")},{id:"save",title:p._T("document-updated-save-button"),cssClass:"btn-primary"}]}),e=this;a.on("button:save",function(b){b.preventDefault();a.hide();e._viewerUI.downloadCurrentDocument()})}else this._viewerUI.showDismissBox("warn",p._T("message-document-updated-title"),
p._T("message-document-updated"))},onOfflineStorageInvalidated:function(b){if(b){var a=this._expiredDocumentDeletedAction;b=this._viewerUI.showDismissBox("info",p._T("web-viewer-deleted-expired-document-title"),p._T("web-viewer-deleted-expired-document"),{buttons:[{id:"close",title:p._T("web-viewer-deleted-expired-document-button"),cssClass:"btn-primary"}]});var e=this;b.on("button:close",function(){e._errorBox=null;m.executeAction(a)});this._errorBox=b}},onApplicationUpdated:function(){this._viewerUI.showDismissBox("info",
p._T("web-viewer-updated-title"),p._T("web-viewer-updated"),{buttons:[{id:"close",title:p._T("web-viewer-updated-button"),cssClass:"btn-primary"}]}).on("button:close",function(){window.location.reload()})}}})(r.viewer,r.actions,r.i18n,r.ui,r.io,r.utils.asyncStorage);(function(q,m,p){function h(h,l){this._exceptionHandler=h;this._globalEventHub=l;this._pwdAttempt=0;this.password=null}q.PasswordProvider=h;h.prototype.requestNewPassword=function(h){var l=this;this.password=null;0!==this._pwdAttempt&&
this.trigger("invalidPassword");this._globalEventHub.trigger("documentPasswordRequested",function(f){l.setCurrentPwd(f);h(f)},this._pwdAttempt++)};h.prototype.reportKeyDerivationError=function(h){this._exceptionHandler.onKeyDerivationError(h)};h.prototype.setCurrentPwd=function(h){this.password=h;this.trigger("passwordEntered",h)};p.extend(h.prototype,m.Events)})(r.viewer,Backbone,_);(function(q,m,p,h,n){function l(d,h){var l;function n(){clearTimeout(T);T=setTimeout(q,0)}function q(){m.log.debug("safeInit");
var a=null,a=Q.has("documentUrl")?[{service:"Document",action:"describe",model:{set:D},optional:!1,updateEvent:"DOCUMENT:SETTINGS_CHANGED",remoteErrorHandler:function(a){w.onServerError("server",a)}},{service:"Document",action:"getWatermarks",model:{set:function(a){B.setWatermarks(a)}},optional:!0,updateEvent:"WATERMARK:CHANGED"},{service:"Event",action:"subscribe",model:{set:function(a){M.init(a)}},optional:!0},{service:"Annotation",action:"describe",model:{set:function(a){null!==a&&u.annotationsEnabled&&
u.annotationsSync.replaceModel(a)}},optional:!0,updateEvent:"ANNOTATION:CHANGED",store:!0}]:[{service:"Event",action:"subscribe",model:{set:function(a){M.init(a)}},optional:!0}];H&&H.destroy();H=new m.viewer.DynamicEnvironment(window.location.toString(),a,L,M,Q);u.dynamicEnv=H;l=Q.get("documentUrl");Q.has("documentId")&&Q.get("documentId");H.init().then(function(){l&&l===Q.get("documentUrl")?(R(p.extend(Q.toJSON(),K.toJSON())),E.complete()):Q.has("documentUrl")||(S(),E.complete());K.trigger("dynamicEnv:initialized",
H)}).catchError(function(a){K.set("offlineExpiryDate","1970-01-01T00:00:00");R(p.extend(Q.toJSON(),K.toJSON()));m.log.warn("Unable to contact webviewer service. Safe mode is active.");w.onDocumentLoadingFailed(a);E.fail()})}function r(a){Q.set(p.pick(a,p.keys(c.prototype.defaults)));K.set(p.pick(a,p.keys(g.prototype.defaults)))}function D(a){delete a.rsaModulus;delete a.rsaExponent;delete a.communicationUrl;delete a.documentUrl;r(a);F=p.pick(a,x);C&&Q.has("documentUrl")&&I===Q.get("documentUrl")&&
C.setDocumentInfo(F);Y(F)}document.body.style.overflow="hidden";var E=new m.service.Completer;E.future.then(p.bind(function(){this.trigger("initialized",this)},this)).catchError(p.bind(function(){this.trigger("initialization-failed",this)},this));var u=new k.WebViewerUI,w=new k.ExceptionHandler(u,h);p.isNumber(h.loggingLevel)&&m.log.setLevel(h.loggingLevel);u._uiLoop.on("initialPageLoaded",function(){this.trigger("initialPageLoaded")},this);b(d,u.el);var x=["title","author","publisher"];p.isArray(h.documentInfoFields)&&
x.push.apply(x,h.documentInfoFields);var G=u.viewer;h.analyticsUrl&&e(G,h.analyticsUrl);var B=u.watermarksModel,C=null,I=null,N=null,Q=new c,K=new g,F=a(h),L=null;l=void 0;var H=null;(function(a,b){m.actions.validateServerAction(b.defaultActionForServerError||"refresh");m.actions.validateServerAction(b.expiredDocumentDeletedAction||"refresh");var c=m.actions.validateServerActions(p.isObject(b.actionsForServerErrors)?c:{});window.applicationCache&&applicationCache.addEventListener("updateready",p.bind(w.onApplicationUpdated,
w));this.destroy=function(){H&&H.destroy();G&&G.destroy();viewerDOM&&viewerDOM.remove();M&&M.destroy();M=H=G=viewerDOM=null;for(var a in this)delete this[a]};this.setToolsHook=function(a){u.eventHub.on("ToolsMenuChange",a)};this.onAction=function(a,b){u.eventHub.on("action:"+a,b)};this.offAction=function(a,b){u.eventHub.off("action:"+a,b)};this.refreshTools=function(){u.eventHub.trigger("menuRefreshRequested")};this.closeDocument=function(){C=I=null;G.dettachDocument()};this.loadDocument=function U(a){u.hideToolsMenu();
var b=new m.io.CachableFileSystemContext(a.documentUrl);b.passwordProvider=new k.PasswordProvider(w,this);"cacheEnabled"in a&&(b.cacheEnabled=a.cacheEnabled);"encryptionKey"in a&&(b.encryptionKey=a.encryptionKey);var c=new m.io.CachableFileSystem(b),d=new k.VitriumDocumentModel(c,b);d.setDocumentInfo(F);var e=p.bind(function(){d.off("reload-requested",e);U.call(this,a)},this);clearInterval(N);N=setInterval(function(){c.checkForChanges()},62E3);d.on("reload-requested",e);I=a.documentUrl;C=d;G.attachDocument(d);
w.bindFileSystemContext(b);w.bindDocumentModel(d);var f=a.page;if(f)d.on("info:loaded",function(a){a=Math.min(a.pages.length-1,Math.max(f-1,0));G.scrollTo(a)});c.init().then(function(){d.load()})};this.getWatermarks=function(){return B.getWatermarks()};this.setWatermarks=function(a){B.setWatermarks(a)};this.showToolsMenu=function(){u.showToolsMenu()};this.showModalDialogBox=function(a){return u.showDismissBox(a.type||"info",a.title,a.content,a)};this.getSavedDocumentCount=function(a){function b(){a(0)}
if(p.isFunction(a)){var c=m.io.CachableFileSystemContext.getCacheManager();c.init().then(function(){c.getOfflineDownloadedDocumentsCount(a,b)}).catchError(b)}};this.eraseStorage=function(a){m.utils.asyncStorage.eraseLocalData(Date.now(),a,a)};this.updateUiAfterDomChange=function(){u.updateUiAfterDomChange()}}).call(this,d,h);var R=p.bind(this.loadDocument,this),T=0,S=p.bind(function(){G.initDocumentRenderer();this.showToolsMenu()},this),M=null;K.on("change:copyEnabled",function(a,b){u.textCopyEnabled=
b});r(h);K.on("change",p.bind(function(){setTimeout(p.bind(function(){this.trigger("envChanged",K.toJSON())},this),0)},this));var Y=p.bind(function(a){this.trigger("infoChanged",a)},this);new m.viewer.OfflineStorageGuard(K,G);if(K.has("communicationUrl")){Q.on("change:documentUrl",n);this.loadDocument=function(a){Q.set(p.pick(a,p.keys(c.prototype.defaults)))};K.has("rsaModulus")&&K.has("rsaExponent")&&new m.crypto.SignatureCalulator(K.get("rsaModulus"),K.get("rsaExponent"));L=m.viewer.createRestCompatibleServiceCaller(K.get("communicationUrl"));
u.serviceCaller=L;K.on("change:annotationsEnabled",function(a,b){!K.has("communicationUrl")&&b?m.log.error("Communications URL must be set to enable annotations!"):(u.annotationsEnabled=b)&&null!==H&&H.refresh("Annotation.describe")});var aa=!1;K.on("change:analyticsEvents",function(a,b){function c(){G.analyticsProcessor.setAcceptedEvents(p.isArray(b)?b:[]);aa||(G.analyticsProcessor.init(),aa=!0,G.analyticsProcessor.processViewerOpened())}null!==G.analyticsFuture?G.analyticsFuture.then(c):c()});K.get("annotationsEnabled")&&
K.trigger("change:annotationsEnabled",K,!0);M=new m.viewer.PollAgent(L);f.call(this,G,M);M.on("poll:error",function(a){if(401==a||403==a)w.onServerError("server",a),M.destroy()});q()}else Q.has("documentUrl")?(R(p.extend(Q.toJSON(),K.toJSON())),setTimeout(function(){E.complete()},0)):Q.get("showMenuWhenNoDocument")&&S()}function f(a,b){new k.InteractionChannelHandler(a,b);var c=this.getSavedDocumentCount;b.on("APPLICATION:CLEAR_PRIVATE_DATA_REQUESTED",function(b){if(p.isNumber(b.eraseId)){var e=a.cancelCurrentStorageAction();
c(function(a){(0<a||e)&&viewerUI.showDismissBox("warn",m.i18n._T("message-documents-erased-title"),m.i18n._T("message-documents-erased"))});setTimeout(function(){m.utils.asyncStorage.eraseLocalData(b.eraseId,function(){m.log.info("local data has been erased")},function(){m.log.error("local data has not been erased")})},100)}else m.log.error("APPLICATION:CLEAR_PRIVATE_DATA_REQUESTED must contain the 'eraseId' field.")})}function b(a,b){var c=document.getElementById(a);if(null===c){b.id=a;var c=document.body,
e=c.firstChild;null===e?c.appendChild(b):c.insertBefore(b,e)}else c.appendChild(b)}function a(a){var b={};p.each(a,function(a,c){"documentTitle"===c?b.title=a:"documentAuthor"===c?b.author=a:"documentPublisher"===c&&(b.publisher=a)});return b}function e(a,b){function c(e){a.analyticsFuture=null;e=a.analyticsProcessor=new m.analytics.AnalyticsProcessor(b,e);new m.analytics.PageLeftCalculator(a,e)}a.analyticsFuture=m.utils.ObjectDatabase.open(b).then(c).catchError(function(){c(null)})}q.WebViewer=l;
var k=m.viewer,c=h.Model.extend({defaults:{lang:"en-US",documentUrl:null,documentId:null,documentObject:null,encryptionKey:null}}),g=h.Model.extend({defaults:{cacheEnabled:!1,communicationUrl:null,rsaModulus:null,rsaExponent:null,offlineExpiryDate:null,copyEnabled:!1,annotationsEnabled:!1,printEnabled:!1,analyticsEvents:null}});p.extend(l.prototype,h.Events);l.checkBrowserSupport=function(a){var b=a.success;a=a.error;if(!b||!a)throw Error("You have to provide a success callback and an error callback");
m.require(["canvas-woff-support"],b,a)}})(I,r,_,Backbone,jQuery);(function(q,m,p){q.openDocument=function(h,n,l,f){h=new r.io.CachableFileSystemContext(h);f&&(h.passwordProvider=f,h.encryptionKey=f.encryptionKey);f=new r.io.CachableFileSystem(h);var b=new m.VitriumDocumentModel(f,h);b.on("loading:error",l);b.on("server:error",l);b.on("change:documentInfo",function(){n({info:b.info,renderPageToCanvas:function(a,e,f,c){function g(d){(new m.PageRenderer(b,b.fileProvider(),[])).renderPage(a,f,e,b.info.pages[e],
d,!1);c(a,e)}var d=!1,h=null;b.on("page-fonts:initialized",function v(a){if(d=a[e])b.off("page-fonts:initialized",v),h&&g(h)});b.on("page:loaded",function A(a,c,e){this.idx===a&&"IMG"!==c.tagName&&(b.off("page:loaded",A,this),h=c,d&&g(h))},{idx:e});b.requestPage(e)},loadPageTextContent:function(a){var e=new p.Completer;b.on("textindex:loaded",function(a,c){if(a==this.idx)if(b.off("textindex:loaded",null,this),"no-text"===c)e.complete("");else for(var f=c[0].data,d=0,h=f.length;d!==h;++d){var l=f[d];
if(parseInt(l.page,10)-1===this.idx){e.complete(l.text);break}}},{idx:a});b.requestTextIndexFileForPage(a);return e.future}})});f.init().then(function(){b.load()})}})(r.easy,r.viewer,r.async);(function(q,m,p,h){function n(b,a){this._controller=a;this._model=b;b.on("change:state",this.onStateChanged,this);b.on("change:pageImage",this.onPageImageChanged,this);this._initUi()}function l(){this.lastState=this.state=null;this.pageCount=this.pageIdx=0;this.pageContent="";this.pageImage=null}function f(b,
a){this._model=b;this._doc=null;this._passwordProvider=a}q.AriaView=n;q.AriaModel=l;q.AriaController=f;n.prototype._initUi=function(){this.$el=$("<div>");this.$toolbar=$("<div id='toolbar' aria-controls='page-content'></div>").appendTo(this.$el);this.$status=$("<div id='status' aria-live='polite'></div>").appendTo(this.$el);this.$pageContent=$("<div id='page-content' aria-live='polite'></div>").appendTo($("<div id='page-wrapper'></div>").appendTo(this.$el));this.$pageImage=$("<div id='page-image'></div>").appendTo(this.$el)};
n.prototype.onPageImageChanged=function(){this.$pageImage.empty().append(this._model.pageImage)};n.prototype.onStateChanged=function(){switch(this._model.state){case 0:this.$toolbar.empty();this.$pageContent.empty();this.setStatusText("The document is loading.");break;case 1:0==this._model.lastState?($("<button type='button' class='btn'>Previous page</button>").click(h.bind(this._controller.prevPage,this._controller)).appendTo(this.$toolbar),$("<button type='button' class='btn'>Next page</button>").click(h.bind(this._controller.nextPage,
this._controller)).appendTo(this.$toolbar).focus(),this.setStatusText("The document contains "+this._model.pageCount+" pages. The page 1 is loading.")):this.setStatusText("The page "+(this._model.pageIdx+1)+" is requested.");this.$pageContent.empty();break;case 2:this.setStatusText("The page "+(this._model.pageIdx+1)+" is loaded.");this.$pageContent.empty().append(this._model.pageContent);break;case 3:var b="The loading of a page has failed!";0==this._model.lastState&&(b="The loading of a document has failed!");
this.setStatusText(b)}};n.prototype.setStatusText=function(b){this.$status.empty().append($("<p>").text(b))};h.extend(l.prototype,p.Events);l.prototype.updateState=function(b){this.lastState=this.state;this.state=b;this.trigger("change:state")};l.prototype.updatePageImage=function(b){this.pageImage=b;this.trigger("change:pageImage")};f.prototype.loadDocument=function(b){this._model.updateState(0);m.openDocument(b,h.bind(function(a){this._doc=a;this._model.pageCount=a.info.pages.length;this.loadPage(0)},
this),h.bind(this.onError,this),this._passwordProvider)};f.prototype.loadPage=function(b){this._model.pageIdx=b;this._model.pageContent="";this._model.updateState(1);this._doc.loadPageTextContent(b).then(h.bind(function(a){this._model.pageContent=$("<p>").text(a).append("<p>End of page</p>");this._model.updateState(2)},this)).error(h.bind(this.onError,this));var a=document.createElement("canvas"),e=this._doc.info.pages[b];a.width=e.width|0;a.height=e.height|0;this._doc.renderPageToCanvas(a,b,1,h.bind(function(){this._model.updatePageImage(a)},
this))};f.prototype.nextPage=function(){var b=Math.min(this._model.pageIdx+1,this._model.pageCount-1);b!==this._model.pageIdx&&this.loadPage(b)};f.prototype.prevPage=function(){var b=Math.max(this._model.pageIdx-1,0);b!==this._model.pageIdx&&this.loadPage(b)};f.prototype.onError=function(){this._model.updateState(3)}})(r.aria,r.easy,Backbone,_);(function(q){q.major=1;q.minor=1;q.build=412;q.buildTime="2016-09-22T17:13:45.214000";q.toString=function(){return this.major+"."+this.minor+"."+this.build}})(r.viewer.version);
I.vitrium={};_.extend(I.vitrium,{i18n:r.i18n});_.extend(I.vitrium,{crypto:r.crypto});_.extend(I.vitrium,{codec:r.codec});_.extend(I.vitrium,{aria:r.aria});_.extend(I.vitrium,{log:r.log})}).call(this,this);
